(self.webpackChunkkoku_ui=self.webpackChunkkoku_ui||[]).push([[1918],{95371:(e,t,r)=>{"use strict";r.d(t,{qV:()=>s,WB:()=>n,WK:()=>i});var a=r(45997);const s=e=>{let t;for(const r of Object.keys(e.group_by)){const e=r.indexOf(a.P);if(-1!==e){t=r.substring(e+a.P.length);break}}return t},n=(e,t,r)=>{const a=Object.assign({},JSON.parse(JSON.stringify(e)));if("*"!==r||"*"!==a.group_by[t]){if(a.filter_by[t]){let e=!1;const s=a.filter_by[t];if(Array.isArray(s)){for(const t of s)if(t===r){e=!0;break}}else e=r===a.filter_by[t];e||(a.filter_by[t]=[a.filter_by[t],r])}else a.filter_by[t]=[r];return a}},i=(e,t,r)=>{const a=Object.assign({},JSON.parse(JSON.stringify(e)));if(null===t)a.filter_by=void 0;else if(null===r)a.filter_by[t]=void 0;else if(Array.isArray(a.filter_by[t])){const s=a.filter_by[t].indexOf(r);s>-1&&(a.filter_by[t]=[...e.filter_by[t].slice(0,s),...e.filter_by[t].slice(s+1)])}else a.filter_by[t]=void 0;return a}},44633:(e,t,r)=>{"use strict";r.d(t,{e:()=>d});var a=r(48927),s=r(45997),n=r(38850),i=r(97522),o=r.n(i),l=r(79878),c=r(75699),u=r(55399),p=r(87932);class h extends o().Component{constructor(e){super(e),this.defaultState={isDropdownOpen:!1,isExportModalOpen:!1},this.state=Object.assign({},this.defaultState),this.getExportModal=()=>{const{groupBy:e,item:t,query:r,reportPathsType:a}=this.props,{isExportModalOpen:s}=this.state;return o().createElement(n.X,{groupBy:e,isOpen:s,items:[t],onClose:this.handleExportModalClose,query:r,reportPathsType:a})},this.handleExportModalClose=e=>{this.setState({isExportModalOpen:e})},this.handleExportModalOpen=()=>{this.setState({isExportModalOpen:!0})},this.handleOnSelect=()=>{const{isDropdownOpen:e}=this.state;this.setState({isDropdownOpen:!e})},this.handleOnToggle=e=>{this.setState({isDropdownOpen:e})},this.handleExportModalClose=this.handleExportModalClose.bind(this),this.handleExportModalOpen=this.handleExportModalOpen.bind(this),this.handleOnToggle=this.handleOnToggle.bind(this),this.handleOnSelect=this.handleOnSelect.bind(this)}render(){const{groupBy:e,isDisabled:t,showPriceListOption:r,t:n,redirectToCostModel:i,history:l,item:{source_uuid:c}}=this.props,u=[o().createElement(a.DropdownItem,{component:"button",isDisabled:t,key:"export-action",onClick:this.handleExportModalOpen},n("details.actions.export"))];return r&&u.unshift(o().createElement(a.DropdownItem,{component:"button",key:"price-list-action",isDisabled:t||e.includes(s.P)||0===c.length,onClick:()=>i(c[0],l)},n("details.actions.price_list"))),o().createElement(o().Fragment,null,o().createElement(a.Dropdown,{onSelect:this.handleOnSelect,toggle:o().createElement(a.KebabToggle,{onToggle:this.handleOnToggle}),isOpen:this.state.isDropdownOpen,isPlain:!0,position:"right",dropdownItems:u}),this.getExportModal())}}const d=(0,c.connect)(void 0,{redirectToCostModel:p.F0.redirectToCostModelFromSourceUuid})((0,l.withTranslation)()((0,u.withRouter)(h)))},27166:(e,t,r)=>{"use strict";r.d(t,{Z:()=>J});var a=r(48927),s=r(73466),n=r(13883),i=r(81787),o=r(97522),l=r.n(o),c=r(16679),u=r(98499);const p={content:{paddingBottom:u.ZP.value,paddingLeft:u.ZP.value,paddingRight:u.ZP.value,paddingTop:u.ZP.value}};var h=r(5866),d=r(45997),g=r(16001),m=r(79878),y=r(75699),b=r(94377),v=r(5754),f=r(76821),C=r(23992),_=r(11331),S=r(48196);const T={dataListHeading:{fontWeight:C.ZP.value},groupByHeading:{marginBottom:u.ZP.value},tagLink:{marginLeft:S.ZP.value},tagsContainer:{marginRight:_.ZP.value,marginTop:S.ZP.value}};class E extends l().Component{constructor(){super(...arguments),this.getDataListItems=()=>{const{tagReport:e}=this.props,t=[];if(e)for(const r of e.data)for(const e of r.values){const s=`${r.key}:${e}`;t.push(l().createElement(a.DataListItem,{"aria-labelledby":s,key:`${s}-item`},l().createElement(a.DataListItemRow,null,l().createElement(a.DataListItemCells,{dataListCells:[l().createElement(a.DataListCell,{key:`${s}-cell1`},l().createElement("span",{id:s},r.key)),l().createElement(a.DataListCell,{key:`${s}-cell2`},e)]}))))}return t}}render(){const{filterBy:e,groupBy:t,t:r}=this.props,s=this.getDataListItems();return l().createElement(l().Fragment,null,l().createElement("div",null,l().createElement("span",{style:T.dataListHeading},r(`group_by.values.${t}`))),l().createElement("div",{style:T.groupByHeading},l().createElement("span",null,e)),l().createElement(a.DataList,{"aria-label":"Simple data list example",isCompact:!0},l().createElement(a.DataListItem,{"aria-labelledby":"heading1"},l().createElement(a.DataListItemRow,null,l().createElement(a.DataListItemCells,{dataListCells:[l().createElement(a.DataListCell,{key:"primary content"},l().createElement("span",{id:"heading1",style:T.dataListHeading},r("tag.heading_key"))),l().createElement(a.DataListCell,{key:"secondary content"},l().createElement("span",{id:"heading2",style:T.dataListHeading},r("tag.heading_value")))]}))),s.map((e=>e))))}}const k=(0,m.withTranslation)()((0,y.connect)()(E)),O="tag";class D extends l().Component{constructor(e){super(e),this.getTagValueCount=()=>{const{tagReport:e}=this.props;let t=0;if(e)for(const r of e.data)r.values&&(t+=r.values.length);return t},this.handleClose=()=>{this.props.onClose(!1)},this.handleClose=this.handleClose.bind(this)}componentDidMount(){const{fetchTag:e,queryString:t,tagReportPathsType:r}=this.props;e(r,O,t)}componentDidUpdate(e){const{fetchTag:t,queryString:r,tagReportPathsType:a}=this.props;e.queryString!==r&&t(a,O,r)}shouldComponentUpdate(e){const{filterBy:t,isOpen:r}=this.props;return e.filterBy!==t||e.isOpen!==r}render(){const{filterBy:e,groupBy:t,isOpen:r,tagReport:s,t:n}=this.props;return l().createElement(a.Modal,{isOpen:r,onClose:this.handleClose,title:n("tag.title",{value:this.getTagValueCount()}),width:"50%"},l().createElement(k,{filterBy:e,groupBy:t,tagReport:s}))}}const B=(0,b.X1)(((e,{filterBy:t,groupBy:r,tagReportPathsType:a})=>{const s=(0,d.mB)(location.search),n=(0,d.pm)({filter:Object.assign({[r]:t,resolution:"monthly",time_scope_units:"month",time_scope_value:-1},s.filter.account&&{account:s.filter.account})});return{queryString:n,tagReport:v.ux.selectTag(e,a,O,n),tagReportFetchStatus:v.ux.selectTagFetchStatus(e,a,O,n)}})),w={fetchTag:v.xr.Xt},R=(0,m.withTranslation)()((0,y.connect)(B,w)(D)),x="tag";class P extends l().Component{constructor(e){super(e),this.defaultState={isOpen:!1},this.state=Object.assign({},this.defaultState),this.handleClose=e=>{this.setState({isOpen:e})},this.handleOpen=e=>(this.setState({isOpen:!0}),e.preventDefault(),!1),this.handleClose=this.handleClose.bind(this),this.handleOpen=this.handleOpen.bind(this)}componentDidMount(){const{fetchTag:e,queryString:t,tagReportPathsType:r}=this.props;e(r,x,t)}componentDidUpdate(e){const{fetchTag:t,queryString:r,tagReportPathsType:a}=this.props;e.queryString!==r&&t(a,x,r)}render(){const{filterBy:e,groupBy:t,id:r,tagReport:a,tagReportPathsType:s}=this.props,{isOpen:n}=this.state;let i=0;if(a)for(const e of a.data)e.values&&(i+=e.values.length);return l().createElement("div",{style:T.tagsContainer,id:r},Boolean(i>0)&&l().createElement(l().Fragment,null,l().createElement(g.lO,null),l().createElement("a",Object.assign({},(0,f.g_)(f._q.details.tag_lnk),{href:"#/",onClick:this.handleOpen,style:T.tagLink}),i)),l().createElement(R,{filterBy:e,groupBy:t,isOpen:n,onClose:this.handleClose,tagReportPathsType:s}))}}const V=(0,b.X1)(((e,{filterBy:t,groupBy:r,tagReportPathsType:a})=>{const s=(0,d.mB)(location.search),n=(0,d.pm)({filter:Object.assign({[r]:t,resolution:"monthly",time_scope_units:"month",time_scope_value:-1},s.filter.account&&{account:s.filter.account})});return{filterBy:t,queryString:n,tagReport:v.ux.selectTag(e,a,x,n),tagReportFetchStatus:v.ux.selectTagFetchStatus(e,a,x,n)}})),I={fetchTag:v.xr.Xt},L=(0,m.withTranslation)()((0,y.connect)(V,I)(P));var G=r(55399),M=r(33307),j=r(901),z=r(72892),q=r(50021),F=r(12289),Z=r(54881),$=r(40794),A=r(32412),U=r(57640),N=r(73861);const K={cost:{marginTop:U.ZP.var},costLabel:{marginTop:N.ZP.var},costValue:{marginTop:0,marginBottom:0,textAlign:"right"},costLabelDate:{fontSize:Z.ZP.value,color:q.ZP.var,textAlign:"right"},header:{display:"flex",justifyContent:"space-between",paddingLeft:u.ZP.var,paddingRight:u.ZP.var,paddingTop:u.ZP.var,backgroundColor:z.ZP.var},infoDescription:{color:F.ZP.value,fontSize:$.ZP.value},tabs:{display:"flex"},tag:{marginLeft:u.ZP.var},title:{paddingBottom:u.ZP.var,paddingTop:A.ZP.var}};class W extends l().Component{constructor(){super(...arguments),this.buildDetailsLink=()=>{const{detailsURL:e,groupBy:t,query:r}=this.props;let a=t,s="*";r[d.dV]&&(a=d.dV,s=r[d.dV]);const n=Object.assign(Object.assign({},JSON.parse(JSON.stringify(r))),{group_by:{[a]:s}});return n.filter&&(n.filter.account=void 0,n[d.eG]=void 0,n[d.dV]=void 0,n[d.yG]=void 0),`${e}?${(0,d.IV)(n)}`},this.getGroupByOrg=()=>{const{query:e}=this.props;let t;for(const r of Object.keys(e.group_by))if(r===d.dV){t=e.group_by[d.dV];break}return t},this.getTotalCost=()=>{const{report:e}=this.props,t=e&&e.meta&&e.meta.total&&e.meta.total.cost&&e.meta.total.cost.total;return(0,j.Bw)(t?e.meta.total.cost.total.value:0,t?e.meta.total.cost.total.units:"USD")}}render(){const{description:e,filterBy:t,groupBy:r,query:s,t:n,tabs:i,tagReportPathsType:o,title:c}=this.props,u=s&&s.filter?s.filter.account:void 0,p=this.getGroupByOrg(),g=u||"account"===r||"project"===r||"subscription_guid"===r,m=r||(u?"account":p?d.dV:void 0);return l().createElement("header",{style:K.header},l().createElement("div",null,l().createElement("nav",{"aria-label":"breadcrumb",className:"breadcrumbOverride"},l().createElement("ol",{className:"pf-c-breadcrumb__list"},l().createElement("li",{className:"pf-c-breadcrumb__item"},l().createElement("span",{className:"pf-c-breadcrumb__item-divider"},l().createElement(h.fP,null)),l().createElement(G.Link,{to:this.buildDetailsLink()},n("breakdown.back_to_details",{groupBy:m,value:o}))))),l().createElement(a.Title,{headingLevel:"h2",style:K.title,size:"2xl"},n("breakdown.title",{value:c}),e&&l().createElement("div",{style:K.infoDescription},e)),l().createElement("div",{style:K.tabs},i,l().createElement("div",{style:K.tag},Boolean(g)&&l().createElement(L,{filterBy:t,groupBy:m,id:"tags",tagReportPathsType:o})))),l().createElement("div",{style:K.cost},l().createElement("div",{style:K.costLabel},l().createElement(a.Title,{headingLevel:"h2",style:K.costValue,size:"4xl"},l().createElement("span",null,this.getTotalCost()))),l().createElement("div",{style:K.costLabelDate},(0,M.Y)(m,"breakdown.total_cost_date",0))))}}const H=(0,m.withTranslation)()(W),Q=e=>{switch(e){case"cost-overview":return"cost-overview";case"historical-data":return"historical-data"}};class X extends l().Component{constructor(){super(...arguments),this.defaultState={activeTabKey:0},this.state=Object.assign({},this.defaultState),this.getAvailableTabs=()=>[{contentRef:l().createRef(),tab:"cost-overview"},{contentRef:l().createRef(),tab:"historical-data"}],this.getTab=(e,t,r)=>l().createElement(a.Tab,{eventKey:r,key:`${Q(e)}-tab`,tabContentId:`tab-${r}`,tabContentRef:t,title:l().createElement(a.TabTitleText,null,this.getTabTitle(e))}),this.getTabContent=e=>e.map(((e,t)=>l().createElement(a.TabContent,{eventKey:t,key:`${Q(e.tab)}-tabContent`,id:`tab-${t}`,ref:e.contentRef},this.getTabItem(e.tab,t)))),this.getTabItem=(e,t)=>{const{costOverviewComponent:r,historicalDataComponent:a}=this.props,{activeTabKey:s}=this.state,n=l().createElement(l().Fragment,null);if(s!==t)return n;const i=Q(e);return"cost-overview"===i?r:"historical-data"===i?a:n},this.getTabs=e=>{const{activeTabKey:t}=this.state;return l().createElement(a.Tabs,{activeKey:t,onSelect:this.handleTabClick},e.map(((e,t)=>this.getTab(e.tab,e.contentRef,t))))},this.getTabTitle=e=>{const{t}=this.props;return"cost-overview"===e?t("breakdown.cost_overview_title"):"historical-data"===e?t("breakdown.historical_data_title"):void 0},this.handleTabClick=(e,t)=>{const{activeTabKey:r}=this.state;r!==t&&this.setState({activeTabKey:t})},this.hasCurrentMonthData=()=>{const{providers:e}=this.props;let t=!1;if(e&&e.data)for(const r of e.data)if(r.current_month_data){t=!0;break}return t},this.updateReport=()=>{const{location:e,fetchReport:t,queryString:r,reportPathsType:a,reportType:s}=this.props;e.search&&t(a,s,r)}}componentDidMount(){this.updateReport()}componentDidUpdate(e){const{location:t,report:r,reportError:a,queryString:s}=this.props,n=e.queryString!==s,i=!r&&!a,o=!t.search;(n||i||o)&&this.updateReport()}render(){const{description:e,detailsURL:t,emptyStateTitle:r,filterBy:a,groupBy:o,providers:u,providersFetchStatus:h,providerType:d,query:g,report:m,reportError:y,reportFetchStatus:b,tagReportPathsType:v,title:f}=this.props,C=this.getAvailableTabs();if(y)return l().createElement(i.Z,{title:r});if(1===h&&1===b)return l().createElement(s.Z,{title:r});if(2===h&&2===b){if(u&&u.meta&&0===u.meta.count&&2===h)return l().createElement(n.Z,{providerType:d,title:r});if(!this.hasCurrentMonthData())return l().createElement(c.Z,{title:f})}return l().createElement(l().Fragment,null,l().createElement(H,{description:e,detailsURL:t,filterBy:a,groupBy:o,query:g,report:m,tabs:this.getTabs(C),tagReportPathsType:v,title:f}),l().createElement("div",{style:p.content},this.getTabContent(C)))}}const J=X},26872:(e,t,r)=>{"use strict";r.d(t,{X:()=>ee});var a=r(48927),s=r(9779),n=r(45997),i=r(97522),o=r.n(i),l=r(79878),c=r(76821),u=r(31447),p=r(11331),h=r(48196);const d={clustersContainer:{marginRight:p.ZP.value,marginTop:h.ZP.value}},g={modal:{height:"700px",width:"600px"},subTitle:{marginTop:r(91707).ZP.value,textAlign:"right"}};class m extends o().Component{render(){const{item:e}=this.props;return e.clusters?e.clusters.map(((e,t)=>o().createElement("div",{key:`cluster-${t}`},e))):null}}const y=(0,l.withTranslation)()(m);class b extends o().Component{constructor(e){super(e),this.handleClose=()=>{this.props.onClose(!1)},this.handleClose=this.handleClose.bind(this)}shouldComponentUpdate(e){const{isOpen:t,item:r}=this.props;return e.item!==r||e.isOpen!==t}render(){const{groupBy:e,isOpen:t,item:r,t:s}=this.props;return o().createElement(a.Modal,{className:"modalOverride",style:g.modal,isOpen:t,onClose:this.handleClose,title:s("details.clusters_modal_title",{groupBy:e,name:r.label}),width:"50%"},o().createElement(y,{item:r}))}}const v=(0,l.withTranslation)()(b);class f extends o().Component{constructor(e){super(e),this.defaultState={isOpen:!1,showAll:!1},this.state=Object.assign({},this.defaultState),this.handleClose=e=>{this.setState({isOpen:e})},this.handleOpen=e=>(this.setState({isOpen:!0}),e.preventDefault(),!1),this.handleClose=this.handleClose.bind(this),this.handleOpen=this.handleOpen.bind(this)}render(){const{groupBy:e,report:t,t:r}=this.props,{isOpen:a,showAll:s}=this.state;let n=0;const i=[],l=[],p=(0,u.R)({report:t,idKey:e}),h=p&&p.length?p[0]:void 0;if(!h)return null;for(const e of h.clusters){const t=`${i.length>0?", ":""}${e}`;s?i.push(t):n<=50&&(n+t.length>50?i.push(t.slice(0,50-n).trim().concat("...")):i.push(t)),n+=t.length,l.push(e)}return o().createElement("div",{style:d.clustersContainer},Boolean(i)&&i.map(((e,t)=>o().createElement("span",{key:t},e))),Boolean(i.length<l.length)&&o().createElement("a",Object.assign({},(0,c.g_)(c._q.details.cluster_lnk),{href:"#/",onClick:this.handleOpen}),r("details.more_clusters",{value:l.length-i.length})),o().createElement(v,{groupBy:e,isOpen:a,item:h,onClose:this.handleClose}))}}const C=(0,l.withTranslation)()(f);var _=r(88970),S=r(86411),T=r(901),E=r(23992),k=r(32412);const O={chartHeight:150,subTitle:{fontWeight:E.ZP.value}},D={chartSkeleton:{height:"125px",marginBottom:k.ZP.value,marginTop:p.ZP.value}};class B extends o().Component{constructor(){super(...arguments),this.containerRef=o().createRef(),this.state={width:0},this.getLegendLabel=()=>e=>{var{values:t}=e,r=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(r[a[s]]=e[a[s]])}return r}(e,["values"]);return o().createElement(_.ChartLabel,Object.assign({},r,{style:[{fontWeight:O.subTitle.fontWeight},{}],text:[t[r.index],r.text]}))},this.getSkeleton=()=>o().createElement(o().Fragment,null,o().createElement(S.Skeleton,{style:D.chartSkeleton,size:"md"})),this.handleResize=()=>{this.containerRef.current&&this.setState({width:this.containerRef.current.clientWidth})}}componentDidMount(){setTimeout((()=>{this.containerRef.current&&this.setState({width:this.containerRef.current.clientWidth}),window.addEventListener("resize",this.handleResize)}))}componentWillUnmount(){window.removeEventListener("resize",this.handleResize)}render(){const{report:e,reportFetchStatus:t,t:r}=this.props,{width:a}=this.state,s=e&&e.meta&&e.meta.total&&e.meta.total.cost,n=s&&e.meta.total.cost.markup,i=s&&e.meta.total.cost.raw,l=s&&e.meta.total.cost.usage,c=n?e.meta.total.cost.markup.units:"USD",u=i?e.meta.total.cost.raw.units:"USD",p=l?e.meta.total.cost.usage.units:"USD",h=n?e.meta.total.cost.markup.value:0,d=i?e.meta.total.cost.raw.value:0,g=l?e.meta.total.cost.usage.value:0,m=(0,T.Bw)(n?e.meta.total.cost.markup.value:0,c),y=(0,T.Bw)(i?e.meta.total.cost.raw.value:0,u),b=(0,T.Bw)(l?e.meta.total.cost.usage.value:0,p),v=r("breakdown.cost_chart.markup_label"),f=r("breakdown.cost_chart.raw_label"),C=r("breakdown.cost_chart.usage_label"),S=this.getLegendLabel(),E=o().createElement(_.ChartLegend,{gutter:25,itemsPerRow:2,labelComponent:o().createElement(S,{dy:10,lineHeight:1.5,values:[y,m,b]}),rowGutter:20});return o().createElement("div",{ref:this.containerRef,style:{height:O.chartHeight}},1===t?this.getSkeleton():o().createElement(_.ChartPie,{ariaDesc:r("breakdown.cost_chart.aria_desc"),ariaTitle:r("breakdown.cost_chart.aria_title"),constrainToVisibleArea:!0,data:[{x:f,y:d,units:u},{x:v,y:h,units:c},{x:C,y:g,units:p}],height:O.chartHeight,labels:({datum:e})=>r("breakdown.cost_chart.tooltip",{name:e.x,value:(0,T.Bw)(e.y,e.units)}),legendComponent:E,legendData:[{name:f},{name:v},{name:C}],legendOrientation:"vertical",legendPosition:"right",padding:{bottom:20,left:0,right:a-O.chartHeight,top:20},themeColor:_.ChartThemeColor.green,width:a}))}}const w=(0,l.withTranslation)()(B);var R=r(35956),x=r(75699),P=r(94377),V=r(90203);const I={mainContent:{marginTop:r(57640).ZP.value},subTitle:{textAlign:"right"}},L="cost";class G extends o().Component{constructor(e){super(e)}componentDidMount(){const{fetchReport:e,queryString:t,reportPathsType:r}=this.props;e(r,L,t)}componentDidUpdate(e){const{fetchReport:t,queryString:r,reportPathsType:a}=this.props;e.queryString!==r&&t(a,L,r)}render(){const{groupBy:e,report:t,reportFetchStatus:r,t:s}=this.props,n=(0,T.xG)(t&&t.meta&&t.meta.total?t.meta.total.cost.total.value:0);return o().createElement(o().Fragment,null,o().createElement("div",{style:I.subTitle},o().createElement(a.Title,{headingLevel:"h2",size:"xl"},s("details.cost_value",{value:n}))),o().createElement("div",{style:I.mainContent},o().createElement(R.mZ,{idKey:e,report:t,status:r},(({items:e})=>e.map((e=>o().createElement(R.EH,{key:e.id,formatOptions:{},formatValue:T.Bw,label:e.label?e.label.toString():"",totalValue:t.meta.total.cost.total.value,units:t.meta.total.cost.total.units,value:e.cost.total.value})))))))}}const M=(0,P.X1)(((e,{filterBy:t,groupBy:r,parentGroupBy:a,query:s,reportPathsType:i})=>{const o=s&&s.group_by[n.dV]?s.group_by[n.dV]:void 0,l={filter:Object.assign({time_scope_units:"month",time_scope_value:-1,resolution:"monthly",[a]:t},s&&s.filter&&s.filter.account&&{account:s.filter.account}),filter_by:s?s.filter_by:void 0,group_by:Object.assign(Object.assign({},o&&{[n.dV]:o}),r&&{[r]:"*"})},c=(0,n.pm)(l);return{queryString:c,report:V.ZV.selectReport(e,i,L,c),reportFetchStatus:V.ZV.selectReportFetchStatus(e,i,L,c)}})),j={fetchReport:V.nx.fetchReport},z=(0,l.withTranslation)()((0,x.connect)(M,j)(G));class q extends o().Component{constructor(e){super(e),this.handleClose=()=>{this.props.onClose(!1)},this.handleClose=this.handleClose.bind(this)}shouldComponentUpdate(e){const{filterBy:t,isOpen:r}=this.props;return e.filterBy!==t||e.isOpen!==r}render(){const{filterBy:e,groupBy:t,isOpen:r,parentGroupBy:s,query:n,reportPathsType:i,t:l}=this.props;return o().createElement(a.Modal,{className:"modalOverride",isOpen:r,onClose:this.handleClose,title:l("details.summary_modal_title",{groupBy:t,name:e}),variant:"large"},o().createElement(z,{filterBy:e,groupBy:t,parentGroupBy:s,query:n,reportPathsType:i}))}}const F=(0,l.withTranslation)()(q),Z={card:{},skeleton:{marginTop:k.ZP.value},viewAllContainer:{marginLeft:"-15px"}};class $ extends o().Component{constructor(){super(...arguments),this.state={isBulletChartModalOpen:!1},this.getItems=()=>{const{groupBy:e,report:t}=this.props;return(0,u.R)({report:t,idKey:e})},this.getSummary=()=>{const{groupBy:e,report:t,reportFetchStatus:r}=this.props;return o().createElement(R.mZ,{idKey:e,report:t,status:r},(({items:e})=>e.map((e=>o().createElement(R.EH,{key:`${e.id}-item`,formatOptions:{},formatValue:T.Bw,label:e.label?e.label.toString():void 0,totalValue:t.meta.total.cost.total.value,units:t.meta.total.cost.total.units,value:e.cost.total.value})))))},this.getViewAll=()=>{const{filterBy:e,groupBy:t,parentGroupBy:r,query:s,reportPathsType:n,t:i}=this.props,{isBulletChartModalOpen:l}=this.state;return-1!==this.getItems().findIndex((e=>{const t=e.id;if(t&&null!==t)return t.toString().includes("Other")}))?o().createElement("div",{style:Z.viewAllContainer},o().createElement(a.Button,Object.assign({},(0,c.g_)(c._q.details.view_all_btn),{onClick:this.handleBulletChartModalOpen,type:a.ButtonType.button,variant:a.ButtonVariant.link}),i("details.view_all",{groupBy:t})),o().createElement(F,{filterBy:e,groupBy:t,isOpen:l,onClose:this.handleBulletChartModalClose,parentGroupBy:r,query:s,reportPathsType:n})):null},this.handleBulletChartModalClose=e=>{this.setState({isBulletChartModalOpen:e})},this.handleBulletChartModalOpen=e=>{this.setState({isBulletChartModalOpen:!0}),e.preventDefault()}}componentDidMount(){const{fetchReport:e,queryString:t,reportPathsType:r,reportType:a}=this.props;e(r,a,t)}componentDidUpdate(e){const{fetchReport:t,queryString:r,reportPathsType:a,reportType:s}=this.props;e.queryString!==r&&t(a,s,r)}render(){const{groupBy:e,reportFetchStatus:t,t:r}=this.props;return o().createElement(a.Card,{style:Z.card},o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:"lg"},r("breakdown.summary_title",{groupBy:e}))),o().createElement(a.CardBody,null,1===t?o().createElement(o().Fragment,null,o().createElement(S.Skeleton,{size:"md"}),o().createElement(S.Skeleton,{size:"md",style:Z.skeleton}),o().createElement(S.Skeleton,{size:"md",style:Z.skeleton}),o().createElement(S.Skeleton,{size:"md",style:Z.skeleton})):this.getSummary()),o().createElement(a.CardFooter,null,this.getViewAll()))}}const A=(0,P.X1)(((e,{filterBy:t,groupBy:r,parentGroupBy:a,query:s,reportPathsType:i,reportType:o})=>{const l=s&&s.group_by[n.dV]?s.group_by[n.dV]:void 0,c={filter:Object.assign({limit:3,time_scope_units:"month",time_scope_value:-1,resolution:"monthly",[a]:t},s&&s.filter&&s.filter.account&&{account:s.filter.account}),filter_by:s?s.filter_by:void 0,group_by:Object.assign(Object.assign({},l&&{[n.dV]:l}),r&&{[r]:"*"})},u=(0,n.pm)(c);return{queryString:u,report:V.ZV.selectReport(e,i,o,u),reportFetchStatus:V.ZV.selectReportFetchStatus(e,i,o,u),reportPathsType:i,reportType:o}})),U={fetchReport:V.nx.fetchReport},N=(0,l.withTranslation)()((0,x.connect)(A,U)($));r(5118);const K={chartSkeleton:{marginBottom:k.ZP.value},capacity:{fontWeight:E.ZP.value},legendSkeleton:{marginTop:k.ZP.value}};class W extends o().Component{constructor(){super(...arguments),this.containerRef=o().createRef(),this.state={width:0},this.handleResize=()=>{this.containerRef.current&&this.containerRef.current.clientWidth&&this.setState({width:this.containerRef.current.clientWidth})},this.getCpuChart=()=>{const{parentGroupBy:e,reportFetchStatus:t,report:r}=this.props,{width:a}=this.state,s="cluster"===e?this.getChartDatumWithCapacity():this.getChartDatum();return r&&0!==s.usage.length?o().createElement("div",{className:"chartOverride"},1===t?this.getSkeleton():o().createElement(o().Fragment,null,Boolean("cluster"===e)&&this.getFreeSpace(),o().createElement(_.ChartBullet,{comparativeErrorMeasureData:s.limit.value?[{tooltip:s.limit.tooltip,y:s.limit.value}]:[],comparativeErrorMeasureLegendData:s.limit.value?[{name:s.limit.legend}]:[],height:this.getChartHeight(),labels:({datum:e})=>`${e.tooltip}`,legendPosition:"bottom-left",legendItemsPerRow:this.getItemsPerRow(),maxDomain:this.isDatumEmpty(s)?100:void 0,minDomain:0,padding:{bottom:75,left:10,right:50,top:0},primarySegmentedMeasureData:s.usage.length?s.usage.map((e=>({tooltip:e.tooltip,y:e.value}))):[],primarySegmentedMeasureLegendData:s.usage.length?s.usage.map((e=>({name:e.legend}))):[],qualitativeRangeData:s.ranges.length?[{tooltip:s.ranges[0].tooltip,y:s.ranges[0].value}]:[],qualitativeRangeLegendData:s.ranges.length?[{name:s.ranges[0].legend}]:[],width:a}))):null},this.getChartHeight=()=>{const{parentGroupBy:e}=this.props,{width:t}=this.state;return"cluster"===e?t>950?115:t>450?150:210:t>700?115:t>450?150:180},this.getItemsPerRow=()=>{const{width:e}=this.state;return e>950?4:e>700?3:e>450?2:1},this.getSkeleton=()=>o().createElement(o().Fragment,null,o().createElement(S.Skeleton,{style:K.chartSkeleton,size:"md"}),o().createElement(S.Skeleton,{style:K.legendSkeleton,size:"xs"})),this.isDatumEmpty=e=>{let t=!1;for(const r of e.ranges)if(r.value){t=!0;break}let r=!1;for(const t of e.usage)if(t.value){r=!0;break}return!(e.limit.value||t||r)}}componentDidMount(){const{fetchReport:e,queryString:t,reportPathsType:r,reportType:a}=this.props;e(r,a,t),window.addEventListener("resize",this.handleResize),this.handleResize()}componentDidUpdate(e){const{fetchReport:t,queryString:r,reportPathsType:a,reportType:s}=this.props;e.queryString!==this.props.queryString&&t(a,s,r)}componentWillUnmount(){window.removeEventListener("resize",this.handleResize)}getChartDatum(){const{report:e,reportType:t,t:r}=this.props,a={limit:{},ranges:[],usage:[]},s=e&&e.meta&&e.meta.total,n=s&&e.meta.total.limit&&null!==e.meta.total.limit,i=Math.trunc(n?e.meta.total.limit.value:0),o=r(`units.${(0,T.dM)(n?e.meta.total.limit.units:"")}`);a.limit={legend:r(`details.usage.${t}_limit`,{value:i,units:o}),tooltip:r(`details.usage.${t}_limit`,{value:i,units:o}),value:Math.trunc(i)};const l=s&&e.meta.total.request&&null!==e.meta.total.request,c=Math.trunc(l?e.meta.total.request.value:0),u=r(`units.${(0,T.dM)(l?e.meta.total.request.units:"")}`);a.ranges=[{legend:r(`details.usage.${t}_requests`,{value:c,units:u}),tooltip:r(`details.usage.${t}_requests`,{value:c,units:u}),value:Math.trunc(c)}];const p=s&&e.meta.total.usage&&null!==e.meta.total.usage,h=Math.trunc(p?e.meta.total.usage.value:0),d=r(`units.${(0,T.dM)(p?e.meta.total.usage.units:"")}`);return a.usage=[{legend:r(`details.usage.${t}_usage`,{value:h,units:d}),tooltip:r(`details.usage.${t}_usage`,{value:h,units:d}),value:Math.trunc(h)}],a}getChartDatumWithCapacity(){const{report:e,reportType:t,t:r}=this.props,a={limit:{},ranges:[],usage:[]},s=e&&e.meta&&e.meta.total,n=s&&e.meta.total.limit&&null!==e.meta.total.limit,i=Math.trunc(n?e.meta.total.limit.value:0),o=r(`units.${(0,T.dM)(n?e.meta.total.limit.units:"")}`);a.limit={legend:r(`details.usage.${t}_limit`,{value:i,units:o}),tooltip:r(`details.usage.${t}_limit`,{value:i,units:o}),value:Math.trunc(i)};const l=s&&e.meta.total.request&&null!==e.meta.total.request,c=Math.trunc(l?e.meta.total.capacity.value:0),u=r(`units.${(0,T.dM)(l?e.meta.total.capacity.units:"")}`);a.ranges=[{legend:r(`details.usage.${t}_capacity`,{value:c,units:u}),tooltip:r(`details.usage.${t}_capacity`,{value:c,units:u}),value:Math.trunc(c)}];const p=s&&e.meta.total.request&&null!==e.meta.total.request,h=s&&e.meta.total.usage&&null!==e.meta.total.usage,d=Math.trunc(p?e.meta.total.request.value:0),g=r(`units.${(0,T.dM)(p?e.meta.total.request.units:"")}`),m=Math.trunc(h?e.meta.total.usage.value:0),y=r(`units.${(0,T.dM)(h?e.meta.total.usage.units:"")}`);return a.usage=[{legend:r(`details.usage.${t}_usage`,{value:m,units:y}),tooltip:r(`details.usage.${t}_usage`,{value:m,units:y}),value:Math.trunc(m)},{legend:r(`details.usage.${t}_requests`,{value:d,units:g}),tooltip:r(`details.usage.${t}_requests`,{value:d,units:g}),value:Math.trunc(d)}],a}getFreeSpace(){const{report:e,reportType:t,t:r}=this.props,s=e&&e.meta&&e.meta.total,n=s&&e.meta.total.request&&null!==e.meta.total.request,i=s&&e.meta.total.request&&null!==e.meta.total.request,l=s&&e.meta.total.usage&&null!==e.meta.total.usage,c=Math.trunc(n?e.meta.total.capacity.value:0),u=Math.trunc(i?e.meta.total.request.value:0),p=r(`units.${(0,T.dM)(i?e.meta.total.request.units:"")}`),h=Math.trunc(l?e.meta.total.usage.value:0),d=r(`units.${(0,T.dM)(l?e.meta.total.usage.units:"")}`),g=c-u,m=c-h;let y=u>0?u/c*100:0;y>100&&(y=100-y);let b=c>h?h/c*100:0;return b>100&&(b=100-b),o().createElement(a.Grid,{hasGutter:!0},o().createElement(a.GridItem,{md:12,lg:6},o().createElement("div",null,r(`details.usage.${t}_usage_unused_label`)),o().createElement("div",{style:K.capacity},(0,T.Bw)(m)),o().createElement("div",null,r(`details.usage.${t}_usage_unused_units`,{percentage:(0,T.Bw)(b,d),units:d}))),o().createElement(a.GridItem,{md:12,lg:6},o().createElement("div",null,r(`details.usage.${t}_requests_unused_label`)),o().createElement("div",{style:K.capacity},(0,T.Bw)(g)),o().createElement("div",null,r(`details.usage.${t}_requests_unused_units`,{percentage:(0,T.Bw)(y,p),units:p}))))}render(){return o().createElement("div",{className:"chartOverride",ref:this.containerRef},this.getCpuChart())}}const H=(0,P.X1)(((e,{groupBy:t,parentGroupBy:r,reportPathsType:a,reportType:s})=>{const i={filter:{time_scope_units:"month",time_scope_value:-1,resolution:"monthly",limit:3},group_by:{[r]:t}},o=(0,n.pm)(i);return{report:V.ZV.selectReport(e,a,s,o),reportFetchStatus:V.ZV.selectReportFetchStatus(e,a,s,o),queryString:o}})),Q={fetchReport:V.nx.fetchReport},X=(0,l.withTranslation)()((0,x.connect)(H,Q)(W));var J=r(2646);const Y="placeholder";class ee extends o().Component{constructor(){super(...arguments),this.getClusterChart=e=>{const{groupBy:t,report:r,t:s}=this.props;let i=!1;for(const r of e.cluster.showWidgetOnGroupBy)if(r===t||r===n.P&&-1!==t.indexOf(n.P)){i=!0;break}return i?o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:"lg"},s("breakdown.cluster_title"))),o().createElement(a.CardBody,null,o().createElement(C,{groupBy:e.cluster.reportGroupBy,report:r}))):null},this.getCostChart=()=>{const{report:e,t}=this.props;return o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:"lg"},t("breakdown.cost_breakdown_title"),o().createElement(a.Popover,{"aria-label":t("breakdown.cost_breakdown_aria_label"),enableFlip:!0,bodyContent:o().createElement(o().Fragment,null,o().createElement("p",{style:J.W.infoTitle},t("breakdown.raw_cost_title")),o().createElement("p",null,t("breakdown.raw_cost_desc")),o().createElement("br",null),o().createElement("p",{style:J.W.infoTitle},t("breakdown.usage_cost_title")),o().createElement("p",null,t("breakdown.usage_cost_desc")),o().createElement("br",null),o().createElement("p",{style:J.W.infoTitle},t("breakdown.markup_title")),o().createElement("p",null,t("breakdown.markup_desc")),o().createElement("br",null),o().createElement("a",{href:t("docs.using_cost_model"),target:"blank"},t("cost_models_wizard.general_info.learn_more")))},o().createElement(a.Button,{variant:a.ButtonVariant.plain},o().createElement(s.OutlinedQuestionCircleIcon,{style:J.W.info}))))),o().createElement(a.CardBody,null,o().createElement(w,{report:e})))},this.getCpuUsageChart=e=>{const{filterBy:t,groupBy:r,t:s}=this.props;return o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:"lg"},s("breakdown.cpu_title"))),o().createElement(a.CardBody,null,o().createElement(X,{groupBy:t,parentGroupBy:r,reportPathsType:e.reportPathsType,reportType:e.reportType})))},this.getMemoryUsageChart=e=>{const{filterBy:t,groupBy:r,t:s}=this.props;return o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:"lg"},s("breakdown.memory_title"))),o().createElement(a.CardBody,null,o().createElement(X,{groupBy:t,parentGroupBy:r,reportPathsType:e.reportPathsType,reportType:e.reportType})))},this.getSummaryCard=e=>{const{filterBy:t,groupBy:r,query:a}=this.props;let s=!1;for(const t of e.reportSummary.showWidgetOnGroupBy)if(t===r||a&&a.group_by&&a.group_by[n.dV]||t===n.P&&r&&-1!==r.indexOf(n.P)){s=!0;break}return s?o().createElement(N,{filterBy:t,groupBy:e.reportSummary.reportGroupBy,parentGroupBy:r,query:a,reportPathsType:e.reportPathsType,reportType:e.reportType}):e.reportSummary.usePlaceholder?Y:null},this.getWidgetsColumns=()=>{const{selectWidgets:e,widgets:t}=this.props,r=[];t.map((t=>{const a=e[t],s=this.renderWidget(a);null!==s&&r.push(s)}));const a=Math.floor(r.length/2)+r.length%2,s=[],n=[];for(let e=0;e<a;e++)r[e]!==Y&&s.push(r[e]),e+a<r.length&&r[e+a]!==Y&&n.push(r[e+a]);return{leftColumnWidgets:s,rightColumnWidgets:n}}}renderWidget(e){switch(e.type){case"cluster":return this.getClusterChart(e);case"cost":return this.getCostChart();case"cpuUsage":return this.getCpuUsageChart(e);case"memoryUsage":return this.getMemoryUsageChart(e);case"summary":return this.getSummaryCard(e);default:return null}}render(){const{leftColumnWidgets:e,rightColumnWidgets:t}=this.getWidgetsColumns();return o().createElement(a.Grid,{hasGutter:!0},o().createElement(a.GridItem,{lg:12,xl:6},o().createElement(a.Grid,{hasGutter:!0},e.map(((e,t)=>o().createElement(a.GridItem,{key:`widget-${t}`},e))))),o().createElement(a.GridItem,{lg:12,xl:6},o().createElement(a.Grid,{hasGutter:!0},t.map(((e,t)=>o().createElement(a.GridItem,{key:`widget-${t}`},e))))))}}},87614:(e,t,r)=>{"use strict";r.d(t,{k:()=>f});var a=r(48927),s=r(1657),n=r(8755),i=r(48794),o=r(45997),l=r(17230),c=r(97522),u=r.n(c),p=r(79878),h=r(19853),d=r(49382),g=r(98499),m=r(32412);const y={export:{marginRight:m.ZP.value},toolbarContainer:{backgroundColor:d.ZP.value,paddingBottom:m.ZP.value,paddingTop:m.ZP.value,marginLeft:g.ZP.value,marginRight:g.ZP.value}};const b={tag:{}};class v extends u().Component{constructor(){super(...arguments),this.defaultState={categoryInput:"",filters:(0,l.cloneDeep)(b),isBulkSelectOpen:!1,isCategoryDropdownOpen:!1,isOrgUnitSelectExpanded:!1,isTagValueDropdownOpen:!1,isTagKeySelectExpanded:!1,isTagValueSelectExpanded:!1,tagKeyValueInput:""},this.state=Object.assign({},this.defaultState),this.getDefaultCategory=()=>{const{categoryOptions:e,groupBy:t,query:r}=this.props;if(!e)return"name";if(r&&r.group_by&&r.group_by[o.dV])return o.dV;for(const r of e)if(t===r.key||t&&-1!==t.indexOf(o.P)&&r.key===o.up)return r.key;return e[0].key},this.getActiveFilters=e=>{const t=(0,l.cloneDeep)(b);return e&&e.filter_by&&Object.keys(e.filter_by).forEach((r=>{const a=Array.isArray(e.filter_by[r])?[...e.filter_by[r]]:[e.filter_by[r]];-1!==r.indexOf(o.P)?t.tag[r.substring(o.P.length)]=a:t[r]=a})),t},this.onDelete=(e,t)=>{const r=e&&e.key?e.key:e,a=t&&t.key?t.key:t;r?this.setState((e=>(e.filters.tag[r]?e.filters.tag[r]=e.filters.tag[r].filter((e=>e!==a)):e.filters[r]&&(e.filters[r]=e.filters[r].filter((e=>e!==a))),{filters:e.filters})),(()=>{const{filters:e}=this.state,t=e.tag[r]?`${o.P}${r}`:r;this.props.onFilterRemoved(t,a)})):this.setState({filters:(0,l.cloneDeep)(b)},(()=>{this.props.onFilterRemoved(null)}))},this.getBulkSelect=()=>{const{isAllSelected:e,isBulkSelectDisabled:t,isDisabled:r,itemsPerPage:s,itemsTotal:n,selectedItems:i,t:o}=this.props,{isBulkSelectOpen:l}=this.state,c=e?n:i?i.length:0,p=c>0,h=!(!e&&c!==n||!(n>0))||!!p&&null,d=[u().createElement(a.DropdownItem,{key:"item-1",onClick:()=>this.onBulkSelectClicked("none")},o("toolbar.bulk_select.select_none")),u().createElement(a.DropdownItem,{key:"item-2",onClick:()=>this.onBulkSelectClicked("page")},o("toolbar.bulk_select.select_page",{value:s})),u().createElement(a.DropdownItem,{key:"item-3",onClick:()=>this.onBulkSelectClicked("all")},o("toolbar.bulk_select.select_all",{value:n}))];return u().createElement(a.Dropdown,{onSelect:this.onBulkSelect,position:a.DropdownPosition.left,toggle:u().createElement(a.DropdownToggle,{isDisabled:r||t,splitButtonItems:[u().createElement(a.DropdownToggleCheckbox,{id:"bulk-select",key:"bulk-select","aria-label":o(p?"toolbar.bulk_select.aria_deselect":"toolbar.bulk_select.aria_select"),isChecked:h,onClick:()=>{p?this.onBulkSelectClicked("none"):this.onBulkSelectClicked("all")}})],onToggle:this.onBulkSelectToggle},0!==c&&u().createElement(u().Fragment,null,c," selected")),isOpen:l,dropdownItems:d})},this.onBulkSelectClicked=e=>{const{onBulkSelected:t}=this.props;t&&t(e)},this.onBulkSelect=()=>{this.setState({isBulkSelectOpen:!this.state.isBulkSelectOpen})},this.onBulkSelectToggle=e=>{this.setState({isBulkSelectOpen:e})},this.getCurrentCategoryOption=()=>{const{categoryOptions:e}=this.props,{currentCategory:t}=this.state;if(e){for(const r of e)if(t===r.key)return r;return e[0]}},this.onCategoryClick=e=>{this.setState({currentCategory:e})},this.onCategorySelect=()=>{this.setState({categoryInput:"",currentTagKey:void 0,isCategoryDropdownOpen:!this.state.isCategoryDropdownOpen})},this.onCategoryToggle=e=>{this.setState({isCategoryDropdownOpen:e})},this.getCategoryInput=e=>{const{isDisabled:t,t:r}=this.props,{currentCategory:s,filters:n,categoryInput:o}=this.state;return u().createElement(a.ToolbarFilter,{categoryName:e,chips:n[e.key],deleteChip:this.onDelete,key:e.key,showToolbarItem:s===e.key},u().createElement(a.InputGroup,null,u().createElement(a.TextInput,{isDisabled:t,name:`${e.key}-input`,id:`${e.key}-input`,type:"search","aria-label":r(`filter_by.${e.key}.input_aria_label`),onChange:this.onCategoryInputChange,value:o,placeholder:r(`filter_by.${e.key}.placeholder`),onKeyDown:t=>this.onCategoryInput(t,e.key)}),u().createElement(a.Button,{isDisabled:t,variant:a.ButtonVariant.control,"aria-label":r(`filter_by.${e.key}.button_aria_label`),onClick:t=>this.onCategoryInput(t,e.key)},u().createElement(i.W1,null))))},this.getDefaultCategoryOptions=()=>{const{t:e}=this.props;return[{name:e("filter_by.values.name"),key:"name"}]},this.onCategoryInputChange=e=>{this.setState({categoryInput:e})},this.onCategoryInput=(e,t)=>{const{categoryInput:r,currentCategory:a}=this.state;e.key&&"Enter"!==e.key||""===r.trim()||this.setState((e=>{const s=e.filters[t];return{filters:Object.assign(Object.assign({},e.filters),{[a]:s&&s.includes(r)?s:s?[...s,r]:[r]}),categoryInput:""}}),(()=>{this.props.onFilterAdded(a,r)}))},this.getOrgUnitSelect=()=>{const{isDisabled:e,t}=this.props,{currentCategory:r,filters:s,isOrgUnitSelectExpanded:n}=this.state,i=this.getOrgUnitOptions().map((e=>({id:e.key,toString:()=>e.name,compareTo:e=>!!s[o.dV]&&s[o.dV].find((t=>t===e.id))}))),l=[],c=[];return s[o.dV]&&Array.isArray(s[o.dV])&&s[o.dV].map((e=>{const t=i.find((t=>t.id===e));t&&(c.push(t),l.push({key:t.id,node:t.toString()}))})),u().createElement(a.ToolbarFilter,{categoryName:{key:o.dV,name:t("filter_by.values.org_unit_id")},chips:l,deleteChip:this.onDelete,key:o.dV,showToolbarItem:r===o.dV},u().createElement(a.Select,{isDisabled:e,className:"selectOverride",variant:a.SelectVariant.checkbox,"aria-label":t("filter_by.org_unit.aria_label"),onToggle:this.onOrgUnitToggle,onSelect:this.onOrgUnitSelect,selections:c,isOpen:n,placeholderText:t("filter_by.org_unit.placeholder")},i.map((e=>u().createElement(a.SelectOption,{description:e.id,key:e.id,value:e})))))},this.onOrgUnitSelect=(e,t)=>{const r=e.target.checked;this.setState((e=>{const a=e.filters[o.dV]?e.filters[o.dV]:[];return{filters:Object.assign(Object.assign({},e.filters),{tag:Object.assign({},e.filters.tag),[o.dV]:r?[...a,t.id]:a.filter((e=>e!==t.id))})}}),(()=>{r?this.props.onFilterAdded(o.dV,t.id):this.onDelete(o.dV,t.id)}))},this.onOrgUnitToggle=e=>{this.setState({isOrgUnitSelectExpanded:e})},this.getTagKeySelect=()=>{const{isDisabled:e,t}=this.props,{currentCategory:r,currentTagKey:s,isTagKeySelectExpanded:n}=this.state;if(r!==o.up)return null;const i=this.getTagKeyOptions().map((e=>u().createElement(a.SelectOption,{key:e.key,value:e.key})));return u().createElement(a.ToolbarItem,null,u().createElement(a.Select,{isDisabled:e,variant:a.SelectVariant.typeahead,"aria-label":t("filter_by.tag_key.aria_label"),onClear:this.onTagKeyClear,onToggle:this.onTagKeyToggle,onSelect:this.onTagKeySelect,isOpen:n,placeholderText:t("filter_by.tag_key.placeholder"),selections:s},i))},this.onTagKeyClear=()=>{this.setState({currentTagKey:void 0,isTagKeySelectExpanded:!1})},this.onTagKeySelect=(e,t)=>{this.setState({currentTagKey:t,isTagKeySelectExpanded:!this.state.isTagKeySelectExpanded})},this.onTagKeyToggle=e=>{this.setState({isTagKeySelectExpanded:e})},this.getTagValueSelect=e=>{const{isDisabled:t,t:r}=this.props,{currentCategory:s,currentTagKey:n,filters:l,isTagValueSelectExpanded:c,tagKeyValueInput:p}=this.state,h=this.getTagValueOptions().map((e=>u().createElement(a.SelectOption,{key:e.key,value:e.key})));return u().createElement(a.ToolbarFilter,{categoryName:e,chips:l.tag[e.key],deleteChip:this.onDelete,key:e.key,showToolbarItem:s===o.up&&n===e.key},h.length<50?u().createElement(a.Select,{isDisabled:t,variant:a.SelectVariant.checkbox,"aria-label":r("filter_by.tag_value.aria_label"),onToggle:this.onTagValueToggle,onSelect:this.onTagValueSelect,selections:l.tag[e.key]?l.tag[e.key]:[],isOpen:c,placeholderText:r("filter_by.tag_value.placeholder")},h):u().createElement(a.InputGroup,null,u().createElement(a.TextInput,{isDisabled:t,name:"tagkeyvalue-input",id:"tagkeyvalue-input",type:"search","aria-label":r("filter_by.tag_value.aria_label"),onChange:this.onTagValueInputChange,value:p,placeholder:r("filter_by.tag_value.input_placeholder"),onKeyDown:e=>this.onTagValueInput(e)}),u().createElement(a.Button,{isDisabled:t,variant:a.ButtonVariant.control,"aria-label":r("filter_by.tag_value.button_aria_label"),onClick:e=>this.onTagValueInput(e)},u().createElement(i.W1,null))))},this.onTagValueInputChange=e=>{this.setState({tagKeyValueInput:e})},this.onTagValueInput=e=>{const{currentTagKey:t,tagKeyValueInput:r}=this.state;e.key&&"Enter"!==e.key||""===r.trim()||this.setState((e=>{const a=e.filters.tag[t]?e.filters.tag[t]:[];return{filters:Object.assign(Object.assign({},e.filters),{tag:Object.assign(Object.assign({},e.filters.tag),{[t]:[...a,r]})}),tagKeyValueInput:""}}),(()=>{this.props.onFilterAdded(`${o.P}${t}`,r)}))},this.onTagValueSelect=(e,t)=>{const{currentTagKey:r}=this.state,a=e.target.checked;this.setState((e=>{const s=e.filters.tag[r]?e.filters.tag[r]:[];return{filters:Object.assign(Object.assign({},e.filters),{tag:Object.assign(Object.assign({},e.filters.tag),{[r]:a?[...s,t]:s.filter((e=>e!==t))})})}}),(()=>{a?this.props.onFilterAdded(`${o.P}${r}`,t):this.onDelete(r,t)}))},this.onTagValueToggle=e=>{this.setState({isTagValueSelectExpanded:e})},this.getExportButton=()=>{const{isDisabled:e,isExportDisabled:t}=this.props;return u().createElement(a.ToolbarItem,null,u().createElement(a.Button,{isDisabled:e||t,onClick:this.handleExportClicked,variant:a.ButtonVariant.plain},u().createElement(s.Hy,null)))},this.handleExportClicked=()=>{this.props.onExportClicked()}}componentDidMount(){this.setState({currentCategory:this.getDefaultCategory()})}componentDidUpdate(e){const{categoryOptions:t,groupBy:r,orgReport:a,query:s,tagReport:n}=this.props;(t!==e.categoryOptions||r!==e.groupBy||s&&!(0,h.X)(s,e.query)||a&&!(0,h.X)(a,e.orgReport)||n&&!(0,h.X)(n,e.tagReport))&&this.setState((()=>{const a=this.getActiveFilters(s);return t!==e.categoryOptions||e.groupBy!==r?{categoryInput:"",currentCategory:this.getDefaultCategory(),currentOrgUnit:"",currentTagKey:"",tagKeyValueInput:"",filters:a}:{filters:a}}))}getCategoryDropdown(){const{categoryOptions:e,isDisabled:t}=this.props,{isCategoryDropdownOpen:r}=this.state;return e?u().createElement(a.ToolbarItem,null,u().createElement(a.Dropdown,{onSelect:this.onCategorySelect,position:a.DropdownPosition.left,toggle:u().createElement(a.DropdownToggle,{isDisabled:t,onToggle:this.onCategoryToggle,style:{width:"100%"}},u().createElement(n.k1,null)," ",this.getCurrentCategoryOption().name),isOpen:r,dropdownItems:e&&e.map((e=>u().createElement(a.DropdownItem,{key:e.key,onClick:()=>this.onCategoryClick(e.key)},e.name))),style:{width:"100%"}})):null}getOrgUnitOptions(){const{orgReport:e}=this.props;let t=[];if(!e||!e.data)return t;const r=e.data.sort(((e,t)=>e[o.iP]<t[o.iP]?-1:e[o.iP]>t[o.iP]?1:0)),a=r.filter((e=>0===e.level)),s=r.filter((e=>0!==e.level));return a.map((e=>{const t=r.find((t=>t[o.dV]===e[o.dV]));s.unshift(t)})),s.length>0&&(t=s.map((e=>({key:e[o.dV],name:e[o.iP]})))),t}getTagKeyOptions(){const{tagReport:e}=this.props;let t=[],r=[];if(!e||!e.data)return r;let a=!1;for(const t of e.data)if(t.hasOwnProperty("key")){a=!0;break}if(a){const r=e.data.map((e=>{var{type:t}=e;return function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(r[a[s]]=e[a[s]])}return r}(e,["type"])}));t=(0,l.uniqBy)(r,"key")}else t=(0,l.uniq)(e.data);return t.length>0&&(r=t.map((e=>{const t=a?e.key:e;return{key:t,name:t}}))),r}getTagValueOptions(){const{tagReport:e}=this.props,{currentTagKey:t}=this.state;let r=[];e&&e.data&&(r=[...new Set([...e.data])]);let a=[];if(r.length>0)for(const e of r)if(t===e.key&&e.values){a=e.values.map((e=>({key:e,name:e})));break}return a}render(){const{categoryOptions:e,pagination:t,showBulkSelect:r,showExport:s,showFilter:i,style:l}=this.props,c=e||this.getDefaultCategoryOptions();return u().createElement("div",{style:l||y.toolbarContainer},u().createElement(a.Toolbar,{id:"details-toolbar",clearAllFilters:this.onDelete,collapseListedFiltersBreakpoint:"xl"},u().createElement(a.ToolbarContent,null,u().createElement(a.ToolbarToggleGroup,{breakpoint:"xl",toggleIcon:u().createElement(n.k1,null)},r&&u().createElement(a.ToolbarItem,{variant:"bulk-select"},this.getBulkSelect()),i&&u().createElement(a.ToolbarGroup,{variant:"filter-group"},this.getCategoryDropdown(),this.getTagKeySelect(),this.getTagKeyOptions().map((e=>this.getTagValueSelect(e))),this.getOrgUnitSelect(),c&&c.filter((e=>e.key!==o.up&&e.key!==o.dV)).map((e=>this.getCategoryInput(e)))),Boolean(s)&&u().createElement(a.ToolbarGroup,null,this.getExportButton())),u().createElement(a.ToolbarItem,{alignment:{default:"alignRight"},variant:"pagination"},t))))}}const f=(0,p.withTranslation)()(v)},38850:(e,t,r)=>{"use strict";r.d(t,{X:()=>R});var a=r(48927),s=r(45997),n=r(36234),i=r(17230),o=r(97522),l=r.n(o),c=r(79878),u=r(75699),p=r(94377),h=r(42560),d=r(76821),g=r(32412),m=r(48196),y=r(73861);const b={form:{marginLeft:m.ZP.var},modal:{input:{marginRight:y.ZP.var},ul:{marginLeft:m.ZP.var}},title:{marginBottom:g.ZP.var}};var v=r(93562),f=r.n(v);const C="cost";class _ extends l().Component{constructor(e,t){super(e,t),this.defaultState={fetchReportClicked:!1},this.state=Object.assign({},this.defaultState),this.getExport=()=>{const{report:e,reportFetchStatus:t}=this.props;e&&2===t&&(f()(e.data,this.getFileName(),"text/csv"),this.handleClose())},this.getFileName=()=>{const{groupBy:e,reportPathsType:t,t:r}=this.props;return`${r("export.file_name",{provider:t,groupBy:e,date:(0,n.format)(new Date,"yyyy-MM-dd")})}.csv`},this.handleClose=()=>{this.props.onClose(!1)},this.handleFetchReport=()=>{const{exportReport:e,queryString:t,reportPathsType:r}=this.props;e(r,C,t),this.setState({fetchReportClicked:!0},(()=>{this.getExport()}))},this.handleResolutionChange=(e,t)=>{this.setState({resolution:t.currentTarget.value})},this.handleResolutionChange=this.handleResolutionChange.bind(this)}componentDidUpdate(e){const{report:t}=this.props,{fetchReportClicked:r}=this.state;e.report!==t&&r&&this.getExport()}render(){const{reportFetchStatus:e,t}=this.props;return l().createElement(a.Button,Object.assign({},(0,d.g_)(d._q.export.submit_btn),{isDisabled:1===e,key:"confirm",onClick:this.handleFetchReport,variant:a.ButtonVariant.primary}),t("export.confirm"))}}const S=(0,p.X1)(((e,t)=>{const{groupBy:r,isAllItems:a,items:n,query:i,reportPathsType:o,resolution:l,timeScope:c=-1}=t,u=(()=>{const e=Object.assign(Object.assign({},JSON.parse(JSON.stringify(i))),{filter_by:{},order_by:void 0});if(e.filter.limit=void 0,e.filter.offset=void 0,e.filter.resolution=l,e.filter.time_scope_value=c,i.filter_by)for(const t of Object.keys(i.filter_by))void 0===e.filter_by[t]&&(e.filter_by[t]=[]),e.filter_by[t].push(i.filter_by[t]);if(a)r===s.dV&&(void 0===e.filter_by[s.dV]&&(e.filter_by[s.dV]=[]),e.filter_by[s.dV].push(i.group_by[s.dV]));else if(r===s.dV)for(const t of n){const r="organizational_unit"===t.type?s.dV:t.type;void 0===e.filter_by[r]&&(e.filter_by[r]=[]),e.filter_by[r].push(t.id)}else for(const t of n)void 0===e.filter_by[r]&&(e.filter_by[r]=[]),e.filter_by[r].push(t.id);return(0,s.pm)(e)})();return{queryString:u,report:h.$S.selectExport(e,o,C,u),reportError:h.$S.selectExportError(e,o,C,u),reportFetchStatus:h.$S.selectExportFetchStatus(e,o,C,u)}})),T={exportReport:h.HY.Hy},E=(0,c.withTranslation)()((0,u.connect)(S,T)(_)),k=[{label:"export.resolution_daily",value:"daily"},{label:"export.resolution_monthly",value:"monthly"}],O=[{label:"export.time_scope_current",value:-1},{label:"export.time_scope_previous",value:-2}];class D extends l().Component{constructor(e,t){super(e,t),this.defaultState={timeScope:-1,resolution:"monthly"},this.state=Object.assign({},this.defaultState),this.handleClose=()=>{this.props.onClose(!1)},this.handleMonthChange=(e,t)=>{this.setState({timeScope:Number(t.currentTarget.value)})},this.handleResolutionChange=(e,t)=>{this.setState({resolution:t.currentTarget.value})},this.handleResolutionChange=this.handleResolutionChange.bind(this)}componentDidUpdate(e){const{isOpen:t}=this.props;t&&!e.isOpen&&this.setState(Object.assign({},this.defaultState))}render(){const{groupBy:e,isAllItems:t,items:r,query:o,reportPathsType:c,t:u}=this.props,{resolution:p,timeScope:h}=this.state;let g=[...r];this.props.isOpen&&(g=r&&0===r.length&&t?[{label:u("export.all")}]:(0,i.orderBy)(g,["label"],["asc"]));let m=u("export.selected",{groupBy:e});-1!==e.indexOf(s.P)&&(m=u("export.selected_tags"));const y=new Date,v=(new Date).setMonth(y.getMonth()-1),f=(0,n.format)(y,"MMMM yyyy"),C=(0,n.format)(v-1,"MMMM yyyy");return l().createElement(a.Modal,{style:b.modal,isOpen:this.props.isOpen,onClose:this.handleClose,title:u("export.title"),variant:"small",actions:[l().createElement(E,{groupBy:e,isAllItems:t,items:r,key:"confirm",timeScope:h,onClose:this.handleClose,query:o,reportPathsType:c,resolution:p}),l().createElement(a.Button,Object.assign({},(0,d.g_)(d._q.export.cancel_btn),{key:"cancel",onClick:this.handleClose,variant:a.ButtonVariant.link}),u("export.cancel"))]},l().createElement("div",{style:b.title},l().createElement("span",null,u("export.heading",{groupBy:e}))),l().createElement(a.Form,{style:b.form},l().createElement(a.FormGroup,{label:u("export.aggregate_type"),fieldId:"aggregate-type"},l().createElement(l().Fragment,null,k.map(((e,t)=>l().createElement(a.Radio,{key:t,id:`resolution-${t}`,isValid:void 0!==e.value,label:u(e.label),value:e.value,checked:p===e.value,name:"resolution",onChange:this.handleResolutionChange,"aria-label":u(e.label)}))))),l().createElement(a.FormGroup,{label:u("export.time_scope_title"),fieldId:"timeScope"},l().createElement(l().Fragment,null,O.map(((e,t)=>l().createElement(a.Radio,{key:t,id:`timeScope-${t}`,isValid:void 0!==e.value,label:u(e.label,{date:-2===e.value?C:f}),value:e.value,checked:h===e.value,name:"timeScope",onChange:this.handleMonthChange,"aria-label":u(e.label)}))))),l().createElement(a.FormGroup,{label:m,fieldId:"selected-labels"},l().createElement("ul",null,g.map(((e,t)=>l().createElement("li",{key:t},e.label)))))))}}const B=(0,p.X1)((()=>({}))),w={exportReport:h.HY.Hy},R=(0,c.withTranslation)()((0,u.connect)(B,w)(D))},64418:(e,t,r)=>{"use strict";r.d(t,{X:()=>k});var a=r(48927),s=r(45997),n=r(97522),i=r.n(n),o=r(79878),l=r(75699),c=r(94377),u=r(38434),p=r(5754);const h={groupBySelector:{display:"flex",alignItems:"center"},groupBySelectorLabel:{marginBottom:0,marginRight:r(32412).ZP.var}};class d extends i().Component{constructor(e){super(e),this.defaultState={defaultItem:this.props.groupBy||this.props.options[0].value,isGroupByOpen:!1},this.state=Object.assign({},this.defaultState),this.getCurrentGroupBy=()=>{const{getIdKeyForGroupBy:e}=this.props,t=(0,s.mB)(location.search),r=t&&t.group_by?Object.keys(t.group_by):[];let a=e(t.group_by);for(const e of r)if(-1!==e.indexOf(s.dV)){a=t.group_by[s.dV];break}return a},this.getGroupByItems=()=>{const{orgReport:e}=this.props;if(!e||!e.data)return[];const t=e.data.sort(((e,t)=>e[s.iP]<t[s.iP]?-1:e[s.iP]>t[s.iP]?1:0)),r=t.filter((e=>0===e.level)),a=t.filter((e=>0!==e.level));return r.map((e=>{const r=t.find((t=>t[s.dV]===e[s.dV]));a.unshift(r)})),a.map((e=>({id:e[s.dV],toString:()=>e[s.iP]})))},this.handleGroupByClear=()=>{this.setState({currentItem:void 0})},this.handleGroupBySelect=(e,t)=>{const{onItemClicked:r}=this.props;this.setState({currentItem:t.id,isGroupByOpen:!1}),r&&r(`${s.dV}${t.id}`)},this.handleGroupByToggle=e=>{this.setState({isGroupByOpen:e})},this.handleGroupByClear=this.handleGroupByClear.bind(this),this.handleGroupBySelect=this.handleGroupBySelect.bind(this),this.handleGroupByToggle=this.handleGroupByToggle.bind(this)}componentDidMount(){this.setState({currentItem:this.getCurrentGroupBy()})}componentDidUpdate(e){const{groupBy:t}=this.props;e.groupBy!==t&&this.setState({currentItem:this.getCurrentGroupBy()})}render(){const{isDisabled:e=!1,t}=this.props,{currentItem:r,isGroupByOpen:s}=this.state,n=this.getGroupByItems(),o=n.find((e=>e.id===r));return i().createElement("div",{style:h.groupBySelector},i().createElement(a.Select,{"aria-label":t("group_by.org_unit_aria_label"),isDisabled:e,onClear:this.handleGroupByClear,onToggle:this.handleGroupByToggle,onSelect:this.handleGroupBySelect,isOpen:s,placeholderText:t("group_by.org_unit_placeholder"),selections:o,variant:a.SelectVariant.typeahead},n.map((e=>i().createElement(a.SelectOption,{description:e.id,key:e.id,value:e})))))}}const g=(0,o.withTranslation)()(d);var m=r(17230);class y extends i().Component{constructor(e){super(e),this.defaultState={isGroupByOpen:!1},this.state=Object.assign({},this.defaultState),this.getGroupByItems=()=>{const{tagReport:e}=this.props;if(!e||!e.data)return[];let t=!1;for(const r of e.data)if(r.hasOwnProperty("key")){t=!0;break}let r=[];if(t){const t=e.data.map((e=>{var{type:t}=e;return function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(r[a[s]]=e[a[s]])}return r}(e,["type"])}));r=(0,m.uniqBy)(t,"key")}else r=(0,m.uniq)(e.data);return r.map((e=>{const r=t?e.key:e;return i().createElement(a.SelectOption,{key:e.key,value:r})}))},this.getCurrentGroupBy=()=>{const e=(0,s.mB)(location.search),t=e&&e.group_by?Object.keys(e.group_by):[];let r;for(const e of t)if(-1!==e.indexOf(s.P)){r=e.slice(s.P.length);break}return r},this.handleGroupByClear=()=>{this.setState({currentItem:void 0})},this.handleGroupBySelect=(e,t)=>{const{onItemClicked:r}=this.props;this.setState({currentItem:t,isGroupByOpen:!1}),r&&r(`${s.P}${t}`)},this.handleGroupByToggle=e=>{this.setState({isGroupByOpen:e})},this.handleGroupByClear=this.handleGroupByClear.bind(this),this.handleGroupBySelect=this.handleGroupBySelect.bind(this),this.handleGroupByToggle=this.handleGroupByToggle.bind(this)}componentDidMount(){this.setState({currentItem:this.getCurrentGroupBy()})}componentDidUpdate(e){const{groupBy:t}=this.props;e.groupBy!==t&&this.setState({currentItem:this.getCurrentGroupBy()})}render(){const{isDisabled:e,t}=this.props,{currentItem:r,isGroupByOpen:s}=this.state;return i().createElement("div",{style:h.groupBySelector},i().createElement(a.Select,{"aria-label":t("group_by.tag_key_aria_label"),isDisabled:e,onClear:this.handleGroupByClear,onToggle:this.handleGroupByToggle,onSelect:this.handleGroupBySelect,isOpen:s,placeholderText:t("group_by.tag_key_placeholder"),selections:r,variant:a.SelectVariant.typeahead},this.getGroupByItems()))}}const b=(0,o.withTranslation)()(y),v=[{label:s.dV,value:s.dV}],f=[{label:s.up,value:s.up}],C="org",_="tag";class S extends i().Component{constructor(e,t){super(e,t),this.defaultState={defaultItem:this.props.groupBy||this.props.options[0].value,isGroupByOpen:!1,isGroupByOrgVisible:!1,isGroupByTagVisible:!1},this.state=Object.assign({},this.defaultState),this.handleGroupByClick=e=>{const{onItemClicked:t}=this.props;e===s.dV||e===s.up?this.setState({currentItem:e,isGroupByOrgVisible:e===s.dV,isGroupByTagVisible:e===s.up}):(this.setState({currentItem:e,isGroupByOrgVisible:!1,isGroupByTagVisible:!1}),t&&t(e))},this.getGroupByItems=()=>{const{options:e,orgReport:t,tagReport:r,t:s}=this.props,n=[...e];return t&&t.data&&t.data.length>0&&n.push(...v),r&&r.data&&r.data.length>0&&n.push(...f),n.map((e=>i().createElement(a.DropdownItem,{component:"button",key:e.value,onClick:()=>this.handleGroupByClick(e.value)},s(`group_by.values.${e.label}`))))},this.getCurrentGroupBy=()=>{const{getIdKeyForGroupBy:e}=this.props,{defaultItem:t}=this.state,r=(0,s.mB)(location.search);if(!r||!r.group_by)return t;let a=e(r.group_by);const n=r&&r.group_by?Object.keys(r.group_by):[];for(const e of n){let t=e.indexOf(s.P);if(-1!==t){a=s.up,this.setState({isGroupByTagVisible:!0});break}if(t=e.indexOf(s.dV),-1!==t){a=s.dV,this.setState({isGroupByOrgVisible:!0});break}}return"date"!==a?a:t},this.handleGroupBySelect=()=>{this.setState({isGroupByOpen:!this.state.isGroupByOpen})},this.handleGroupByToggle=e=>{this.setState({isGroupByOpen:e})},this.handleGroupByClick=this.handleGroupByClick.bind(this),this.handleGroupBySelect=this.handleGroupBySelect.bind(this),this.handleGroupByToggle=this.handleGroupByToggle.bind(this)}componentDidMount(){const{fetchOrg:e,fetchTag:t,queryString:r,orgReportPathsType:a,showOrgs:s,showTags:n,tagReportPathsType:i}=this.props;s&&e(a,C,r),n&&t(i,_,r),this.setState({currentItem:this.getCurrentGroupBy()})}componentDidUpdate(e){const{fetchOrg:t,fetchTag:r,groupBy:a,orgReportPathsType:s,perspective:n,queryString:i,showOrgs:o,showTags:l,tagReportPathsType:c}=this.props;if(e.groupBy!==a||e.perspective!==n){let a;o&&t(s,C,i),l&&r(c,_,i),e.perspective!==n&&(a={isGroupByOrgVisible:!1,isGroupByTagVisible:!1}),this.setState(Object.assign({currentItem:this.getCurrentGroupBy()},a||{}))}}render(){const{getIdKeyForGroupBy:e,groupBy:t,isDisabled:r=!1,onItemClicked:s,orgReport:n,t:o,tagReport:l}=this.props,{currentItem:c,isGroupByOpen:u,isGroupByOrgVisible:p,isGroupByTagVisible:d}=this.state;return i().createElement("div",{style:h.groupBySelector},i().createElement("label",{style:h.groupBySelectorLabel},o("group_by.view"),":"),i().createElement(a.Dropdown,{onSelect:this.handleGroupBySelect,toggle:i().createElement(a.DropdownToggle,{isDisabled:r,onToggle:this.handleGroupByToggle},o(`group_by.values.${c}`)),isOpen:u,dropdownItems:[this.getGroupByItems()]}),Boolean(p)&&i().createElement(g,{getIdKeyForGroupBy:e,groupBy:t,isDisabled:r,onItemClicked:s,options:v,orgReport:n}),Boolean(d)&&i().createElement(b,{groupBy:t,isDisabled:r,onItemClicked:s,options:f,tagReport:l}))}}const T=(0,c.X1)(((e,{orgReportPathsType:t,tagReportPathsType:r})=>{const a=(0,s.pm)({});return{queryString:a,orgReport:u.zE.selectOrg(e,t,C,a),orgReportFetchStatus:u.zE.selectOrgFetchStatus(e,t,C,a),tagReport:p.ux.selectTag(e,r,_,a),tagReportFetchStatus:p.ux.selectTagFetchStatus(e,r,_,a)}})),E={fetchOrg:u.Lp.T7,fetchTag:p.xr.Xt},k=(0,o.withTranslation)()((0,l.connect)(T,E)(S))},98648:(e,t,r)=>{"use strict";r.d(t,{f:()=>ae});var a=r(48927),s=r(97522),n=r.n(s),i=r(86411),o=r(45997),l=r(60232),c=(r(5118),r(88970)),u=r(40125),p=r(63802),h=r(36234),d=r(30136),g=r.n(d),m=r(63211),y=r(27765),b=r(19960),v=r(84076),f=r(18131),C=r(24656),_=r(84615),S=r(70698),T=r(72021),E=r(21768),k=r(41534),O=r(98499),D=r(48196);const B={currentCapacityData:{fill:"none"},currentColorScale:[E.CH.value,T.R0.value,S.t6.value,_.S7.value,k.iM.value],currentInfrastructureCostData:{fill:"none",strokeDasharray:"3,3"},currentCostData:{fill:"none"},itemsPerRow:0,previousCapacityData:{fill:"none"},previousColorScale:[y.O6.value,b.OS.value,v.iY.value,f.cQ.value,C.DD.value],previousInfrastructureCostData:{fill:"none",strokeDasharray:"3,3"},previousCostData:{fill:"none"},yAxis:{axisLabel:{padding:15},grid:{stroke:"none"},ticks:{stroke:"none"},tickLabels:{fontSize:0}},xAxis:{axisLabel:{padding:40},grid:{stroke:"none"},ticks:{stroke:"none"}}},w={chart:{marginTop:D.S1.value},title:{marginLeft:"-"+O.Js.value}};class R extends n().Component{constructor(){super(...arguments),this.containerRef=n().createRef(),this.resizeObserver=m.Z,this.navToggle=m.Z,this.state={hiddenSeries:new Set,width:0},this.initDatum=()=>{const{currentCostData:e,currentInfrastructureCostData:t,previousCostData:r,previousInfrastructureCostData:a}=this.props,s="chart.cost_legend_label",n="chart.cost_infrastructure_legend_label",i="chart.cost_infrastructure_legend_tooltip",o="chart.cost_legend_tooltip",c=[{childName:"previousCost",data:r,legendItem:{name:(0,l.uL)(r,s,!0,!0,1),symbol:{fill:B.previousColorScale[0],type:"minus"},tooltip:(0,l.uL)(r,o,!1,!1,1)},style:{data:Object.assign(Object.assign({},B.previousCostData),{stroke:B.previousColorScale[0]})}},{childName:"currentCost",data:e,legendItem:{name:(0,l.uL)(e,s,!0,!1),symbol:{fill:B.currentColorScale[0],type:"minus"},tooltip:(0,l.uL)(e,o,!1,!1)},style:{data:Object.assign(Object.assign({},B.currentCostData),{stroke:B.currentColorScale[0]})}},{childName:"previousInfrastructureCost",data:a,legendItem:{name:(0,l.uL)(a,n,!0,!0,1),symbol:{fill:B.previousColorScale[1],type:"dash"},tooltip:(0,l.uL)(a,i,!1,!1,1)},style:{data:Object.assign(Object.assign({},B.previousInfrastructureCostData),{stroke:B.previousColorScale[1]})}},{childName:"currentInfrastructureCost",data:t,legendItem:{name:(0,l.uL)(t,n,!0,!1),symbol:{fill:B.currentColorScale[1],type:"dash"},tooltip:(0,l.uL)(t,i,!1,!1)},style:{data:Object.assign(Object.assign({},B.currentInfrastructureCostData),{stroke:B.currentColorScale[1]})}}],u=this.getCursorVoronoiContainer();this.setState({cursorVoronoiContainer:u,series:c})},this.initResizeObserve=()=>{const e=this.containerRef.current,{ResizeObserver:t}=window;if(e&&t){const r=new t(this.handleResize);r.observe(e),this.resizeObserver=()=>r.unobserve(e)}else this.handleResize(),window.addEventListener("resize",this.handleResize),this.resizeObserver=()=>window.removeEventListener("resize",this.handleResize),this.navToggle=insights.chrome.on("NAVIGATION_TOGGLE",this.handleNavToggle)},this.getChart=(e,t)=>{const{hiddenSeries:r}=this.state;return n().createElement(c.ChartArea,{data:r.has(t)?[{y:null}]:e.data,interpolation:"monotoneX",key:e.childName,name:e.childName,style:e.style})},this.getCursorVoronoiContainer=()=>{const{formatDatumValue:e,formatDatumOptions:t}=this.props,r=(0,c.createContainer)("voronoi","cursor");return n().createElement(r,{cursorDimension:"x",labels:({datum:r})=>(0,p.zj)(r,e,t),mouseFollowTooltips:!0,voronoiDimension:"x",voronoiPadding:{bottom:120,left:8,right:8,top:8}})},this.getLegend=()=>{const{legendItemsPerRow:e}=this.props,{hiddenSeries:t,series:r,width:a}=this.state,s=e||(a>700?B.itemsPerRow:2);return n().createElement(c.ChartLegend,{data:(0,p.oX)(r,t),height:25,gutter:20,itemsPerRow:s,name:"legend"})},this.handleLegendClick=e=>{const t=(0,p.nV)(this.state.series,this.state.hiddenSeries,e);this.setState({hiddenSeries:t})},this.handleNavToggle=()=>{setTimeout(this.handleResize,500)},this.handleResize=()=>{const{width:e}=this.state,{clientWidth:t=0}=this.containerRef.current||{};t!==e&&this.setState({width:t})}}componentDidMount(){this.initDatum(),this.initResizeObserve()}componentDidUpdate(e){e.currentCostData===this.props.currentCostData&&e.currentInfrastructureCostData===this.props.currentInfrastructureCostData&&e.previousCostData===this.props.previousCostData&&e.previousInfrastructureCostData===this.props.previousInfrastructureCostData||this.initDatum()}componentWillUnmount(){this.resizeObserver&&this.resizeObserver(),this.navToggle&&this.navToggle()}getEndDate(){const{currentInfrastructureCostData:e,previousInfrastructureCostData:t}=this.props,r=e?(0,h.getDate)((0,l.Y_)(e,!0,!0)[1]):0,a=t?(0,h.getDate)((0,l.Y_)(t,!0,!0)[1]):0;return r>0||a>0?Math.max(r,a):31}getEvents(){const{hiddenSeries:e,series:t}=this.state;return(0,c.getInteractiveLegendEvents)({chartNames:(0,p.bC)(t),isHidden:t=>(0,p.Yt)(e,t),legendName:"legend",onLegendClick:e=>this.handleLegendClick(e.index)})}render(){const{adjustContainerHeight:e,height:t,containerHeight:r=t,padding:s={bottom:120,left:8,right:8,top:8},title:i,xAxisLabel:o,yAxisLabel:l}=this.props,{cursorVoronoiContainer:h,hiddenSeries:d,series:m,width:y}=this.state,b=(0,p.ge)(m,d),v=this.getEndDate(),f=Math.floor(v/2),C=e&&y>700?r-25:r,_=h?n().cloneElement(h,{disable:!(0,p.TW)(m,d),labelComponent:n().createElement(c.ChartLegendTooltip,{legendData:(0,p.oX)(m,d,!0),title:e=>g().t("chart.day_of_month_title",{day:e.x})})}):void 0;return n().createElement("div",{className:"chartOverride",ref:this.containerRef},n().createElement(a.Title,{headingLevel:"h2",style:w.title,size:"xl"},i),n().createElement("div",{style:Object.assign(Object.assign({},w.chart),{height:C})},n().createElement("div",{style:{height:t,width:y}},n().createElement(c.Chart,{containerComponent:_,domain:b,events:this.getEvents(),height:t,legendComponent:this.getLegend(),legendData:(0,p.oX)(m,d),legendPosition:"bottom",padding:s,theme:u.Z,width:y},m&&m.map(((e,t)=>this.getChart(e,t))),n().createElement(c.ChartAxis,{label:o,style:B.xAxis,tickValues:[1,f,v]}),n().createElement(c.ChartAxis,{dependentAxis:!0,label:l,style:B.yAxis})))))}}var x=r(79878),P=r(75699),V=r(94377),I=r(90203),L=r(901),G=r(11331),M=r(32412);const j={chartContainer:{marginLeft:O.ZP.value},chartSkeleton:{height:"125px",marginBottom:M.ZP.value,marginTop:G.ZP.value},costChart:{marginBottom:D.ZP.value,marginTop:D.ZP.value},legendSkeleton:{marginTop:M.ZP.value},trendChart:{marginBottom:D.ZP.value,marginTop:D.ZP.value},usageChart:{marginTop:D.ZP.value}};class z extends n().Component{constructor(){super(...arguments),this.getSkeleton=()=>n().createElement(n().Fragment,null,n().createElement(i.Skeleton,{style:j.chartSkeleton,size:"md"}),n().createElement(i.Skeleton,{style:j.legendSkeleton,size:"xs"}))}componentDidMount(){const{fetchReport:e,currentQueryString:t,previousQueryString:r,reportPathsType:a,reportType:s}=this.props;e(a,s,t),e(a,s,r)}componentDidUpdate(e){const{fetchReport:t,currentQueryString:r,previousQueryString:a,reportPathsType:s,reportType:n}=this.props;e.currentQueryString!==r&&t(s,n,r),e.previousQueryString!==a&&t(s,n,a)}render(){const{currentReport:e,currentReportFetchStatus:t,previousReport:r,previousReportFetchStatus:a,reportType:s,t:i}=this.props,o=(0,l.zJ)(e,0,"date","cost"),c=(0,l.zJ)(e,0,"date","infrastructure"),u=(0,l.zJ)(r,0,"date","cost"),p=(0,l.zJ)(r,0,"date","infrastructure"),h=e&&e.meta&&e.meta.total&&e.meta.total.cost?e.meta.total.cost.total.units:"USD";return n().createElement("div",{style:j.chartContainer},n().createElement("div",{style:j.costChart},1===t&&1===a?this.getSkeleton():n().createElement(R,{adjustContainerHeight:!0,containerHeight:275,currentCostData:o,currentInfrastructureCostData:c,formatDatumValue:L.Bw,formatDatumOptions:{},height:300,previousCostData:u,previousInfrastructureCostData:p,xAxisLabel:i("breakdown.historical_chart.day_of_month_label"),yAxisLabel:i(`breakdown.historical_chart.${s}_label`,{units:i(`units.${(0,L.dM)(h)}`)})})))}}const q=(0,V.X1)(((e,{filterBy:t,groupBy:r,reportPathsType:a,reportType:s})=>{const n={filter:{time_scope_units:"month",time_scope_value:-1,resolution:"daily",limit:3},group_by:{[r]:t}},i=(0,o.pm)(n),l={filter:{time_scope_units:"month",time_scope_value:-2,resolution:"daily",limit:3},group_by:{[r]:t}},c=(0,o.pm)(l);return{currentQuery:n,currentQueryString:i,currentReport:I.ZV.selectReport(e,a,s,i),currentReportFetchStatus:I.ZV.selectReportFetchStatus(e,a,s,i),previousQuery:l,previousQueryString:c,previousReport:I.ZV.selectReport(e,a,s,c),previousReportFetchStatus:I.ZV.selectReportFetchStatus(e,a,s,c)}})),F={fetchReport:I.nx.fetchReport},Z=(0,x.withTranslation)()((0,P.connect)(q,F)(z)),$={currentColorScale:[E.CH.value,T.R0.value,S.t6.value,_.S7.value,k.iM.value],currentMonthData:{fill:"none"},itemsPerRow:0,previousColorScale:[y.O6.value,b.OS.value,v.iY.value,f.cQ.value,C.DD.value],previousMonthData:{fill:"none"},yAxis:{axisLabel:{padding:15},grid:{stroke:"none"},ticks:{stroke:"none"},tickLabels:{fontSize:0}},xAxis:{axisLabel:{padding:40},grid:{stroke:"none"},ticks:{stroke:"none"}}},A={chart:{marginTop:D.S1.value},title:{marginLeft:"-"+O.Js.value}};class U extends n().Component{constructor(){super(...arguments),this.containerRef=n().createRef(),this.resizeObserver=m.Z,this.navToggle=m.Z,this.state={hiddenSeries:new Set,width:0},this.initDatum=()=>{const{currentData:e,previousData:t,showUsageLegendLabel:r=!1}=this.props,a=r?"chart.usage_legend_label":"chart.cost_legend_label",s=r?"chart.usage_legend_tooltip":"chart.cost_legend_tooltip",n=[{childName:"previousCost",data:t,legendItem:{name:(0,l.uL)(t,a,!0,!0,1),symbol:{fill:$.previousColorScale[0],type:"minus"},tooltip:(0,l.uL)(t,s,!1,!1,1)},style:{data:Object.assign(Object.assign({},$.previousMonthData),{stroke:$.previousColorScale[0]})}},{childName:"currentCost",data:e,legendItem:{name:(0,l.uL)(e,a,!0,!1),symbol:{fill:$.currentColorScale[1],type:"minus"},tooltip:(0,l.uL)(e,s,!1,!1)},style:{data:Object.assign(Object.assign({},$.currentMonthData),{stroke:$.currentColorScale[1]})}}],i=this.getCursorVoronoiContainer();this.setState({cursorVoronoiContainer:i,series:n})},this.initResizeObserve=()=>{const e=this.containerRef.current,{ResizeObserver:t}=window;if(e&&t){const r=new t(this.handleResize);r.observe(e),this.resizeObserver=()=>r.unobserve(e)}else this.handleResize(),window.addEventListener("resize",this.handleResize),this.resizeObserver=()=>window.removeEventListener("resize",this.handleResize),this.navToggle=insights.chrome.on("NAVIGATION_TOGGLE",this.handleNavToggle)},this.getChart=(e,t)=>{const{hiddenSeries:r}=this.state;return n().createElement(c.ChartArea,{data:r.has(t)?[{y:null}]:e.data,interpolation:"monotoneX",key:e.childName,name:e.childName,style:e.style})},this.getCursorVoronoiContainer=()=>{const{formatDatumValue:e,formatDatumOptions:t}=this.props,r=(0,c.createContainer)("voronoi","cursor");return n().createElement(r,{cursorDimension:"x",labels:({datum:r})=>(0,p.zj)(r,e,t),mouseFollowTooltips:!0,voronoiDimension:"x",voronoiPadding:{bottom:120,left:8,right:8,top:8}})},this.getLegend=()=>{const{legendItemsPerRow:e}=this.props,{hiddenSeries:t,series:r}=this.state;return n().createElement(c.ChartLegend,{data:(0,p.oX)(r,t),height:25,gutter:20,itemsPerRow:e,name:"legend"})},this.handleLegendClick=e=>{const t=(0,p.nV)(this.state.series,this.state.hiddenSeries,e);this.setState({hiddenSeries:t})},this.handleNavToggle=()=>{setTimeout(this.handleResize,500)},this.handleResize=()=>{const{width:e}=this.state,{clientWidth:t=0}=this.containerRef.current||{};t!==e&&this.setState({width:t})}}componentDidMount(){this.initDatum(),this.initResizeObserve()}componentDidUpdate(e){e.currentData===this.props.currentData&&e.previousData===this.props.previousData||this.initDatum()}componentWillUnmount(){this.resizeObserver&&this.resizeObserver(),this.navToggle&&this.navToggle()}getEndDate(){const{currentData:e,previousData:t}=this.props,r=t?(0,h.getDate)((0,l.Y_)(t,!0,!0)[1]):0,a=e?(0,h.getDate)((0,l.Y_)(e,!0,!0)[1]):0;return a>0||r>0?Math.max(a,r):31}getEvents(){const{hiddenSeries:e,series:t}=this.state;return(0,c.getInteractiveLegendEvents)({chartNames:(0,p.bC)(t),isHidden:t=>(0,p.Yt)(e,t),legendName:"legend",onLegendClick:e=>this.handleLegendClick(e.index)})}render(){const{height:e,containerHeight:t=e,padding:r={bottom:120,left:8,right:8,top:8},title:s,xAxisLabel:i,yAxisLabel:o}=this.props,{cursorVoronoiContainer:l,hiddenSeries:h,series:d,width:m}=this.state,y=(0,p.ge)(d,h),b=this.getEndDate(),v=Math.floor(b/2),f=l?n().cloneElement(l,{disable:!(0,p.TW)(d,h),labelComponent:n().createElement(c.ChartLegendTooltip,{legendData:(0,p.oX)(d,h,!0),title:e=>g().t("chart.day_of_month_title",{day:e.x})})}):void 0;return n().createElement("div",{className:"chartOverride",ref:this.containerRef},n().createElement(a.Title,{headingLevel:"h2",style:A.title,size:"xl"},s),n().createElement("div",{style:Object.assign(Object.assign({},A.chart),{height:t})},n().createElement("div",{style:{height:e,width:m}},n().createElement(c.Chart,{containerComponent:f,domain:y,events:this.getEvents(),height:e,legendComponent:this.getLegend(),legendData:(0,p.oX)(d,h),legendPosition:"bottom",padding:r,theme:u.Z,width:m},d&&d.map(((e,t)=>this.getChart(e,t))),n().createElement(c.ChartAxis,{label:i,style:$.xAxis,tickValues:[1,v,b]}),n().createElement(c.ChartAxis,{dependentAxis:!0,label:o,style:$.yAxis})))))}}class N extends n().Component{constructor(){super(...arguments),this.getSkeleton=()=>n().createElement(n().Fragment,null,n().createElement(i.Skeleton,{style:j.chartSkeleton,size:"md"}),n().createElement(i.Skeleton,{style:j.legendSkeleton,size:"xs"}))}componentDidMount(){const{fetchReport:e,currentQueryString:t,previousQueryString:r,reportPathsType:a,reportType:s}=this.props;e(a,s,t),e(a,s,r)}componentDidUpdate(e){const{fetchReport:t,currentQueryString:r,previousQueryString:a,reportPathsType:s,reportType:n}=this.props;e.currentQueryString!==r&&t(s,n,r),e.previousQueryString!==a&&t(s,n,a)}render(){const{currentReport:e,currentReportFetchStatus:t,previousReport:r,previousReportFetchStatus:a,reportType:s,t:i}=this.props,o="cost"===s,c=(0,l.zJ)(e,o?0:1,"date",o?"cost":"usage"),u=(0,l.zJ)(r,o?0:1,"date",o?"cost":"usage"),p=e&&e.meta&&e.meta.total&&e.meta.total.cost?e.meta.total.cost.total.units:"USD";let h,d=e&&e.meta&&e.meta.total&&e.meta.total.usage?e.meta.total.usage.units:void 0;return o?h=i(`breakdown.historical_chart.${s}_label`,{units:i(`units.${(0,L.dM)(p)}`)}):(d&&Number.isNaN(Number(e.meta.total.usage.units))||(d=i(`breakdown.historical_chart.${s}_label`)),h=i("breakdown.historical_chart.units_label",{units:i(`units.${(0,L.dM)(d)}`)})),n().createElement("div",{style:j.chartContainer},n().createElement("div",{style:j.trendChart},1===t&&1===a?this.getSkeleton():n().createElement(U,{containerHeight:250,currentData:c,formatDatumValue:L.Bw,formatDatumOptions:{},height:300,previousData:u,units:o?p:d,xAxisLabel:i("breakdown.historical_chart.day_of_month_label"),yAxisLabel:h})))}}const K=(0,V.X1)(((e,{filterBy:t,groupBy:r,query:a,reportPathsType:s,reportType:n})=>{const i=a&&a.group_by[o.dV]?a.group_by[o.dV]:void 0,l="instance_type"===n||"storage"===n,c={filter:Object.assign(Object.assign({time_scope_units:"month",time_scope_value:-1,resolution:"daily",limit:3},a&&a.filter&&a.filter.account&&{account:a.filter.account}),i&&l&&{[o.dV]:i}),filter_by:a?a.filter_by:void 0,group_by:Object.assign(Object.assign({},i&&!l&&{[o.dV]:i}),{[r]:t})},u=(0,o.pm)(c),p={filter:Object.assign(Object.assign({time_scope_units:"month",time_scope_value:-2,resolution:"daily",limit:3},a&&a.filter&&a.filter.account&&{account:a.filter.account}),i&&l&&{[o.dV]:i}),filter_by:a?a.filter_by:void 0,group_by:Object.assign(Object.assign({},i&&!l&&{[o.dV]:i}),{[r]:t})},h=(0,o.pm)(p);return{currentQuery:c,currentQueryString:u,currentReport:I.ZV.selectReport(e,s,n,u),currentReportFetchStatus:I.ZV.selectReportFetchStatus(e,s,n,u),previousQuery:p,previousQueryString:h,previousReport:I.ZV.selectReport(e,s,n,h),previousReportFetchStatus:I.ZV.selectReportFetchStatus(e,s,n,h)}})),W={fetchReport:I.nx.fetchReport},H=(0,x.withTranslation)()((0,P.connect)(K,W)(N)),Q={currentCapacityData:{fill:"none"},currentColorScale:[E.CH.value,T.R0.value,S.t6.value,_.S7.value,k.iM.value],currentLimitData:{fill:"none"},currentRequestData:{fill:"none",strokeDasharray:"3,3"},currentUsageData:{fill:"none"},itemsPerRow:0,previousCapacityData:{fill:"none"},previousColorScale:[y.O6.value,b.OS.value,v.iY.value,f.cQ.value,C.DD.value],previousLimitData:{fill:"none"},previousRequestData:{fill:"none",strokeDasharray:"3,3"},previousUsageData:{fill:"none"},yAxis:{axisLabel:{padding:15},grid:{stroke:"none"},ticks:{stroke:"none"},tickLabels:{fontSize:0}},xAxis:{axisLabel:{padding:40},grid:{stroke:"none"},ticks:{stroke:"none"}}},X={chart:{marginTop:D.S1.value},title:{marginLeft:"-"+O.Js.value}};class J extends n().Component{constructor(){super(...arguments),this.containerRef=n().createRef(),this.resizeObserver=m.Z,this.navToggle=m.Z,this.state={hiddenSeries:new Set,width:0},this.initDatum=()=>{const{currentLimitData:e,currentRequestData:t,currentUsageData:r,previousLimitData:a,previousRequestData:s,previousUsageData:n}=this.props,i="chart.limit_legend_label",o="chart.limit_legend_tooltip",c="chart.requests_legend_label",u="chart.requests_legend_tooltip",p="chart.usage_legend_label",h="chart.usage_legend_tooltip",d=[{childName:"previousUsage",data:n,legendItem:{name:(0,l.Fs)(n,p,!0,!0,1),symbol:{fill:Q.previousColorScale[0],type:"minus"},tooltip:(0,l.Fs)(n,h,!1,!1,1)},style:{data:Object.assign(Object.assign({},Q.previousUsageData),{stroke:Q.previousColorScale[0]})}},{childName:"currentUsage",data:r,legendItem:{name:(0,l.Fs)(r,p,!0,!1),symbol:{fill:Q.currentColorScale[0],type:"minus"},tooltip:(0,l.Fs)(r,h,!1,!1)},style:{data:Object.assign(Object.assign({},Q.currentUsageData),{stroke:Q.currentColorScale[0]})}},{childName:"previousRequest",data:s,legendItem:{name:(0,l.Fs)(s,c,!0,!0,1),symbol:{fill:Q.previousColorScale[1],type:"dash"},tooltip:(0,l.Fs)(s,u,!1,!1,1)},style:{data:Object.assign(Object.assign({},Q.previousRequestData),{stroke:Q.previousColorScale[1]})}},{childName:"currentRequest",data:t,legendItem:{name:(0,l.Fs)(t,c,!0,!1),symbol:{fill:Q.currentColorScale[1],type:"dash"},tooltip:(0,l.Fs)(t,u,!1,!1)},style:{data:Object.assign(Object.assign({},Q.currentRequestData),{stroke:Q.currentColorScale[1]})}},{childName:"previousLimit",data:a,legendItem:{name:(0,l.Fs)(a,i,!0,!0,1),symbol:{fill:Q.previousColorScale[2],type:"minus"},tooltip:(0,l.Fs)(a,o,!1,!1,1)},style:{data:Object.assign(Object.assign({},Q.previousLimitData),{stroke:Q.previousColorScale[2]})}},{childName:"currentLimit",data:e,legendItem:{name:(0,l.Fs)(e,i,!0,!1),symbol:{fill:Q.currentColorScale[2],type:"minus"},tooltip:(0,l.Fs)(e,o,!1,!1)},style:{data:Object.assign(Object.assign({},Q.currentLimitData),{stroke:Q.currentColorScale[2]})}}],g=this.getCursorVoronoiContainer();this.setState({cursorVoronoiContainer:g,series:d})},this.initResizeObserve=()=>{const e=this.containerRef.current,{ResizeObserver:t}=window;if(e&&t){const r=new t(this.handleResize);r.observe(e),this.resizeObserver=()=>r.unobserve(e)}else this.handleResize(),window.addEventListener("resize",this.handleResize),this.resizeObserver=()=>window.removeEventListener("resize",this.handleResize),this.navToggle=insights.chrome.on("NAVIGATION_TOGGLE",this.handleNavToggle)},this.getChart=(e,t)=>{const{hiddenSeries:r}=this.state;return n().createElement(c.ChartArea,{data:r.has(t)?[{y:null}]:e.data,interpolation:"monotoneX",key:e.childName,name:e.childName,style:e.style})},this.getCursorVoronoiContainer=()=>{const{formatDatumValue:e,formatDatumOptions:t}=this.props,r=(0,c.createContainer)("voronoi","cursor");return n().createElement(r,{cursorDimension:"x",labels:({datum:r})=>(0,p.zj)(r,e,t),mouseFollowTooltips:!0,voronoiDimension:"x",voronoiPadding:{bottom:130,left:8,right:8,top:8}})},this.getLegend=()=>{const{legendItemsPerRow:e}=this.props,{hiddenSeries:t,series:r,width:a}=this.state,s=e||(a>900?Q.itemsPerRow:2);return n().createElement(c.ChartLegend,{data:(0,p.oX)(r,t),height:25,gutter:20,itemsPerRow:s,name:"legend"})},this.handleLegendClick=e=>{const t=(0,p.nV)(this.state.series,this.state.hiddenSeries,e);this.setState({hiddenSeries:t})},this.handleNavToggle=()=>{setTimeout(this.handleResize,500)},this.handleResize=()=>{const{width:e}=this.state,{clientWidth:t=0}=this.containerRef.current||{};t!==e&&this.setState({width:t})}}componentDidMount(){this.initDatum(),this.initResizeObserve()}componentDidUpdate(e){e.currentLimitData===this.props.currentLimitData&&e.currentRequestData===this.props.currentRequestData&&e.currentUsageData===this.props.currentUsageData&&e.previousLimitData===this.props.previousLimitData&&e.previousRequestData===this.props.previousRequestData&&e.previousUsageData===this.props.previousUsageData||this.initDatum()}componentWillUnmount(){this.resizeObserver&&this.resizeObserver(),this.navToggle&&this.navToggle()}getEndDate(){const{currentRequestData:e,currentUsageData:t,previousRequestData:r,previousUsageData:a}=this.props,s=e?(0,h.getDate)((0,l.Y_)(e,!0,!0)[1]):0,n=t?(0,h.getDate)((0,l.Y_)(t,!0,!0)[1]):0,i=r?(0,h.getDate)((0,l.Y_)(r,!0,!0)[1]):0,o=a?(0,h.getDate)((0,l.Y_)(a,!0,!0)[1]):0;return s>0||n>0||i>0||o>0?Math.max(s,n,i,o):31}getEvents(){const{hiddenSeries:e,series:t}=this.state;return(0,c.getInteractiveLegendEvents)({chartNames:(0,p.bC)(t),isHidden:t=>(0,p.Yt)(e,t),legendName:"legend",onLegendClick:e=>this.handleLegendClick(e.index)})}render(){const{adjustContainerHeight:e,height:t,containerHeight:r=t,padding:s={bottom:130,left:8,right:8,top:8},title:i,xAxisLabel:o,yAxisLabel:l}=this.props,{cursorVoronoiContainer:h,hiddenSeries:d,series:m,width:y}=this.state,b=(0,p.ge)(m,d),v=this.getEndDate(),f=Math.floor(v/2),C=e&&y>900?r-50:r,_=h?n().cloneElement(h,{disable:!(0,p.TW)(m,d),labelComponent:n().createElement(c.ChartLegendTooltip,{legendData:(0,p.oX)(m,d,!0),title:e=>g().t("chart.day_of_month_title",{day:e.x})})}):void 0;return n().createElement("div",{className:"chartOverride",ref:this.containerRef},n().createElement(a.Title,{headingLevel:"h2",style:X.title,size:"xl"},i),n().createElement("div",{style:Object.assign(Object.assign({},X.chart),{height:C})},n().createElement("div",{style:{height:t,width:y}},n().createElement(c.Chart,{containerComponent:_,domain:b,events:this.getEvents(),height:t,legendComponent:this.getLegend(),legendData:(0,p.oX)(m,d),legendPosition:"bottom",padding:s,theme:u.Z,width:y},m&&m.map(((e,t)=>this.getChart(e,t))),n().createElement(c.ChartAxis,{label:o,style:Q.xAxis,tickValues:[1,f,v]}),n().createElement(c.ChartAxis,{dependentAxis:!0,label:l,style:Q.yAxis})))))}}class Y extends n().Component{constructor(){super(...arguments),this.getSkeleton=()=>n().createElement(n().Fragment,null,n().createElement(i.Skeleton,{style:j.chartSkeleton,size:"md"}),n().createElement(i.Skeleton,{style:j.legendSkeleton,size:"xs"}))}componentDidMount(){const{fetchReport:e,currentQueryString:t,previousQueryString:r,reportPathsType:a,reportType:s}=this.props;e(a,s,t),e(a,s,r)}componentDidUpdate(e){const{fetchReport:t,currentQueryString:r,previousQueryString:a,reportPathsType:s,reportType:n}=this.props;e.currentQueryString!==r&&t(s,n,r),e.previousQueryString!==a&&t(s,n,a)}render(){const{currentReport:e,currentReportFetchStatus:t,previousReport:r,previousReportFetchStatus:a,t:s}=this.props,i=(0,l.zJ)(e,1,"date","limit"),o=(0,l.zJ)(e,1,"date","request"),c=(0,l.zJ)(e,1,"date","usage"),u=(0,l.zJ)(r,1,"date","limit"),p=(0,l.zJ)(r,1,"date","request"),h=(0,l.zJ)(r,1,"date","usage"),d=e&&e.meta&&e.meta.total&&e.meta.total.usage?e.meta.total.usage.units:"";return n().createElement("div",{style:j.chartContainer},n().createElement("div",{style:j.usageChart},1===t&&1===a?this.getSkeleton():n().createElement(J,{adjustContainerHeight:!0,containerHeight:300,currentLimitData:i,currentRequestData:o,currentUsageData:c,formatDatumValue:L.Bw,formatDatumOptions:{},height:300,previousLimitData:u,previousRequestData:p,previousUsageData:h,xAxisLabel:s("breakdown.historical_chart.day_of_month_label"),yAxisLabel:s("breakdown.historical_chart.units_label",{units:s(`units.${(0,L.dM)(d)}`)})})))}}const ee=(0,V.X1)(((e,{filterBy:t,groupBy:r,reportPathsType:a,reportType:s})=>{const n={filter:{time_scope_units:"month",time_scope_value:-1,resolution:"daily",limit:3},group_by:{[r]:t}},i=(0,o.pm)(n),l={filter:{time_scope_units:"month",time_scope_value:-2,resolution:"daily",limit:3},group_by:{[r]:t}},c=(0,o.pm)(l);return{currentQuery:n,currentQueryString:i,currentReport:I.ZV.selectReport(e,a,s,i),currentReportFetchStatus:I.ZV.selectReportFetchStatus(e,a,s,i),previousQuery:l,previousQueryString:c,previousReport:I.ZV.selectReport(e,a,s,c),previousReportFetchStatus:I.ZV.selectReportFetchStatus(e,a,s,c)}})),te={fetchReport:I.nx.fetchReport},re=(0,x.withTranslation)()((0,P.connect)(ee,te)(Y));class ae extends n().Component{constructor(){super(...arguments),this.getCostChart=e=>{const{filterBy:t,groupBy:r,t:s}=this.props;return n().createElement(a.Card,null,n().createElement(a.CardTitle,null,n().createElement(a.Title,{headingLevel:"h2",size:"lg"},s(`breakdown.historical_chart.${e.reportType}_title`))),n().createElement(a.CardBody,null,n().createElement(Z,{filterBy:t,groupBy:r,reportPathsType:e.reportPathsType,reportType:e.reportType})))},this.getTrendChart=e=>{const{filterBy:t,groupBy:r,query:s,t:i}=this.props;return n().createElement(a.Card,null,n().createElement(a.CardTitle,null,n().createElement(a.Title,{headingLevel:"h2",size:"lg"},i(`breakdown.historical_chart.${e.reportType}_title`))),n().createElement(a.CardBody,null,n().createElement(H,{filterBy:t,groupBy:r,query:s,reportPathsType:e.reportPathsType,reportType:e.reportType})))},this.getUsageChart=e=>{const{filterBy:t,groupBy:r,t:s}=this.props;return n().createElement(a.Card,null,n().createElement(a.CardTitle,null,n().createElement(a.Title,{headingLevel:"h2",size:"lg"},s(`breakdown.historical_chart.${e.reportType}_title`))),n().createElement(a.CardBody,null,n().createElement(re,{filterBy:t,groupBy:r,reportPathsType:e.reportPathsType,reportType:e.reportType})))}}renderWidget(e){switch(e.type){case"cost":return this.getCostChart(e);case"trend":return this.getTrendChart(e);case"usage":return this.getUsageChart(e);default:return null}}render(){const{selectWidgets:e,widgets:t}=this.props;return n().createElement(a.Grid,{hasGutter:!0},t.map((t=>{const r=e[t];return n().createElement(a.GridItem,{key:`widget-${t}`},this.renderWidget(r))})))}}},60635:(e,t,r)=>{"use strict";r.d(t,{V:()=>s,p:()=>n});var a=r(45997);const s=e=>(e&&e.group_by?Object.keys(e.group_by):[]).find((e=>e!==a.dV)),n=e=>{const t=s(e);return t?e.group_by[t]:void 0}},2646:(e,t,r)=>{"use strict";r.d(t,{W:()=>p});var a=r(49382),s=r(33605),n=r(50021),i=r(17918),o=r(54881),l=r(98499),c=r(32412),u=r(48196);const p={cost:{display:"flex",alignItems:"center"},costLabel:{},costValue:{marginTop:0,marginBottom:0,marginRight:c.ZP.var},costLabelUnit:{fontSize:o.ZP.value,color:s.ZP.var},costLabelDate:{fontSize:o.ZP.value,color:n.ZP.var},header:{display:"flex",justifyContent:"space-between",padding:l.ZP.var,backgroundColor:a.ZP.var},info:{verticalAlign:"middle"},infoIcon:{fontSize:i.ZP.value},infoTitle:{fontWeight:"bold"},title:{paddingBottom:u.ZP.var}}},16679:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});const a=r(64146).Z},81787:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var a=r(47205),s=r(84049),n=r(62616),i=r(97522),o=r.n(i);const l=(0,r(55399).withRouter)((({title:e})=>o().createElement(o().Fragment,null,e&&o().createElement(s.PageHeader,null,o().createElement(s.PageHeaderTitle,{title:e})),o().createElement(a.Main,null,o().createElement(n.Unavailable,null)))))},76821:(e,t,r)=>{"use strict";r.d(t,{g_:()=>a,_q:()=>s});const a=e=>({"data-testid":e}),s={details:{cluster_lnk:"cluster-lnk",historical_data_btn:"historical-data-btn",show_more_btn:"show-more-btn",tag_lnk:"tag-lnk",view_all_btn:"view-all-btn"},export:{cancel_btn:"cancel-btn",submit_btn:"submit-btn"},login:{alert:"alert",form:"login-form",username_input:"username-input",password_input:"password-input",submit:"submit"},masthead:{masthead:"masthead",username:"username",sidebarToggle:"sidebar-toggle",logout:"logout"},onboarding:{btn_cancel:"btn-cancel",btn_back:"btn-back",btn_continue:"btn-continue",btn_close:"btn-close",type_selector:"type-selector",type_opt_aws:"type-option-aws",type_opt_ocp:"type-option-ocp",type_opt_non:"type-option-non",name_input:"name-input",check_box_1:"check-box-1",check_box_2:"check-box-2",s3_input:"s3-input",clusterid_input:"clusterid-input",arn_input:"arn-input"},providers:{add_btn:"add-btn",bucket_input:"bucket-input",cancel_btn:"cancel-btn",empty_state_add_btn:"empty_state_add-btn",name_input:"provider-name-input",resource_name_input:"provider-resource-name-input",cluster_id_input:"provider-cluster-id-input",submit_btn:"submit-btn",type_input:"provider-type-input"},sidebar:{nav:"vertical-nav",link:"vertical-nav-link",backdrop:"sidebar-backdrop"}}},33307:(e,t,r)=>{"use strict";r.d(t,{Tf:()=>i,Y:()=>o,J4:()=>l});var a=r(36234),s=r(30136),n=r.n(s);function i(e="no_data_for_date",t=1){const r=new Date;t&&r.setMonth(r.getMonth()-t);const s=(0,a.getMonth)(r),i=(0,a.format)(r,"d"),o=(0,a.format)((0,a.startOfMonth)(r),"d");return n().t(e,{count:(0,a.getDate)(r),endDate:i,month:s,startDate:o})}function o(e,t="for_date",r=1){const s=new Date;r&&s.setMonth(s.getMonth()-r);const i=(0,a.getMonth)(s),o=(0,a.format)(s,"d"),l=(0,a.format)((0,a.startOfMonth)(s),"d");return n().t(t,{count:(0,a.getDate)(s),endDate:o,month:i,startDate:l,value:e})}function l(e="since_date"){const t=new Date,r=(0,a.getMonth)(t),s=(0,a.format)(t,"d"),i=(0,a.format)((0,a.startOfMonth)(t),"d");return n().t(e,{count:(0,a.getDate)(t),endDate:s,month:r,startDate:i})}},19853:(e,t,r)=>{"use strict";function a(e,t){let r=JSON.stringify(e),a=JSON.stringify(t);return r||(r=""),a||(a=""),r.split("").sort().join("")===a.split("").sort().join("")}r.d(t,{X:()=>a})}}]);
//# sourceMappingURL=4736653a1b712ac382aa.bundle.js.map