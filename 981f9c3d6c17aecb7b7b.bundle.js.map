{"version":3,"sources":["webpack:///./node_modules/xstate/es/_virtual/_tslib.js","webpack:///./node_modules/xstate/es/utils.js","webpack:///./node_modules/xstate/es/environment.js","webpack:///./node_modules/xstate/es/types.js","webpack:///./node_modules/xstate/es/constants.js","webpack:///./node_modules/xstate/es/stateUtils.js","webpack:///./node_modules/xstate/es/actions.js","webpack:///./node_modules/xstate/es/actionTypes.js","webpack:///./node_modules/xstate/es/State.js","webpack:///./node_modules/xstate/es/Actor.js","webpack:///./node_modules/xstate/es/scheduler.js","webpack:///./node_modules/xstate/es/registry.js","webpack:///./node_modules/xstate/es/devTools.js","webpack:///./node_modules/xstate/es/interpreter.js","webpack:///./node_modules/xstate/es/StateNode.js","webpack:///./node_modules/xstate/es/Machine.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__values","o","m","Symbol","iterator","next","value","done","__read","r","ar","push","error","__spread","concat","keys","matchesState","parentStateId","childStateId","delimiter","parentStateValue","toStateValue","childStateValue","isString","every","key","getEventType","event","type","Error","toStatePath","stateId","isArray","toString","split","stateValue","state","pathToStateValue","statePath","marker","mapValues","collection","iteratee","result","collectionKeys","mapFilterValues","predicate","e_1","_a","_b","_c","item","e_1_1","return","path","props","object","e_2","props_1","props_1_1","e_2_1","nestedPath","accessorProp","e_3","props_2","props_2_1","prop","e_3_1","toStatePaths","flatten","map","subStateValue","subPath","array","toArrayStrict","toArray","undefined","mapContext","mapper","context","_event","e_5","isFunction","data","subMapper","e_5_1","isBuiltInEvent","eventType","test","isPromiseLike","Promise","then","partition","items","e_6","truthy","falsy","items_1","items_1_1","e_6_1","updateHistoryStates","hist","states","subHist","current","updateHistoryValue","updateContext","assignActions","warn","reduce","acc","assignAction","e_7","assignment","meta","action","partialUpdate","propAssignment","e_7_1","Array","toGuard","condition","guardMap","name","isObservable","subscribe","message","console","args","symbolObservable","observable","isMachine","uniqueId","currentId","toEventObject","payload","toSCXMLEvent","scxmlEvent","$$type","eventObject","toTransitionConfigArray","configLike","transitionLike","target","normalizeTarget","reportUnhandledExceptionOnInvocation","originalError","currentError","id","originalStackTrace","stack","stackTrace","IS_PRODUCTION","ActionTypes","SpecialTargets","STATE_DELIMITER","EMPTY_ACTIVITY_MAP","DEFAULT_GUARD_TYPE","TARGETLESS_KEY","isLeafNode","stateNode","getChildren","getAllStateNodes","stateNodes","getConfiguration","prevStateNodes","e_4","_d","prevAdjList","getAdjList","Set","configuration","configuration_1","configuration_1_1","parent","has","add","adjList","configuration_2","configuration_2_1","get","_e","_f","child","forEach","sn","initialStateNodes","configuration_3","configuration_3_1","e_4_1","Map","configuration_4","configuration_4_1","set","getValue","rootNode","getValueFromAdj","baseNode","childStateNodes","childStateNode","csn","iterable","some","member","nextEvents","ownEvents","isInFinalState","initEvent","getActionFunction","actionType","actionFunctionMap","toActionObject","actionObject","exec","other","defineProperty","enumerable","configurable","toActionObjects","subAction","toActivityDefinition","raise","send","to","Internal","resolveRaise","options","delay","resolveSend","ctx","delaysMap","resolvedDelay","resolvedEvent","configDelay","resolvedTarget","resolveLog","expr","cancel","sendId","start","activity","activityDef","Start","stop","Stop","after","delayRef","idSuffix","After","DoneState","doneInvoke","DoneInvoke","ErrorPlatform","Raise","Send","Cancel","nullEvent","NullEvent","Assign","log","Log","init","Init","invoke","Invoke","errorPlatform","ErrorExecution","ErrorCustom","update","Update","pure","Pure","stateValuesEqual","a","b","aKeys","bKeys","isState","bindActionToState","State","config","actions","activities","events","_sessionid","historyValue","history","matches","bind","toStrings","transitions","children","from","create","inert","_this","valueKeys","toJSON","createInvocableActor","invokeDefinition","tempActor","unsubscribe","isActor","defaultOptions","deferEvents","Scheduler","processingEvent","queue","initialized","initialize","callback","schedule","process","flushEvents","task","clear","nextCallback","shift","sessionIdIndex","registry","bookId","register","actor","free","delete","registerService","service","window","devTools","w","__xstate__","getDevTools","InterpreterStatus","DEFAULT_SPAWN_OPTIONS","sync","autoForward","withServiceScope","serviceStack","fn","pop","Interpreter","machine","scheduler","delayedEventsMap","listeners","contextListeners","stopListeners","doneListeners","eventListeners","sendListeners","_status","NotStarted","forwardTo","batch","Stopped","JSON","stringify","Running","forward","nextState","_state","sendTo","isParent","Parent","origin","sessionId","resolvedOptions","clock","logger","resolvedId","_initialState","initialState","execute","actionsConfig","listener","_g","_h","_j","_k","contextListener","isDone","finalChildStateNode","find","doneData","_l","_m","onTransition","nextListenerOrObserver","errorListener","completeListener","resolvedCompleteListener","complete","onDone","onEvent","onSend","onChange","onStop","off","resolvedState","resolveState","attachDev","e_8","e_9","e_10","e_8_1","_o","e_9_1","_p","_q","clearTimeout","e_10_1","e_11","batchChanged","batchedActions","_loop_1","event_1","transition","changed","events_1","events_1_1","e_11_1","sender","nextEvent","e_12","e_12_1","defer","sendAction","setTimeout","actionOrExec","err","serviceCreator","services","src","source","spawnPromise","resolve","spawnCallback","spawnObservable","spawnMachine","withContext","spawnActivity","stopChild","label","childId","spawn","entity","spawnActor","childService","doneEvent","promise","canceled","response","errorData","errorEvent","strict","handleError","unsubscribed","callbackStop","receivers","newListener","receiver","subscription","implementation","dispose","spawnEffect","__REDUX_DEVTOOLS_EXTENSION__","devToolsOptions","connect","autoPause","stateSanitizer","features","jump","skip","global","ms","interpret","EMPTY_OBJECT","isStateId","str","StateNode","order","__xstatenode","__cache","relativeValue","initialStateValue","on","candidates","delayedTransitions","idMap","guards","delays","_parent","_key","join","version","parallel","initial","stateConfig","dfs","_transient","onEntry","entry","onExit","exit","invokeConfig","invokeSrc","_init","withConfig","definition","getDelayedTransitions","formatTransitions","getCandidates","eventName","transient","filter","sameEventType","afterConfig","mutateEntryExit","configTransition","resolvedTransition","isNaN","delayedTransition","formatTransition","getStateNodes","getStateNode","subStateKeys","subStateKey","allSubStateNodes","subStateNode","handles","includes","transitionLeafNode","transitionCompoundNode","_transition","transitionParallelNode","transitionMap","stateTransitions","enabledTransitions","st","entryNodes","entrySet","exitSet","selectedTransition","nextStateNodes","candidate","cond","stateIn","in","resolvedContext","isInState","getStateNodeById","slice","guardPassed","evaluateGuard","allNextStateNodes","getRelativeStateNodes","isInternal","internal","nodesFromChild","escapes","nodes","guard","guardMeta","condFn","getActions","currentContext","prevState","prevConfig","resolvedConfig","resolvedConfig_1","resolvedConfig_1_1","prevConfig_1","prevConfig_1_1","doneEvents","grandparent","parentNode","sort","entryStates","exitStates","entryActions","exitActions","currentState","resolvedStateValue","getResolvedPath","stateTransition","resolveTransition","resolveRaisedTransition","originalEvent","currentActions","unshift","actions_1","actions_1_1","otherActions","updatedContext","resolvedActions","raisedEvents","nonRaisedActions","resolvedConfiguration","maybeNextState","raisedEvent","stateKey","resolvedStateId","getStateNodeByPath","arrayStatePath","currentStateNode","stateIdentifier","getInitialState","historyConfig","relativeStateId","resolveHistory","initialStateNodePaths","initialPath","getFromRelativePath","relativePath","childStatePath","relativeStateValue","historyTarget","relativeChildPath","subHistoryValue","subStatePath","childStateIds","stateIds","resolveTarget","_target","isInternalTarget","transitionConfig","normalizedTarget","onConfig","wildcardConfigs","strictOnConfigs_1","arrayified","hasNonLastUnguardedTarget","eventText","validateArrayifiedTransitions","doneConfig","String","invokeDef","settleTransitions","onError","formattedTransitions","delayedTransitions_1","delayedTransitions_1_1","Machine","initialContext","resolvedInitialContext"],"mappings":"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","file":"981f9c3d6c17aecb7b7b.bundle.js","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nfunction __rest(s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n}\n\nfunction __values(o) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator],\n      i = 0;\n  if (m) return m.call(o);\n  return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n}\n\nfunction __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n}\n\nfunction __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n}\n\nexport { __assign, __read, __rest, __spread, __values };","import { __spread, __values, __read, __assign } from './_virtual/_tslib.js';\nimport { DEFAULT_GUARD_TYPE, TARGETLESS_KEY, STATE_DELIMITER } from './constants.js';\nimport { IS_PRODUCTION } from './environment.js';\n\nfunction keys(value) {\n  return Object.keys(value);\n}\n\nfunction matchesState(parentStateId, childStateId, delimiter) {\n  if (delimiter === void 0) {\n    delimiter = STATE_DELIMITER;\n  }\n\n  var parentStateValue = toStateValue(parentStateId, delimiter);\n  var childStateValue = toStateValue(childStateId, delimiter);\n\n  if (isString(childStateValue)) {\n    if (isString(parentStateValue)) {\n      return childStateValue === parentStateValue;\n    } // Parent more specific than child\n\n\n    return false;\n  }\n\n  if (isString(parentStateValue)) {\n    return parentStateValue in childStateValue;\n  }\n\n  return keys(parentStateValue).every(function (key) {\n    if (!(key in childStateValue)) {\n      return false;\n    }\n\n    return matchesState(parentStateValue[key], childStateValue[key]);\n  });\n}\n\nfunction getEventType(event) {\n  try {\n    return isString(event) || typeof event === 'number' ? \"\" + event : event.type;\n  } catch (e) {\n    throw new Error('Events must be strings or objects with a string event.type property.');\n  }\n}\n\nfunction toStatePath(stateId, delimiter) {\n  try {\n    if (isArray(stateId)) {\n      return stateId;\n    }\n\n    return stateId.toString().split(delimiter);\n  } catch (e) {\n    throw new Error(\"'\" + stateId + \"' is not a valid state path.\");\n  }\n}\n\nfunction isStateLike(state) {\n  return typeof state === 'object' && 'value' in state && 'context' in state && 'event' in state && '_event' in state;\n}\n\nfunction toStateValue(stateValue, delimiter) {\n  if (isStateLike(stateValue)) {\n    return stateValue.value;\n  }\n\n  if (isArray(stateValue)) {\n    return pathToStateValue(stateValue);\n  }\n\n  if (typeof stateValue !== 'string') {\n    return stateValue;\n  }\n\n  var statePath = toStatePath(stateValue, delimiter);\n  return pathToStateValue(statePath);\n}\n\nfunction pathToStateValue(statePath) {\n  if (statePath.length === 1) {\n    return statePath[0];\n  }\n\n  var value = {};\n  var marker = value;\n\n  for (var i = 0; i < statePath.length - 1; i++) {\n    if (i === statePath.length - 2) {\n      marker[statePath[i]] = statePath[i + 1];\n    } else {\n      marker[statePath[i]] = {};\n      marker = marker[statePath[i]];\n    }\n  }\n\n  return value;\n}\n\nfunction mapValues(collection, iteratee) {\n  var result = {};\n  var collectionKeys = keys(collection);\n\n  for (var i = 0; i < collectionKeys.length; i++) {\n    var key = collectionKeys[i];\n    result[key] = iteratee(collection[key], key, collection, i);\n  }\n\n  return result;\n}\n\nfunction mapFilterValues(collection, iteratee, predicate) {\n  var e_1, _a;\n\n  var result = {};\n\n  try {\n    for (var _b = __values(keys(collection)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var key = _c.value;\n      var item = collection[key];\n\n      if (!predicate(item)) {\n        continue;\n      }\n\n      result[key] = iteratee(item, key, collection);\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return result;\n}\n/**\r\n * Retrieves a value at the given path.\r\n * @param props The deep path to the prop of the desired value\r\n */\n\n\nvar path = function (props) {\n  return function (object) {\n    var e_2, _a;\n\n    var result = object;\n\n    try {\n      for (var props_1 = __values(props), props_1_1 = props_1.next(); !props_1_1.done; props_1_1 = props_1.next()) {\n        var prop = props_1_1.value;\n        result = result[prop];\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (props_1_1 && !props_1_1.done && (_a = props_1.return)) _a.call(props_1);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    return result;\n  };\n};\n/**\r\n * Retrieves a value at the given path via the nested accessor prop.\r\n * @param props The deep path to the prop of the desired value\r\n */\n\n\nfunction nestedPath(props, accessorProp) {\n  return function (object) {\n    var e_3, _a;\n\n    var result = object;\n\n    try {\n      for (var props_2 = __values(props), props_2_1 = props_2.next(); !props_2_1.done; props_2_1 = props_2.next()) {\n        var prop = props_2_1.value;\n        result = result[accessorProp][prop];\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (props_2_1 && !props_2_1.done && (_a = props_2.return)) _a.call(props_2);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    return result;\n  };\n}\n\nfunction toStatePaths(stateValue) {\n  if (!stateValue) {\n    return [[]];\n  }\n\n  if (isString(stateValue)) {\n    return [[stateValue]];\n  }\n\n  var result = flatten(keys(stateValue).map(function (key) {\n    var subStateValue = stateValue[key];\n\n    if (typeof subStateValue !== 'string' && (!subStateValue || !Object.keys(subStateValue).length)) {\n      return [[key]];\n    }\n\n    return toStatePaths(stateValue[key]).map(function (subPath) {\n      return [key].concat(subPath);\n    });\n  }));\n  return result;\n}\n\nfunction flatten(array) {\n  var _a;\n\n  return (_a = []).concat.apply(_a, __spread(array));\n}\n\nfunction toArrayStrict(value) {\n  if (isArray(value)) {\n    return value;\n  }\n\n  return [value];\n}\n\nfunction toArray(value) {\n  if (value === undefined) {\n    return [];\n  }\n\n  return toArrayStrict(value);\n}\n\nfunction mapContext(mapper, context, _event) {\n  var e_5, _a;\n\n  if (isFunction(mapper)) {\n    return mapper(context, _event.data);\n  }\n\n  var result = {};\n\n  try {\n    for (var _b = __values(keys(mapper)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var key = _c.value;\n      var subMapper = mapper[key];\n\n      if (isFunction(subMapper)) {\n        result[key] = subMapper(context, _event.data);\n      } else {\n        result[key] = subMapper;\n      }\n    }\n  } catch (e_5_1) {\n    e_5 = {\n      error: e_5_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_5) throw e_5.error;\n    }\n  }\n\n  return result;\n}\n\nfunction isBuiltInEvent(eventType) {\n  return /^(done|error)\\./.test(eventType);\n}\n\nfunction isPromiseLike(value) {\n  if (value instanceof Promise) {\n    return true;\n  } // Check if shape matches the Promise/A+ specification for a \"thenable\".\n\n\n  if (value !== null && (isFunction(value) || typeof value === 'object') && isFunction(value.then)) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction partition(items, predicate) {\n  var e_6, _a;\n\n  var _b = __read([[], []], 2),\n      truthy = _b[0],\n      falsy = _b[1];\n\n  try {\n    for (var items_1 = __values(items), items_1_1 = items_1.next(); !items_1_1.done; items_1_1 = items_1.next()) {\n      var item = items_1_1.value;\n\n      if (predicate(item)) {\n        truthy.push(item);\n      } else {\n        falsy.push(item);\n      }\n    }\n  } catch (e_6_1) {\n    e_6 = {\n      error: e_6_1\n    };\n  } finally {\n    try {\n      if (items_1_1 && !items_1_1.done && (_a = items_1.return)) _a.call(items_1);\n    } finally {\n      if (e_6) throw e_6.error;\n    }\n  }\n\n  return [truthy, falsy];\n}\n\nfunction updateHistoryStates(hist, stateValue) {\n  return mapValues(hist.states, function (subHist, key) {\n    if (!subHist) {\n      return undefined;\n    }\n\n    var subStateValue = (isString(stateValue) ? undefined : stateValue[key]) || (subHist ? subHist.current : undefined);\n\n    if (!subStateValue) {\n      return undefined;\n    }\n\n    return {\n      current: subStateValue,\n      states: updateHistoryStates(subHist, subStateValue)\n    };\n  });\n}\n\nfunction updateHistoryValue(hist, stateValue) {\n  return {\n    current: stateValue,\n    states: updateHistoryStates(hist, stateValue)\n  };\n}\n\nfunction updateContext(context, _event, assignActions, state) {\n  if (!IS_PRODUCTION) {\n    warn(!!context, 'Attempting to update undefined context');\n  }\n\n  var updatedContext = context ? assignActions.reduce(function (acc, assignAction) {\n    var e_7, _a;\n\n    var assignment = assignAction.assignment;\n    var meta = {\n      state: state,\n      action: assignAction,\n      _event: _event\n    };\n    var partialUpdate = {};\n\n    if (isFunction(assignment)) {\n      partialUpdate = assignment(acc, _event.data, meta);\n    } else {\n      try {\n        for (var _b = __values(keys(assignment)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var key = _c.value;\n          var propAssignment = assignment[key];\n          partialUpdate[key] = isFunction(propAssignment) ? propAssignment(acc, _event.data, meta) : propAssignment;\n        }\n      } catch (e_7_1) {\n        e_7 = {\n          error: e_7_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_7) throw e_7.error;\n        }\n      }\n    }\n\n    return Object.assign({}, acc, partialUpdate);\n  }, context) : context;\n  return updatedContext;\n} // tslint:disable-next-line:no-empty\n\n\nvar warn = function () {};\n\nif (!IS_PRODUCTION) {\n  warn = function (condition, message) {\n    var error = condition instanceof Error ? condition : undefined;\n\n    if (!error && condition) {\n      return;\n    }\n\n    if (console !== undefined) {\n      var args = [\"Warning: \" + message];\n\n      if (error) {\n        args.push(error);\n      } // tslint:disable-next-line:no-console\n\n\n      console.warn.apply(console, args);\n    }\n  };\n}\n\nfunction isArray(value) {\n  return Array.isArray(value);\n} // tslint:disable-next-line:ban-types\n\n\nfunction isFunction(value) {\n  return typeof value === 'function';\n}\n\nfunction isString(value) {\n  return typeof value === 'string';\n} // export function memoizedGetter<T, TP extends { prototype: object }>(\n//   o: TP,\n//   property: string,\n//   getter: () => T\n// ): void {\n//   Object.defineProperty(o.prototype, property, {\n//     get: getter,\n//     enumerable: false,\n//     configurable: false\n//   });\n// }\n\n\nfunction toGuard(condition, guardMap) {\n  if (!condition) {\n    return undefined;\n  }\n\n  if (isString(condition)) {\n    return {\n      type: DEFAULT_GUARD_TYPE,\n      name: condition,\n      predicate: guardMap ? guardMap[condition] : undefined\n    };\n  }\n\n  if (isFunction(condition)) {\n    return {\n      type: DEFAULT_GUARD_TYPE,\n      name: condition.name,\n      predicate: condition\n    };\n  }\n\n  return condition;\n}\n\nfunction isObservable(value) {\n  try {\n    return 'subscribe' in value && isFunction(value.subscribe);\n  } catch (e) {\n    return false;\n  }\n}\n\nvar symbolObservable =\n/*#__PURE__*/\nfunction () {\n  return typeof Symbol === 'function' && Symbol.observable || '@@observable';\n}();\n\nfunction isMachine(value) {\n  try {\n    return '__xstatenode' in value;\n  } catch (e) {\n    return false;\n  }\n}\n\nvar uniqueId =\n/*#__PURE__*/\nfunction () {\n  var currentId = 0;\n  return function () {\n    currentId++;\n    return currentId.toString(16);\n  };\n}();\n\nfunction toEventObject(event, payload // id?: TEvent['type']\n) {\n  if (isString(event) || typeof event === 'number') {\n    return __assign({\n      type: event\n    }, payload);\n  }\n\n  return event;\n}\n\nfunction toSCXMLEvent(event, scxmlEvent) {\n  if (!isString(event) && '$$type' in event && event.$$type === 'scxml') {\n    return event;\n  }\n\n  var eventObject = toEventObject(event);\n  return __assign({\n    name: eventObject.type,\n    data: eventObject,\n    $$type: 'scxml',\n    type: 'external'\n  }, scxmlEvent);\n}\n\nfunction toTransitionConfigArray(event, configLike) {\n  var transitions = toArrayStrict(configLike).map(function (transitionLike) {\n    if (typeof transitionLike === 'undefined' || typeof transitionLike === 'string' || isMachine(transitionLike)) {\n      // @ts-ignore until Type instantiation is excessively deep and possibly infinite bug is fixed\n      return {\n        target: transitionLike,\n        event: event\n      };\n    }\n\n    return __assign(__assign({}, transitionLike), {\n      event: event\n    });\n  });\n  return transitions;\n}\n\nfunction normalizeTarget(target) {\n  if (target === undefined || target === TARGETLESS_KEY) {\n    return undefined;\n  }\n\n  return toArray(target);\n}\n\nfunction reportUnhandledExceptionOnInvocation(originalError, currentError, id) {\n  if (!IS_PRODUCTION) {\n    var originalStackTrace = originalError.stack ? \" Stacktrace was '\" + originalError.stack + \"'\" : '';\n\n    if (originalError === currentError) {\n      // tslint:disable-next-line:no-console\n      console.error(\"Missing onError handler for invocation '\" + id + \"', error was '\" + originalError + \"'.\" + originalStackTrace);\n    } else {\n      var stackTrace = currentError.stack ? \" Stacktrace was '\" + currentError.stack + \"'\" : ''; // tslint:disable-next-line:no-console\n\n      console.error(\"Missing onError handler and/or unhandled exception/promise rejection for invocation '\" + id + \"'. \" + (\"Original error: '\" + originalError + \"'. \" + originalStackTrace + \" Current error is '\" + currentError + \"'.\" + stackTrace));\n    }\n  }\n}\n\nexport { flatten, getEventType, isArray, isBuiltInEvent, isFunction, isMachine, isObservable, isPromiseLike, isStateLike, isString, keys, mapContext, mapFilterValues, mapValues, matchesState, nestedPath, normalizeTarget, partition, path, pathToStateValue, reportUnhandledExceptionOnInvocation, symbolObservable, toArray, toArrayStrict, toEventObject, toGuard, toSCXMLEvent, toStatePath, toStatePaths, toStateValue, toTransitionConfigArray, uniqueId, updateContext, updateHistoryStates, updateHistoryValue, warn };","var IS_PRODUCTION = process.env.NODE_ENV === 'production';\nexport { IS_PRODUCTION };","var ActionTypes;\n\n(function (ActionTypes) {\n  ActionTypes[\"Start\"] = \"xstate.start\";\n  ActionTypes[\"Stop\"] = \"xstate.stop\";\n  ActionTypes[\"Raise\"] = \"xstate.raise\";\n  ActionTypes[\"Send\"] = \"xstate.send\";\n  ActionTypes[\"Cancel\"] = \"xstate.cancel\";\n  ActionTypes[\"NullEvent\"] = \"\";\n  ActionTypes[\"Assign\"] = \"xstate.assign\";\n  ActionTypes[\"After\"] = \"xstate.after\";\n  ActionTypes[\"DoneState\"] = \"done.state\";\n  ActionTypes[\"DoneInvoke\"] = \"done.invoke\";\n  ActionTypes[\"Log\"] = \"xstate.log\";\n  ActionTypes[\"Init\"] = \"xstate.init\";\n  ActionTypes[\"Invoke\"] = \"xstate.invoke\";\n  ActionTypes[\"ErrorExecution\"] = \"error.execution\";\n  ActionTypes[\"ErrorCommunication\"] = \"error.communication\";\n  ActionTypes[\"ErrorPlatform\"] = \"error.platform\";\n  ActionTypes[\"ErrorCustom\"] = \"xstate.error\";\n  ActionTypes[\"Update\"] = \"xstate.update\";\n  ActionTypes[\"Pure\"] = \"xstate.pure\";\n})(ActionTypes || (ActionTypes = {}));\n\nvar SpecialTargets;\n\n(function (SpecialTargets) {\n  SpecialTargets[\"Parent\"] = \"#_parent\";\n  SpecialTargets[\"Internal\"] = \"#_internal\";\n})(SpecialTargets || (SpecialTargets = {}));\n\nexport { ActionTypes, SpecialTargets };","var STATE_DELIMITER = '.';\nvar EMPTY_ACTIVITY_MAP = {};\nvar DEFAULT_GUARD_TYPE = 'xstate.guard';\nvar TARGETLESS_KEY = '';\nexport { DEFAULT_GUARD_TYPE, EMPTY_ACTIVITY_MAP, STATE_DELIMITER, TARGETLESS_KEY };","import { __values, __spread } from './_virtual/_tslib.js';\nimport { keys, flatten } from './utils.js';\n\nvar isLeafNode = function (stateNode) {\n  return stateNode.type === 'atomic' || stateNode.type === 'final';\n};\n\nfunction getChildren(stateNode) {\n  return keys(stateNode.states).map(function (key) {\n    return stateNode.states[key];\n  });\n}\n\nfunction getAllStateNodes(stateNode) {\n  var stateNodes = [stateNode];\n\n  if (isLeafNode(stateNode)) {\n    return stateNodes;\n  }\n\n  return stateNodes.concat(flatten(getChildren(stateNode).map(getAllStateNodes)));\n}\n\nfunction getConfiguration(prevStateNodes, stateNodes) {\n  var e_1, _a, e_2, _b, e_3, _c, e_4, _d;\n\n  var prevConfiguration = new Set(prevStateNodes);\n  var prevAdjList = getAdjList(prevConfiguration);\n  var configuration = new Set(stateNodes);\n\n  try {\n    // add all ancestors\n    for (var configuration_1 = __values(configuration), configuration_1_1 = configuration_1.next(); !configuration_1_1.done; configuration_1_1 = configuration_1.next()) {\n      var s = configuration_1_1.value;\n      var m = s.parent;\n\n      while (m && !configuration.has(m)) {\n        configuration.add(m);\n        m = m.parent;\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configuration_1_1 && !configuration_1_1.done && (_a = configuration_1.return)) _a.call(configuration_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  var adjList = getAdjList(configuration);\n\n  try {\n    // add descendants\n    for (var configuration_2 = __values(configuration), configuration_2_1 = configuration_2.next(); !configuration_2_1.done; configuration_2_1 = configuration_2.next()) {\n      var s = configuration_2_1.value; // if previously active, add existing child nodes\n\n      if (s.type === 'compound' && (!adjList.get(s) || !adjList.get(s).length)) {\n        if (prevAdjList.get(s)) {\n          prevAdjList.get(s).forEach(function (sn) {\n            return configuration.add(sn);\n          });\n        } else {\n          s.initialStateNodes.forEach(function (sn) {\n            return configuration.add(sn);\n          });\n        }\n      } else {\n        if (s.type === 'parallel') {\n          try {\n            for (var _e = (e_3 = void 0, __values(getChildren(s))), _f = _e.next(); !_f.done; _f = _e.next()) {\n              var child = _f.value;\n\n              if (child.type === 'history') {\n                continue;\n              }\n\n              if (!configuration.has(child)) {\n                configuration.add(child);\n\n                if (prevAdjList.get(child)) {\n                  prevAdjList.get(child).forEach(function (sn) {\n                    return configuration.add(sn);\n                  });\n                } else {\n                  child.initialStateNodes.forEach(function (sn) {\n                    return configuration.add(sn);\n                  });\n                }\n              }\n            }\n          } catch (e_3_1) {\n            e_3 = {\n              error: e_3_1\n            };\n          } finally {\n            try {\n              if (_f && !_f.done && (_c = _e.return)) _c.call(_e);\n            } finally {\n              if (e_3) throw e_3.error;\n            }\n          }\n        }\n      }\n    }\n  } catch (e_2_1) {\n    e_2 = {\n      error: e_2_1\n    };\n  } finally {\n    try {\n      if (configuration_2_1 && !configuration_2_1.done && (_b = configuration_2.return)) _b.call(configuration_2);\n    } finally {\n      if (e_2) throw e_2.error;\n    }\n  }\n\n  try {\n    // add all ancestors\n    for (var configuration_3 = __values(configuration), configuration_3_1 = configuration_3.next(); !configuration_3_1.done; configuration_3_1 = configuration_3.next()) {\n      var s = configuration_3_1.value;\n      var m = s.parent;\n\n      while (m && !configuration.has(m)) {\n        configuration.add(m);\n        m = m.parent;\n      }\n    }\n  } catch (e_4_1) {\n    e_4 = {\n      error: e_4_1\n    };\n  } finally {\n    try {\n      if (configuration_3_1 && !configuration_3_1.done && (_d = configuration_3.return)) _d.call(configuration_3);\n    } finally {\n      if (e_4) throw e_4.error;\n    }\n  }\n\n  return configuration;\n}\n\nfunction getValueFromAdj(baseNode, adjList) {\n  var childStateNodes = adjList.get(baseNode);\n\n  if (!childStateNodes) {\n    return {}; // todo: fix?\n  }\n\n  if (baseNode.type === 'compound') {\n    var childStateNode = childStateNodes[0];\n\n    if (childStateNode) {\n      if (isLeafNode(childStateNode)) {\n        return childStateNode.key;\n      }\n    } else {\n      return {};\n    }\n  }\n\n  var stateValue = {};\n  childStateNodes.forEach(function (csn) {\n    stateValue[csn.key] = getValueFromAdj(csn, adjList);\n  });\n  return stateValue;\n}\n\nfunction getAdjList(configuration) {\n  var e_5, _a;\n\n  var adjList = new Map();\n\n  try {\n    for (var configuration_4 = __values(configuration), configuration_4_1 = configuration_4.next(); !configuration_4_1.done; configuration_4_1 = configuration_4.next()) {\n      var s = configuration_4_1.value;\n\n      if (!adjList.has(s)) {\n        adjList.set(s, []);\n      }\n\n      if (s.parent) {\n        if (!adjList.has(s.parent)) {\n          adjList.set(s.parent, []);\n        }\n\n        adjList.get(s.parent).push(s);\n      }\n    }\n  } catch (e_5_1) {\n    e_5 = {\n      error: e_5_1\n    };\n  } finally {\n    try {\n      if (configuration_4_1 && !configuration_4_1.done && (_a = configuration_4.return)) _a.call(configuration_4);\n    } finally {\n      if (e_5) throw e_5.error;\n    }\n  }\n\n  return adjList;\n}\n\nfunction getValue(rootNode, configuration) {\n  var config = getConfiguration([rootNode], configuration);\n  return getValueFromAdj(rootNode, getAdjList(config));\n}\n\nfunction has(iterable, item) {\n  if (Array.isArray(iterable)) {\n    return iterable.some(function (member) {\n      return member === item;\n    });\n  }\n\n  if (iterable instanceof Set) {\n    return iterable.has(item);\n  }\n\n  return false; // TODO: fix\n}\n\nfunction nextEvents(configuration) {\n  return flatten(__spread(new Set(configuration.map(function (sn) {\n    return sn.ownEvents;\n  }))));\n}\n\nfunction isInFinalState(configuration, stateNode) {\n  if (stateNode.type === 'compound') {\n    return getChildren(stateNode).some(function (s) {\n      return s.type === 'final' && has(configuration, s);\n    });\n  }\n\n  if (stateNode.type === 'parallel') {\n    return getChildren(stateNode).every(function (sn) {\n      return isInFinalState(configuration, sn);\n    });\n  }\n\n  return false;\n}\n\nexport { getAdjList, getAllStateNodes, getChildren, getConfiguration, getValue, has, isInFinalState, isLeafNode, nextEvents };","import { __assign, __rest } from './_virtual/_tslib.js';\nimport { toSCXMLEvent, isFunction, toEventObject, getEventType, isString, isArray } from './utils.js';\nimport { SpecialTargets, ActionTypes } from './types.js';\nimport { send as send$1, update, assign as assign$1, raise as raise$1, init, log as log$1, cancel as cancel$1, error as error$1 } from './actionTypes.js';\nvar initEvent =\n/*#__PURE__*/\ntoSCXMLEvent({\n  type: init\n});\n\nfunction getActionFunction(actionType, actionFunctionMap) {\n  return actionFunctionMap ? actionFunctionMap[actionType] || undefined : undefined;\n}\n\nfunction toActionObject(action, actionFunctionMap) {\n  var actionObject;\n\n  if (isString(action) || typeof action === 'number') {\n    var exec = getActionFunction(action, actionFunctionMap);\n\n    if (isFunction(exec)) {\n      actionObject = {\n        type: action,\n        exec: exec\n      };\n    } else if (exec) {\n      actionObject = exec;\n    } else {\n      actionObject = {\n        type: action,\n        exec: undefined\n      };\n    }\n  } else if (isFunction(action)) {\n    actionObject = {\n      // Convert action to string if unnamed\n      type: action.name || action.toString(),\n      exec: action\n    };\n  } else {\n    var exec = getActionFunction(action.type, actionFunctionMap);\n\n    if (isFunction(exec)) {\n      actionObject = __assign(__assign({}, action), {\n        exec: exec\n      });\n    } else if (exec) {\n      var type = action.type,\n          other = __rest(action, [\"type\"]);\n\n      actionObject = __assign(__assign({\n        type: type\n      }, exec), other);\n    } else {\n      actionObject = action;\n    }\n  }\n\n  Object.defineProperty(actionObject, 'toString', {\n    value: function () {\n      return actionObject.type;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return actionObject;\n}\n\nvar toActionObjects = function (action, actionFunctionMap) {\n  if (!action) {\n    return [];\n  }\n\n  var actions = isArray(action) ? action : [action];\n  return actions.map(function (subAction) {\n    return toActionObject(subAction, actionFunctionMap);\n  });\n};\n\nfunction toActivityDefinition(action) {\n  var actionObject = toActionObject(action);\n  return __assign(__assign({\n    id: isString(action) ? action : actionObject.id\n  }, actionObject), {\n    type: actionObject.type\n  });\n}\n/**\r\n * Raises an event. This places the event in the internal event queue, so that\r\n * the event is immediately consumed by the machine in the current step.\r\n *\r\n * @param eventType The event to raise.\r\n */\n\n\nfunction raise(event) {\n  if (!isString(event)) {\n    return send(event, {\n      to: SpecialTargets.Internal\n    });\n  }\n\n  return {\n    type: raise$1,\n    event: event\n  };\n}\n\nfunction resolveRaise(action) {\n  return {\n    type: raise$1,\n    _event: toSCXMLEvent(action.event)\n  };\n}\n/**\r\n * Sends an event. This returns an action that will be read by an interpreter to\r\n * send the event in the next step, after the current step is finished executing.\r\n *\r\n * @param event The event to send.\r\n * @param options Options to pass into the send event:\r\n *  - `id` - The unique send event identifier (used with `cancel()`).\r\n *  - `delay` - The number of milliseconds to delay the sending of the event.\r\n *  - `to` - The target of this event (by default, the machine the event was sent from).\r\n */\n\n\nfunction send(event, options) {\n  return {\n    to: options ? options.to : undefined,\n    type: send$1,\n    event: isFunction(event) ? event : toEventObject(event),\n    delay: options ? options.delay : undefined,\n    id: options && options.id !== undefined ? options.id : isFunction(event) ? event.name : getEventType(event)\n  };\n}\n\nfunction resolveSend(action, ctx, _event, delaysMap) {\n  var meta = {\n    _event: _event\n  }; // TODO: helper function for resolving Expr\n\n  var resolvedEvent = toSCXMLEvent(isFunction(action.event) ? action.event(ctx, _event.data, meta) : action.event);\n  var resolvedDelay;\n\n  if (isString(action.delay)) {\n    var configDelay = delaysMap && delaysMap[action.delay];\n    resolvedDelay = isFunction(configDelay) ? configDelay(ctx, _event.data, meta) : configDelay;\n  } else {\n    resolvedDelay = isFunction(action.delay) ? action.delay(ctx, _event.data, meta) : action.delay;\n  }\n\n  var resolvedTarget = isFunction(action.to) ? action.to(ctx, _event.data, meta) : action.to;\n  return __assign(__assign({}, action), {\n    to: resolvedTarget,\n    _event: resolvedEvent,\n    event: resolvedEvent.data,\n    delay: resolvedDelay\n  });\n}\n/**\r\n * Sends an event to this machine's parent.\r\n *\r\n * @param event The event to send to the parent machine.\r\n * @param options Options to pass into the send event.\r\n */\n\n\nfunction sendParent(event, options) {\n  return send(event, __assign(__assign({}, options), {\n    to: SpecialTargets.Parent\n  }));\n}\n/**\r\n * Sends an update event to this machine's parent.\r\n */\n\n\nfunction sendUpdate() {\n  return sendParent(update);\n}\n/**\r\n * Sends an event back to the sender of the original event.\r\n *\r\n * @param event The event to send back to the sender\r\n * @param options Options to pass into the send event\r\n */\n\n\nfunction respond(event, options) {\n  return send(event, __assign(__assign({}, options), {\n    to: function (_, __, _a) {\n      var _event = _a._event;\n      return _event.origin; // TODO: handle when _event.origin is undefined\n    }\n  }));\n}\n\nvar defaultLogExpr = function (context, event) {\n  return {\n    context: context,\n    event: event\n  };\n};\n/**\r\n *\r\n * @param expr The expression function to evaluate which will be logged.\r\n *  Takes in 2 arguments:\r\n *  - `ctx` - the current state context\r\n *  - `event` - the event that caused this action to be executed.\r\n * @param label The label to give to the logged expression.\r\n */\n\n\nfunction log(expr, label) {\n  if (expr === void 0) {\n    expr = defaultLogExpr;\n  }\n\n  return {\n    type: log$1,\n    label: label,\n    expr: expr\n  };\n}\n\nvar resolveLog = function (action, ctx, _event) {\n  return __assign(__assign({}, action), {\n    value: isString(action.expr) ? action.expr : action.expr(ctx, _event.data, {\n      _event: _event\n    })\n  });\n};\n/**\r\n * Cancels an in-flight `send(...)` action. A canceled sent action will not\r\n * be executed, nor will its event be sent, unless it has already been sent\r\n * (e.g., if `cancel(...)` is called after the `send(...)` action's `delay`).\r\n *\r\n * @param sendId The `id` of the `send(...)` action to cancel.\r\n */\n\n\nvar cancel = function (sendId) {\n  return {\n    type: cancel$1,\n    sendId: sendId\n  };\n};\n/**\r\n * Starts an activity.\r\n *\r\n * @param activity The activity to start.\r\n */\n\n\nfunction start(activity) {\n  var activityDef = toActivityDefinition(activity);\n  return {\n    type: ActionTypes.Start,\n    activity: activityDef,\n    exec: undefined\n  };\n}\n/**\r\n * Stops an activity.\r\n *\r\n * @param activity The activity to stop.\r\n */\n\n\nfunction stop(activity) {\n  var activityDef = toActivityDefinition(activity);\n  return {\n    type: ActionTypes.Stop,\n    activity: activityDef,\n    exec: undefined\n  };\n}\n/**\r\n * Updates the current context of the machine.\r\n *\r\n * @param assignment An object that represents the partial context to update.\r\n */\n\n\nvar assign = function (assignment) {\n  return {\n    type: assign$1,\n    assignment: assignment\n  };\n};\n/**\r\n * Returns an event type that represents an implicit event that\r\n * is sent after the specified `delay`.\r\n *\r\n * @param delayRef The delay in milliseconds\r\n * @param id The state node ID where this event is handled\r\n */\n\n\nfunction after(delayRef, id) {\n  var idSuffix = id ? \"#\" + id : '';\n  return ActionTypes.After + \"(\" + delayRef + \")\" + idSuffix;\n}\n/**\r\n * Returns an event that represents that a final state node\r\n * has been reached in the parent state node.\r\n *\r\n * @param id The final state node's parent state node `id`\r\n * @param data The data to pass into the event\r\n */\n\n\nfunction done(id, data) {\n  var type = ActionTypes.DoneState + \".\" + id;\n  var eventObject = {\n    type: type,\n    data: data\n  };\n\n  eventObject.toString = function () {\n    return type;\n  };\n\n  return eventObject;\n}\n/**\r\n * Returns an event that represents that an invoked service has terminated.\r\n *\r\n * An invoked service is terminated when it has reached a top-level final state node,\r\n * but not when it is canceled.\r\n *\r\n * @param id The final state node ID\r\n * @param data The data to pass into the event\r\n */\n\n\nfunction doneInvoke(id, data) {\n  var type = ActionTypes.DoneInvoke + \".\" + id;\n  var eventObject = {\n    type: type,\n    data: data\n  };\n\n  eventObject.toString = function () {\n    return type;\n  };\n\n  return eventObject;\n}\n\nfunction error(id, data) {\n  var type = ActionTypes.ErrorPlatform + \".\" + id;\n  var eventObject = {\n    type: type,\n    data: data\n  };\n\n  eventObject.toString = function () {\n    return type;\n  };\n\n  return eventObject;\n}\n/**\r\n * Forwards (sends) an event to a specified service.\r\n *\r\n * @param target The target service to forward the event to.\r\n * @param options Options to pass into the send action creator.\r\n */\n\n\nfunction forwardTo(target, options) {\n  return send(function (_, event) {\n    return event;\n  }, __assign(__assign({}, options), {\n    to: target\n  }));\n}\n/**\r\n * Escalates an error by sending it as an event to this machine's parent.\r\n *\r\n * @param errorData The error data to send, or the expression function that\r\n * takes in the `context`, `event`, and `meta`, and returns the error data to send.\r\n * @param options Options to pass into the send action creator.\r\n */\n\n\nfunction escalate(errorData, options) {\n  return sendParent(function (context, event, meta) {\n    return {\n      type: error$1,\n      data: isFunction(errorData) ? errorData(context, event, meta) : errorData\n    };\n  }, __assign(__assign({}, options), {\n    to: SpecialTargets.Parent\n  }));\n}\n\nexport { after, assign, cancel, done, doneInvoke, error, escalate, forwardTo, getActionFunction, initEvent, log, raise, resolveLog, resolveRaise, resolveSend, respond, send, sendParent, sendUpdate, start, stop, toActionObject, toActionObjects, toActivityDefinition };","import { ActionTypes } from './types.js'; // xstate-specific action types\n\nvar start = ActionTypes.Start;\nvar stop = ActionTypes.Stop;\nvar raise = ActionTypes.Raise;\nvar send = ActionTypes.Send;\nvar cancel = ActionTypes.Cancel;\nvar nullEvent = ActionTypes.NullEvent;\nvar assign = ActionTypes.Assign;\nvar after = ActionTypes.After;\nvar doneState = ActionTypes.DoneState;\nvar log = ActionTypes.Log;\nvar init = ActionTypes.Init;\nvar invoke = ActionTypes.Invoke;\nvar errorExecution = ActionTypes.ErrorExecution;\nvar errorPlatform = ActionTypes.ErrorPlatform;\nvar error = ActionTypes.ErrorCustom;\nvar update = ActionTypes.Update;\nvar pure = ActionTypes.Pure;\nexport { after, assign, cancel, doneState, error, errorExecution, errorPlatform, init, invoke, log, nullEvent, pure, raise, send, start, stop, update };","import { __spread, __rest, __assign } from './_virtual/_tslib.js';\nimport { EMPTY_ACTIVITY_MAP } from './constants.js';\nimport { isString, matchesState, keys } from './utils.js';\nimport { nextEvents } from './stateUtils.js';\nimport { initEvent } from './actions.js';\n\nfunction stateValuesEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a === undefined || b === undefined) {\n    return false;\n  }\n\n  if (isString(a) || isString(b)) {\n    return a === b;\n  }\n\n  var aKeys = keys(a);\n  var bKeys = keys(b);\n  return aKeys.length === bKeys.length && aKeys.every(function (key) {\n    return stateValuesEqual(a[key], b[key]);\n  });\n}\n\nfunction isState(state) {\n  if (isString(state)) {\n    return false;\n  }\n\n  return 'value' in state && 'history' in state;\n}\n\nfunction bindActionToState(action, state) {\n  var exec = action.exec;\n\n  var boundAction = __assign(__assign({}, action), {\n    exec: exec !== undefined ? function () {\n      return exec(state.context, state.event, {\n        action: action,\n        state: state,\n        _event: state._event\n      });\n    } : undefined\n  });\n\n  return boundAction;\n}\n\nvar State =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  /**\r\n   * Creates a new State instance.\r\n   * @param value The state value\r\n   * @param context The extended state\r\n   * @param historyValue The tree representing historical values of the state nodes\r\n   * @param history The previous state\r\n   * @param actions An array of action objects to execute as side-effects\r\n   * @param activities A mapping of activities and whether they are started (`true`) or stopped (`false`).\r\n   * @param meta\r\n   * @param events Internal event queue. Should be empty with run-to-completion semantics.\r\n   * @param configuration\r\n   */\n  function State(config) {\n    this.actions = [];\n    this.activities = EMPTY_ACTIVITY_MAP;\n    this.meta = {};\n    this.events = [];\n    this.value = config.value;\n    this.context = config.context;\n    this._event = config._event;\n    this._sessionid = config._sessionid;\n    this.event = this._event.data;\n    this.historyValue = config.historyValue;\n    this.history = config.history;\n    this.actions = config.actions || [];\n    this.activities = config.activities || EMPTY_ACTIVITY_MAP;\n    this.meta = config.meta || {};\n    this.events = config.events || [];\n    this.matches = this.matches.bind(this);\n    this.toStrings = this.toStrings.bind(this);\n    this.configuration = config.configuration;\n    this.transitions = config.transitions;\n    this.children = config.children;\n    this.done = !!config.done;\n    Object.defineProperty(this, 'nextEvents', {\n      get: function () {\n        return nextEvents(config.configuration);\n      }\n    });\n  }\n  /**\r\n   * Creates a new State instance for the given `stateValue` and `context`.\r\n   * @param stateValue\r\n   * @param context\r\n   */\n\n\n  State.from = function (stateValue, context) {\n    if (stateValue instanceof State) {\n      if (stateValue.context !== context) {\n        return new State({\n          value: stateValue.value,\n          context: context,\n          _event: stateValue._event,\n          _sessionid: null,\n          historyValue: stateValue.historyValue,\n          history: stateValue.history,\n          actions: [],\n          activities: stateValue.activities,\n          meta: {},\n          events: [],\n          configuration: [],\n          transitions: [],\n          children: {}\n        });\n      }\n\n      return stateValue;\n    }\n\n    var _event = initEvent;\n    return new State({\n      value: stateValue,\n      context: context,\n      _event: _event,\n      _sessionid: null,\n      historyValue: undefined,\n      history: undefined,\n      actions: [],\n      activities: undefined,\n      meta: undefined,\n      events: [],\n      configuration: [],\n      transitions: [],\n      children: {}\n    });\n  };\n  /**\r\n   * Creates a new State instance for the given `config`.\r\n   * @param config The state config\r\n   */\n\n\n  State.create = function (config) {\n    return new State(config);\n  };\n  /**\r\n   * Creates a new `State` instance for the given `stateValue` and `context` with no actions (side-effects).\r\n   * @param stateValue\r\n   * @param context\r\n   */\n\n\n  State.inert = function (stateValue, context) {\n    if (stateValue instanceof State) {\n      if (!stateValue.actions.length) {\n        return stateValue;\n      }\n\n      var _event = initEvent;\n      return new State({\n        value: stateValue.value,\n        context: context,\n        _event: _event,\n        _sessionid: null,\n        historyValue: stateValue.historyValue,\n        history: stateValue.history,\n        activities: stateValue.activities,\n        configuration: stateValue.configuration,\n        transitions: [],\n        children: {}\n      });\n    }\n\n    return State.from(stateValue, context);\n  };\n  /**\r\n   * Returns an array of all the string leaf state node paths.\r\n   * @param stateValue\r\n   * @param delimiter The character(s) that separate each subpath in the string state node path.\r\n   */\n\n\n  State.prototype.toStrings = function (stateValue, delimiter) {\n    var _this = this;\n\n    if (stateValue === void 0) {\n      stateValue = this.value;\n    }\n\n    if (delimiter === void 0) {\n      delimiter = '.';\n    }\n\n    if (isString(stateValue)) {\n      return [stateValue];\n    }\n\n    var valueKeys = keys(stateValue);\n    return valueKeys.concat.apply(valueKeys, __spread(valueKeys.map(function (key) {\n      return _this.toStrings(stateValue[key], delimiter).map(function (s) {\n        return key + delimiter + s;\n      });\n    })));\n  };\n\n  State.prototype.toJSON = function () {\n    var _a = this,\n        configuration = _a.configuration,\n        transitions = _a.transitions,\n        jsonValues = __rest(_a, [\"configuration\", \"transitions\"]);\n\n    return jsonValues;\n  };\n  /**\r\n   * Whether the current state value is a subset of the given parent state value.\r\n   * @param parentStateValue\r\n   */\n\n\n  State.prototype.matches = function (parentStateValue) {\n    return matchesState(parentStateValue, this.value);\n  };\n\n  return State;\n}();\n\nexport { State, bindActionToState, isState, stateValuesEqual };","function createNullActor(id) {\n  return {\n    id: id,\n    send: function () {\n      return void 0;\n    },\n    subscribe: function () {\n      return {\n        unsubscribe: function () {\n          return void 0;\n        }\n      };\n    },\n    toJSON: function () {\n      return {\n        id: id\n      };\n    }\n  };\n}\n/**\r\n * Creates a null actor that is able to be invoked given the provided\r\n * invocation information in its `.meta` value.\r\n *\r\n * @param invokeDefinition The meta information needed to invoke the actor.\r\n */\n\n\nfunction createInvocableActor(invokeDefinition) {\n  var tempActor = createNullActor(invokeDefinition.id);\n  tempActor.meta = invokeDefinition;\n  return tempActor;\n}\n\nfunction isActor(item) {\n  try {\n    return typeof item.send === 'function';\n  } catch (e) {\n    return false;\n  }\n}\n\nexport { createInvocableActor, createNullActor, isActor };","import { __assign } from './_virtual/_tslib.js';\nvar defaultOptions = {\n  deferEvents: false\n};\n\nvar Scheduler =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  function Scheduler(options) {\n    this.processingEvent = false;\n    this.queue = [];\n    this.initialized = false;\n    this.options = __assign(__assign({}, defaultOptions), options);\n  }\n\n  Scheduler.prototype.initialize = function (callback) {\n    this.initialized = true;\n\n    if (callback) {\n      if (!this.options.deferEvents) {\n        this.schedule(callback);\n        return;\n      }\n\n      this.process(callback);\n    }\n\n    this.flushEvents();\n  };\n\n  Scheduler.prototype.schedule = function (task) {\n    if (!this.initialized || this.processingEvent) {\n      this.queue.push(task);\n      return;\n    }\n\n    if (this.queue.length !== 0) {\n      throw new Error('Event queue should be empty when it is not processing events');\n    }\n\n    this.process(task);\n    this.flushEvents();\n  };\n\n  Scheduler.prototype.clear = function () {\n    this.queue = [];\n  };\n\n  Scheduler.prototype.flushEvents = function () {\n    var nextCallback = this.queue.shift();\n\n    while (nextCallback) {\n      this.process(nextCallback);\n      nextCallback = this.queue.shift();\n    }\n  };\n\n  Scheduler.prototype.process = function (callback) {\n    this.processingEvent = true;\n\n    try {\n      callback();\n    } catch (e) {\n      // there is no use to keep the future events\n      // as the situation is not anymore the same\n      this.clear();\n      throw e;\n    } finally {\n      this.processingEvent = false;\n    }\n  };\n\n  return Scheduler;\n}();\n\nexport { Scheduler };","var children =\n/*#__PURE__*/\nnew Map();\nvar sessionIdIndex = 0;\nvar registry = {\n  bookId: function () {\n    return \"x:\" + sessionIdIndex++;\n  },\n  register: function (id, actor) {\n    children.set(id, actor);\n    return id;\n  },\n  get: function (id) {\n    return children.get(id);\n  },\n  free: function (id) {\n    children.delete(id);\n  }\n};\nexport { registry };","import { IS_PRODUCTION } from './environment.js';\n\nfunction getDevTools() {\n  var w = window;\n\n  if (!!w.__xstate__) {\n    return w.__xstate__;\n  }\n\n  return undefined;\n}\n\nfunction registerService(service) {\n  if (IS_PRODUCTION || typeof window === 'undefined') {\n    return;\n  }\n\n  var devTools = getDevTools();\n\n  if (devTools) {\n    devTools.register(service);\n  }\n}\n\nexport { registerService };","import { __values, __assign, __spread } from './_virtual/_tslib.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { warn, mapContext, isFunction, keys, toSCXMLEvent, isPromiseLike, isObservable, isMachine, reportUnhandledExceptionOnInvocation, symbolObservable, isArray, toEventObject, isString, uniqueId } from './utils.js';\nimport { ActionTypes, SpecialTargets } from './types.js';\nimport { isInFinalState } from './stateUtils.js';\nimport { errorPlatform, log, stop, start, cancel, send, update, error as error$1 } from './actionTypes.js';\nimport { doneInvoke, initEvent, getActionFunction, error } from './actions.js';\nimport { isState, State, bindActionToState } from './State.js';\nimport { isActor } from './Actor.js';\nimport { Scheduler } from './scheduler.js';\nimport { registry } from './registry.js';\nimport { registerService } from './devTools.js';\nvar DEFAULT_SPAWN_OPTIONS = {\n  sync: false,\n  autoForward: false\n};\n/**\r\n * Maintains a stack of the current service in scope.\r\n * This is used to provide the correct service to spawn().\r\n *\r\n * @private\r\n */\n\nvar withServiceScope =\n/*#__PURE__*/\nfunction () {\n  var serviceStack = [];\n  return function (service, fn) {\n    service && serviceStack.push(service);\n    var result = fn(service || serviceStack[serviceStack.length - 1]);\n    service && serviceStack.pop();\n    return result;\n  };\n}();\n\nvar InterpreterStatus;\n\n(function (InterpreterStatus) {\n  InterpreterStatus[InterpreterStatus[\"NotStarted\"] = 0] = \"NotStarted\";\n  InterpreterStatus[InterpreterStatus[\"Running\"] = 1] = \"Running\";\n  InterpreterStatus[InterpreterStatus[\"Stopped\"] = 2] = \"Stopped\";\n})(InterpreterStatus || (InterpreterStatus = {}));\n\nvar Interpreter =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  /**\r\n   * Creates a new Interpreter instance (i.e., service) for the given machine with the provided options, if any.\r\n   *\r\n   * @param machine The machine to be interpreted\r\n   * @param options Interpreter options\r\n   */\n  function Interpreter(machine, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = Interpreter.defaultOptions;\n    }\n\n    this.machine = machine;\n    this.scheduler = new Scheduler();\n    this.delayedEventsMap = {};\n    this.listeners = new Set();\n    this.contextListeners = new Set();\n    this.stopListeners = new Set();\n    this.doneListeners = new Set();\n    this.eventListeners = new Set();\n    this.sendListeners = new Set();\n    /**\r\n     * Whether the service is started.\r\n     */\n\n    this.initialized = false;\n    this._status = InterpreterStatus.NotStarted;\n    this.children = new Map();\n    this.forwardTo = new Set();\n    /**\r\n     * Alias for Interpreter.prototype.start\r\n     */\n\n    this.init = this.start;\n    /**\r\n     * Sends an event to the running interpreter to trigger a transition.\r\n     *\r\n     * An array of events (batched) can be sent as well, which will send all\r\n     * batched events to the running interpreter. The listeners will be\r\n     * notified only **once** when all events are processed.\r\n     *\r\n     * @param event The event(s) to send\r\n     */\n\n    this.send = function (event, payload) {\n      if (isArray(event)) {\n        _this.batch(event);\n\n        return _this.state;\n      }\n\n      var _event = toSCXMLEvent(toEventObject(event, payload));\n\n      if (_this._status === InterpreterStatus.Stopped) {\n        // do nothing\n        if (!IS_PRODUCTION) {\n          warn(false, \"Event \\\"\" + _event.name + \"\\\" was sent to stopped service \\\"\" + _this.machine.id + \"\\\". This service has already reached its final state, and will not transition.\\nEvent: \" + JSON.stringify(_event.data));\n        }\n\n        return _this.state;\n      }\n\n      if (_this._status === InterpreterStatus.NotStarted && _this.options.deferEvents) {\n        // tslint:disable-next-line:no-console\n        if (!IS_PRODUCTION) {\n          warn(false, \"Event \\\"\" + _event.name + \"\\\" was sent to uninitialized service \\\"\" + _this.machine.id + \"\\\" and is deferred. Make sure .start() is called for this service.\\nEvent: \" + JSON.stringify(_event.data));\n        }\n      } else if (_this._status !== InterpreterStatus.Running) {\n        throw new Error(\"Event \\\"\" + _event.name + \"\\\" was sent to uninitialized service \\\"\" + _this.machine.id + \"\\\". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\\nEvent: \" + JSON.stringify(_event.data));\n      }\n\n      _this.scheduler.schedule(function () {\n        // Forward copy of event to child actors\n        _this.forward(_event);\n\n        var nextState = _this.nextState(_event);\n\n        _this.update(nextState, _event);\n      });\n\n      return _this._state; // TODO: deprecate (should return void)\n      // tslint:disable-next-line:semicolon\n    };\n\n    this.sendTo = function (event, to) {\n      var isParent = _this.parent && (to === SpecialTargets.Parent || _this.parent.id === to);\n      var target = isParent ? _this.parent : isActor(to) ? to : _this.children.get(to) || registry.get(to);\n\n      if (!target) {\n        if (!isParent) {\n          throw new Error(\"Unable to send event to child '\" + to + \"' from service '\" + _this.id + \"'.\");\n        } // tslint:disable-next-line:no-console\n\n\n        if (!IS_PRODUCTION) {\n          warn(false, \"Service '\" + _this.id + \"' has no parent: unable to send event \" + event.type);\n        }\n\n        return;\n      }\n\n      if ('machine' in target) {\n        // Send SCXML events to machines\n        target.send(__assign(__assign({}, event), {\n          name: event.name === error$1 ? \"\" + error(_this.id) : event.name,\n          origin: _this.sessionId\n        }));\n      } else {\n        // Send normal events to other targets\n        target.send(event.data);\n      }\n    };\n\n    var resolvedOptions = __assign(__assign({}, Interpreter.defaultOptions), options);\n\n    var clock = resolvedOptions.clock,\n        logger = resolvedOptions.logger,\n        parent = resolvedOptions.parent,\n        id = resolvedOptions.id;\n    var resolvedId = id !== undefined ? id : machine.id;\n    this.id = resolvedId;\n    this.logger = logger;\n    this.clock = clock;\n    this.parent = parent;\n    this.options = resolvedOptions;\n    this.scheduler = new Scheduler({\n      deferEvents: this.options.deferEvents\n    });\n    this.sessionId = registry.bookId();\n  }\n\n  Object.defineProperty(Interpreter.prototype, \"initialState\", {\n    get: function () {\n      var _this = this;\n\n      if (this._initialState) {\n        return this._initialState;\n      }\n\n      return withServiceScope(this, function () {\n        _this._initialState = _this.machine.initialState;\n        return _this._initialState;\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Interpreter.prototype, \"state\", {\n    get: function () {\n      if (!IS_PRODUCTION) {\n        warn(this._status !== InterpreterStatus.NotStarted, \"Attempted to read state from uninitialized service '\" + this.id + \"'. Make sure the service is started first.\");\n      }\n\n      return this._state;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Executes the actions of the given state, with that state's `context` and `event`.\r\n   *\r\n   * @param state The state whose actions will be executed\r\n   * @param actionsConfig The action implementations to use\r\n   */\n\n  Interpreter.prototype.execute = function (state, actionsConfig) {\n    var e_1, _a;\n\n    try {\n      for (var _b = __values(state.actions), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var action = _c.value;\n        this.exec(action, state, actionsConfig);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n\n  Interpreter.prototype.update = function (state, _event) {\n    var e_2, _a, e_3, _b, e_4, _c, e_5, _d;\n\n    var _this = this; // Attach session ID to state\n\n\n    state._sessionid = this.sessionId; // Update state\n\n    this._state = state; // Execute actions\n\n    if (this.options.execute) {\n      this.execute(this.state);\n    } // Dev tools\n\n\n    if (this.devTools) {\n      this.devTools.send(_event.data, state);\n    } // Execute listeners\n\n\n    if (state.event) {\n      try {\n        for (var _e = __values(this.eventListeners), _f = _e.next(); !_f.done; _f = _e.next()) {\n          var listener = _f.value;\n          listener(state.event);\n        }\n      } catch (e_2_1) {\n        e_2 = {\n          error: e_2_1\n        };\n      } finally {\n        try {\n          if (_f && !_f.done && (_a = _e.return)) _a.call(_e);\n        } finally {\n          if (e_2) throw e_2.error;\n        }\n      }\n    }\n\n    try {\n      for (var _g = __values(this.listeners), _h = _g.next(); !_h.done; _h = _g.next()) {\n        var listener = _h.value;\n        listener(state, state.event);\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (_h && !_h.done && (_b = _g.return)) _b.call(_g);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    try {\n      for (var _j = __values(this.contextListeners), _k = _j.next(); !_k.done; _k = _j.next()) {\n        var contextListener = _k.value;\n        contextListener(this.state.context, this.state.history ? this.state.history.context : undefined);\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (_k && !_k.done && (_c = _j.return)) _c.call(_j);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n\n    var isDone = isInFinalState(state.configuration || [], this.machine);\n\n    if (this.state.configuration && isDone) {\n      // get final child state node\n      var finalChildStateNode = state.configuration.find(function (sn) {\n        return sn.type === 'final' && sn.parent === _this.machine;\n      });\n      var doneData = finalChildStateNode && finalChildStateNode.data ? mapContext(finalChildStateNode.data, state.context, _event) : undefined;\n\n      try {\n        for (var _l = __values(this.doneListeners), _m = _l.next(); !_m.done; _m = _l.next()) {\n          var listener = _m.value;\n          listener(doneInvoke(this.id, doneData));\n        }\n      } catch (e_5_1) {\n        e_5 = {\n          error: e_5_1\n        };\n      } finally {\n        try {\n          if (_m && !_m.done && (_d = _l.return)) _d.call(_l);\n        } finally {\n          if (e_5) throw e_5.error;\n        }\n      }\n\n      this.stop();\n    }\n  };\n  /*\r\n   * Adds a listener that is notified whenever a state transition happens. The listener is called with\r\n   * the next state and the event object that caused the state transition.\r\n   *\r\n   * @param listener The state listener\r\n   */\n\n\n  Interpreter.prototype.onTransition = function (listener) {\n    this.listeners.add(listener); // Send current state to listener\n\n    if (this._status === InterpreterStatus.Running) {\n      listener(this.state, this.state.event);\n    }\n\n    return this;\n  };\n\n  Interpreter.prototype.subscribe = function (nextListenerOrObserver, // @ts-ignore\n  errorListener, completeListener) {\n    var _this = this;\n\n    if (!nextListenerOrObserver) {\n      return {\n        unsubscribe: function () {\n          return void 0;\n        }\n      };\n    }\n\n    var listener;\n    var resolvedCompleteListener = completeListener;\n\n    if (typeof nextListenerOrObserver === 'function') {\n      listener = nextListenerOrObserver;\n    } else {\n      listener = nextListenerOrObserver.next.bind(nextListenerOrObserver);\n      resolvedCompleteListener = nextListenerOrObserver.complete.bind(nextListenerOrObserver);\n    }\n\n    this.listeners.add(listener); // Send current state to listener\n\n    if (this._status === InterpreterStatus.Running) {\n      listener(this.state);\n    }\n\n    if (resolvedCompleteListener) {\n      this.onDone(resolvedCompleteListener);\n    }\n\n    return {\n      unsubscribe: function () {\n        listener && _this.listeners.delete(listener);\n        resolvedCompleteListener && _this.doneListeners.delete(resolvedCompleteListener);\n      }\n    };\n  };\n  /**\r\n   * Adds an event listener that is notified whenever an event is sent to the running interpreter.\r\n   * @param listener The event listener\r\n   */\n\n\n  Interpreter.prototype.onEvent = function (listener) {\n    this.eventListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds an event listener that is notified whenever a `send` event occurs.\r\n   * @param listener The event listener\r\n   */\n\n\n  Interpreter.prototype.onSend = function (listener) {\n    this.sendListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a context listener that is notified whenever the state context changes.\r\n   * @param listener The context listener\r\n   */\n\n\n  Interpreter.prototype.onChange = function (listener) {\n    this.contextListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a listener that is notified when the machine is stopped.\r\n   * @param listener The listener\r\n   */\n\n\n  Interpreter.prototype.onStop = function (listener) {\n    this.stopListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a state listener that is notified when the statechart has reached its final state.\r\n   * @param listener The state listener\r\n   */\n\n\n  Interpreter.prototype.onDone = function (listener) {\n    this.doneListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Removes a listener.\r\n   * @param listener The listener to remove\r\n   */\n\n\n  Interpreter.prototype.off = function (listener) {\n    this.listeners.delete(listener);\n    this.eventListeners.delete(listener);\n    this.sendListeners.delete(listener);\n    this.stopListeners.delete(listener);\n    this.doneListeners.delete(listener);\n    this.contextListeners.delete(listener);\n    return this;\n  };\n  /**\r\n   * Starts the interpreter from the given state, or the initial state.\r\n   * @param initialState The state to start the statechart from\r\n   */\n\n\n  Interpreter.prototype.start = function (initialState) {\n    var _this = this;\n\n    if (this._status === InterpreterStatus.Running) {\n      // Do not restart the service if it is already started\n      return this;\n    }\n\n    registry.register(this.sessionId, this);\n    this.initialized = true;\n    this._status = InterpreterStatus.Running;\n    var resolvedState = initialState === undefined ? this.initialState : withServiceScope(this, function () {\n      return isState(initialState) ? _this.machine.resolveState(initialState) : _this.machine.resolveState(State.from(initialState, _this.machine.context));\n    });\n\n    if (this.options.devTools) {\n      this.attachDev();\n    }\n\n    this.scheduler.initialize(function () {\n      _this.update(resolvedState, initEvent);\n    });\n    return this;\n  };\n  /**\r\n   * Stops the interpreter and unsubscribe all listeners.\r\n   *\r\n   * This will also notify the `onStop` listeners.\r\n   */\n\n\n  Interpreter.prototype.stop = function () {\n    var e_6, _a, e_7, _b, e_8, _c, e_9, _d, e_10, _e;\n\n    try {\n      for (var _f = __values(this.listeners), _g = _f.next(); !_g.done; _g = _f.next()) {\n        var listener = _g.value;\n        this.listeners.delete(listener);\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (_g && !_g.done && (_a = _f.return)) _a.call(_f);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n\n    try {\n      for (var _h = __values(this.stopListeners), _j = _h.next(); !_j.done; _j = _h.next()) {\n        var listener = _j.value; // call listener, then remove\n\n        listener();\n        this.stopListeners.delete(listener);\n      }\n    } catch (e_7_1) {\n      e_7 = {\n        error: e_7_1\n      };\n    } finally {\n      try {\n        if (_j && !_j.done && (_b = _h.return)) _b.call(_h);\n      } finally {\n        if (e_7) throw e_7.error;\n      }\n    }\n\n    try {\n      for (var _k = __values(this.contextListeners), _l = _k.next(); !_l.done; _l = _k.next()) {\n        var listener = _l.value;\n        this.contextListeners.delete(listener);\n      }\n    } catch (e_8_1) {\n      e_8 = {\n        error: e_8_1\n      };\n    } finally {\n      try {\n        if (_l && !_l.done && (_c = _k.return)) _c.call(_k);\n      } finally {\n        if (e_8) throw e_8.error;\n      }\n    }\n\n    try {\n      for (var _m = __values(this.doneListeners), _o = _m.next(); !_o.done; _o = _m.next()) {\n        var listener = _o.value;\n        this.doneListeners.delete(listener);\n      }\n    } catch (e_9_1) {\n      e_9 = {\n        error: e_9_1\n      };\n    } finally {\n      try {\n        if (_o && !_o.done && (_d = _m.return)) _d.call(_m);\n      } finally {\n        if (e_9) throw e_9.error;\n      }\n    } // Stop all children\n\n\n    this.children.forEach(function (child) {\n      if (isFunction(child.stop)) {\n        child.stop();\n      }\n    });\n\n    try {\n      // Cancel all delayed events\n      for (var _p = __values(keys(this.delayedEventsMap)), _q = _p.next(); !_q.done; _q = _p.next()) {\n        var key = _q.value;\n        this.clock.clearTimeout(this.delayedEventsMap[key]);\n      }\n    } catch (e_10_1) {\n      e_10 = {\n        error: e_10_1\n      };\n    } finally {\n      try {\n        if (_q && !_q.done && (_e = _p.return)) _e.call(_p);\n      } finally {\n        if (e_10) throw e_10.error;\n      }\n    }\n\n    this.scheduler.clear();\n    this.initialized = false;\n    this._status = InterpreterStatus.Stopped;\n    registry.free(this.sessionId);\n    return this;\n  };\n\n  Interpreter.prototype.batch = function (events) {\n    var _this = this;\n\n    if (this._status === InterpreterStatus.NotStarted && this.options.deferEvents) {\n      // tslint:disable-next-line:no-console\n      if (!IS_PRODUCTION) {\n        warn(false, events.length + \" event(s) were sent to uninitialized service \\\"\" + this.machine.id + \"\\\" and are deferred. Make sure .start() is called for this service.\\nEvent: \" + JSON.stringify(event));\n      }\n    } else if (this._status !== InterpreterStatus.Running) {\n      throw new Error( // tslint:disable-next-line:max-line-length\n      events.length + \" event(s) were sent to uninitialized service \\\"\" + this.machine.id + \"\\\". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\");\n    }\n\n    this.scheduler.schedule(function () {\n      var e_11, _a;\n\n      var nextState = _this.state;\n      var batchChanged = false;\n      var batchedActions = [];\n\n      var _loop_1 = function (event_1) {\n        var _event = toSCXMLEvent(event_1);\n\n        _this.forward(_event);\n\n        nextState = withServiceScope(_this, function () {\n          return _this.machine.transition(nextState, _event);\n        });\n        batchedActions.push.apply(batchedActions, __spread(nextState.actions.map(function (a) {\n          return bindActionToState(a, nextState);\n        })));\n        batchChanged = batchChanged || !!nextState.changed;\n      };\n\n      try {\n        for (var events_1 = __values(events), events_1_1 = events_1.next(); !events_1_1.done; events_1_1 = events_1.next()) {\n          var event_1 = events_1_1.value;\n\n          _loop_1(event_1);\n        }\n      } catch (e_11_1) {\n        e_11 = {\n          error: e_11_1\n        };\n      } finally {\n        try {\n          if (events_1_1 && !events_1_1.done && (_a = events_1.return)) _a.call(events_1);\n        } finally {\n          if (e_11) throw e_11.error;\n        }\n      }\n\n      nextState.changed = batchChanged;\n      nextState.actions = batchedActions;\n\n      _this.update(nextState, toSCXMLEvent(events[events.length - 1]));\n    });\n  };\n  /**\r\n   * Returns a send function bound to this interpreter instance.\r\n   *\r\n   * @param event The event to be sent by the sender.\r\n   */\n\n\n  Interpreter.prototype.sender = function (event) {\n    return this.send.bind(this, event);\n  };\n  /**\r\n   * Returns the next state given the interpreter's current state and the event.\r\n   *\r\n   * This is a pure method that does _not_ update the interpreter's state.\r\n   *\r\n   * @param event The event to determine the next state\r\n   */\n\n\n  Interpreter.prototype.nextState = function (event) {\n    var _this = this;\n\n    var _event = toSCXMLEvent(event);\n\n    if (_event.name.indexOf(errorPlatform) === 0 && !this.state.nextEvents.some(function (nextEvent) {\n      return nextEvent.indexOf(errorPlatform) === 0;\n    })) {\n      throw _event.data.data;\n    }\n\n    var nextState = withServiceScope(this, function () {\n      return _this.machine.transition(_this.state, _event);\n    });\n    return nextState;\n  };\n\n  Interpreter.prototype.forward = function (event) {\n    var e_12, _a;\n\n    try {\n      for (var _b = __values(this.forwardTo), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var id = _c.value;\n        var child = this.children.get(id);\n\n        if (!child) {\n          throw new Error(\"Unable to forward event '\" + event + \"' from interpreter '\" + this.id + \"' to nonexistant child '\" + id + \"'.\");\n        }\n\n        child.send(event);\n      }\n    } catch (e_12_1) {\n      e_12 = {\n        error: e_12_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_12) throw e_12.error;\n      }\n    }\n  };\n\n  Interpreter.prototype.defer = function (sendAction) {\n    var _this = this;\n\n    this.delayedEventsMap[sendAction.id] = this.clock.setTimeout(function () {\n      if (sendAction.to) {\n        _this.sendTo(sendAction._event, sendAction.to);\n      } else {\n        _this.send(sendAction._event);\n      }\n    }, sendAction.delay);\n  };\n\n  Interpreter.prototype.cancel = function (sendId) {\n    this.clock.clearTimeout(this.delayedEventsMap[sendId]);\n    delete this.delayedEventsMap[sendId];\n  };\n\n  Interpreter.prototype.exec = function (action, state, actionFunctionMap) {\n    var context = state.context,\n        _event = state._event;\n    var actionOrExec = getActionFunction(action.type, actionFunctionMap) || action.exec;\n    var exec = isFunction(actionOrExec) ? actionOrExec : actionOrExec ? actionOrExec.exec : action.exec;\n\n    if (exec) {\n      try {\n        return exec(context, _event.data, {\n          action: action,\n          state: this.state,\n          _event: _event\n        });\n      } catch (err) {\n        if (this.parent) {\n          this.parent.send({\n            type: 'xstate.error',\n            data: err\n          });\n        }\n\n        throw err;\n      }\n    }\n\n    switch (action.type) {\n      case send:\n        var sendAction = action;\n\n        if (typeof sendAction.delay === 'number') {\n          this.defer(sendAction);\n          return;\n        } else {\n          if (sendAction.to) {\n            this.sendTo(sendAction._event, sendAction.to);\n          } else {\n            this.send(sendAction._event);\n          }\n        }\n\n        break;\n\n      case cancel:\n        this.cancel(action.sendId);\n        break;\n\n      case start:\n        {\n          var activity = action.activity; // If the activity will be stopped right after it's started\n          // (such as in transient states)\n          // don't bother starting the activity.\n\n          if (!this.state.activities[activity.type]) {\n            break;\n          } // Invoked services\n\n\n          if (activity.type === ActionTypes.Invoke) {\n            var serviceCreator = this.machine.options.services ? this.machine.options.services[activity.src] : undefined;\n            var id = activity.id,\n                data = activity.data;\n\n            if (!IS_PRODUCTION) {\n              warn(!('forward' in activity), // tslint:disable-next-line:max-line-length\n              \"`forward` property is deprecated (found in invocation of '\" + activity.src + \"' in in machine '\" + this.machine.id + \"'). \" + \"Please use `autoForward` instead.\");\n            }\n\n            var autoForward = 'autoForward' in activity ? activity.autoForward : !!activity.forward;\n\n            if (!serviceCreator) {\n              // tslint:disable-next-line:no-console\n              if (!IS_PRODUCTION) {\n                warn(false, \"No service found for invocation '\" + activity.src + \"' in machine '\" + this.machine.id + \"'.\");\n              }\n\n              return;\n            }\n\n            var source = isFunction(serviceCreator) ? serviceCreator(context, _event.data) : serviceCreator;\n\n            if (isPromiseLike(source)) {\n              this.state.children[id] = this.spawnPromise(Promise.resolve(source), id);\n            } else if (isFunction(source)) {\n              this.state.children[id] = this.spawnCallback(source, id);\n            } else if (isObservable(source)) {\n              this.state.children[id] = this.spawnObservable(source, id);\n            } else if (isMachine(source)) {\n              // TODO: try/catch here\n              this.state.children[id] = this.spawnMachine(data ? source.withContext(mapContext(data, context, _event)) : source, {\n                id: id,\n                autoForward: autoForward\n              });\n            }\n          } else {\n            this.spawnActivity(activity);\n          }\n\n          break;\n        }\n\n      case stop:\n        {\n          this.stopChild(action.activity.id);\n          break;\n        }\n\n      case log:\n        var label = action.label,\n            value = action.value;\n\n        if (label) {\n          this.logger(label, value);\n        } else {\n          this.logger(value);\n        }\n\n        break;\n\n      default:\n        if (!IS_PRODUCTION) {\n          warn(false, \"No implementation found for action type '\" + action.type + \"'\");\n        }\n\n        break;\n    }\n\n    return undefined;\n  };\n\n  Interpreter.prototype.stopChild = function (childId) {\n    var child = this.children.get(childId);\n\n    if (!child) {\n      return;\n    }\n\n    this.children.delete(childId);\n    this.forwardTo.delete(childId);\n    delete this.state.children[childId];\n\n    if (isFunction(child.stop)) {\n      child.stop();\n    }\n  };\n\n  Interpreter.prototype.spawn = function (entity, name, options) {\n    if (isPromiseLike(entity)) {\n      return this.spawnPromise(Promise.resolve(entity), name);\n    } else if (isFunction(entity)) {\n      return this.spawnCallback(entity, name);\n    } else if (isActor(entity)) {\n      return this.spawnActor(entity);\n    } else if (isObservable(entity)) {\n      return this.spawnObservable(entity, name);\n    } else if (isMachine(entity)) {\n      return this.spawnMachine(entity, __assign(__assign({}, options), {\n        id: name\n      }));\n    } else {\n      throw new Error(\"Unable to spawn entity \\\"\" + name + \"\\\" of type \\\"\" + typeof entity + \"\\\".\");\n    }\n  };\n\n  Interpreter.prototype.spawnMachine = function (machine, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    var childService = new Interpreter(machine, __assign(__assign({}, this.options), {\n      parent: this,\n      id: options.id || machine.id\n    }));\n\n    var resolvedOptions = __assign(__assign({}, DEFAULT_SPAWN_OPTIONS), options);\n\n    if (resolvedOptions.sync) {\n      childService.onTransition(function (state) {\n        _this.send(update, {\n          state: state,\n          id: childService.id\n        });\n      });\n    }\n\n    childService.onDone(function (doneEvent) {\n      _this.send(toSCXMLEvent(doneEvent, {\n        origin: childService.id\n      }));\n    }).start();\n    var actor = childService;\n    this.children.set(childService.id, actor);\n\n    if (resolvedOptions.autoForward) {\n      this.forwardTo.add(childService.id);\n    }\n\n    return actor;\n  };\n\n  Interpreter.prototype.spawnPromise = function (promise, id) {\n    var _this = this;\n\n    var canceled = false;\n    promise.then(function (response) {\n      if (!canceled) {\n        _this.send(toSCXMLEvent(doneInvoke(id, response), {\n          origin: id\n        }));\n      }\n    }, function (errorData) {\n      if (!canceled) {\n        var errorEvent = error(id, errorData);\n\n        try {\n          // Send \"error.platform.id\" to this (parent).\n          _this.send(toSCXMLEvent(errorEvent, {\n            origin: id\n          }));\n        } catch (error) {\n          reportUnhandledExceptionOnInvocation(errorData, error, id);\n\n          if (_this.devTools) {\n            _this.devTools.send(errorEvent, _this.state);\n          }\n\n          if (_this.machine.strict) {\n            // it would be better to always stop the state machine if unhandled\n            // exception/promise rejection happens but because we don't want to\n            // break existing code so enforce it on strict mode only especially so\n            // because documentation says that onError is optional\n            _this.stop();\n          }\n        }\n      }\n    });\n    var actor = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function (next, handleError, complete) {\n        var unsubscribed = false;\n        promise.then(function (response) {\n          if (unsubscribed) {\n            return;\n          }\n\n          next && next(response);\n\n          if (unsubscribed) {\n            return;\n          }\n\n          complete && complete();\n        }, function (err) {\n          if (unsubscribed) {\n            return;\n          }\n\n          handleError(err);\n        });\n        return {\n          unsubscribe: function () {\n            return unsubscribed = true;\n          }\n        };\n      },\n      stop: function () {\n        canceled = true;\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    };\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnCallback = function (callback, id) {\n    var _this = this;\n\n    var canceled = false;\n    var receivers = new Set();\n    var listeners = new Set();\n\n    var receive = function (e) {\n      listeners.forEach(function (listener) {\n        return listener(e);\n      });\n\n      if (canceled) {\n        return;\n      }\n\n      _this.send(e);\n    };\n\n    var callbackStop;\n\n    try {\n      callbackStop = callback(receive, function (newListener) {\n        receivers.add(newListener);\n      });\n    } catch (err) {\n      this.send(error(id, err));\n    }\n\n    if (isPromiseLike(callbackStop)) {\n      // it turned out to be an async function, can't reliably check this before calling `callback`\n      // because transpiled async functions are not recognizable\n      return this.spawnPromise(callbackStop, id);\n    }\n\n    var actor = {\n      id: id,\n      send: function (event) {\n        return receivers.forEach(function (receiver) {\n          return receiver(event);\n        });\n      },\n      subscribe: function (next) {\n        listeners.add(next);\n        return {\n          unsubscribe: function () {\n            listeners.delete(next);\n          }\n        };\n      },\n      stop: function () {\n        canceled = true;\n\n        if (isFunction(callbackStop)) {\n          callbackStop();\n        }\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    };\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnObservable = function (source, id) {\n    var _this = this;\n\n    var subscription = source.subscribe(function (value) {\n      _this.send(toSCXMLEvent(value, {\n        origin: id\n      }));\n    }, function (err) {\n      _this.send(toSCXMLEvent(error(id, err), {\n        origin: id\n      }));\n    }, function () {\n      _this.send(toSCXMLEvent(doneInvoke(id), {\n        origin: id\n      }));\n    });\n    var actor = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function (next, handleError, complete) {\n        return source.subscribe(next, handleError, complete);\n      },\n      stop: function () {\n        return subscription.unsubscribe();\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    };\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnActor = function (actor) {\n    this.children.set(actor.id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnActivity = function (activity) {\n    var implementation = this.machine.options && this.machine.options.activities ? this.machine.options.activities[activity.type] : undefined;\n\n    if (!implementation) {\n      if (!IS_PRODUCTION) {\n        warn(false, \"No implementation found for activity '\" + activity.type + \"'\");\n      } // tslint:disable-next-line:no-console\n\n\n      return;\n    } // Start implementation\n\n\n    var dispose = implementation(this.state.context, activity);\n    this.spawnEffect(activity.id, dispose);\n  };\n\n  Interpreter.prototype.spawnEffect = function (id, dispose) {\n    this.children.set(id, {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function () {\n        return {\n          unsubscribe: function () {\n            return void 0;\n          }\n        };\n      },\n      stop: dispose || undefined,\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    });\n  };\n\n  Interpreter.prototype.attachDev = function () {\n    if (this.options.devTools && typeof window !== 'undefined') {\n      if (window.__REDUX_DEVTOOLS_EXTENSION__) {\n        var devToolsOptions = typeof this.options.devTools === 'object' ? this.options.devTools : undefined;\n        this.devTools = window.__REDUX_DEVTOOLS_EXTENSION__.connect(__assign(__assign({\n          name: this.id,\n          autoPause: true,\n          stateSanitizer: function (state) {\n            return {\n              value: state.value,\n              context: state.context,\n              actions: state.actions\n            };\n          }\n        }, devToolsOptions), {\n          features: __assign({\n            jump: false,\n            skip: false\n          }, devToolsOptions ? devToolsOptions.features : undefined)\n        }), this.machine);\n        this.devTools.init(this.state);\n      } // add XState-specific dev tooling hook\n\n\n      registerService(this);\n    }\n  };\n\n  Interpreter.prototype.toJSON = function () {\n    return {\n      id: this.id\n    };\n  };\n\n  Interpreter.prototype[symbolObservable] = function () {\n    return this;\n  };\n  /**\r\n   * The default interpreter options:\r\n   *\r\n   * - `clock` uses the global `setTimeout` and `clearTimeout` functions\r\n   * - `logger` uses the global `console.log()` method\r\n   */\n\n\n  Interpreter.defaultOptions =\n  /*#__PURE__*/\n  function (global) {\n    return {\n      execute: true,\n      deferEvents: true,\n      clock: {\n        setTimeout: function (fn, ms) {\n          return global.setTimeout.call(null, fn, ms);\n        },\n        clearTimeout: function (id) {\n          return global.clearTimeout.call(null, id);\n        }\n      },\n      logger: global.console.log.bind(console),\n      devTools: false\n    };\n  }(typeof window === 'undefined' ? global : window);\n\n  Interpreter.interpret = interpret;\n  return Interpreter;\n}();\n\nvar createNullActor = function (name) {\n  if (name === void 0) {\n    name = 'null';\n  }\n\n  return {\n    id: name,\n    send: function () {\n      return void 0;\n    },\n    subscribe: function () {\n      // tslint:disable-next-line:no-empty\n      return {\n        unsubscribe: function () {}\n      };\n    },\n    toJSON: function () {\n      return {\n        id: name\n      };\n    }\n  };\n};\n\nvar resolveSpawnOptions = function (nameOrOptions) {\n  if (isString(nameOrOptions)) {\n    return __assign(__assign({}, DEFAULT_SPAWN_OPTIONS), {\n      name: nameOrOptions\n    });\n  }\n\n  return __assign(__assign(__assign({}, DEFAULT_SPAWN_OPTIONS), {\n    name: uniqueId()\n  }), nameOrOptions);\n};\n\nfunction spawn(entity, nameOrOptions) {\n  var resolvedOptions = resolveSpawnOptions(nameOrOptions);\n  return withServiceScope(undefined, function (service) {\n    if (!IS_PRODUCTION) {\n      warn(!!service, \"Attempted to spawn an Actor (ID: \\\"\" + (isMachine(entity) ? entity.id : 'undefined') + \"\\\") outside of a service. This will have no effect.\");\n    }\n\n    if (service) {\n      return service.spawn(entity, resolvedOptions.name, resolvedOptions);\n    } else {\n      return createNullActor(resolvedOptions.name);\n    }\n  });\n}\n/**\r\n * Creates a new Interpreter instance for the given machine with the provided options, if any.\r\n *\r\n * @param machine The machine to interpret\r\n * @param options Interpreter options\r\n */\n\n\nfunction interpret(machine, options) {\n  var interpreter = new Interpreter(machine, options);\n  return interpreter;\n}\n\nexport { Interpreter, interpret, spawn };","import { __assign, __values, __spread, __read, __rest } from './_virtual/_tslib.js';\nimport { DEFAULT_GUARD_TYPE, STATE_DELIMITER } from './constants.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { mapValues, isArray, flatten, keys, toArray, toStateValue, isString, getEventType, matchesState, path, mapContext, toSCXMLEvent, pathToStateValue, isBuiltInEvent, partition, updateContext, warn, updateHistoryValue, toStatePath, mapFilterValues, toStatePaths, nestedPath, normalizeTarget, toGuard, toTransitionConfigArray, isMachine, isFunction } from './utils.js';\nimport { SpecialTargets } from './types.js';\nimport { getAllStateNodes, getConfiguration, has, getChildren, isInFinalState, getValue, isLeafNode } from './stateUtils.js';\nimport { start as start$1, stop as stop$1, pure, log, send, raise as raise$1, invoke, update, nullEvent, assign } from './actionTypes.js';\nimport { done, start, raise, stop, toActionObjects, toActionObject, resolveLog, resolveSend, resolveRaise, doneInvoke, error, toActivityDefinition, after, send as send$1, cancel, initEvent } from './actions.js';\nimport { State, stateValuesEqual } from './State.js';\nimport { createInvocableActor } from './Actor.js';\nvar NULL_EVENT = '';\nvar STATE_IDENTIFIER = '#';\nvar WILDCARD = '*';\nvar EMPTY_OBJECT = {};\n\nvar isStateId = function (str) {\n  return str[0] === STATE_IDENTIFIER;\n};\n\nvar createDefaultOptions = function () {\n  return {\n    actions: {},\n    guards: {},\n    services: {},\n    activities: {},\n    delays: {}\n  };\n};\n\nvar validateArrayifiedTransitions = function (stateNode, event, transitions) {\n  var hasNonLastUnguardedTarget = transitions.slice(0, -1).some(function (transition) {\n    return !('cond' in transition) && !('in' in transition) && (isString(transition.target) || isMachine(transition.target));\n  });\n  var eventText = event === NULL_EVENT ? 'the transient event' : \"event '\" + event + \"'\";\n  warn(!hasNonLastUnguardedTarget, \"One or more transitions for \" + eventText + \" on state '\" + stateNode.id + \"' are unreachable. \" + \"Make sure that the default transition is the last one defined.\");\n};\n\nvar StateNode =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  function StateNode(\n  /**\r\n   * The raw config used to create the machine.\r\n   */\n  config, options,\n  /**\r\n   * The initial extended state\r\n   */\n  context) {\n    var _this = this;\n\n    this.config = config;\n    this.context = context;\n    /**\r\n     * The order this state node appears. Corresponds to the implicit SCXML document order.\r\n     */\n\n    this.order = -1;\n    this.__xstatenode = true;\n    this.__cache = {\n      events: undefined,\n      relativeValue: new Map(),\n      initialStateValue: undefined,\n      initialState: undefined,\n      on: undefined,\n      transitions: undefined,\n      candidates: {},\n      delayedTransitions: undefined\n    };\n    this.idMap = {};\n    this.options = Object.assign(createDefaultOptions(), options);\n    this.parent = this.options._parent;\n    this.key = this.config.key || this.options._key || this.config.id || '(machine)';\n    this.machine = this.parent ? this.parent.machine : this;\n    this.path = this.parent ? this.parent.path.concat(this.key) : [];\n    this.delimiter = this.config.delimiter || (this.parent ? this.parent.delimiter : STATE_DELIMITER);\n    this.id = this.config.id || __spread([this.machine.key], this.path).join(this.delimiter);\n    this.version = this.parent ? this.parent.version : this.config.version;\n    this.type = this.config.type || (this.config.parallel ? 'parallel' : this.config.states && keys(this.config.states).length ? 'compound' : this.config.history ? 'history' : 'atomic');\n\n    if (!IS_PRODUCTION) {\n      warn(!('parallel' in this.config), \"The \\\"parallel\\\" property is deprecated and will be removed in version 4.1. \" + (this.config.parallel ? \"Replace with `type: 'parallel'`\" : \"Use `type: '\" + this.type + \"'`\") + \" in the config for state node '\" + this.id + \"' instead.\");\n    }\n\n    this.initial = this.config.initial;\n    this.states = this.config.states ? mapValues(this.config.states, function (stateConfig, key) {\n      var _a;\n\n      var stateNode = new StateNode(stateConfig, {\n        _parent: _this,\n        _key: key\n      });\n      Object.assign(_this.idMap, __assign((_a = {}, _a[stateNode.id] = stateNode, _a), stateNode.idMap));\n      return stateNode;\n    }) : EMPTY_OBJECT; // Document order\n\n    var order = 0;\n\n    function dfs(stateNode) {\n      var e_1, _a;\n\n      stateNode.order = order++;\n\n      try {\n        for (var _b = __values(getChildren(stateNode)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var child = _c.value;\n          dfs(child);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n    }\n\n    dfs(this); // History config\n\n    this.history = this.config.history === true ? 'shallow' : this.config.history || false;\n    this._transient = !this.config.on ? false : Array.isArray(this.config.on) ? this.config.on.some(function (_a) {\n      var event = _a.event;\n      return event === NULL_EVENT;\n    }) : NULL_EVENT in this.config.on;\n    this.strict = !!this.config.strict; // TODO: deprecate (entry)\n\n    this.onEntry = toArray(this.config.entry || this.config.onEntry).map(function (action) {\n      return toActionObject(action);\n    }); // TODO: deprecate (exit)\n\n    this.onExit = toArray(this.config.exit || this.config.onExit).map(function (action) {\n      return toActionObject(action);\n    });\n    this.meta = this.config.meta;\n    this.data = this.type === 'final' ? this.config.data : undefined;\n    this.invoke = toArray(this.config.invoke).map(function (invokeConfig, i) {\n      var _a, _b;\n\n      if (isMachine(invokeConfig)) {\n        _this.machine.options.services = __assign((_a = {}, _a[invokeConfig.id] = invokeConfig, _a), _this.machine.options.services);\n        return {\n          type: invoke,\n          src: invokeConfig.id,\n          id: invokeConfig.id\n        };\n      } else if (typeof invokeConfig.src !== 'string') {\n        var invokeSrc = _this.id + \":invocation[\" + i + \"]\"; // TODO: util function\n\n        _this.machine.options.services = __assign((_b = {}, _b[invokeSrc] = invokeConfig.src, _b), _this.machine.options.services);\n        return __assign(__assign({\n          type: invoke,\n          id: invokeSrc\n        }, invokeConfig), {\n          src: invokeSrc\n        });\n      } else {\n        return __assign(__assign({}, invokeConfig), {\n          type: invoke,\n          id: invokeConfig.id || invokeConfig.src,\n          src: invokeConfig.src\n        });\n      }\n    });\n    this.activities = toArray(this.config.activities).concat(this.invoke).map(function (activity) {\n      return toActivityDefinition(activity);\n    });\n    this.transition = this.transition.bind(this);\n  }\n\n  StateNode.prototype._init = function () {\n    if (this.__cache.transitions) {\n      return;\n    }\n\n    getAllStateNodes(this).forEach(function (stateNode) {\n      return stateNode.on;\n    });\n  };\n  /**\r\n   * Clones this state machine with custom options and context.\r\n   *\r\n   * @param options Options (actions, guards, activities, services) to recursively merge with the existing options.\r\n   * @param context Custom context (will override predefined context)\r\n   */\n\n\n  StateNode.prototype.withConfig = function (options, context) {\n    if (context === void 0) {\n      context = this.context;\n    }\n\n    var _a = this.options,\n        actions = _a.actions,\n        activities = _a.activities,\n        guards = _a.guards,\n        services = _a.services,\n        delays = _a.delays;\n    return new StateNode(this.config, {\n      actions: __assign(__assign({}, actions), options.actions),\n      activities: __assign(__assign({}, activities), options.activities),\n      guards: __assign(__assign({}, guards), options.guards),\n      services: __assign(__assign({}, services), options.services),\n      delays: __assign(__assign({}, delays), options.delays)\n    }, context);\n  };\n  /**\r\n   * Clones this state machine with custom context.\r\n   *\r\n   * @param context Custom context (will override predefined context, not recursive)\r\n   */\n\n\n  StateNode.prototype.withContext = function (context) {\n    return new StateNode(this.config, this.options, context);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"definition\", {\n    /**\r\n     * The well-structured state node definition.\r\n     */\n    get: function () {\n      return {\n        id: this.id,\n        key: this.key,\n        version: this.version,\n        type: this.type,\n        initial: this.initial,\n        history: this.history,\n        states: mapValues(this.states, function (state) {\n          return state.definition;\n        }),\n        on: this.on,\n        transitions: this.transitions,\n        onEntry: this.onEntry,\n        onExit: this.onExit,\n        activities: this.activities || [],\n        meta: this.meta,\n        order: this.order || -1,\n        data: this.data,\n        invoke: this.invoke\n      };\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  StateNode.prototype.toJSON = function () {\n    return this.definition;\n  };\n\n  Object.defineProperty(StateNode.prototype, \"on\", {\n    /**\r\n     * The mapping of events to transitions.\r\n     */\n    get: function () {\n      if (this.__cache.on) {\n        return this.__cache.on;\n      }\n\n      var transitions = this.transitions;\n      return this.__cache.on = transitions.reduce(function (map, transition) {\n        map[transition.eventType] = map[transition.eventType] || [];\n        map[transition.eventType].push(transition);\n        return map;\n      }, {});\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"after\", {\n    get: function () {\n      return this.__cache.delayedTransitions || (this.__cache.delayedTransitions = this.getDelayedTransitions(), this.__cache.delayedTransitions);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"transitions\", {\n    /**\r\n     * All the transitions that can be taken from this state node.\r\n     */\n    get: function () {\n      return this.__cache.transitions || (this.__cache.transitions = this.formatTransitions(), this.__cache.transitions);\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  StateNode.prototype.getCandidates = function (eventName) {\n    if (this.__cache.candidates[eventName]) {\n      return this.__cache.candidates[eventName];\n    }\n\n    var transient = eventName === NULL_EVENT;\n    var candidates = this.transitions.filter(function (transition) {\n      var sameEventType = transition.eventType === eventName; // null events should only match against eventless transitions\n\n      return transient ? sameEventType : sameEventType || transition.eventType === WILDCARD;\n    });\n    this.__cache.candidates[eventName] = candidates;\n    return candidates;\n  };\n  /**\r\n   * All delayed transitions from the config.\r\n   */\n\n\n  StateNode.prototype.getDelayedTransitions = function () {\n    var _this = this;\n\n    var afterConfig = this.config.after;\n\n    if (!afterConfig) {\n      return [];\n    }\n\n    var mutateEntryExit = function (delay, i) {\n      var delayRef = isFunction(delay) ? _this.id + \":delay[\" + i + \"]\" : delay;\n      var eventType = after(delayRef, _this.id);\n\n      _this.onEntry.push(send$1(eventType, {\n        delay: delay\n      }));\n\n      _this.onExit.push(cancel(eventType));\n\n      return eventType;\n    };\n\n    var delayedTransitions = isArray(afterConfig) ? afterConfig.map(function (transition, i) {\n      var eventType = mutateEntryExit(transition.delay, i);\n      return __assign(__assign({}, transition), {\n        event: eventType\n      });\n    }) : flatten(keys(afterConfig).map(function (delay, i) {\n      var configTransition = afterConfig[delay];\n      var resolvedTransition = isString(configTransition) ? {\n        target: configTransition\n      } : configTransition;\n      var resolvedDelay = !isNaN(+delay) ? +delay : delay;\n      var eventType = mutateEntryExit(resolvedDelay, i);\n      return toArray(resolvedTransition).map(function (transition) {\n        return __assign(__assign({}, transition), {\n          event: eventType,\n          delay: resolvedDelay\n        });\n      });\n    }));\n    return delayedTransitions.map(function (delayedTransition) {\n      var delay = delayedTransition.delay;\n      return __assign(__assign({}, _this.formatTransition(delayedTransition)), {\n        delay: delay\n      });\n    });\n  };\n  /**\r\n   * Returns the state nodes represented by the current state value.\r\n   *\r\n   * @param state The state value or State instance\r\n   */\n\n\n  StateNode.prototype.getStateNodes = function (state) {\n    var _a;\n\n    var _this = this;\n\n    if (!state) {\n      return [];\n    }\n\n    var stateValue = state instanceof State ? state.value : toStateValue(state, this.delimiter);\n\n    if (isString(stateValue)) {\n      var initialStateValue = this.getStateNode(stateValue).initial;\n      return initialStateValue !== undefined ? this.getStateNodes((_a = {}, _a[stateValue] = initialStateValue, _a)) : [this.states[stateValue]];\n    }\n\n    var subStateKeys = keys(stateValue);\n    var subStateNodes = subStateKeys.map(function (subStateKey) {\n      return _this.getStateNode(subStateKey);\n    });\n    return subStateNodes.concat(subStateKeys.reduce(function (allSubStateNodes, subStateKey) {\n      var subStateNode = _this.getStateNode(subStateKey).getStateNodes(stateValue[subStateKey]);\n\n      return allSubStateNodes.concat(subStateNode);\n    }, []));\n  };\n  /**\r\n   * Returns `true` if this state node explicitly handles the given event.\r\n   *\r\n   * @param event The event in question\r\n   */\n\n\n  StateNode.prototype.handles = function (event) {\n    var eventType = getEventType(event);\n    return this.events.includes(eventType);\n  };\n  /**\r\n   * Resolves the given `state` to a new `State` instance relative to this machine.\r\n   *\r\n   * This ensures that `.events` and `.nextEvents` represent the correct values.\r\n   *\r\n   * @param state The state to resolve\r\n   */\n\n\n  StateNode.prototype.resolveState = function (state) {\n    var configuration = Array.from(getConfiguration([], this.getStateNodes(state.value)));\n    return new State(__assign(__assign({}, state), {\n      value: this.resolve(state.value),\n      configuration: configuration\n    }));\n  };\n\n  StateNode.prototype.transitionLeafNode = function (stateValue, state, _event) {\n    var stateNode = this.getStateNode(stateValue);\n    var next = stateNode.next(state, _event);\n\n    if (!next || !next.transitions.length) {\n      return this.next(state, _event);\n    }\n\n    return next;\n  };\n\n  StateNode.prototype.transitionCompoundNode = function (stateValue, state, _event) {\n    var subStateKeys = keys(stateValue);\n    var stateNode = this.getStateNode(subStateKeys[0]);\n\n    var next = stateNode._transition(stateValue[subStateKeys[0]], state, _event);\n\n    if (!next || !next.transitions.length) {\n      return this.next(state, _event);\n    }\n\n    return next;\n  };\n\n  StateNode.prototype.transitionParallelNode = function (stateValue, state, _event) {\n    var e_2, _a;\n\n    var transitionMap = {};\n\n    try {\n      for (var _b = __values(keys(stateValue)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var subStateKey = _c.value;\n        var subStateValue = stateValue[subStateKey];\n\n        if (!subStateValue) {\n          continue;\n        }\n\n        var subStateNode = this.getStateNode(subStateKey);\n\n        var next = subStateNode._transition(subStateValue, state, _event);\n\n        if (next) {\n          transitionMap[subStateKey] = next;\n        }\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    var stateTransitions = keys(transitionMap).map(function (key) {\n      return transitionMap[key];\n    });\n    var enabledTransitions = flatten(stateTransitions.map(function (st) {\n      return st.transitions;\n    }));\n    var willTransition = stateTransitions.some(function (st) {\n      return st.transitions.length > 0;\n    });\n\n    if (!willTransition) {\n      return this.next(state, _event);\n    }\n\n    var entryNodes = flatten(stateTransitions.map(function (t) {\n      return t.entrySet;\n    }));\n    var configuration = flatten(keys(transitionMap).map(function (key) {\n      return transitionMap[key].configuration;\n    }));\n    return {\n      transitions: enabledTransitions,\n      entrySet: entryNodes,\n      exitSet: flatten(stateTransitions.map(function (t) {\n        return t.exitSet;\n      })),\n      configuration: configuration,\n      source: state,\n      actions: flatten(keys(transitionMap).map(function (key) {\n        return transitionMap[key].actions;\n      }))\n    };\n  };\n\n  StateNode.prototype._transition = function (stateValue, state, _event) {\n    // leaf node\n    if (isString(stateValue)) {\n      return this.transitionLeafNode(stateValue, state, _event);\n    } // hierarchical node\n\n\n    if (keys(stateValue).length === 1) {\n      return this.transitionCompoundNode(stateValue, state, _event);\n    } // orthogonal node\n\n\n    return this.transitionParallelNode(stateValue, state, _event);\n  };\n\n  StateNode.prototype.next = function (state, _event) {\n    var e_3, _a;\n\n    var _this = this;\n\n    var eventName = _event.name;\n    var actions = [];\n    var nextStateNodes = [];\n    var selectedTransition;\n\n    try {\n      for (var _b = __values(this.getCandidates(eventName)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var candidate = _c.value;\n        var cond = candidate.cond,\n            stateIn = candidate.in;\n        var resolvedContext = state.context;\n        var isInState = stateIn ? isString(stateIn) && isStateId(stateIn) ? // Check if in state by ID\n        state.matches(toStateValue(this.getStateNodeById(stateIn).path, this.delimiter)) : // Check if in state by relative grandparent\n        matchesState(toStateValue(stateIn, this.delimiter), path(this.path.slice(0, -2))(state.value)) : true;\n        var guardPassed = false;\n\n        try {\n          guardPassed = !cond || this.evaluateGuard(cond, resolvedContext, _event, state);\n        } catch (err) {\n          throw new Error(\"Unable to evaluate guard '\" + (cond.name || cond.type) + \"' in transition for event '\" + eventName + \"' in state node '\" + this.id + \"':\\n\" + err.message);\n        }\n\n        if (guardPassed && isInState) {\n          if (candidate.target !== undefined) {\n            nextStateNodes = candidate.target;\n          }\n\n          actions.push.apply(actions, __spread(candidate.actions));\n          selectedTransition = candidate;\n          break;\n        }\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    if (!selectedTransition) {\n      return undefined;\n    }\n\n    if (!nextStateNodes.length) {\n      return {\n        transitions: [selectedTransition],\n        entrySet: [],\n        exitSet: [],\n        configuration: state.value ? [this] : [],\n        source: state,\n        actions: actions\n      };\n    }\n\n    var allNextStateNodes = flatten(nextStateNodes.map(function (stateNode) {\n      return _this.getRelativeStateNodes(stateNode, state.historyValue);\n    }));\n    var isInternal = !!selectedTransition.internal;\n    var reentryNodes = isInternal ? [] : flatten(allNextStateNodes.map(function (n) {\n      return _this.nodesFromChild(n);\n    }));\n    return {\n      transitions: [selectedTransition],\n      entrySet: reentryNodes,\n      exitSet: isInternal ? [] : [this],\n      configuration: allNextStateNodes,\n      source: state,\n      actions: actions\n    };\n  };\n\n  StateNode.prototype.nodesFromChild = function (childStateNode) {\n    if (childStateNode.escapes(this)) {\n      return [];\n    }\n\n    var nodes = [];\n    var marker = childStateNode;\n\n    while (marker && marker !== this) {\n      nodes.push(marker);\n      marker = marker.parent;\n    }\n\n    nodes.push(this); // inclusive\n\n    return nodes;\n  };\n  /**\r\n   * Whether the given state node \"escapes\" this state node. If the `stateNode` is equal to or the parent of\r\n   * this state node, it does not escape.\r\n   */\n\n\n  StateNode.prototype.escapes = function (stateNode) {\n    if (this === stateNode) {\n      return false;\n    }\n\n    var parent = this.parent;\n\n    while (parent) {\n      if (parent === stateNode) {\n        return false;\n      }\n\n      parent = parent.parent;\n    }\n\n    return true;\n  };\n\n  StateNode.prototype.evaluateGuard = function (guard, context, _event, state) {\n    var guards = this.machine.options.guards;\n    var guardMeta = {\n      state: state,\n      cond: guard,\n      _event: _event\n    }; // TODO: do not hardcode!\n\n    if (guard.type === DEFAULT_GUARD_TYPE) {\n      return guard.predicate(context, _event.data, guardMeta);\n    }\n\n    var condFn = guards[guard.type];\n\n    if (!condFn) {\n      throw new Error(\"Guard '\" + guard.type + \"' is not implemented on machine '\" + this.machine.id + \"'.\");\n    }\n\n    return condFn(context, _event.data, guardMeta);\n  };\n\n  StateNode.prototype.getActions = function (transition, currentContext, _event, prevState) {\n    var e_4, _a, e_5, _b;\n\n    var prevConfig = getConfiguration([], prevState ? this.getStateNodes(prevState.value) : [this]);\n    var resolvedConfig = transition.configuration.length ? getConfiguration(prevConfig, transition.configuration) : prevConfig;\n\n    try {\n      for (var resolvedConfig_1 = __values(resolvedConfig), resolvedConfig_1_1 = resolvedConfig_1.next(); !resolvedConfig_1_1.done; resolvedConfig_1_1 = resolvedConfig_1.next()) {\n        var sn = resolvedConfig_1_1.value;\n\n        if (!has(prevConfig, sn)) {\n          transition.entrySet.push(sn);\n        }\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (resolvedConfig_1_1 && !resolvedConfig_1_1.done && (_a = resolvedConfig_1.return)) _a.call(resolvedConfig_1);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n\n    try {\n      for (var prevConfig_1 = __values(prevConfig), prevConfig_1_1 = prevConfig_1.next(); !prevConfig_1_1.done; prevConfig_1_1 = prevConfig_1.next()) {\n        var sn = prevConfig_1_1.value;\n\n        if (!has(resolvedConfig, sn) || has(transition.exitSet, sn.parent)) {\n          transition.exitSet.push(sn);\n        }\n      }\n    } catch (e_5_1) {\n      e_5 = {\n        error: e_5_1\n      };\n    } finally {\n      try {\n        if (prevConfig_1_1 && !prevConfig_1_1.done && (_b = prevConfig_1.return)) _b.call(prevConfig_1);\n      } finally {\n        if (e_5) throw e_5.error;\n      }\n    }\n\n    if (!transition.source) {\n      transition.exitSet = []; // Ensure that root StateNode (machine) is entered\n\n      transition.entrySet.push(this);\n    }\n\n    var doneEvents = flatten(transition.entrySet.map(function (sn) {\n      var events = [];\n\n      if (sn.type !== 'final') {\n        return events;\n      }\n\n      var parent = sn.parent;\n      events.push(done(sn.id, sn.data), // TODO: deprecate - final states should not emit done events for their own state.\n      done(parent.id, sn.data ? mapContext(sn.data, currentContext, _event) : undefined));\n\n      if (parent.parent) {\n        var grandparent = parent.parent;\n\n        if (grandparent.type === 'parallel') {\n          if (getChildren(grandparent).every(function (parentNode) {\n            return isInFinalState(transition.configuration, parentNode);\n          })) {\n            events.push(done(grandparent.id, grandparent.data));\n          }\n        }\n      }\n\n      return events;\n    }));\n    transition.exitSet.sort(function (a, b) {\n      return b.order - a.order;\n    });\n    transition.entrySet.sort(function (a, b) {\n      return a.order - b.order;\n    });\n    var entryStates = new Set(transition.entrySet);\n    var exitStates = new Set(transition.exitSet);\n\n    var _c = __read([flatten(Array.from(entryStates).map(function (stateNode) {\n      return __spread(stateNode.activities.map(function (activity) {\n        return start(activity);\n      }), stateNode.onEntry);\n    })).concat(doneEvents.map(raise)), flatten(Array.from(exitStates).map(function (stateNode) {\n      return __spread(stateNode.onExit, stateNode.activities.map(function (activity) {\n        return stop(activity);\n      }));\n    }))], 2),\n        entryActions = _c[0],\n        exitActions = _c[1];\n\n    var actions = toActionObjects(exitActions.concat(transition.actions).concat(entryActions), this.machine.options.actions);\n    return actions;\n  };\n  /**\r\n   * Determines the next state given the current `state` and sent `event`.\r\n   *\r\n   * @param state The current State instance or state value\r\n   * @param event The event that was sent at the current state\r\n   * @param context The current context (extended state) of the current state\r\n   */\n\n\n  StateNode.prototype.transition = function (state, event, context) {\n    if (state === void 0) {\n      state = this.initialState;\n    }\n\n    var _event = toSCXMLEvent(event);\n\n    var currentState;\n\n    if (state instanceof State) {\n      currentState = context === undefined ? state : this.resolveState(State.from(state, context));\n    } else {\n      var resolvedStateValue = isString(state) ? this.resolve(pathToStateValue(this.getResolvedPath(state))) : this.resolve(state);\n      var resolvedContext = context ? context : this.machine.context;\n      currentState = this.resolveState(State.from(resolvedStateValue, resolvedContext));\n    }\n\n    if (!IS_PRODUCTION && _event.name === WILDCARD) {\n      throw new Error(\"An event cannot have the wildcard type ('\" + WILDCARD + \"')\");\n    }\n\n    if (this.strict) {\n      if (!this.events.includes(_event.name) && !isBuiltInEvent(_event.name)) {\n        throw new Error(\"Machine '\" + this.id + \"' does not accept event '\" + _event.name + \"'\");\n      }\n    }\n\n    var stateTransition = this._transition(currentState.value, currentState, _event) || {\n      transitions: [],\n      configuration: [],\n      entrySet: [],\n      exitSet: [],\n      source: currentState,\n      actions: []\n    };\n    var prevConfig = getConfiguration([], this.getStateNodes(currentState.value));\n    var resolvedConfig = stateTransition.configuration.length ? getConfiguration(prevConfig, stateTransition.configuration) : prevConfig;\n    stateTransition.configuration = __spread(resolvedConfig);\n    return this.resolveTransition(stateTransition, currentState, _event);\n  };\n\n  StateNode.prototype.resolveRaisedTransition = function (state, _event, originalEvent) {\n    var _a;\n\n    var currentActions = state.actions;\n    state = this.transition(state, _event); // Save original event to state\n\n    state._event = originalEvent;\n    state.event = originalEvent.data;\n\n    (_a = state.actions).unshift.apply(_a, __spread(currentActions));\n\n    return state;\n  };\n\n  StateNode.prototype.resolveTransition = function (stateTransition, currentState, _event, context) {\n    var e_6, _a;\n\n    var _this = this;\n\n    if (_event === void 0) {\n      _event = initEvent;\n    }\n\n    if (context === void 0) {\n      context = this.machine.context;\n    }\n\n    var configuration = stateTransition.configuration; // Transition will \"apply\" if:\n    // - this is the initial state (there is no current state)\n    // - OR there are transitions\n\n    var willTransition = !currentState || stateTransition.transitions.length > 0;\n    var resolvedStateValue = willTransition ? getValue(this.machine, configuration) : undefined;\n    var historyValue = currentState ? currentState.historyValue ? currentState.historyValue : stateTransition.source ? this.machine.historyValue(currentState.value) : undefined : undefined;\n    var currentContext = currentState ? currentState.context : context;\n    var actions = this.getActions(stateTransition, currentContext, _event, currentState);\n    var activities = currentState ? __assign({}, currentState.activities) : {};\n\n    try {\n      for (var actions_1 = __values(actions), actions_1_1 = actions_1.next(); !actions_1_1.done; actions_1_1 = actions_1.next()) {\n        var action = actions_1_1.value;\n\n        if (action.type === start$1) {\n          activities[action.activity.type] = action;\n        } else if (action.type === stop$1) {\n          activities[action.activity.type] = false;\n        }\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (actions_1_1 && !actions_1_1.done && (_a = actions_1.return)) _a.call(actions_1);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n\n    var _b = __read(partition(actions, function (action) {\n      return action.type === assign;\n    }), 2),\n        assignActions = _b[0],\n        otherActions = _b[1];\n\n    var updatedContext = assignActions.length ? updateContext(currentContext, _event, assignActions, currentState) : currentContext;\n    var resolvedActions = flatten(otherActions.map(function (actionObject) {\n      switch (actionObject.type) {\n        case raise$1:\n          return resolveRaise(actionObject);\n\n        case send:\n          var sendAction = resolveSend(actionObject, updatedContext, _event, _this.machine.options.delays); // TODO: fix ActionTypes.Init\n\n          if (!IS_PRODUCTION) {\n            // warn after resolving as we can create better contextual message here\n            warn(!isString(actionObject.delay) || typeof sendAction.delay === 'number', // tslint:disable-next-line:max-line-length\n            \"No delay reference for delay expression '\" + actionObject.delay + \"' was found on machine '\" + _this.machine.id + \"'\");\n          }\n\n          return sendAction;\n\n        case log:\n          return resolveLog(actionObject, updatedContext, _event);\n\n        case pure:\n          return actionObject.get(updatedContext, _event.data) || [];\n\n        default:\n          return toActionObject(actionObject, _this.options.actions);\n      }\n    }));\n\n    var _c = __read(partition(resolvedActions, function (action) {\n      return action.type === raise$1 || action.type === send && action.to === SpecialTargets.Internal;\n    }), 2),\n        raisedEvents = _c[0],\n        nonRaisedActions = _c[1];\n\n    var invokeActions = resolvedActions.filter(function (action) {\n      return action.type === start$1 && action.activity.type === invoke;\n    });\n    var children = invokeActions.reduce(function (acc, action) {\n      acc[action.activity.id] = createInvocableActor(action.activity);\n      return acc;\n    }, currentState ? __assign({}, currentState.children) : {});\n    var resolvedConfiguration = resolvedStateValue ? stateTransition.configuration : currentState ? currentState.configuration : [];\n    var meta = resolvedConfiguration.reduce(function (acc, stateNode) {\n      if (stateNode.meta !== undefined) {\n        acc[stateNode.id] = stateNode.meta;\n      }\n\n      return acc;\n    }, {});\n    var isDone = isInFinalState(resolvedConfiguration, this);\n    var nextState = new State({\n      value: resolvedStateValue || currentState.value,\n      context: updatedContext,\n      _event: _event,\n      // Persist _sessionid between states\n      _sessionid: currentState ? currentState._sessionid : null,\n      historyValue: resolvedStateValue ? historyValue ? updateHistoryValue(historyValue, resolvedStateValue) : undefined : currentState ? currentState.historyValue : undefined,\n      history: !resolvedStateValue || stateTransition.source ? currentState : undefined,\n      actions: resolvedStateValue ? nonRaisedActions : [],\n      activities: resolvedStateValue ? activities : currentState ? currentState.activities : {},\n      meta: resolvedStateValue ? meta : currentState ? currentState.meta : undefined,\n      events: [],\n      configuration: resolvedConfiguration,\n      transitions: stateTransition.transitions,\n      children: children,\n      done: isDone\n    });\n    nextState.changed = _event.name === update || !!assignActions.length; // Dispose of penultimate histories to prevent memory leaks\n\n    var history = nextState.history;\n\n    if (history) {\n      delete history.history;\n    }\n\n    if (!resolvedStateValue) {\n      return nextState;\n    }\n\n    var maybeNextState = nextState;\n\n    if (!isDone) {\n      var isTransient = this._transient || configuration.some(function (stateNode) {\n        return stateNode._transient;\n      });\n\n      if (isTransient) {\n        maybeNextState = this.resolveRaisedTransition(maybeNextState, {\n          type: nullEvent\n        }, _event);\n      }\n\n      while (raisedEvents.length) {\n        var raisedEvent = raisedEvents.shift();\n        maybeNextState = this.resolveRaisedTransition(maybeNextState, raisedEvent._event, _event);\n      }\n    } // Detect if state changed\n\n\n    var changed = maybeNextState.changed || (history ? !!maybeNextState.actions.length || !!assignActions.length || typeof history.value !== typeof maybeNextState.value || !stateValuesEqual(maybeNextState.value, history.value) : undefined);\n    maybeNextState.changed = changed; // Preserve original history after raised events\n\n    maybeNextState.historyValue = nextState.historyValue;\n    maybeNextState.history = history;\n    return maybeNextState;\n  };\n  /**\r\n   * Returns the child state node from its relative `stateKey`, or throws.\r\n   */\n\n\n  StateNode.prototype.getStateNode = function (stateKey) {\n    if (isStateId(stateKey)) {\n      return this.machine.getStateNodeById(stateKey);\n    }\n\n    if (!this.states) {\n      throw new Error(\"Unable to retrieve child state '\" + stateKey + \"' from '\" + this.id + \"'; no child states exist.\");\n    }\n\n    var result = this.states[stateKey];\n\n    if (!result) {\n      throw new Error(\"Child state '\" + stateKey + \"' does not exist on '\" + this.id + \"'\");\n    }\n\n    return result;\n  };\n  /**\r\n   * Returns the state node with the given `stateId`, or throws.\r\n   *\r\n   * @param stateId The state ID. The prefix \"#\" is removed.\r\n   */\n\n\n  StateNode.prototype.getStateNodeById = function (stateId) {\n    var resolvedStateId = isStateId(stateId) ? stateId.slice(STATE_IDENTIFIER.length) : stateId;\n\n    if (resolvedStateId === this.id) {\n      return this;\n    }\n\n    var stateNode = this.machine.idMap[resolvedStateId];\n\n    if (!stateNode) {\n      throw new Error(\"Child state node '#\" + resolvedStateId + \"' does not exist on machine '\" + this.id + \"'\");\n    }\n\n    return stateNode;\n  };\n  /**\r\n   * Returns the relative state node from the given `statePath`, or throws.\r\n   *\r\n   * @param statePath The string or string array relative path to the state node.\r\n   */\n\n\n  StateNode.prototype.getStateNodeByPath = function (statePath) {\n    if (typeof statePath === 'string' && isStateId(statePath)) {\n      try {\n        return this.getStateNodeById(statePath.slice(1));\n      } catch (e) {// try individual paths\n        // throw e;\n      }\n    }\n\n    var arrayStatePath = toStatePath(statePath, this.delimiter).slice();\n    var currentStateNode = this;\n\n    while (arrayStatePath.length) {\n      var key = arrayStatePath.shift();\n\n      if (!key.length) {\n        break;\n      }\n\n      currentStateNode = currentStateNode.getStateNode(key);\n    }\n\n    return currentStateNode;\n  };\n  /**\r\n   * Resolves a partial state value with its full representation in this machine.\r\n   *\r\n   * @param stateValue The partial state value to resolve.\r\n   */\n\n\n  StateNode.prototype.resolve = function (stateValue) {\n    var _a;\n\n    var _this = this;\n\n    if (!stateValue) {\n      return this.initialStateValue || EMPTY_OBJECT; // TODO: type-specific properties\n    }\n\n    switch (this.type) {\n      case 'parallel':\n        return mapValues(this.initialStateValue, function (subStateValue, subStateKey) {\n          return subStateValue ? _this.getStateNode(subStateKey).resolve(stateValue[subStateKey] || subStateValue) : EMPTY_OBJECT;\n        });\n\n      case 'compound':\n        if (isString(stateValue)) {\n          var subStateNode = this.getStateNode(stateValue);\n\n          if (subStateNode.type === 'parallel' || subStateNode.type === 'compound') {\n            return _a = {}, _a[stateValue] = subStateNode.initialStateValue, _a;\n          }\n\n          return stateValue;\n        }\n\n        if (!keys(stateValue).length) {\n          return this.initialStateValue || {};\n        }\n\n        return mapValues(stateValue, function (subStateValue, subStateKey) {\n          return subStateValue ? _this.getStateNode(subStateKey).resolve(subStateValue) : EMPTY_OBJECT;\n        });\n\n      default:\n        return stateValue || EMPTY_OBJECT;\n    }\n  };\n\n  StateNode.prototype.getResolvedPath = function (stateIdentifier) {\n    if (isStateId(stateIdentifier)) {\n      var stateNode = this.machine.idMap[stateIdentifier.slice(STATE_IDENTIFIER.length)];\n\n      if (!stateNode) {\n        throw new Error(\"Unable to find state node '\" + stateIdentifier + \"'\");\n      }\n\n      return stateNode.path;\n    }\n\n    return toStatePath(stateIdentifier, this.delimiter);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialStateValue\", {\n    get: function () {\n      var _a;\n\n      if (this.__cache.initialStateValue) {\n        return this.__cache.initialStateValue;\n      }\n\n      var initialStateValue;\n\n      if (this.type === 'parallel') {\n        initialStateValue = mapFilterValues(this.states, function (state) {\n          return state.initialStateValue || EMPTY_OBJECT;\n        }, function (stateNode) {\n          return !(stateNode.type === 'history');\n        });\n      } else if (this.initial !== undefined) {\n        if (!this.states[this.initial]) {\n          throw new Error(\"Initial state '\" + this.initial + \"' not found on '\" + this.key + \"'\");\n        }\n\n        initialStateValue = isLeafNode(this.states[this.initial]) ? this.initial : (_a = {}, _a[this.initial] = this.states[this.initial].initialStateValue, _a);\n      }\n\n      this.__cache.initialStateValue = initialStateValue;\n      return this.__cache.initialStateValue;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  StateNode.prototype.getInitialState = function (stateValue, context) {\n    var configuration = this.getStateNodes(stateValue);\n    return this.resolveTransition({\n      configuration: configuration,\n      entrySet: configuration,\n      exitSet: [],\n      transitions: [],\n      source: undefined,\n      actions: []\n    }, undefined, undefined, context);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialState\", {\n    /**\r\n     * The initial State instance, which includes all actions to be executed from\r\n     * entering the initial state.\r\n     */\n    get: function () {\n      this._init();\n\n      var initialStateValue = this.initialStateValue;\n\n      if (!initialStateValue) {\n        throw new Error(\"Cannot retrieve initial state from simple state '\" + this.id + \"'.\");\n      }\n\n      return this.getInitialState(initialStateValue);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"target\", {\n    /**\r\n     * The target state value of the history state node, if it exists. This represents the\r\n     * default state value to transition to if no history value exists yet.\r\n     */\n    get: function () {\n      var target;\n\n      if (this.type === 'history') {\n        var historyConfig = this.config;\n\n        if (isString(historyConfig.target)) {\n          target = isStateId(historyConfig.target) ? pathToStateValue(this.machine.getStateNodeById(historyConfig.target).path.slice(this.path.length - 1)) : historyConfig.target;\n        } else {\n          target = historyConfig.target;\n        }\n      }\n\n      return target;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Returns the leaf nodes from a state path relative to this state node.\r\n   *\r\n   * @param relativeStateId The relative state path to retrieve the state nodes\r\n   * @param history The previous state to retrieve history\r\n   * @param resolve Whether state nodes should resolve to initial child state nodes\r\n   */\n\n  StateNode.prototype.getRelativeStateNodes = function (relativeStateId, historyValue, resolve) {\n    if (resolve === void 0) {\n      resolve = true;\n    }\n\n    return resolve ? relativeStateId.type === 'history' ? relativeStateId.resolveHistory(historyValue) : relativeStateId.initialStateNodes : [relativeStateId];\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialStateNodes\", {\n    get: function () {\n      var _this = this;\n\n      if (isLeafNode(this)) {\n        return [this];\n      } // Case when state node is compound but no initial state is defined\n\n\n      if (this.type === 'compound' && !this.initial) {\n        if (!IS_PRODUCTION) {\n          warn(false, \"Compound state node '\" + this.id + \"' has no initial state.\");\n        }\n\n        return [this];\n      }\n\n      var initialStateNodePaths = toStatePaths(this.initialStateValue);\n      return flatten(initialStateNodePaths.map(function (initialPath) {\n        return _this.getFromRelativePath(initialPath);\n      }));\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Retrieves state nodes from a relative path to this state node.\r\n   *\r\n   * @param relativePath The relative path from this state node\r\n   * @param historyValue\r\n   */\n\n  StateNode.prototype.getFromRelativePath = function (relativePath) {\n    if (!relativePath.length) {\n      return [this];\n    }\n\n    var _a = __read(relativePath),\n        stateKey = _a[0],\n        childStatePath = _a.slice(1);\n\n    if (!this.states) {\n      throw new Error(\"Cannot retrieve subPath '\" + stateKey + \"' from node with no states\");\n    }\n\n    var childStateNode = this.getStateNode(stateKey);\n\n    if (childStateNode.type === 'history') {\n      return childStateNode.resolveHistory();\n    }\n\n    if (!this.states[stateKey]) {\n      throw new Error(\"Child state '\" + stateKey + \"' does not exist on '\" + this.id + \"'\");\n    }\n\n    return this.states[stateKey].getFromRelativePath(childStatePath);\n  };\n\n  StateNode.prototype.historyValue = function (relativeStateValue) {\n    if (!keys(this.states).length) {\n      return undefined;\n    }\n\n    return {\n      current: relativeStateValue || this.initialStateValue,\n      states: mapFilterValues(this.states, function (stateNode, key) {\n        if (!relativeStateValue) {\n          return stateNode.historyValue();\n        }\n\n        var subStateValue = isString(relativeStateValue) ? undefined : relativeStateValue[key];\n        return stateNode.historyValue(subStateValue || stateNode.initialStateValue);\n      }, function (stateNode) {\n        return !stateNode.history;\n      })\n    };\n  };\n  /**\r\n   * Resolves to the historical value(s) of the parent state node,\r\n   * represented by state nodes.\r\n   *\r\n   * @param historyValue\r\n   */\n\n\n  StateNode.prototype.resolveHistory = function (historyValue) {\n    var _this = this;\n\n    if (this.type !== 'history') {\n      return [this];\n    }\n\n    var parent = this.parent;\n\n    if (!historyValue) {\n      var historyTarget = this.target;\n      return historyTarget ? flatten(toStatePaths(historyTarget).map(function (relativeChildPath) {\n        return parent.getFromRelativePath(relativeChildPath);\n      })) : parent.initialStateNodes;\n    }\n\n    var subHistoryValue = nestedPath(parent.path, 'states')(historyValue).current;\n\n    if (isString(subHistoryValue)) {\n      return [parent.getStateNode(subHistoryValue)];\n    }\n\n    return flatten(toStatePaths(subHistoryValue).map(function (subStatePath) {\n      return _this.history === 'deep' ? parent.getFromRelativePath(subStatePath) : [parent.states[subStatePath[0]]];\n    }));\n  };\n\n  Object.defineProperty(StateNode.prototype, \"stateIds\", {\n    /**\r\n     * All the state node IDs of this state node and its descendant state nodes.\r\n     */\n    get: function () {\n      var _this = this;\n\n      var childStateIds = flatten(keys(this.states).map(function (stateKey) {\n        return _this.states[stateKey].stateIds;\n      }));\n      return [this.id].concat(childStateIds);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"events\", {\n    /**\r\n     * All the event types accepted by this state node and its descendants.\r\n     */\n    get: function () {\n      var e_7, _a, e_8, _b;\n\n      if (this.__cache.events) {\n        return this.__cache.events;\n      }\n\n      var states = this.states;\n      var events = new Set(this.ownEvents);\n\n      if (states) {\n        try {\n          for (var _c = __values(keys(states)), _d = _c.next(); !_d.done; _d = _c.next()) {\n            var stateId = _d.value;\n            var state = states[stateId];\n\n            if (state.states) {\n              try {\n                for (var _e = (e_8 = void 0, __values(state.events)), _f = _e.next(); !_f.done; _f = _e.next()) {\n                  var event_1 = _f.value;\n                  events.add(\"\" + event_1);\n                }\n              } catch (e_8_1) {\n                e_8 = {\n                  error: e_8_1\n                };\n              } finally {\n                try {\n                  if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n                } finally {\n                  if (e_8) throw e_8.error;\n                }\n              }\n            }\n          }\n        } catch (e_7_1) {\n          e_7 = {\n            error: e_7_1\n          };\n        } finally {\n          try {\n            if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n          } finally {\n            if (e_7) throw e_7.error;\n          }\n        }\n      }\n\n      return this.__cache.events = Array.from(events);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"ownEvents\", {\n    /**\r\n     * All the events that have transitions directly from this state node.\r\n     *\r\n     * Excludes any inert events.\r\n     */\n    get: function () {\n      var events = new Set(this.transitions.filter(function (transition) {\n        return !(!transition.target && !transition.actions.length && transition.internal);\n      }).map(function (transition) {\n        return transition.eventType;\n      }));\n      return Array.from(events);\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  StateNode.prototype.resolveTarget = function (_target) {\n    var _this = this;\n\n    if (_target === undefined) {\n      // an undefined target signals that the state node should not transition from that state when receiving that event\n      return undefined;\n    }\n\n    return _target.map(function (target) {\n      if (!isString(target)) {\n        return target;\n      }\n\n      var isInternalTarget = target[0] === _this.delimiter; // If internal target is defined on machine,\n      // do not include machine key on target\n\n      if (isInternalTarget && !_this.parent) {\n        return _this.getStateNodeByPath(target.slice(1));\n      }\n\n      var resolvedTarget = isInternalTarget ? _this.key + target : target;\n\n      if (_this.parent) {\n        try {\n          var targetStateNode = _this.parent.getStateNodeByPath(resolvedTarget);\n\n          return targetStateNode;\n        } catch (err) {\n          throw new Error(\"Invalid transition definition for state node '\" + _this.id + \"':\\n\" + err.message);\n        }\n      } else {\n        return _this.getStateNodeByPath(resolvedTarget);\n      }\n    });\n  };\n\n  StateNode.prototype.formatTransition = function (transitionConfig) {\n    var _this = this;\n\n    var normalizedTarget = normalizeTarget(transitionConfig.target);\n    var internal = 'internal' in transitionConfig ? transitionConfig.internal : normalizedTarget ? normalizedTarget.some(function (_target) {\n      return isString(_target) && _target[0] === _this.delimiter;\n    }) : true;\n    var guards = this.machine.options.guards;\n    var target = this.resolveTarget(normalizedTarget);\n    return __assign(__assign({}, transitionConfig), {\n      actions: toActionObjects(toArray(transitionConfig.actions)),\n      cond: toGuard(transitionConfig.cond, guards),\n      target: target,\n      source: this,\n      internal: internal,\n      eventType: transitionConfig.event\n    });\n  };\n\n  StateNode.prototype.formatTransitions = function () {\n    var e_9, _a;\n\n    var _this = this;\n\n    var onConfig;\n\n    if (!this.config.on) {\n      onConfig = [];\n    } else if (Array.isArray(this.config.on)) {\n      onConfig = this.config.on;\n    } else {\n      var _b = this.config.on,\n          _c = WILDCARD,\n          _d = _b[_c],\n          wildcardConfigs = _d === void 0 ? [] : _d,\n          strictOnConfigs_1 = __rest(_b, [typeof _c === \"symbol\" ? _c : _c + \"\"]);\n\n      onConfig = flatten(keys(strictOnConfigs_1).map(function (key) {\n        var arrayified = toTransitionConfigArray(key, strictOnConfigs_1[key]);\n\n        if (!IS_PRODUCTION) {\n          validateArrayifiedTransitions(_this, key, arrayified);\n        }\n\n        return arrayified;\n      }).concat(toTransitionConfigArray(WILDCARD, wildcardConfigs)));\n    }\n\n    var doneConfig = this.config.onDone ? toTransitionConfigArray(String(done(this.id)), this.config.onDone) : [];\n    var invokeConfig = flatten(this.invoke.map(function (invokeDef) {\n      var settleTransitions = [];\n\n      if (invokeDef.onDone) {\n        settleTransitions.push.apply(settleTransitions, __spread(toTransitionConfigArray(String(doneInvoke(invokeDef.id)), invokeDef.onDone)));\n      }\n\n      if (invokeDef.onError) {\n        settleTransitions.push.apply(settleTransitions, __spread(toTransitionConfigArray(String(error(invokeDef.id)), invokeDef.onError)));\n      }\n\n      return settleTransitions;\n    }));\n    var delayedTransitions = this.after;\n    var formattedTransitions = flatten(__spread(doneConfig, invokeConfig, onConfig).map(function (transitionConfig) {\n      return toArray(transitionConfig).map(function (transition) {\n        return _this.formatTransition(transition);\n      });\n    }));\n\n    try {\n      for (var delayedTransitions_1 = __values(delayedTransitions), delayedTransitions_1_1 = delayedTransitions_1.next(); !delayedTransitions_1_1.done; delayedTransitions_1_1 = delayedTransitions_1.next()) {\n        var delayedTransition = delayedTransitions_1_1.value;\n        formattedTransitions.push(delayedTransition);\n      }\n    } catch (e_9_1) {\n      e_9 = {\n        error: e_9_1\n      };\n    } finally {\n      try {\n        if (delayedTransitions_1_1 && !delayedTransitions_1_1.done && (_a = delayedTransitions_1.return)) _a.call(delayedTransitions_1);\n      } finally {\n        if (e_9) throw e_9.error;\n      }\n    }\n\n    return formattedTransitions;\n  };\n\n  return StateNode;\n}();\n\nexport { StateNode };","import { StateNode } from './StateNode.js';\n\nfunction Machine(config, options, initialContext) {\n  if (initialContext === void 0) {\n    initialContext = config.context;\n  }\n\n  var resolvedInitialContext = typeof initialContext === 'function' ? initialContext() : initialContext;\n  return new StateNode(config, options, resolvedInitialContext);\n}\n\nfunction createMachine(config, options) {\n  var resolvedInitialContext = typeof config.context === 'function' ? config.context() : config.context;\n  return new StateNode(config, options, resolvedInitialContext);\n}\n\nexport { Machine, createMachine };"],"sourceRoot":""}