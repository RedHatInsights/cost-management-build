(self.webpackChunkkoku_ui=self.webpackChunkkoku_ui||[]).push([[9612],{88482:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>We});var n=a(489),r=a(97522),l=a.n(r),s=a(86588),o=a(87932),i=a(99627),c=a(46462),m=a(55399),u=a(62691);const d={limit:10,offset:0,ordering:null,name:null,source_type:null,description:null};function p(e){return Object.keys(e).reduce(((t,a)=>null===e[a]?t:""===t?`?${a}=${e[a]}`:`${t}&${a}=${e[a]}`),"")}function g(e,t){return(e-1)*t}Object.keys(d);const h=(0,m.withRouter)((0,s.connect)((e=>{const{count:t,page:a,perPage:n}=o.E6.pagination(e);return{query:o.E6.query(e),count:t,page:a,perPage:n}}),void 0,((e,t,a)=>{const{history:{push:r}}=a,{count:l,page:s,perPage:o,query:i}=e;return{itemCount:l,page:s,perPage:o,variant:n.PaginationVariant.bottom,onSetPage:(e,t,a)=>{r(p(Object.assign(Object.assign(Object.assign({},d),i),{offset:g(t,a)})))},onPerPageSelect:(e,t)=>{r(p(Object.assign(Object.assign(Object.assign({},d),i),{limit:t,offset:0})))}}}))((function(e){const{variant:t,itemCount:a,page:r,perPage:s,onSetPage:o,onPerPageSelect:i}=e;return l().createElement(n.Toolbar,null,l().createElement(n.ToolbarContent,null,l().createElement(n.ToolbarItem,{variant:n.ToolbarItemVariant.pagination},l().createElement(n.Pagination,{onPerPageSelect:i,onSetPage:o,variant:t,itemCount:a,page:r,perPage:s}))))})));var _=a(20546),E=a(19694),y=a(6813),b=a(57827),S=a(94377),T=a(901),C=a(5144);const v=l().createContext({metricsHash:{},step:1,type:"",name:"",dirtyName:!1,markup:"",description:"",error:null,apiError:null,sources:[],onTypeChange:e=>null,onNameChange:e=>null,onDescChange:e=>null,onMarkupChange:e=>null,onSourceSelect:(...e)=>null,setSources:e=>null,dataFetched:!1,loading:!1,filterName:"",onFilterChange:e=>null,query:{},clearQuery:()=>null,total:0,page:1,perPage:10,onPageChange:(e,t)=>null,onPerPageChange:(e,t)=>null,tiers:[],goToAddPL:e=>null,submitTiers:e=>null,priceListPagination:{page:1,perPage:4,onPerPageSet:(e,t)=>null,onPageSet:(e,t)=>null},fetchSources:(e,t,a,n)=>null,createError:null,createSuccess:!1,onClose:()=>null,createProcess:!1});var f=a(88485),P=a(51508);const k={form:{width:"350px"},textArea:{maxWidth:"450px",minWidth:"350px",minHeight:"75px",maxHeight:"150px"}},w=(0,b.withTranslation)()((({t:e})=>l().createElement(v.Consumer,null,(({name:t,dirtyName:a,description:r,type:s,onNameChange:o,onDescChange:i,onTypeChange:c})=>l().createElement(n.Stack,{hasGutter:!0},l().createElement(n.StackItem,null,l().createElement(n.Title,{headingLevel:"h2",size:"xl"},e("cost_models_wizard.general_info.title"))),l().createElement(n.StackItem,null,l().createElement("a",{href:e("docs.config_cost_models"),rel:"noreferrer",target:"_blank"},e("learn_more"))),l().createElement(n.StackItem,null,l().createElement(P.l,{style:k.form},l().createElement(n.FormGroup,{helperTextInvalid:e(re(t)),validated:null!==re(t)&&a?"error":"default",label:e("name"),isRequired:!0,fieldId:"name"},l().createElement(n.TextInput,{validated:null!==re(t)&&a?"error":"default",isRequired:!0,type:"text",id:"name",name:"name",value:t,onChange:o})),l().createElement(n.FormGroup,{helperTextInvalid:e(le(r)),validated:null===le(r)?"default":"error",label:e("description"),fieldId:"description"},l().createElement(n.TextArea,{style:k.textArea,type:"text",id:"description",name:"description",value:r,validated:null===le(r)?"default":"error",onChange:i})),l().createElement(n.FormGroup,{label:e("cost_models_wizard.general_info.source_type_label"),isRequired:!0,fieldId:"source-type"},l().createElement(n.FormSelect,{id:"source-type",value:s,onChange:c},l().createElement(n.FormSelectOption,{value:"",label:e("cost_models_wizard.general_info.source_type_empty_value_label")}),l().createElement(n.FormSelectOption,{value:"AWS",label:e("onboarding.type_options.aws")}),l().createElement(n.FormSelectOption,{value:"AZURE",label:e("onboarding.type_options.azure")}),l().createElement(n.FormSelectOption,{value:"GCP",label:e("onboarding.type_options.gcp")}),l().createElement(n.FormSelectOption,{value:"OCP",label:e("onboarding.type_options.ocp")}))))))))));class x extends l().Component{constructor(){super(...arguments),this.state={isValid:!0}}render(){const{t:e}=this.props,{isValid:t}=this.state;return l().createElement(v.Consumer,null,(({onMarkupChange:a,markup:r})=>l().createElement(n.Stack,{hasGutter:!0},l().createElement(n.StackItem,null,l().createElement(n.Title,{headingLevel:"h2",size:"xl"},e("cost_models_wizard.markup.title"))),l().createElement(n.StackItem,null,l().createElement(n.TextContent,null,l().createElement(n.Text,{component:n.TextVariants.h6},e("cost_models_wizard.markup.sub_title")))),l().createElement(n.StackItem,null,l().createElement(P.l,null,l().createElement(n.FormGroup,{label:e("cost_models_wizard.markup.markup_label"),fieldId:"markup",helperTextInvalid:e("cost_models_wizard.markup.invalid_markup_text"),validated:t?"default":"error"},l().createElement(n.InputGroup,{style:{width:"150px"}},l().createElement(n.TextInput,{type:"text",id:"markup",name:"markup",value:r,onBlur:()=>{this.setState({isValid:!isNaN(Number(r))})},onChange:e=>{a(e),"-"!==e&&this.setState({isValid:!isNaN(Number(e))})},validated:t?"default":"error"}),l().createElement(n.InputGroupText,{style:{borderLeft:"0"}},"%"))))))))}}const O=(0,b.withTranslation)()(x);var z=a(52591);const I=({submitRate:e,cancel:t,metricsHash:a})=>{const{tiers:r}=l().useContext(v),{t:s}=(0,b.useTranslation)(),o=(0,z.bF)(a,void 0,r),i=l().useMemo((()=>(0,z.Cw)(o)),[o.errors,o.rateKind]);return l().createElement(n.Stack,{hasGutter:!0},l().createElement(n.StackItem,null,l().createElement(n.Title,{headingLevel:"h2",size:"xl"},s("cost_models_wizard.price_list.title"))),l().createElement(n.StackItem,null,l().createElement(n.TextContent,null,l().createElement(n.Text,{component:n.TextVariants.h6},s("cost_models_wizard.price_list.sub_title_add")))),l().createElement(n.StackItem,null,l().createElement(n.Form,null,l().createElement(z.HJ,{metricsHash:a,rateFormData:o}))),l().createElement(n.StackItem,null,l().createElement(n.ActionGroup,null,l().createElement(n.Button,{variant:n.ButtonVariant.primary,isDisabled:!i,onClick:()=>e(o)},s("cost_models_wizard.price_list.create_rate")),l().createElement(n.Button,{variant:n.ButtonVariant.link,onClick:t},s("cost_models_wizard.price_list.cancel")))))};var j=a(20777),D=a(55483),F=a(77656),L=a(80963),N=a(66555),B=a(39574),V=a(85218),q=a(60477);const M=({t:e})=>l().createElement(n.Bullseye,null,l().createElement(n.EmptyState,null,l().createElement(n.EmptyStateIcon,{icon:j.wl}),l().createElement(n.Title,{headingLevel:"h2",size:"lg"},e("cost_models_wizard.empty_state.title")),l().createElement(n.EmptyStateBody,null,l().createElement(b.Trans,{i18nKey:"cost_models_wizard.empty_state.desc_create"},l().createElement("strong",null,e("cost_models_wizard.price_list.create_rate"))),l().createElement("br",null),l().createElement(b.Trans,{i18nKey:"cost_models_wizard.empty_state.desc_skip"},l().createElement("strong",null,e("cost_models_wizard.empty_state.next"))),l().createElement("br",null),l().createElement(b.Trans,{i18nKey:"cost_models_wizard.empty_state.desc_other_time"}))));class A extends l().Component{constructor(){super(...arguments),this.state={metrics:[],measurements:[]}}render(){const{metricsHash:e,t,addRateAction:a,deleteRateAction:r,items:s}=this.props,o=Object.keys(e).map((e=>({label:e,value:e}))),i=o.reduce(((t,a)=>{const n=Object.keys(e[a.value]).filter((e=>!t.map((e=>e.value)).includes(e))).map((e=>({label:e,value:e})));return[...t,...n]}),[]);return l().createElement(v.Consumer,null,(({priceListPagination:e})=>l().createElement(n.Stack,{hasGutter:!0},l().createElement(n.StackItem,null,l().createElement(n.Title,{headingLevel:"h2",size:"xl"},t("cost_models_wizard.price_list.title"))),l().createElement(n.StackItem,null,l().createElement(n.TextContent,null,l().createElement(n.Text,{component:n.TextVariants.h6},t("cost_models_wizard.price_list.sub_title_table")))),l().createElement(n.StackItem,null,l().createElement(F.j,{initialFilters:{primary:"metrics",metrics:[],measurements:[]}},(({search:c,setSearch:m,onRemove:u,onSelect:d,onClearAll:p})=>{const g=(e.page-1)*e.perPage,h=e.page*e.perPage,_=s.filter((e=>0===c.metrics.length||c.metrics.includes(e.metric.label_metric))).filter((e=>0===c.measurements.length||c.measurements.includes(e.metric.label_measurement))),E=_.slice(g,h);return l().createElement(l().Fragment,null,l().createElement(N.Q,{primary:l().createElement(q.J,{isDisabled:0===s.length,primary:c.primary,setPrimary:e=>m({primary:e}),options:[{label:t("toolbar.pricelist.metric"),value:"metrics"},{label:t("toolbar.pricelist.measurement"),value:"measurements"}]}),selected:c.primary,secondaries:[{component:l().createElement(V.n,{isDisabled:0===s.length,placeholderText:t("toolbar.pricelist.measurement_placeholder"),selections:c.measurements,setSelections:e=>d("measurements",e),options:i}),name:"measurements",onRemove:u,filters:c.measurements},{component:l().createElement(V.n,{isDisabled:0===s.length,placeholderText:t("toolbar.pricelist.metric_placeholder"),selections:c.metrics,setSelections:e=>d("metrics",e),options:o}),name:"metrics",onRemove:u,filters:c.metrics}],button:l().createElement(n.Button,{onClick:a},t("cost_models_wizard.price_list.create_rate")),onClear:p,pagination:l().createElement(n.Pagination,{isCompact:!0,itemCount:_.length,perPage:e.perPage,page:e.page,onSetPage:e.onPageSet,onPerPageSelect:e.onPerPageSet})}),0===E.length&&(0!==this.state.metrics.length||0!==this.state.measurements.length)&&l().createElement(n.Bullseye,null,l().createElement(D.c,{filter:t("cost_models_wizard.price_list.toolbar_top_results_aria_label")})),0===E.length&&0===this.state.metrics.length&&0===this.state.measurements.length&&l().createElement(M,{t}),E.length>0&&l().createElement(B.y,{isCompact:!0,t,tiers:E,actions:[{title:"Remove",onClick:(e,t,a)=>{r(a.data.index+g)}}]}),l().createElement(L.Z,{isCompact:!0,itemCount:_.length,perPage:e.perPage,page:e.page,onSetPage:e.onPageSet,onPerPageSelect:e.onPerPageSet}))}))))))}}const R=(0,s.connect)((0,S.X1)((e=>({metricsHash:i.qw.metrics(e)}))))((0,b.withTranslation)()(A)),W=()=>{const{metricsHash:e,tiers:t,submitTiers:a,goToAddPL:n}=l().useContext(v),[r,s]=l().useState("table");return"table"===r?l().createElement(R,{items:t,deleteRateAction:e=>{const r=[...t.slice(0,e),...t.slice(e+1)];a(r),0===r.length&&(s("form"),n(!1))},addRateAction:()=>{s("form"),n(!1)}}):"form"===r?l().createElement(I,{metricsHash:e,submitRate:r=>{var l;l=(0,z.Nl)(r,e),a([...t,l]),s("table"),n(!0)},cancel:()=>{s("table"),n(!0)}}):null};var G=a(78091),$=a(39887);const H=(0,b.withTranslation)()((({t:e})=>l().createElement(v.Consumer,null,(({onClose:t,name:a})=>l().createElement(n.EmptyState,null,l().createElement(n.EmptyStateIcon,{icon:G.xX,color:"green"}),l().createElement(n.Title,{headingLevel:"h2",size:"lg"},e("cost_models_wizard.review.title_success")),l().createElement(n.EmptyStateBody,null,e("cost_models_wizard.review.sub_title_success",{cost_model:a})),l().createElement(n.EmptyStateSecondaryActions,null,l().createElement(n.Button,{variant:"link",onClick:t},e("cost_models_wizard.review.close_button")))))))),K=(0,b.withTranslation)()((({t:e})=>l().createElement(v.Consumer,null,(({name:t,description:a,type:r,markup:s,sources:o,tiers:i,createError:c})=>l().createElement(l().Fragment,null,c&&l().createElement(n.Alert,{variant:"danger",title:`${c}`}),l().createElement(n.Stack,{hasGutter:!0},l().createElement(n.StackItem,null,l().createElement(n.Title,{headingLevel:"h2",size:"xl"},e("cost_models_wizard.review.title_details"))),l().createElement(n.StackItem,null,l().createElement(n.TextContent,null,l().createElement(n.Text,{component:n.TextVariants.h6},l().createElement(b.Trans,{i18nKey:"cost_models_wizard.review.sub_title_details"},l().createElement("strong",null,e("cost_models_wizard.review.create_button")),l().createElement("strong",null,e("cost_models_wizard.review.back_button")))))),l().createElement(n.StackItem,null,l().createElement(n.TextContent,null,l().createElement(n.TextList,{component:n.TextListVariants.dl},l().createElement(n.TextListItem,{component:n.TextListItemVariants.dt},e("name")),l().createElement(n.TextListItem,{component:n.TextListItemVariants.dd},t),l().createElement(n.TextListItem,{component:n.TextListItemVariants.dt},e("description")),l().createElement(n.TextListItem,{component:n.TextListItemVariants.dd},a),"OCP"===r&&l().createElement(l().Fragment,null,l().createElement(n.TextListItem,{component:n.TextListItemVariants.dt},e("cost_models_wizard.steps.price_list")),l().createElement(n.TextListItem,{component:n.TextListItemVariants.dd},i.length>0?l().createElement(B.y,{t:e,tiers:i}):e("cost_models_wizard.no_rates"))),l().createElement(n.TextListItem,{component:n.TextListItemVariants.dt},e("cost_models_wizard.review.markup")),l().createElement(n.TextListItem,{component:n.TextListItemVariants.dd},s,"%"),l().createElement(n.TextListItem,{component:n.TextListItemVariants.dt},e("cost_models_wizard.review.sources")," ",o.find((e=>e.selected&&Boolean(e.costmodel)))&&l().createElement($.a,{text:e("cost_models_wizard.warning_override_sources")})),l().createElement(n.TextListItem,{component:n.TextListItemVariants.dd},o.filter((e=>e.selected)).map((e=>e.name)).join(", "))))))))))),Z=()=>l().createElement(v.Consumer,null,(({createSuccess:e})=>e?l().createElement(H,null):l().createElement(K,null)));var U=a(52413),J=a(27916),Q=a(10209),X=a(48794);const Y=({id:e,placeholder:t="",value:a,onChange:r,onSearch:s})=>l().createElement(n.InputGroup,null,l().createElement(n.TextInput,{value:a,placeholder:t,id:e,onChange:r,onKeyPress:e=>{"Enter"===e.key&&""!==a&&s(e)}}),l().createElement(n.InputGroupText,{style:{borderLeft:"0"}},l().createElement(X.W1,null))),ee=(0,b.withTranslation)()((({t:e,filterInputProps:t,paginationProps:a,filter:r})=>l().createElement(n.Toolbar,{id:"assign-sources-toolbar",clearAllFilters:r.onClearAll},l().createElement(n.ToolbarContent,null,l().createElement(n.ToolbarItem,{variant:"search-filter"},l().createElement(n.ToolbarFilter,{deleteChip:r.onRemove,chips:r.query.name,categoryName:"name"},l().createElement(Y,Object.assign({placeholder:e("cost_models_wizard.source_table.filter_placeholder")},t)))),l().createElement(n.ToolbarItem,{variant:"pagination"},l().createElement(n.Pagination,{isCompact:a.isCompact,itemCount:a.itemCount,page:a.page,perPage:a.perPage,onSetPage:a.onSetPage,onPerPageSelect:a.onPerPageSelect})))))),te=(0,b.withTranslation)()((({t:e})=>l().createElement(v.Consumer,null,(({loading:t,onSourceSelect:a,sources:r,perPage:s,page:o,type:i,query:c,fetchSources:m,filterName:d,onFilterChange:p})=>{const g="AZURE"===i?"Azure":i;return l().createElement(n.Stack,{hasGutter:!0},l().createElement(n.StackItem,null,l().createElement(n.Title,{headingLevel:"h2",size:"xl"},e("cost_models_wizard.source.title"))),l().createElement(n.StackItem,null,l().createElement(n.TextContent,null,l().createElement(n.Text,{component:n.TextVariants.h6},e("cost_models_wizard.source.sub_title")))),l().createElement(n.StackItem,null,l().createElement(n.TextContent,null,l().createElement(n.Text,{component:n.TextVariants.h3},e("cost_models_wizard.source.caption",{type:e(`source_details.type.${i}`)})))),l().createElement(n.StackItem,null,l().createElement(ee,{filter:{onRemove:(e,t)=>m(g,(0,Q.fg)(c)(e,t),1,s),onClearAll:()=>m(g,{},1,s),query:c},filterInputProps:{id:"assign-source-search-input",value:d,onChange:p,onSearch:()=>{m(g,(0,Q.xZ)(c)("name",d),1,s)}},paginationProps:{isCompact:!0,itemCount:r.length,perPage:s,page:o,onSetPage:(e,t)=>{m(g,c,t,s)},onPerPageSelect:(e,t)=>m(g,c,1,t)}}),t?l().createElement(U.G,null):l().createElement(u.Table,{"aria-label":e("cost_models_wizard.source_table.table_aria_label"),cells:["",e("name"),e("cost_models_wizard.source_table.column_cost_model")],rows:r.map(((t,r)=>({cells:[l().createElement(l().Fragment,null,l().createElement(n.Checkbox,{onChange:e=>{a(r,e)},id:t.name,key:t.name,isChecked:t.selected,isDisabled:Boolean(t.costmodel)})),l().createElement(l().Fragment,null,t.name," ",Boolean(t.costmodel)&&l().createElement($.a,{key:`wrng-${t.name}`,text:e("cost_models_wizard.warning_source",{cost_model:t.costmodel})})),t.costmodel?t.costmodel:""],selected:t.selected})))},l().createElement(u.TableHeader,null),l().createElement(u.TableBody,null)),l().createElement(L.N,{"aria-label":"cost_models_wizard.source_table.pagination_section_aria_label",itemCount:r.length,perPage:s,page:o,onSetPage:(e,t)=>{m(g,c,t,s)},onPerPageSelect:(e,t)=>m(g,c,1,t)})))}))));class ae extends l().Component{constructor(e){super(e),this.fetchData=()=>null,this.fetchData=()=>{const{type:e,query:t,page:a,perPage:n,fetchSources:r}=this.context;r("AZURE"===e?"Azure":e,t,a,n)}}componentDidMount(){const{dataFetched:e}=this.context;e||this.fetchData()}renderContent(){return this.context.loading?l().createElement(U.G,null):this.context.apiError?l().createElement(J.Bu,{onRefresh:this.fetchData}):l().createElement(te,null)}render(){return this.renderContent()}}ae.contextType=v;const ne=ae,re=e=>0===e.length?"cost_models.required_field":e.length>100?"cost_models_wizard.general_info.name_too_long":null,le=e=>e.length>500?"cost_models.description_too_long":null,se=e=>({"":[{id:1,name:e("cost_models_wizard.steps.general_info"),component:l().createElement(w,null)}],AZURE:[{id:1,name:e("cost_models_wizard.steps.general_info"),component:l().createElement(w,null)},{id:2,name:e("cost_models_wizard.steps.markup"),component:l().createElement(O,null)},{id:3,name:e("cost_models_wizard.steps.sources"),component:l().createElement(ne,null)},{id:4,name:e("cost_models_wizard.steps.review"),component:l().createElement(Z,null)}],AWS:[{id:1,name:e("cost_models_wizard.steps.general_info"),component:l().createElement(w,null)},{id:2,name:e("cost_models_wizard.steps.markup"),component:l().createElement(O,null)},{id:3,name:e("cost_models_wizard.steps.sources"),component:l().createElement(ne,null)},{id:4,name:e("cost_models_wizard.steps.review"),component:l().createElement(Z,null)}],GCP:[{id:1,name:e("cost_models_wizard.steps.general_info"),component:l().createElement(w,null)},{id:2,name:e("cost_models_wizard.steps.markup"),component:l().createElement(O,null)},{id:3,name:e("cost_models_wizard.steps.sources"),component:l().createElement(ne,null)},{id:4,name:e("cost_models_wizard.steps.review"),component:l().createElement(Z,null)}],OCP:[{id:1,name:e("cost_models_wizard.steps.general_info"),component:l().createElement(w,null)},{id:2,name:e("cost_models_wizard.steps.price_list"),component:l().createElement(W,null)},{id:3,name:e("cost_models_wizard.steps.markup"),component:l().createElement(O,null)},{id:4,name:e("cost_models_wizard.steps.sources"),component:l().createElement(ne,null)},{id:5,name:e("cost_models_wizard.steps.review"),component:l().createElement(Z,null)}]}),oe={"":[()=>!1],AWS:[e=>null===re(e.name)&&null===le(e.description)&&""!==e.type,e=>""!==e.markup&&!isNaN(Number(e.markup)),()=>!0,()=>!0],AZURE:[e=>null===re(e.name)&&null===le(e.description)&&""!==e.type,e=>""!==e.markup&&!isNaN(Number(e.markup)),()=>!0,()=>!0],GCP:[e=>null===re(e.name)&&null===le(e.description)&&""!==e.type,e=>""!==e.markup&&!isNaN(Number(e.markup)),()=>!0,()=>!0],OCP:[e=>null===re(e.name)&&null===le(e.description)&&""!==e.type,e=>e.priceListCurrent.justSaved,e=>""!==e.markup&&!isNaN(Number(e.markup)),()=>!0,()=>!0]},ie=(0,b.withTranslation)()((({t:e,isProcess:t,isSuccess:a,closeFnc:r,isOpen:s,onMove:o,validators:i,steps:c,current:m=1,context:u,setError:d,setSuccess:p,updateCostModel:g})=>{const h=c.map(((e,t)=>Object.assign(Object.assign({},e),{canJumpTo:m>t})));h[m-1].enableNext=i[m-1](u);const _="OCP"===u.type&&2===m&&!i[m-1](u);return m===c.length&&""!==u.type&&(h[m-1].nextButtonText=e("cost_models_wizard.review.create_button")),s?l().createElement(n.Wizard,{isOpen:!0,title:e("cost_models_wizard.title"),description:e("cost_models_wizard.description"),steps:h,startAtStep:m,onNext:o,onBack:o,onGoToStep:o,onClose:r,footer:a||t||_?l().createElement("div",null):null,onSave:()=>{const{name:e,type:t,tiers:a,markup:n,description:r,sources:l}=u;(0,y.Rl)({name:e,source_type:t,description:r,rates:a,markup:{value:n,unit:"percent"},source_uuids:l.map((e=>e.uuid))}).then((()=>{p(),g()})).catch((e=>d((0,f.L)(e))))}}):null})),ce={step:1,type:"",name:"",dirtyName:!1,description:"",markup:"0.00",filterName:"",sources:[],error:null,apiError:null,dataFetched:!1,query:{},page:1,perPage:10,total:0,loading:!1,tiers:[],priceListCurrent:{metric:"",measurement:"",rate:"",justSaved:!0},priceListPagination:{page:1,perPage:10},createError:null,createSuccess:!1,createProcess:!1,isDialogOpen:!1};class me extends l().Component{constructor(){super(...arguments),this.state=ce}render(){const{metricsHash:e,t}=this.props,a=()=>{this.setState({isDialogOpen:!1},this.props.openWizard)},r=l().createElement(n.Button,{key:"cancel",variant:"link",onClick:a},t("cost_models_wizard.confirm.cancel")),s=l().createElement(n.Button,{key:"ok",variant:"primary",onClick:()=>this.setState(Object.assign({},ce))},t("cost_models_wizard.confirm.ok"));return l().createElement(v.Provider,{value:{metricsHash:e,step:this.state.step,type:this.state.type,onTypeChange:e=>this.setState({type:e,dataFetched:!1,loading:!1}),name:this.state.name,dirtyName:this.state.dirtyName,onNameChange:e=>this.setState({name:e,dirtyName:!0}),description:this.state.description,onDescChange:e=>this.setState({description:e}),markup:this.state.markup,onMarkupChange:e=>{const t=Number(e),a=e.split("").findIndex((e=>"."===e));!isNaN(t)&&a>-1&&e.length-a-1>2?this.setState({markup:(0,T.Bw)(t,"markup",{fractionDigits:2})}):this.setState({markup:e})},error:this.state.error,apiError:this.state.apiError,sources:this.state.sources,dataFetched:this.state.dataFetched,setSources:e=>this.setState({sources:e,dataFetched:!0,loading:!1}),onSourceSelect:(e,t)=>{if(-1===e)return this.setState({sources:this.state.sources.map((e=>Object.assign(Object.assign({},e),{selected:t})))});const a=[...this.state.sources];return a[e].selected=t,this.setState({sources:a})},total:this.state.total,page:this.state.page,onPageChange:(e,t)=>this.setState({page:t}),onPerPageChange:(e,t)=>this.setState({page:1,perPage:t}),perPage:this.state.perPage,filterName:this.state.filterName,onFilterChange:e=>this.setState({filterName:e}),query:this.state.query,clearQuery:()=>this.setState({query:{}}),loading:this.state.loading,tiers:this.state.tiers,submitTiers:e=>{this.setState({tiers:e})},priceListPagination:{page:this.state.priceListPagination.page,perPage:this.state.priceListPagination.perPage,onPageSet:(e,t)=>this.setState({priceListPagination:Object.assign(Object.assign({},this.state.priceListPagination),{page:t})}),onPerPageSet:(e,t)=>this.setState({priceListPagination:{page:1,perPage:t}})},goToAddPL:e=>this.setState({priceListCurrent:Object.assign(Object.assign({},this.state.priceListCurrent),{justSaved:e||!1})}),fetchSources:(e,t,a,n)=>{this.setState({loading:!0,apiError:null,filterName:""},(()=>(({type:e,page:t,perPage:a,query:n})=>{const r=(t-1)*a,l=a,s=Object.keys(n).reduce(((e,t)=>e?`${e}&${t}=${n[t]}`:`${t}=${n[t]}`),"");return(0,C.l)(`type=${e}&limit=${l}&offset=${r}&${s}`).then((e=>e.data.data)).then((e=>e.map((e=>({name:e.name,uuid:e.uuid,costmodel:e.cost_models.map((e=>e.name)).join(","),selected:!1})))))})({type:e,query:t,page:a,perPage:n}).then((e=>this.setState({sources:e,query:t,page:a,perPage:n,loading:!1,dataFetched:!0,filterName:""}))).catch((e=>this.setState({apiError:e,loading:!1,dataFetched:!0,filterName:""})))))},createSuccess:this.state.createSuccess,createError:this.state.createError,createProcess:this.state.createProcess,onClose:()=>this.setState(Object.assign({},ce),this.props.closeWizard)}},l().createElement(ie,{metricsHash:e,isProcess:this.state.createProcess,isSuccess:this.state.createSuccess,closeFnc:()=>{"OCP"===this.state.type&&this.state.step>1&&this.state.tiers.length>0||"OCP"!==this.state.type&&this.state.step>2?this.setState({isDialogOpen:!0},this.props.closeWizard):this.setState(Object.assign({},ce),this.props.closeWizard)},isOpen:this.props.isOpen,onMove:e=>this.setState({step:Number(e.id)}),steps:se(t)[this.state.type],current:this.state.step,validators:oe[this.state.type],setError:e=>this.setState({createError:e}),setSuccess:()=>this.setState({createError:null,createSuccess:!0}),updateCostModel:()=>this.props.fetch(),context:{name:this.state.name,type:this.state.type,description:this.state.description,markup:this.state.markup,tiers:this.state.tiers,priceListCurrent:this.state.priceListCurrent,sources:this.state.sources.filter((e=>e.selected))}}),l().createElement(n.Modal,{"aria-label":t("cost_models_wizard.confirm.title"),isOpen:this.state.isDialogOpen,header:l().createElement(n.Title,{headingLevel:"h1",size:n.TitleSizes["2xl"]},l().createElement(E.LP,{color:"orange"})," ",t("cost_models_wizard.confirm.title")),onClose:a,actions:[s,r],variant:"small"},t("cost_models_wizard.confirm.message")))}}const ue=(0,s.connect)((0,S.X1)((e=>({metricsHash:i.qw.metrics(e)}))),{fetch:o.F0.fetchCostModels})((0,b.withTranslation)()(me)),de=(0,b.withTranslation)()((0,s.connect)((e=>({canWrite:c.c5.isCostModelWritePermission(e)})),(e=>({openWizard:()=>e(o.F0.setCostModelDialog({name:"createWizard",isOpen:!0})),closeWizard:()=>e(o.F0.setCostModelDialog({name:"createWizard",isOpen:!1}))})),((e,t,a)=>{const{t:r}=a,{canWrite:s}=e,{openWizard:o}=t;return{isDisabled:!s,tooltip:r("cost_models.read_only_tooltip"),children:l().createElement(n.Button,{isDisabled:!s,onClick:o},r("page_cost_models.create_cost_model"))}}))(_.j)),pe=(0,s.connect)((e=>({isOpen:o.E6.isDialogOpen(e)("costmodel").createWizard})),(e=>({openWizard:()=>{e(o.F0.setCostModelDialog({name:"createWizard",isOpen:!0}))},closeWizard:()=>{e(o.F0.setCostModelDialog({name:"createWizard",isOpen:!1}))}})),((e,t)=>{const{isOpen:a}=e,{openWizard:n,closeWizard:r}=t;return{isOpen:a,openWizard:n,closeWizard:r}}))(ue);function ge({head:e,body:t,sources:a}){return l().createElement(n.Stack,{hasGutter:!0},l().createElement(n.StackItem,null,l().createElement(n.TextContent,null,l().createElement(n.Text,null,e))),l().createElement(n.StackItem,null,l().createElement(n.TextContent,null,l().createElement(n.Text,null,t),l().createElement(n.TextList,{component:n.TextListVariants.ol},a.map((e=>l().createElement(n.TextListItem,{key:e},e)))))))}const he=(0,b.withTranslation)()((0,s.connect)((e=>({isOpen:o.E6.isDialogOpen(e)("costmodel").deleteCostModel,isLoading:o.E6.deleteProcessing(e),deleteError:o.E6.deleteError(e),dialogData:o.E6.dialogData(e)})),(e=>({closeDialog:()=>e(o.F0.setCostModelDialog({name:"deleteCostModel",isOpen:!1})),deleteCostModel:t=>o.F0.deleteCostModel(t,"deleteCostModel")(e)})),((e,t,a)=>{const{t:r}=a,s=(o=e.isLoading,i=e.isOpen,c=e.deleteError,i?o?"loading":c?"failure":"open":"close");var o,i,c;const m=e.dialogData&&e.dialogData.costModel?e.dialogData.costModel:null,u=m?m.name:"",d=m?m.sources.map((e=>e.name)):[],p=m?m.uuid:"",g=function({status:e,deleteText:t,deleteAction:a,cancelText:r,cancelAction:s,sourcesNo:o}){let i=[];return"loading"===e&&(i=[l().createElement(n.Button,{key:"pending_delete",variant:n.ButtonVariant.danger,isDisabled:!0},t),l().createElement(n.Button,{key:"pending_cancel",variant:n.ButtonVariant.link,isDisabled:!0},r)]),["failure","open"].includes(e)&&o>0&&(i=[l().createElement(n.Button,{key:"sources_cancel",variant:n.ButtonVariant.link,onClick:s},r)]),["failure","open"].includes(e)&&0===o&&(i=[l().createElement(n.Button,{key:"delete",variant:n.ButtonVariant.danger,onClick:a},t),l().createElement(n.Button,{key:"cancel",variant:n.ButtonVariant.link,onClick:s},r)]),i}({status:s,deleteText:r("page_cost_models.delete_cost_model"),deleteAction:()=>t.deleteCostModel(p),cancelText:r("page_cost_models.cancel"),cancelAction:t.closeDialog,sourcesNo:d.length}),h=function({status:e,sources:t,error:a,cannotDeleteTitle:r,cannotDeleteBody:s,canDeleteBody:o}){return"close"!==e&&t.length>0?l().createElement(ge,{head:r,body:s,sources:t}):"close"!==e&&0===t.length?l().createElement(n.Stack,{hasGutter:!0},"failure"===e?l().createElement(n.StackItem,null,l().createElement(n.Alert,{variant:n.AlertVariant.danger,title:a})):null,l().createElement(n.StackItem,null,o)):void 0}({status:s,sources:d,error:e.deleteError,cannotDeleteTitle:r("page_cost_models.cannot_delete_description_head"),cannotDeleteBody:r("page_cost_models.cannot_delete_description_body",{name:u}),canDeleteBody:r("page_cost_models.can_delete_description",{name:u})});return{actions:g,isOpen:"close"!==s,variant:n.ModalVariant.small,"aria-label":"delete-cost-model",title:r("page_cost_models.delete_title"),titleIconVariant:"warning",onClose:t.closeDialog,children:h}}))(n.Modal));var _e=a(55795);const Ee=(0,b.withTranslation)()((0,s.connect)(((e,t)=>{const{t:a}=t;return{children:l().createElement(l().Fragment,null,a("page_cost_models.header_title"),l().createElement(n.Popover,{"aria-label":"page header popver",bodyContent:l().createElement(b.Trans,{i18nKey:"page_cost_models.header_popover"},l().createElement("a",{href:a("docs.using_cost_models"),rel:"noreferrer",target:"_blank"})),enableFlip:!0},l().createElement(n.Button,{variant:n.ButtonVariant.plain},l().createElement(_e.iC,null))))}}))((function({children:e}){return l().createElement(n.TextContent,null,l().createElement(n.Title,{headingLevel:"h1",size:"2xl"},e))})));var ye=a(20167),be=a(40610),Se=a(48507),Te=a.n(Se);const Ce=function(e){return l().createElement(n.EmptyState,{className:"pf-m-redhat-font"},l().createElement(n.EmptyStateIcon,{icon:e.icon}),l().createElement(n.Title,{headingLevel:"h2",size:"lg"},e.title),l().createElement(n.EmptyStateBody,null,e.description),e.actions?e.actions:null)},ve=Te()((()=>{const{t:e}=(0,b.useTranslation)();return{title:e("page_cost_models.no_cost_models_title"),description:e("page_cost_models.no_cost_models_description"),icon:j.wl,actions:l().createElement(l().Fragment,null,l().createElement(de,null),l().createElement("br",null),l().createElement("br",null),l().createElement("a",{href:e("docs.config_cost_models"),rel:"noreferrer",target:"_blank"},e("page_cost_models.no_cost_models_learn_more")))}}))(Ce),fe=Te()((()=>{const{t:e}=(0,b.useTranslation)();return{title:e("empty_filter_state.title"),description:e("empty_filter_state.subtitle"),icon:X.W1}}))(Ce),Pe=(0,m.withRouter)((0,b.withTranslation)()((0,s.connect)((e=>({canWrite:c.c5.isCostModelWritePermission(e),query:o.E6.query(e),costData:o.E6.costModels(e),stateName:o.E6.stateName(e)})),(e=>{const t=o.F0.setCostModelDialog;return{openDeleteDialog:a=>e(t({name:"deleteCostModel",isOpen:!0,meta:a}))}}),((e,t,a)=>{const{t:r,history:{push:s}}=a,o=[{title:r("name"),transforms:[u.sortable],data:{orderName:"name"}},{title:r("description")},{title:r("page_cost_models.source_type"),transforms:[u.sortable],data:{orderName:"source_type"}},{title:r("page_cost_models.assigned_sources")},{title:r("page_cost_models.last_change"),transforms:[u.sortable],data:{orderName:"updated_timestamp"}}],i=function(e,t){const{ordering:a}=e;if(null===a)return{};const n="-"===a[0]?a.slice(1):a,r="-"===a[0]?u.SortByDirection.desc:u.SortByDirection.asc;return{index:t.findIndex((e=>e.data&&e.data.orderName===n)),direction:r}}(e.query,o),c=function(e,t,a){return function(n,r,l){const s=e[r]&&e[r].data?e[r].data.orderName:null;null!==s&&(l!==u.SortByDirection.asc?a(p(Object.assign(Object.assign({},t),{ordering:`-${s}`}))):a(p(Object.assign(Object.assign({},t),{ordering:s}))))}}(o,e.query,s);return{"aria-label":"cost-models",cells:o,rows:function(e,t){let a=null;return"loading"===e&&(a=l().createElement(U.G,null)),"empty"===e&&(a=l().createElement(ve,null)),"no-match"===e&&(a=l().createElement(fe,null)),"failure"===e&&(a=l().createElement(ye.Z,null)),null!==a?[{heightAuto:!0,cells:[{props:{colSpan:8},title:l().createElement(n.Bullseye,null," ",a," ")}]}]:t.map((e=>({cells:[{title:l().createElement(m.Link,{to:`/cost-models/${e.uuid}`},e.name)},e.description,e.source_type,e.sources.length.toString(),(0,be.relativeTime)(e.updated_timestamp)],data:{costModel:e}})))}(e.stateName,e.costData),sortBy:i,onSort:c,actions:(d=e.stateName,g=e.canWrite,h=[{title:r("page_cost_models.delete"),tooltip:r("cost_models.read_only_tooltip"),onClick:(e,a,n)=>{t.openDeleteDialog(n.data)}}],"success"!==d?[]:h.map((e=>Object.assign(Object.assign({},e),{isDisabled:!g,style:g?void 0:{pointerEvents:"auto"},tooltip:g?void 0:e.tooltip}))))};var d,g,h}))((function(e){return l().createElement(n.PageSection,{variant:n.PageSectionVariants.light},l().createElement(u.Table,{gridBreakPoint:u.TableGridBreakpoint.grid2xl,actions:e.actions,actionResolver:e.actionResolver,rows:e.rows,cells:e.cells,onSort:e.onSort,sortBy:e.sortBy,"aria-label":e["aria-label"]},l().createElement(u.TableHeader,null),l().createElement(u.TableBody,null)))})))),ke=({placeholder:e="",value:t,onChange:a,onKeyPress:r})=>l().createElement(n.InputGroup,null,l().createElement(n.TextInput,{value:t,placeholder:e,onChange:a,onKeyPress:e=>{"Enter"===e.key&&""!==t&&r(e)}}),l().createElement(n.InputGroupText,{style:{borderLeft:"0"}},l().createElement(X.W1,null))),we=(e,t,a,n)=>r=>{if("Enter"===r.key&&""!==n.value){const r=n.value;e(p(Object.assign(Object.assign({},a),{[t]:a[t]?`${a[t]},${r}`:r}))),n.setValue("")}},xe=(e,t,a)=>(n,r)=>{const l=a[t]?a[t].split(",").filter((e=>e!==r)):null;e(p(Object.assign(Object.assign({},a),{[t]:null===l||0===l.length?null:l.join(",")})))},Oe=(e,t,a)=>()=>{e(p(Object.assign(Object.assign({},t),{[a]:null})))},ze=(0,s.connect)((e=>({filterType:o.E6.currentFilterType(e),query:o.E6.query(e)})),void 0,((e,t,a)=>{const{t:n,value:r,setValue:s,history:{push:o}}=a,{filterType:i,query:c}=e,m="description"===i?l().createElement(ke,{placeholder:n("page_cost_models.filter_by_description"),value:r,onChange:e=>s(e),onKeyPress:we(o,"description",Object.assign(Object.assign({},d),c),{value:r,setValue:s})}):null,u=c.description?c.description.split(","):[];return{deleteChip:xe(o,"description",Object.assign(Object.assign({},d),c)),deleteChipGroup:Oe(o,Object.assign(Object.assign({},d),c),"description"),chips:u,categoryName:n("description"),children:m}}))(n.ToolbarFilter),Ie=Te()((()=>{const[e,t]=l().useState("");return{value:e,setValue:t}}))((0,m.withRouter)((0,b.withTranslation)()(ze))),je=(0,s.connect)((e=>({filterType:o.E6.currentFilterType(e),query:o.E6.query(e)})),void 0,((e,t,a)=>{const{t:n,setValue:r,value:s,history:{push:o}}=a,{filterType:i,query:c}=e,m="name"===i?l().createElement(ke,{placeholder:n("page_cost_models.filter_by_name"),value:s,onChange:e=>r(e),onKeyPress:we(o,"name",Object.assign(Object.assign({},d),c),{value:s,setValue:r})}):null,u=c.name?c.name.split(","):[];return{deleteChip:xe(o,"name",Object.assign(Object.assign({},d),c)),deleteChipGroup:Oe(o,Object.assign(Object.assign({},d),c),"name"),chips:u,categoryName:n("name"),children:m}}))(n.ToolbarFilter),De=Te()((()=>{const[e,t]=l().useState("");return{value:e,setValue:t}}))((0,m.withRouter)((0,b.withTranslation)()(je))),Fe=(e,t)=>()=>{t(!1);const a=document.getElementById(e);a&&a.focus()},Le=(0,s.connect)((e=>({filterType:o.E6.currentFilterType(e),query:o.E6.query(e)})),void 0,((e,t,a)=>{const r="source-type-filter",{t:s,isOpen:o,setIsOpen:i,history:{push:c}}=a,{filterType:m,query:u}=e,g=e=>c(p(Object.assign(Object.assign(Object.assign({},d),u),{source_type:e}))),h="sourceType"===m?l().createElement(n.Dropdown,{onSelect:Fe(r,i),isOpen:o,toggle:l().createElement(n.DropdownToggle,{onToggle:e=>{i(e)},id:r},s("page_cost_models.filter_by_source_type")),dropdownItems:[l().createElement(n.DropdownItem,{key:"aws",component:"button",onClick:()=>g("aws")},s("page_cost_models.aws")),l().createElement(n.DropdownItem,{key:"azure",component:"button",onClick:()=>g("azure")},s("page_cost_models.azure")),l().createElement(n.DropdownItem,{key:"ocp",component:"button",onClick:()=>g("ocp")},s("page_cost_models.ocp"))]}):null,_=u.source_type?[u.source_type]:[];return{deleteChip:Oe(c,Object.assign(Object.assign({},d),u),"source_type"),chips:_,categoryName:s("page_cost_models.source_type"),children:h}}))(n.ToolbarFilter),Ne=Te()((()=>{const[e,t]=l().useState(!1);return{isOpen:e,setIsOpen:t}}))((0,m.withRouter)((0,b.withTranslation)()(Le))),Be=(0,m.withRouter)((0,s.connect)((e=>({query:o.E6.query(e)})),void 0,((e,t,a)=>{const{history:{push:n}}=a,{query:r}=e;return{id:"cost-models-toolbar",clearAllFilters:()=>n(p(Object.assign(Object.assign(Object.assign({},d),r),{description:null,source_type:null,name:null}))),children:a.children}}))(n.Toolbar));var Ve=a(8755);const qe=Te()((()=>{const[e,t]=l().useState(!1);return{isOpen:e,setIsOpen:t}}))((0,b.withTranslation)()((0,s.connect)((e=>({filterType:o.E6.currentFilterType(e)})),(e=>({updateFilterType:t=>{e(o.F0.updateFilterToolbar({currentFilterType:t}))}})),((e,t,a)=>{const{t:r}=a,s=[l().createElement(n.SelectOption,{key:"name",value:"name"},r("name")),l().createElement(n.SelectOption,{key:"description",value:"description"},r("description")),l().createElement(n.SelectOption,{key:"sourceType",value:"sourceType"},r("page_cost_models.source_type"))];return{variant:n.SelectVariant.single,selections:e.filterType,onToggle:a.setIsOpen,isOpen:a.isOpen,onSelect:(e,n)=>{t.updateFilterType(n),a.setIsOpen(!1)},children:s,toggleIcon:l().createElement(Ve.k1,null)}}))(n.Select))),Me=(0,m.withRouter)((0,s.connect)((e=>{const{count:t,page:a,perPage:n}=o.E6.pagination(e);return{count:t,page:a,perPage:n,query:o.E6.query(e)}}),void 0,((e,t,a)=>{const{history:{push:r}}=a,{count:l,page:s,perPage:o,query:i}=e;return{isCompact:!0,itemCount:l,page:s,perPage:o,variant:n.PaginationVariant.top,onSetPage:(e,t,a)=>{r(p(Object.assign(Object.assign(Object.assign({},d),i),{offset:g(t,a)})))},onPerPageSelect:(e,t)=>{r(p(Object.assign(Object.assign(Object.assign({},d),i),{limit:t,offset:0})))}}}))(n.Pagination)),Ae=()=>l().createElement(Be,null,l().createElement(n.ToolbarContent,null,l().createElement(n.ToolbarGroup,{variant:"filter-group"},l().createElement(n.ToolbarItem,null,l().createElement(qe,null)),l().createElement(n.ToolbarItem,null,l().createElement(De,null),l().createElement(Ie,null),l().createElement(Ne,null)),l().createElement(n.ToolbarItem,null,l().createElement(de,null))),l().createElement(n.ToolbarItem,{variant:n.ToolbarItemVariant.pagination},l().createElement(Me,null))));class Re extends l().Component{componentDidMount(){this.props.getCostModelsData(this.props.search.slice(1)),this.props.getRbacData(),this.props.getMetricsData()}componentDidUpdate(e){e.search!==this.props.search&&this.props.getCostModelsData(this.props.search.slice(1))}render(){return l().createElement(l().Fragment,null,l().createElement(n.PageSection,{variant:n.PageSectionVariants.light},l().createElement(Ee,null)),l().createElement(n.PageSection,{isFilled:!0},l().createElement(pe,null),l().createElement(he,null),l().createElement(Ae,null),l().createElement(Pe,null),l().createElement(h,null)))}}const We=(0,s.connect)(((e,t)=>({search:t.location.search})),(e=>({getCostModelsData:t=>o.F0.fetchCostModels(t)(e),getRbacData:()=>c.O9.fetchRbac()(e),getMetricsData:()=>i.Wg.fetchMetrics()(e)})))(Re)}}]);
//# sourceMappingURL=9a534b3bfddaee3db30b.bundle.js.map