"use strict";(self.webpackChunkkoku_ui=self.webpackChunkkoku_ui||[]).push([[5345],{86208:(e,t,n)=>{n.d(t,{H:()=>s});var a=n(80129);function s(e){return(0,a.stringify)(e,{encode:!1,indices:!1})}},36613:(e,t,n)=>{n.d(t,{k:()=>H,b:()=>Q.b});var a=n(65834),s=n(93952),r=n(92950),l=n.n(r),i=n(74806),o=n(65048),c=n(94377),u=n(26018),h=n(45997),p=n(96464),d=n(47737),g=n(42581),m=n(17096),y=n(53983),f=n(43047),S=n(50484),b=n(7081),O=n(97529),k=n(57472),E=n(24741);class T extends l().Component{constructor(e,t){super(e,t),this.defaultState={isDropdownOpen:!1},this.state=Object.assign({},this.defaultState),this.handleOnDelete=()=>{const{onDelete:e}=this.props;e&&e()},this.handleOnSelect=()=>{const{isDropdownOpen:e}=this.state;this.setState({isDropdownOpen:!e})},this.handleOnToggle=e=>{this.setState({isDropdownOpen:e})},this.handleOnDelete=this.handleOnDelete.bind(this),this.handleOnToggle=this.handleOnToggle.bind(this),this.handleOnSelect=this.handleOnSelect.bind(this)}render(){const{isDisabled:e,intl:t}=this.props,{isDropdownOpen:n}=this.state,r=[l().createElement(a.DropdownItem,{component:"button",isDisabled:e,key:"export-action",onClick:this.handleOnDelete},t.formatMessage(s.Z.delete))];return l().createElement(l().Fragment,null,l().createElement(a.Dropdown,{onSelect:this.handleOnSelect,toggle:l().createElement(a.KebabToggle,{onToggle:this.handleOnToggle}),isOpen:n,isPlain:!0,position:"right",dropdownItems:r}))}}const C=(0,i.ZP)(T);var v=n(49382),D=n(24094),x=n(54881),B=n(32412),I=n(57640);const P={emptyState:{backgroundColor:v.ZP.value,display:"flex",justifyContent:"center",paddingTop:I.ZP.value,width:"100%"},failed:{color:D.ZP.value},failedButton:{fontSize:x.ZP.value},failedHeader:{marginLeft:B.ZP.value}},V="actions",M="created",w="expires",Z="names",R="status";class _ extends l().Component{constructor(e){super(e),this.state={columns:[],rows:[]},this.initDatum=()=>{const{query:e,report:t,intl:n}=this.props;if(!e||!t)return;const r=[],i=t.data.length>0,o=[Object.assign({id:Z,orderBy:"name",title:n.formatMessage(s.Z.names,{count:1})},i&&{transforms:[k.sortable]}),Object.assign({id:M,orderBy:"created",title:n.formatMessage(s.Z.timeOfExport)},i&&{transforms:[k.sortable]}),Object.assign({id:w,orderBy:"expires",title:n.formatMessage(s.Z.expiresOn)},i&&{transforms:[k.sortable]}),{id:R,title:n.formatMessage(s.Z.statusActions)},{id:V,title:""}];t.data.length&&t.data.map((e=>{r.push({cells:[{title:l().createElement("div",null,e.name),id:Z},{title:l().createElement("div",null,e.created),id:M},{title:l().createElement("div",null,e.expires),id:w},{title:this.getStatus(e.status),id:R},{title:l().createElement(C,{onDelete:this.handleOnDelete}),id:V}],item:e})}));const c=[{heightAuto:!0,cells:[{props:{colSpan:7},title:l().createElement(a.Bullseye,null,l().createElement("div",{style:{textAlign:"center"}},l().createElement(a.Spinner,{size:"xl"})))}]}];this.setState({columns:o,loadingRows:c,rows:r,sortBy:{}})},this.getEmptyState=()=>{const{onClose:e,query:t,intl:n}=this.props;if(t.filter_by)for(const e of Object.values(t.filter_by))if("*"!==e)return l().createElement(E.c,{filter:e,showMargin:!1});return l().createElement(a.EmptyState,null,l().createElement(a.EmptyStateIcon,{icon:b.wl}),l().createElement(a.Title,{headingLevel:"h5",size:"lg"},n.formatMessage(s.Z.noExportsStateTitle)),l().createElement(a.EmptyStateBody,null,n.formatMessage(s.Z.exportsEmptyState)),l().createElement(a.Button,{variant:"primary",onClick:e},n.formatMessage(s.Z.close)))},this.getSortBy=()=>{const{query:e}=this.props,{columns:t}=this.state;let n=-1,a=k.SortByDirection.asc;for(const s of Object.keys(e.order_by)){let r=0;for(const l of t){if(l.orderBy===s){a="asc"===e.order_by[s]?k.SortByDirection.asc:k.SortByDirection.desc,n=r;break}r++}}return n>-1?{index:n,direction:a}:{}},this.getStatus=e=>{const{intl:t}=this.props;switch(e){case"completed":return l().createElement(a.Button,{icon:l().createElement(y._8,null),isInline:!0,onClick:this.handleOnDownload,variant:a.ButtonVariant.link},t.formatMessage(s.Z.download));case"failed":return l().createElement(a.Label,{color:"red",icon:l().createElement(f.$O,null),variant:"outline",render:({className:e,content:n,componentRef:r})=>l().createElement(a.Popover,{"aria-label":t.formatMessage(s.Z.exportsFailed),className:e,headerContent:l().createElement("div",{style:P.failed},l().createElement(f.$O,null),l().createElement("span",{style:P.failedHeader},t.formatMessage(s.Z.exportsFailed))),bodyContent:l().createElement("div",null,t.formatMessage(s.Z.exportsFailedDesc))},l().createElement(a.Button,{className:e,innerRef:r,style:P.failedButton,variant:a.ButtonVariant.plain},n))},t.formatMessage(s.Z.status,{value:e}));case"running":return l().createElement(a.Label,{color:"blue",icon:l().createElement(O.bn,null),variant:"outline"},t.formatMessage(s.Z.status,{value:e}));default:return l().createElement(a.Label,{color:"blue",icon:l().createElement(S.lp,null),variant:"outline"},t.formatMessage(s.Z.status,{value:e}))}},this.handleOnDelete=()=>{console.log("handleDelete clicked")},this.handleOnDownload=()=>{console.log("handleOnDownload clicked")},this.handleOnSort=(e,t,n)=>{const{onSort:a}=this.props,{columns:s}=this.state;a&&a(s[t-1].orderBy,n===k.SortByDirection.asc)},this.handleOnSort=this.handleOnSort.bind(this)}componentDidMount(){this.initDatum()}componentDidUpdate(e){const{query:t,report:n}=this.props,a=n&&n.data?JSON.stringify(n.data):"",s=e.report&&e.report.data?JSON.stringify(e.report.data):"";(0,h.pm)(e.query)===(0,h.pm)(t)&&s===a||this.initDatum()}render(){const{intl:e,isLoading:t}=this.props,{columns:n,loadingRows:a,rows:r}=this.state;return l().createElement(l().Fragment,null,l().createElement(k.Table,{"aria-label":e.formatMessage(s.Z.exportsTableAriaLabel),cells:n,rows:t?a:r,sortBy:this.getSortBy(),onSort:this.handleOnSort,variant:k.TableVariant.compact},l().createElement(k.TableHeader,null),l().createElement(k.TableBody,null)),Boolean(0===r.length)&&l().createElement("div",{style:P.emptyState},this.getEmptyState()))}}const K=(0,i.ZP)(_);var j=n(78067);class F extends l().Component{constructor(){super(...arguments),this.getCategoryOptions=()=>{const{intl:e}=this.props;return[{name:e.formatMessage(s.Z.filterByValues,{value:"name"}),key:"name"}]}}render(){const{onFilterAdded:e,onFilterRemoved:t,pagination:n,query:a}=this.props;return l().createElement(j.k,{categoryOptions:this.getCategoryOptions(),onFilterAdded:e,onFilterRemoved:t,pagination:n,query:a,showFilter:!0,style:m.W.toolbarContainer})}}const A=(0,c.X1)(((e,t)=>({}))),N=(0,o.connect)(A,{})(F),q=(0,i.ZP)(N),U={filter:{limit:10,offset:0},order_by:{name:"desc"}};class L extends l().Component{constructor(){super(...arguments),this.defaultState={query:U},this.state=Object.assign({},this.defaultState),this.getPagination=(e=!1)=>{const{intl:t,report:n}=this.props,r=n&&n.meta?n.meta.count:0,i=n&&n.meta&&n.meta.filter&&n.meta.filter.limit?n.meta.filter.limit:U.filter.limit,o=(n&&n.meta&&n.meta.filter&&n.meta.filter.offset?n.meta.filter.offset:U.filter.offset)/i+1;return l().createElement(a.Pagination,{isCompact:!e,itemCount:r,onPerPageSelect:this.handlePerPageSelect,onSetPage:this.handleSetPage,page:o,perPage:i,titles:{paginationTitle:t.formatMessage(s.Z.paginationTitle,{title:t.formatMessage(s.Z.exportsTitle),placement:e?"bottom":"top"})},variant:e?a.PaginationVariant.bottom:a.PaginationVariant.top,widgetId:"exports-pagination"+(e?"-bottom":"")})},this.getTable=()=>{const{onClose:e,report:t,reportFetchStatus:n}=this.props,{query:a}=this.state;return l().createElement(K,{isLoading:1===n,onClose:e,onSort:this.handleOnSort,query:a,report:t})},this.handleFilterAdded=(e,t)=>{const{query:n}=this.state,a=(0,d.W)(n,e,t);this.setState({query:a},(()=>{}))},this.handleFilterRemoved=(e,t)=>{const{query:n}=this.state,a=(0,d.U)(n,e,t);this.setState({query:a},(()=>{}))},this.handleOnSort=(e,t)=>{const{query:n}=this.state,a=Object.assign({},JSON.parse(JSON.stringify(n)));a.order_by={},a.order_by[e]=t?"asc":"desc",this.setState({query:a},(()=>{}))},this.handlePerPageSelect=(e,t)=>{const{query:n}=this.state,a=Object.assign({},JSON.parse(JSON.stringify(n)));a.filter=Object.assign(Object.assign({},n.filter),{limit:t}),this.setState({query:a},(()=>{}))},this.handleSetPage=(e,t)=>{const{report:n}=this.props,{query:a}=this.state,s=n&&n.meta&&n.meta.filter&&n.meta.filter.limit?n.meta.filter.limit:U.filter.limit,r=t*s-s,l=Object.assign({},JSON.parse(JSON.stringify(a)));l.filter=Object.assign(Object.assign({},a.filter),{offset:r}),this.setState({query:l},(()=>{}))}}render(){const{intl:e,reportFetchStatus:t}=this.props;return l().createElement(l().Fragment,null,e.formatMessage(s.Z.exportsDesc),l().createElement("div",{style:m.W.content},l().createElement(q,{onFilterAdded:this.handleFilterAdded,onFilterRemoved:this.handleFilterRemoved,pagination:this.getPagination()}),1===t?l().createElement(p.Z,null):l().createElement(l().Fragment,null,l().createElement("div",null,this.getTable()),l().createElement("div",{style:m.W.pagination},this.getPagination(!0)))))}}const G=(0,c.X1)((e=>{const t={filter:Object.assign({},U.filter),filter_by:U.filter_by,order_by:U.order_by},n="cost",a=(0,h.pm)(t);return{report:{meta:{count:11,filter:{limit:10,offset:0},order_by:{cost_total:"desc"}},data:[{name:"OpenShift grouped by Project",created:"2022-01-17 13:25:07",expires:"2022-01-24",status:"pending"},{name:"Amazon Web Services grouped by Account",created:"2022-01-17 13:24:23",expires:"2022-01-24",status:"running"},{name:"OpenShift grouped by Cluster",created:"2022-01-16 13:23:08",expires:"2022-01-23",status:"completed"},{name:"Microsoft Azure grouped by Account",created:"2022-01-16 13:18:22",expires:"2022-01-23",status:"failed"},{name:"Google Cloud Platform grouped by Service",created:"2022-01-14 09:05:23",expires:"2022-01-23",status:"completed"},{name:"Explorer - OpenShift grouped by Cluster",created:"2022-01-14 08:38:42",expires:"2022-01-23",status:"completed"}]},reportError:g.ZV.selectReportError(e,"ocp",n,a),reportFetchStatus:g.ZV.selectReportFetchStatus(e,"ocp",n,a)}})),J={fetchReport:g.nx.fetchReport},$=(0,i.ZP)((0,o.connect)(G,J)(L));class X extends l().Component{constructor(e){super(e),this.drawerRef=l().createRef(),this.getPanelContent=()=>{const{intl:e,isOpen:t}=this.props;return l().createElement(a.DrawerPanelContent,{id:"ExportsDrawer",minSize:"1000px"},l().createElement(a.DrawerHead,null,l().createElement("span",{tabIndex:t?0:-1,ref:this.drawerRef},l().createElement(a.Title,{headingLevel:"h1",size:a.TitleSizes.xl},e.formatMessage(s.Z.exportsTitle))),l().createElement(a.DrawerActions,null,l().createElement(a.DrawerCloseButton,{onClick:this.handleClose}))),l().createElement(a.DrawerContentBody,null,l().createElement($,{onClose:this.handleClose})))},this.handleClose=()=>{const{closeExportsDrawer:e}=this.props;e()},this.handleExpand=()=>{this.drawerRef.current&&this.drawerRef.current.focus()},this.handleClose=this.handleClose.bind(this)}componentDidMount(){}componentDidUpdate(e){}render(){const{children:e,isOpen:t}=this.props;return l().createElement(a.Drawer,{className:"drawerOverride",isExpanded:t,onExpand:this.handleExpand},l().createElement(a.DrawerContent,{panelContent:this.getPanelContent()},l().createElement(a.DrawerContentBody,null,e)))}}const z=(0,c.X1)((e=>({isOpen:u.lU.selectIsExportsDrawerOpen(e)}))),W={closeExportsDrawer:u.Aw.k6},H=(0,i.ZP)((0,o.connect)(z,W)(X));var Q=n(74172)},96464:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(55189),s=n(99699),r=n(39173),l=n(92950),i=n.n(l),o=n(5977),c=n(87339);const u=(0,o.EN)((({title:e})=>i().createElement(i().Fragment,null,e&&i().createElement(s.Z,null,i().createElement(r.Z,{title:e})),i().createElement(a.Z,null,i().createElement(c.G,null)))))},78067:(e,t,n)=>{n.d(t,{k:()=>A});var a=n(65834),s=n(74978),r=n(76889),l=n(80810),i=n(45997),o=n(62264),c=n(93952),u=n(44439),h=n(92950),p=n.n(h),d=n(74806),g=n(24307),m=n(65048),y=n(94377),f=n(70433),S=n(63211);class b extends p().Component{constructor(e){super(e),this.menuRef=p().createRef(),this.textInputGroupRef=p().createRef(),this.searchTimeout=S.Z,this.defaultState={createdOptions:[],isSelectExpanded:!1,menuIsOpen:!1},this.state=Object.assign({},this.defaultState),this.focusTextInput=()=>{this.textInputGroupRef.current.querySelector("input").focus()},this.getInputGroup=()=>{const{isDisabled:e,search:t="",onSearchChanged:n}=this.props;return p().createElement("div",{ref:this.textInputGroupRef},p().createElement(a.TextInputGroup,{isDisabled:e},p().createElement(a.TextInputGroupMain,{icon:p().createElement(l.ZP,null),value:t,onChange:n,onFocus:this.openMenu,onKeyDown:this.handleTextInputKeyDown}),t&&t.length&&p().createElement(a.TextInputGroupUtilities,null,p().createElement(a.Button,{variant:"plain",onClick:this.handleClearSearch,"aria-label":"Clear button and input"},p().createElement(g.ZP,null)))))},this.getMenu=()=>{const{search:e}=this.props;return p().createElement("div",{ref:this.menuRef},e&&e.length&&p().createElement(a.Menu,{onSelect:this.handleMenuSelect,onKeyDown:this.handleMenuKeyDown},p().createElement(a.MenuContent,null,p().createElement(a.MenuList,null,this.getMenuItems()))))},this.getMenuItems=()=>{const{intl:e}=this.props,t=this.getOptions().map((e=>p().createElement(a.MenuItem,{key:e.key,itemId:e.key},e.key))),n=p().createElement(a.MenuItem,{isDisabled:!0,key:"heading"},t.length?e.formatMessage(c.Z.suggestions):e.formatMessage(c.Z.noResultsFound));return t.length&&t.unshift(p().createElement(a.Divider,{key:"divider"})),t.unshift(n),t},this.getOptions=()=>{const{resource:e,resourceFetchStatus:t,search:n}=this.props,{createdOptions:a}=this.state;let s=[];if(e&&e.data&&e.data.length>0&&1!==t&&(s=e.data.map((e=>{const t=isNaN(n)&&(e.account_alias||e.cluster_alias)||e.value;return{key:t,name:t}}))),a&&a.length){const e=a.map((e=>({key:e,name:e})));s=[...s,...e]}return s},this.handleMenuClick=e=>{!this.menuRef.current||this.menuRef.current.contains(e.target)||this.textInputGroupRef.current.contains(e.target)||this.setState({menuIsOpen:!1})},this.handleMenuKeyDown=e=>{"Escape"!==e.key&&"Tab"!==e.key||(e.preventDefault(),this.focusTextInput(),this.setState({menuIsOpen:!1}))},this.handleMenuSelect=e=>{const{onSelect:t,search:n}=this.props;e.stopPropagation();const a=e.target.innerText||n;""!==a.trim()&&this.setState({menuIsOpen:!1},(()=>{t&&t(a)}))},this.handleTextInputKeyDown=e=>{switch(e.key){case"Enter":this.handleMenuSelect(e);break;case"Escape":case"Tab":this.focusTextInput(),this.setState({menuIsOpen:!1});break;case"ArrowUp":case"ArrowDown":if(this.menuRef.current){const e=this.menuRef.current.querySelector("li > button:not(:disabled)");e&&e.focus()}break;default:this.openMenu()}},this.handleClearSearch=()=>{const{onClear:e}=this.props;this.setState({menuIsOpen:!1},(()=>{e&&e()}))},this.openMenu=()=>{const{menuIsOpen:e}=this.state;e||this.setState({menuIsOpen:!0})},this.handleClearSearch=this.handleClearSearch.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.handleMenuKeyDown=this.handleMenuKeyDown.bind(this),this.handleMenuSelect=this.handleMenuSelect.bind(this),this.handleTextInputKeyDown=this.handleTextInputKeyDown.bind(this)}componentDidUpdate(e){const{fetchResource:t,resourceFetchStatus:n,resourcePathsType:a,resourceType:s,search:r}=this.props;if(r&&e.search!==r&&1!==n){clearTimeout(this.searchTimeout);const e={search:r},n=(0,i.pm)(e);this.searchTimeout=setTimeout((()=>{t(a,s,n)}),625)}}render(){const{menuIsOpen:e}=this.state;return p().createElement(a.Popper,{trigger:this.getInputGroup(),popper:this.getMenu(),appendTo:()=>this.textInputGroupRef.current,isVisible:e,onDocumentClick:this.handleMenuClick})}}const O=(0,y.X1)(((e,{resourcePathsType:t,resourceType:n,search:a})=>{const s={search:a},r=(0,i.pm)(s);return{resource:f.CM.selectResource(e,t,n,r),resourceFetchStatus:f.CM.selectResourceFetchStatus(e,t,n,r)}})),k={fetchResource:f.Px.PG},E=(0,d.ZP)((0,m.connect)(O,k)(b));class T extends p().Component{constructor(e){super(e),this.defaultState={search:void 0},this.state=Object.assign({},this.defaultState),this.handleOnClear=()=>{this.setState({search:void 0})},this.handleOnSearch=e=>{this.setState({search:e})},this.handleOnSelect=e=>{const{onSelect:t}=this.props;this.setState({search:void 0},(()=>{t&&t(e)}))},this.handleOnClear=this.handleOnClear.bind(this),this.handleOnSearch=this.handleOnSearch.bind(this),this.handleOnSelect=this.handleOnSelect.bind(this)}render(){const{isDisabled:e,resourcePathsType:t,resourceType:n}=this.props,{search:a}=this.state;return p().createElement(E,{isDisabled:e,onClear:this.handleOnClear,onSearchChanged:this.handleOnSearch,onSelect:this.handleOnSelect,resourcePathsType:t,resourceType:n,search:a})}}var C=n(19853),v=n(49382),D=n(98499),x=n(32412);const B={export:{marginRight:x.ZP.value},toolbarContainer:{backgroundColor:v.ZP.value,paddingBottom:x.ZP.value,paddingTop:x.ZP.value,marginLeft:D.ZP.value,marginRight:D.ZP.value}};var I=n(32004),P=n(84072),V=n(7917);const M="tag";class w extends p().Component{constructor(){super(...arguments),this.defaultState={isTagValueExpanded:!1},this.state=Object.assign({},this.defaultState),this.onTagValueChange=e=>{const{onTagValueInputChange:t}=this.props;this.setState({tagKeyValueInput:e},(()=>{t&&t(e)}))},this.onTagValueToggle=e=>{this.setState({isTagValueExpanded:e})}}componentDidMount(){const{fetchTag:e,tagQueryString:t,tagReportFetchStatus:n,tagReportPathsType:a}=this.props;1!==n&&e(a,M,t)}componentDidUpdate(e){const{fetchTag:t,tagQueryString:n,tagReportFetchStatus:a,tagReportPathsType:s}=this.props;e.tagQueryString===n&&e.tagReportPathsType===s||1===a||t(s,M,n)}getTagValueOptions(){const{tagKey:e,tagReport:t}=this.props;let n=[];t&&t.data&&(n=[...new Set([...t.data])]);let a=[];if(n.length>0)for(const t of n)if(e===t.key&&t.values){a=t.values.map((e=>({key:e,name:e})));break}return a}render(){const{isDisabled:e,onTagValueInput:t,onTagValueSelect:n,selections:s,tagKeyValue:r}=this.props,{isTagValueExpanded:i}=this.state,o=this.getTagValueOptions().map((e=>p().createElement(a.SelectOption,{key:e.key,value:e.key})));return o.length>50?p().createElement(a.InputGroup,null,p().createElement(a.TextInput,{isDisabled:e,name:"tagkeyvalue-input",id:"tagkeyvalue-input",type:"search","aria-label":I.N.formatMessage(c.Z.filterByTagValueAriaLabel),onChange:this.onTagValueChange,value:r,placeholder:I.N.formatMessage(c.Z.filterByTagValueInputPlaceholder),onKeyDown:e=>t(e)}),p().createElement(a.Button,{isDisabled:e,variant:a.ButtonVariant.control,"aria-label":I.N.formatMessage(c.Z.filterByTagValueButtonAriaLabel),onClick:e=>t(e)},p().createElement(l.W1,null))):p().createElement(a.Select,{isDisabled:e,variant:a.SelectVariant.checkbox,"aria-label":I.N.formatMessage(c.Z.filterByTagValueAriaLabel),onToggle:this.onTagValueToggle,onSelect:n,selections:s,isOpen:i,placeholderText:I.N.formatMessage(c.Z.filterByTagValuePlaceholder)},o)}}const Z=(0,y.X1)(((e,{tagKey:t,tagReportPathsType:n})=>{const a=(0,i.mB)(location.search),s=(0,P.OA)(a),r=s?i.dV:(0,P.VL)(a),l=s||(0,P.pe)(a),o=(0,i.pm)({filter:{key:t}});return{groupBy:r,groupByValue:l,tagQueryString:o,tagReport:V.ux.selectTag(e,n,M,o),tagReportFetchStatus:V.ux.selectTagFetchStatus(e,n,M,o)}})),R={fetchTag:V.xr.Xt},_=(0,m.connect)(Z,R)(w),K=(0,d.ZP)(_);const j={tag:{}};class F extends p().Component{constructor(){super(...arguments),this.defaultState={categoryInput:"",filters:(0,u.cloneDeep)(j),isBulkSelectOpen:!1,isCategorySelectOpen:!1,isOrgUnitSelectExpanded:!1,isTagValueDropdownOpen:!1,isTagKeySelectExpanded:!1,isTagValueSelectExpanded:!1,tagKeyValueInput:""},this.state=Object.assign({},this.defaultState),this.getDefaultCategory=()=>{const{categoryOptions:e,groupBy:t,query:n}=this.props;if(!e)return"name";if(n&&n.group_by&&n.group_by[i.dV])return i.dV;for(const n of e)if(t===n.key||t&&-1!==t.indexOf(i.P)&&n.key===i.up)return n.key;return e[0].key},this.getActiveFilters=e=>{const t=(0,u.cloneDeep)(j);return e&&e.filter_by&&Object.keys(e.filter_by).forEach((n=>{const a=Array.isArray(e.filter_by[n])?[...e.filter_by[n]]:[e.filter_by[n]];-1!==n.indexOf(i.P)?t.tag[n.substring(i.P.length)]=a:t[n]=a})),t},this.onDelete=(e,t)=>{const n=e&&e.key?e.key:e,a=t&&t.key?t.key:t;n?this.setState((e=>(e.filters.tag[n]?e.filters.tag[n]=e.filters.tag[n].filter((e=>e!==a)):e.filters[n]&&(e.filters[n]=e.filters[n].filter((e=>e!==a))),{filters:e.filters})),(()=>{const{filters:e}=this.state,t=e.tag[n]?`${i.P}${n}`:n;this.props.onFilterRemoved(t,a)})):this.setState({filters:(0,u.cloneDeep)(j)},(()=>{this.props.onFilterRemoved(null)}))},this.getBulkSelect=()=>{const{intl:e,isAllSelected:t,isBulkSelectDisabled:n,isDisabled:s,itemsPerPage:r,itemsTotal:l,selectedItems:i}=this.props,{isBulkSelectOpen:o}=this.state,u=t?l:i?i.length:0,h=u>0,d=!(!t&&u!==l||!(l>0))||!!h&&null,g=[p().createElement(a.DropdownItem,{key:"item-1",onClick:()=>this.handleOnBulkSelectClicked("none")},e.formatMessage(c.Z.toolBarBulkSelectNone)),p().createElement(a.DropdownItem,{key:"item-2",onClick:()=>this.handleOnBulkSelectClicked("page")},e.formatMessage(c.Z.toolBarBulkSelectPage,{value:r})),p().createElement(a.DropdownItem,{key:"item-3",onClick:()=>this.handleOnBulkSelectClicked("all")},e.formatMessage(c.Z.toolBarBulkSelectAll,{value:l}))];return p().createElement(a.Dropdown,{onSelect:this.handleOnBulkSelect,position:a.DropdownPosition.left,toggle:p().createElement(a.DropdownToggle,{isDisabled:s||n,splitButtonItems:[p().createElement(a.DropdownToggleCheckbox,{id:"bulk-select",key:"bulk-select","aria-label":e.formatMessage(h?c.Z.toolBarBulkSelectAriaDeselect:c.Z.toolBarBulkSelectAriaSelect),isChecked:d,onClick:()=>{h?this.handleOnBulkSelectClicked("none"):this.handleOnBulkSelectClicked("all")}})],onToggle:this.handleOnBulkSelectToggle},0!==u&&p().createElement(p().Fragment,null,e.formatMessage(c.Z.selected,{value:u}))),isOpen:o,dropdownItems:g})},this.handleOnBulkSelectClicked=e=>{const{onBulkSelected:t}=this.props;t&&t(e)},this.handleOnBulkSelect=()=>{this.setState({isBulkSelectOpen:!this.state.isBulkSelectOpen})},this.handleOnBulkSelectToggle=e=>{this.setState({isBulkSelectOpen:e})},this.getCategorySelectOptions=()=>{const{categoryOptions:e}=this.props,t=[];return e.map((e=>{t.push({toString:()=>e.name,value:e.key})})),t},this.handleOnCategorySelect=(e,t)=>{this.setState({categoryInput:"",currentCategory:t.value,currentTagKey:void 0,isCategorySelectOpen:!this.state.isCategorySelectOpen})},this.handleOnCategoryToggle=e=>{this.setState({isCategorySelectOpen:e})},this.getCategoryInput=e=>{const{intl:t,isDisabled:n,resourcePathsType:s}=this.props,{currentCategory:r,filters:i,categoryInput:u}=this.state;return p().createElement(a.ToolbarFilter,{categoryName:e,chips:i[e.key],deleteChip:this.onDelete,key:e.key,showToolbarItem:r===e.key},p().createElement(a.InputGroup,null,(0,o.k)(s,e.key)?p().createElement(T,{isDisabled:n,onSelect:t=>this.onCategoryInputSelect(t,e.key),resourcePathsType:s,resourceType:e.key}):p().createElement(p().Fragment,null,p().createElement(a.TextInput,{isDisabled:n,name:`category-input-${e.key}`,id:`category-input-${e.key}`,type:"search","aria-label":t.formatMessage(c.Z.filterByInputAriaLabel,{value:e.key}),onChange:this.handleOnCategoryInputChange,value:u,placeholder:t.formatMessage(c.Z.filterByPlaceholder,{value:e.key}),onKeyDown:t=>this.onCategoryInput(t,e.key)}),p().createElement(a.Button,{isDisabled:n,variant:a.ButtonVariant.control,"aria-label":t.formatMessage(c.Z.filterByButtonAriaLabel,{value:e.key}),onClick:t=>this.onCategoryInput(t,e.key)},p().createElement(l.W1,null)))))},this.getDefaultCategoryOptions=()=>{const{intl:e}=this.props;return[{name:e.formatMessage(c.Z.names,{count:1}),key:"name"}]},this.handleOnCategoryInputChange=e=>{this.setState({categoryInput:e})},this.onCategoryInput=(e,t)=>{const{categoryInput:n,currentCategory:a}=this.state;e&&e.key&&"Enter"!==e.key||""===n.trim()||this.setState((e=>{const s=e.filters[t];return{filters:Object.assign(Object.assign({},e.filters),{[a]:s&&s.includes(n)?s:s?[...s,n]:[n]}),categoryInput:""}}),(()=>{this.props.onFilterAdded(a,n)}))},this.onCategoryInputSelect=(e,t)=>{const{currentCategory:n}=this.state;this.setState((a=>{const s=a.filters[t];return{filters:Object.assign(Object.assign({},a.filters),{[n]:s&&s.includes(e)?s:s?[...s,e]:[e]}),categoryInput:""}}),(()=>{this.props.onFilterAdded(n,e)}))},this.getOrgUnitSelect=()=>{const{intl:e,isDisabled:t}=this.props,{currentCategory:n,filters:s,isOrgUnitSelectExpanded:r}=this.state,l=this.getOrgUnitOptions().map((e=>({id:e.key,toString:()=>e.name,compareTo:e=>!!s[i.dV]&&s[i.dV].find((t=>t===e.id))}))),o=[],u=[];return s[i.dV]&&Array.isArray(s[i.dV])&&s[i.dV].map((e=>{const t=l.find((t=>t.id===e));t&&(u.push(t),o.push({key:t.id,node:t.toString()}))})),p().createElement(a.ToolbarFilter,{categoryName:{key:i.dV,name:e.formatMessage(c.Z.filterByValues,{value:"org_unit_id"})},chips:o,deleteChip:this.onDelete,key:i.dV,showToolbarItem:n===i.dV},p().createElement(a.Select,{isDisabled:t,className:"selectOverride",variant:a.SelectVariant.checkbox,"aria-label":e.formatMessage(c.Z.filterByOrgUnitAriaLabel),onToggle:this.handleOnOrgUnitToggle,onSelect:this.handleOnOrgUnitSelect,selections:u,isOpen:r,placeholderText:e.formatMessage(c.Z.filterByOrgUnitPlaceholder)},l.map((e=>p().createElement(a.SelectOption,{description:e.id,key:e.id,value:e})))))},this.handleOnOrgUnitSelect=(e,t)=>{const n=e.target.checked;this.setState((e=>{const a=e.filters[i.dV]?e.filters[i.dV]:[];return{filters:Object.assign(Object.assign({},e.filters),{tag:Object.assign({},e.filters.tag),[i.dV]:n?[...a,t.id]:a.filter((e=>e!==t.id))})}}),(()=>{n?this.props.onFilterAdded(i.dV,t.id):this.onDelete(i.dV,t.id)}))},this.handleOnOrgUnitToggle=e=>{this.setState({isOrgUnitSelectExpanded:e})},this.getTagKeySelect=()=>{const{intl:e,isDisabled:t}=this.props,{currentCategory:n,currentTagKey:s,isTagKeySelectExpanded:r}=this.state;if(n!==i.up)return null;const l=this.getTagKeyOptions().map((e=>p().createElement(a.SelectOption,{key:e.key,value:e.key})));return p().createElement(a.ToolbarItem,null,p().createElement(a.Select,{isDisabled:t,variant:a.SelectVariant.typeahead,typeAheadAriaLabel:e.formatMessage(c.Z.filterByTagKeyAriaLabel),onClear:this.handleOnTagKeyClear,onToggle:this.handleOnTagKeyToggle,onSelect:this.handleOnTagKeySelect,isOpen:r,placeholderText:e.formatMessage(c.Z.filterByTagKeyPlaceholder),selections:s},l))},this.handleOnTagKeyClear=()=>{this.setState({currentTagKey:void 0,isTagKeySelectExpanded:!1})},this.handleOnTagKeySelect=(e,t)=>{this.setState({currentTagKey:t,isTagKeySelectExpanded:!this.state.isTagKeySelectExpanded})},this.handleOnTagKeyToggle=e=>{this.setState({isTagKeySelectExpanded:e})},this.getTagValueSelect=e=>{const{tagReportPathsType:t}=this.props,{currentCategory:n,currentTagKey:s,filters:r,tagKeyValueInput:l}=this.state,o={name:e.name,key:`${i.P}${e.key}`};return p().createElement(a.ToolbarFilter,{categoryName:o,chips:r.tag[e.key],deleteChip:this.onDelete,key:e.key,showToolbarItem:n===i.up&&s===e.key},p().createElement(K,{onTagValueSelect:this.onTagValueSelect,onTagValueInput:this.onTagValueInput,onTagValueInputChange:this.onTagValueInputChange,selections:r.tag[e.key]?r.tag[e.key]:[],tagKey:s,tagKeyValue:l,tagReportPathsType:t}))},this.onTagValueInputChange=e=>{this.setState({tagKeyValueInput:e})},this.onTagValueInput=e=>{const{currentTagKey:t,tagKeyValueInput:n}=this.state;e.key&&"Enter"!==e.key||""===n.trim()||this.setState((e=>{const a=e.filters.tag[t]?e.filters.tag[t]:[];for(const t of a)if(t===n)return Object.assign(Object.assign({},e.filters),{tagKeyValueInput:""});return{filters:Object.assign(Object.assign({},e.filters),{tag:Object.assign(Object.assign({},e.filters.tag),{[t]:[...a,n]})}),tagKeyValueInput:""}}),(()=>{this.props.onFilterAdded(`${i.P}${t}`,n)}))},this.onTagValueSelect=(e,t)=>{const{currentTagKey:n}=this.state,a=e.target.checked;this.setState((e=>{const s=e.filters.tag[n]?e.filters.tag[n]:[];return{filters:Object.assign(Object.assign({},e.filters),{tag:Object.assign(Object.assign({},e.filters.tag),{[n]:a?[...s,t]:s.filter((e=>e!==t))})})}}),(()=>{a?this.props.onFilterAdded(`${i.P}${n}`,t):this.onDelete(n,t)}))},this.getColumnManagement=()=>{const{intl:e}=this.props;return p().createElement(a.ToolbarItem,null,p().createElement(a.Button,{onClick:this.handleColumnManagementClicked,variant:a.ButtonVariant.link},e.formatMessage(c.Z.detailsColumnManagementTitle)))},this.getExportButton=()=>{const{isDisabled:e,isExportDisabled:t}=this.props;return p().createElement(a.ToolbarItem,{spacer:{default:"spacerNone"}},p().createElement(a.Button,{"aria-label":"Export data",isDisabled:e||t,onClick:this.handleExportClicked,variant:a.ButtonVariant.plain},p().createElement(s.Hy,null)))},this.handleColumnManagementClicked=()=>{this.props.onColumnManagementClicked()},this.handleExportClicked=()=>{this.props.onExportClicked()}}componentDidMount(){this.setState({currentCategory:this.getDefaultCategory()})}componentDidUpdate(e){const{categoryOptions:t,groupBy:n,orgReport:a,query:s,tagReport:r}=this.props;(n!==e.groupBy||t&&!(0,C.X)(t,e.categoryOptions)||s&&!(0,C.X)(s,e.query)||a&&!(0,C.X)(a,e.orgReport)||r&&!(0,C.X)(r,e.tagReport))&&this.setState((()=>{const a=this.getActiveFilters(s);return t!==e.categoryOptions||e.groupBy!==n?{categoryInput:"",currentCategory:this.getDefaultCategory(),currentOrgUnit:"",currentTagKey:"",tagKeyValueInput:"",filters:a}:{filters:a}}))}getCategorySelect(){const{categoryOptions:e,isDisabled:t}=this.props,{currentCategory:n,isCategorySelectOpen:s}=this.state;if(!e)return null;const l=this.getCategorySelectOptions(),i=l.find((e=>e.value===n));return p().createElement(a.ToolbarItem,null,p().createElement(a.Select,{id:"category-select",isDisabled:t,isOpen:s,onSelect:this.handleOnCategorySelect,onToggle:this.handleOnCategoryToggle,selections:i,toggleIcon:p().createElement(r.k1,null),variant:a.SelectVariant.single},l.map((e=>p().createElement(a.SelectOption,{key:e.value,value:e})))))}getOrgUnitOptions(){const{orgReport:e}=this.props;let t=[];if(!e||!e.data)return t;const n=e.data.sort(((e,t)=>e[i.iP]<t[i.iP]?-1:e[i.iP]>t[i.iP]?1:0)),a=n.filter((e=>0===e.level)),s=n.filter((e=>0!==e.level));return a.map((e=>{const t=n.find((t=>t[i.dV]===e[i.dV]));s.unshift(t)})),s.length>0&&(t=s.map((e=>({key:e[i.dV],name:e[i.iP]})))),t}getTagKeyOptions(){const{tagReport:e}=this.props;let t=[],n=[];if(!e||!e.data)return n;let a=!1;for(const t of e.data)if(t.hasOwnProperty("key")){a=!0;break}if(a){const n=e.data.map((e=>{var{type:t}=e;return function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(n[a[s]]=e[a[s]])}return n}(e,["type"])}));t=(0,u.uniqBy)(n,"key")}else t=(0,u.uniq)(e.data);return t.length>0&&(n=t.map((e=>{const t=a?e.key:e;return{key:t,name:t}}))),n}render(){const{categoryOptions:e,dateRange:t,pagination:n,showBulkSelect:s,showColumnManagement:l,showExport:o,showFilter:c,style:u}=this.props,h=e||this.getDefaultCategoryOptions();return p().createElement("div",{style:u||B.toolbarContainer},p().createElement(a.Toolbar,{clearAllFilters:this.onDelete,collapseListedFiltersBreakpoint:"xl"},p().createElement(a.ToolbarContent,null,s&&p().createElement(a.ToolbarItem,{variant:"bulk-select"},this.getBulkSelect()),c&&p().createElement(a.ToolbarToggleGroup,{breakpoint:"xl",toggleIcon:p().createElement(r.k1,null)},p().createElement(a.ToolbarGroup,{variant:"filter-group"},this.getCategorySelect(),this.getTagKeySelect(),this.getTagKeyOptions().map((e=>this.getTagValueSelect(e))),this.getOrgUnitSelect(),h&&h.filter((e=>e.key!==i.up&&e.key!==i.dV)).map((e=>this.getCategoryInput(e))))),(Boolean(o)||Boolean(l))&&p().createElement(a.ToolbarGroup,null,Boolean(o)&&this.getExportButton(),Boolean(l)&&this.getColumnManagement()),t&&p().createElement(a.ToolbarGroup,null,t),p().createElement(a.ToolbarItem,{alignment:{default:"alignRight"},variant:"pagination"},n))))}}const A=(0,d.ZP)(F)},84072:(e,t,n)=>{n.d(t,{OA:()=>l,VL:()=>s,pe:()=>r,qV:()=>i});var a=n(45997);const s=e=>(e&&e.group_by?Object.keys(e.group_by):[]).find((e=>e!==a.dV)),r=e=>{const t=s(e);return t?e.group_by[t]:void 0},l=e=>{let t;if(e&&e.group_by)for(const n of Object.keys(e.group_by))if(n===a.dV){t=e.group_by[a.dV];break}return t},i=e=>{let t;if(e&&e.group_by)for(const n of Object.keys(e.group_by)){const e=n.indexOf(a.P);if(-1!==e){t=n.substring(e+a.P.length);break}}return t}},47737:(e,t,n)=>{n.d(t,{U:()=>s,W:()=>a});const a=(e,t,n)=>{const a=Object.assign({},JSON.parse(JSON.stringify(e)));if(a.filter_by||(a.filter_by={}),"*"!==n||"*"!==a.group_by[t]){if(a.filter_by&&a.filter_by[t]){let e=!1;const s=a.filter_by[t];if(Array.isArray(s)){for(const t of s)if(t===n){e=!0;break}}else e=n===a.filter_by[t];e||(a.filter_by[t]=[a.filter_by[t],n])}else a.filter_by[t]=[n];return a}},s=(e,t,n)=>{const a=Object.assign({},JSON.parse(JSON.stringify(e)));if(a.filter_by||(a.filter_by={}),null===t)a.filter_by=void 0;else if(null===n)a.filter_by[t]=void 0;else if(Array.isArray(a.filter_by[t])){const s=a.filter_by[t].indexOf(n);s>-1&&(a.filter_by[t]=[...e.filter_by[t].slice(0,s),...e.filter_by[t].slice(s+1)])}else a.filter_by[t]=void 0;return a}},19853:(e,t,n)=>{function a(e,t){let n=JSON.stringify(e),a=JSON.stringify(t);return n||(n=""),a||(a=""),n.split("").sort().join("")===a.split("").sort().join("")}n.d(t,{X:()=>a})},63211:(e,t,n)=>{n.d(t,{Z:()=>a});const a=()=>{}}}]);
//# sourceMappingURL=78af31c1d3a9c6f3e142.bundle.js.map