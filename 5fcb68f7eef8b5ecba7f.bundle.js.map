{"version":3,"sources":["webpack://koku-ui/./node_modules/i18next-xhr-backend/dist/esm/i18nextXHRBackend.js"],"names":["arr","each","forEach","slice","defaults","obj","call","arguments","source","prop","undefined","addQueryString","url","params","queryString","e","encodeURIComponent","paramName","indexOf","ajax","options","callback","data","cache","Date","queryStringParams","x","XMLHttpRequest","ActiveXObject","open","crossDomain","setRequestHeader","withCredentials","overrideMimeType","h","customHeaders","i","onreadystatechange","readyState","responseText","send","console","log","getDefaults","loadPath","addPath","allowMultiLoading","parse","JSON","parsePayload","namespace","key","fallbackValue","Backend","services","length","this","init","type","value","languages","namespaces","interpolator","interpolate","lng","join","ns","loadUrl","language","_this","xhr","status","ret","err","_this2","payload"],"mappings":"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","file":"5fcb68f7eef8b5ecba7f.bundle.js","sourcesContent":["import _classCallCheck from '@babel/runtime/helpers/esm/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/esm/createClass';\nimport _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport _typeof from '@babel/runtime/helpers/esm/typeof';\n\nvar arr = [];\nvar each = arr.forEach;\nvar slice = arr.slice;\nfunction defaults(obj) {\n  each.call(slice.call(arguments, 1), function (source) {\n    if (source) {\n      for (var prop in source) {\n        if (obj[prop] === undefined) obj[prop] = source[prop];\n      }\n    }\n  });\n  return obj;\n}\n\nfunction addQueryString(url, params) {\n  if (params && _typeof(params) === 'object') {\n    var queryString = '',\n        e = encodeURIComponent; // Must encode data\n\n    for (var paramName in params) {\n      queryString += '&' + e(paramName) + '=' + e(params[paramName]);\n    }\n\n    if (!queryString) {\n      return url;\n    }\n\n    url = url + (url.indexOf('?') !== -1 ? '&' : '?') + queryString.slice(1);\n  }\n\n  return url;\n} // https://gist.github.com/Xeoncross/7663273\n\n\nfunction ajax(url, options, callback, data, cache) {\n  if (data && _typeof(data) === 'object') {\n    if (!cache) {\n      data['_t'] = new Date();\n    } // URL encoded form data must be in querystring format\n\n\n    data = addQueryString('', data).slice(1);\n  }\n\n  if (options.queryStringParams) {\n    url = addQueryString(url, options.queryStringParams);\n  }\n\n  try {\n    var x;\n\n    if (XMLHttpRequest) {\n      x = new XMLHttpRequest();\n    } else {\n      x = new ActiveXObject('MSXML2.XMLHTTP.3.0');\n    }\n\n    x.open(data ? 'POST' : 'GET', url, 1);\n\n    if (!options.crossDomain) {\n      x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n    }\n\n    x.withCredentials = !!options.withCredentials;\n\n    if (data) {\n      x.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n    }\n\n    if (x.overrideMimeType) {\n      x.overrideMimeType(\"application/json\");\n    }\n\n    var h = options.customHeaders;\n    h = typeof h === 'function' ? h() : h;\n\n    if (h) {\n      for (var i in h) {\n        x.setRequestHeader(i, h[i]);\n      }\n    }\n\n    x.onreadystatechange = function () {\n      x.readyState > 3 && callback && callback(x.responseText, x);\n    };\n\n    x.send(data);\n  } catch (e) {\n    console && console.log(e);\n  }\n}\n\nfunction getDefaults() {\n  return {\n    loadPath: '/locales/{{lng}}/{{ns}}.json',\n    addPath: '/locales/add/{{lng}}/{{ns}}',\n    allowMultiLoading: false,\n    parse: JSON.parse,\n    parsePayload: function parsePayload(namespace, key, fallbackValue) {\n      return _defineProperty({}, key, fallbackValue || '');\n    },\n    crossDomain: false,\n    ajax: ajax\n  };\n}\n\nvar Backend =\n/*#__PURE__*/\nfunction () {\n  function Backend(services) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Backend);\n\n    this.init(services, options);\n    this.type = 'backend';\n  }\n\n  _createClass(Backend, [{\n    key: \"init\",\n    value: function init(services) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      this.services = services;\n      this.options = defaults(options, this.options || {}, getDefaults());\n    }\n  }, {\n    key: \"readMulti\",\n    value: function readMulti(languages, namespaces, callback) {\n      var loadPath = this.options.loadPath;\n\n      if (typeof this.options.loadPath === 'function') {\n        loadPath = this.options.loadPath(languages, namespaces);\n      }\n\n      var url = this.services.interpolator.interpolate(loadPath, {\n        lng: languages.join('+'),\n        ns: namespaces.join('+')\n      });\n      this.loadUrl(url, callback);\n    }\n  }, {\n    key: \"read\",\n    value: function read(language, namespace, callback) {\n      var loadPath = this.options.loadPath;\n\n      if (typeof this.options.loadPath === 'function') {\n        loadPath = this.options.loadPath([language], [namespace]);\n      }\n\n      var url = this.services.interpolator.interpolate(loadPath, {\n        lng: language,\n        ns: namespace\n      });\n      this.loadUrl(url, callback);\n    }\n  }, {\n    key: \"loadUrl\",\n    value: function loadUrl(url, callback) {\n      var _this = this;\n\n      this.options.ajax(url, this.options, function (data, xhr) {\n        if (xhr.status >= 500 && xhr.status < 600) return callback('failed loading ' + url, true\n        /* retry */\n        );\n        if (xhr.status >= 400 && xhr.status < 500) return callback('failed loading ' + url, false\n        /* no retry */\n        );\n        var ret, err;\n\n        try {\n          ret = _this.options.parse(data, url);\n        } catch (e) {\n          err = 'failed parsing ' + url + ' to json';\n        }\n\n        if (err) return callback(err, false);\n        callback(null, ret);\n      });\n    }\n  }, {\n    key: \"create\",\n    value: function create(languages, namespace, key, fallbackValue) {\n      var _this2 = this;\n\n      if (typeof languages === 'string') languages = [languages];\n      var payload = this.options.parsePayload(namespace, key, fallbackValue);\n      languages.forEach(function (lng) {\n        var url = _this2.services.interpolator.interpolate(_this2.options.addPath, {\n          lng: lng,\n          ns: namespace\n        });\n\n        _this2.options.ajax(url, _this2.options, function (data, xhr) {//const statusCode = xhr.status.toString();\n          // TODO: if statusCode === 4xx do log\n        }, payload);\n      });\n    }\n  }]);\n\n  return Backend;\n}();\n\nBackend.type = 'backend';\n\nexport default Backend;\n"],"sourceRoot":""}