(self.webpackChunkkoku_ui=self.webpackChunkkoku_ui||[]).push([[9612],{88482:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Nt});var a=n(32045),l=n(97522),r=n.n(l),s=n(86588),o=n(87932),c=n(99627),i=n(46462),m=n(84812),u=n(78919),d=n(1595),p=n(35472),g=n(55399),h=n(38800);const _={limit:10,offset:0,ordering:null,name:null,source_type:null,description:null};function E(e){return Object.keys(e).reduce(((t,n)=>null===e[n]?t:""===t?`?${n}=${e[n]}`:`${t}&${n}=${e[n]}`),"")}function y(e,t){return(e-1)*t}Object.keys(_);const b=(0,g.withRouter)((0,s.connect)((e=>{const{count:t,page:n,perPage:a}=o.E6.pagination(e);return{query:o.E6.query(e),count:t,page:n,perPage:a}}),void 0,((e,t,n)=>{const{history:{push:a}}=n,{count:l,page:r,perPage:s,query:o}=e;return{itemCount:l,page:r,perPage:s,variant:p.a.bottom,onSetPage:(e,t,n)=>{a(E(Object.assign(Object.assign(Object.assign({},_),o),{offset:y(t,n)})))},onPerPageSelect:(e,t)=>{a(E(Object.assign(Object.assign(Object.assign({},_),o),{limit:t,offset:0})))}}}))((function(e){const{variant:t,itemCount:n,page:a,perPage:l,onSetPage:s,onPerPageSelect:o}=e;return r().createElement(m.o,null,r().createElement(u.c,null,r().createElement(d.E,{variant:d.A.pagination},r().createElement(p.t,{onPerPageSelect:o,onSetPage:s,variant:t,itemCount:n,page:a,perPage:l}))))})));var v=n(47173),f=n(20546),C=n(80181),P=n(60485),w=n(8745),z=n(19694),k=n(6813),S=n(57827),O=n(94377),x=n(901),D=n(5144);const T=r().createContext({metricsHash:{},step:1,type:"",name:"",dirtyName:!1,markup:"",description:"",error:null,apiError:null,sources:[],onTypeChange:e=>null,onNameChange:e=>null,onDescChange:e=>null,onMarkupChange:e=>null,onSourceSelect:(...e)=>null,setSources:e=>null,dataFetched:!1,loading:!1,filterName:"",onFilterChange:e=>null,query:{},clearQuery:()=>null,total:0,page:1,perPage:10,onPageChange:(e,t)=>null,onPerPageChange:(e,t)=>null,tiers:[],goToAddPL:e=>null,submitTiers:e=>null,priceListPagination:{page:1,perPage:4,onPerPageSet:(e,t)=>null,onPageSet:(e,t)=>null},fetchSources:(e,t,n,a)=>null,createError:null,createSuccess:!1,onClose:()=>null,createProcess:!1});var j=n(88485),N=n(49739),F=n(83826),q=n(43627),W=n(92607),L=n(23393),M=n(90784),R=n(22608),A=n(51508);const B={form:{width:"350px"},textArea:{maxWidth:"450px",minWidth:"350px",minHeight:"75px",maxHeight:"150px"}},$=(0,S.withTranslation)()((({t:e})=>r().createElement(T.Consumer,null,(({name:t,dirtyName:n,description:a,type:l,onNameChange:s,onDescChange:o,onTypeChange:c})=>r().createElement(N.K,{hasGutter:!0},r().createElement(F.v,null,r().createElement(P.D,{headingLevel:"h2",size:"xl"},e("cost_models_wizard.general_info.title"))),r().createElement(F.v,null,r().createElement("a",{href:e("docs.config_cost_models"),rel:"noreferrer",target:"_blank"},e("learn_more"))),r().createElement(F.v,null,r().createElement(A.l,{style:B.form},r().createElement(q.c,{helperTextInvalid:e(Me(t)),validated:null!==Me(t)&&n?"error":"default",label:e("name"),isRequired:!0,fieldId:"name"},r().createElement(W.oi,{validated:null!==Me(t)&&n?"error":"default",isRequired:!0,type:"text",id:"name",name:"name",value:t,onChange:s})),r().createElement(q.c,{helperTextInvalid:e(Re(a)),validated:null===Re(a)?"default":"error",label:e("description"),fieldId:"description"},r().createElement(L.Kx,{style:B.textArea,type:"text",id:"description",name:"description",value:a,validated:null===Re(a)?"default":"error",onChange:o})),r().createElement(q.c,{label:e("cost_models_wizard.general_info.source_type_label"),isRequired:!0,fieldId:"source-type"},r().createElement(M.i,{id:"source-type",value:l,onChange:c},r().createElement(R.j,{value:"",label:e("cost_models_wizard.general_info.source_type_empty_value_label")}),r().createElement(R.j,{value:"AWS",label:e("onboarding.type_options.aws")}),r().createElement(R.j,{value:"AZURE",label:e("onboarding.type_options.azure")}),r().createElement(R.j,{value:"GCP",label:e("onboarding.type_options.gcp")}),r().createElement(R.j,{value:"OCP",label:e("onboarding.type_options.ocp")}))))))))));var I=n(68774),K=n(68340),G=n(65802),H=n(46836);class V extends r().Component{constructor(){super(...arguments),this.state={isValid:!0}}render(){const{t:e}=this.props,{isValid:t}=this.state;return r().createElement(T.Consumer,null,(({onMarkupChange:n,markup:a})=>r().createElement(N.K,{hasGutter:!0},r().createElement(F.v,null,r().createElement(P.D,{headingLevel:"h2",size:"xl"},e("cost_models_wizard.markup.title"))),r().createElement(F.v,null,r().createElement(I.D,null,r().createElement(K.x,{component:K.q.h6},e("cost_models_wizard.markup.sub_title")))),r().createElement(F.v,null,r().createElement(A.l,null,r().createElement(q.c,{label:e("cost_models_wizard.markup.markup_label"),fieldId:"markup",helperTextInvalid:e("cost_models_wizard.markup.invalid_markup_text"),validated:t?"default":"error"},r().createElement(G.B,{style:{width:"150px"}},r().createElement(W.oi,{type:"text",id:"markup",name:"markup",value:a,onBlur:()=>{this.setState({isValid:!isNaN(Number(a))})},onChange:e=>{n(e),"-"!==e&&this.setState({isValid:!isNaN(Number(e))})},validated:t?"default":"error"}),r().createElement(H.O,{style:{borderLeft:"0"}},"%"))))))))}}const Z=(0,S.withTranslation)()(V);var U=n(83115),J=n(68809),X=n(35842);const Q=({submitRate:e,cancel:t,metricsHash:n})=>{const{tiers:a}=r().useContext(T),{t:l}=(0,S.useTranslation)(),s=(0,X.bF)(n,void 0,a),o=r().useMemo((()=>(0,X.Cw)(s)),[s.errors,s.rateKind]);return r().createElement(N.K,{hasGutter:!0},r().createElement(F.v,null,r().createElement(P.D,{headingLevel:"h2",size:"xl"},l("cost_models_wizard.price_list.title"))),r().createElement(F.v,null,r().createElement(I.D,null,r().createElement(K.x,{component:K.q.h6},l("cost_models_wizard.price_list.sub_title_add")))),r().createElement(F.v,null,r().createElement(U.l,null,r().createElement(X.HJ,{metricsHash:n,rateFormData:s}))),r().createElement(F.v,null,r().createElement(J.W,null,r().createElement(v.zx,{variant:v.Wu.primary,isDisabled:!o,onClick:()=>e(s)},l("cost_models_wizard.price_list.create_rate")),r().createElement(v.zx,{variant:v.Wu.link,onClick:t},l("cost_models_wizard.price_list.cancel")))))};var Y=n(52643),ee=n(9947),te=n(38424),ne=n(75106),ae=n(20777),le=n(55483),re=n(77656),se=n(80963),oe=n(66555),ce=n(39574),ie=n(85218),me=n(60477);const ue=({t:e})=>r().createElement(Y.b,null,r().createElement(ee.u,null,r().createElement(te.k,{icon:ae.wl}),r().createElement(P.D,{headingLevel:"h2",size:"lg"},e("cost_models_wizard.empty_state.title")),r().createElement(ne.B,null,r().createElement(S.Trans,{i18nKey:"cost_models_wizard.empty_state.desc_create"},r().createElement("strong",null,e("cost_models_wizard.price_list.create_rate"))),r().createElement("br",null),r().createElement(S.Trans,{i18nKey:"cost_models_wizard.empty_state.desc_skip"},r().createElement("strong",null,e("cost_models_wizard.empty_state.next"))),r().createElement("br",null),r().createElement(S.Trans,{i18nKey:"cost_models_wizard.empty_state.desc_other_time"}))));class de extends r().Component{constructor(){super(...arguments),this.state={metrics:[],measurements:[]}}render(){const{metricsHash:e,t,addRateAction:n,deleteRateAction:a,items:l}=this.props,s=Object.keys(e).map((e=>({label:e,value:e}))),o=s.reduce(((t,n)=>{const a=Object.keys(e[n.value]).filter((e=>!t.map((e=>e.value)).includes(e))).map((e=>({label:e,value:e})));return[...t,...a]}),[]);return r().createElement(T.Consumer,null,(({priceListPagination:e})=>r().createElement(N.K,{hasGutter:!0},r().createElement(F.v,null,r().createElement(P.D,{headingLevel:"h2",size:"xl"},t("cost_models_wizard.price_list.title"))),r().createElement(F.v,null,r().createElement(I.D,null,r().createElement(K.x,{component:K.q.h6},t("cost_models_wizard.price_list.sub_title_table")))),r().createElement(F.v,null,r().createElement(re.j,{initialFilters:{primary:"metrics",metrics:[],measurements:[]}},(({search:c,setSearch:i,onRemove:m,onSelect:u,onClearAll:d})=>{const g=(e.page-1)*e.perPage,h=e.page*e.perPage,_=l.filter((e=>0===c.metrics.length||c.metrics.includes(e.metric.label_metric))).filter((e=>0===c.measurements.length||c.measurements.includes(e.metric.label_measurement))),E=_.slice(g,h);return r().createElement(r().Fragment,null,r().createElement(oe.Q,{primary:r().createElement(me.J,{isDisabled:0===l.length,primary:c.primary,setPrimary:e=>i({primary:e}),options:[{label:t("toolbar.pricelist.metric"),value:"metrics"},{label:t("toolbar.pricelist.measurement"),value:"measurements"}]}),selected:c.primary,secondaries:[{component:r().createElement(ie.n,{isDisabled:0===l.length,placeholderText:t("toolbar.pricelist.measurement_placeholder"),selections:c.measurements,setSelections:e=>u("measurements",e),options:o}),name:"measurements",onRemove:m,filters:c.measurements},{component:r().createElement(ie.n,{isDisabled:0===l.length,placeholderText:t("toolbar.pricelist.metric_placeholder"),selections:c.metrics,setSelections:e=>u("metrics",e),options:s}),name:"metrics",onRemove:m,filters:c.metrics}],button:r().createElement(v.zx,{onClick:n},t("cost_models_wizard.price_list.create_rate")),onClear:d,pagination:r().createElement(p.t,{isCompact:!0,itemCount:_.length,perPage:e.perPage,page:e.page,onSetPage:e.onPageSet,onPerPageSelect:e.onPerPageSet})}),0===E.length&&(0!==this.state.metrics.length||0!==this.state.measurements.length)&&r().createElement(Y.b,null,r().createElement(le.c,{filter:t("cost_models_wizard.price_list.toolbar_top_results_aria_label")})),0===E.length&&0===this.state.metrics.length&&0===this.state.measurements.length&&r().createElement(ue,{t}),E.length>0&&r().createElement(ce.y,{isCompact:!0,t,tiers:E,actions:[{title:"Remove",onClick:(e,t,n)=>{a(n.data.index+g)}}]}),r().createElement(se.Z,{isCompact:!0,itemCount:_.length,perPage:e.perPage,page:e.page,onSetPage:e.onPageSet,onPerPageSelect:e.onPerPageSet}))}))))))}}const pe=(0,s.connect)((0,O.X1)((e=>({metricsHash:c.qw.metrics(e)}))))((0,S.withTranslation)()(de)),ge=()=>{const{metricsHash:e,tiers:t,submitTiers:n,goToAddPL:a}=r().useContext(T),[l,s]=r().useState("table");return"table"===l?r().createElement(pe,{items:t,deleteRateAction:e=>{const l=[...t.slice(0,e),...t.slice(e+1)];n(l),0===l.length&&(s("form"),a(!1))},addRateAction:()=>{s("form"),a(!1)}}):"form"===l?r().createElement(Q,{metricsHash:e,submitRate:l=>{var r;r=(0,X.Nl)(l,e),n([...t,r]),s("table"),a(!0)},cancel:()=>{s("table"),a(!0)}}):null};var he=n(35293),_e=n(43547),Ee=n(25834),ye=n(78140),be=n(78091),ve=n(39887);const fe=(0,S.withTranslation)()((({t:e})=>r().createElement(T.Consumer,null,(({onClose:t,name:n})=>r().createElement(ee.u,null,r().createElement(te.k,{icon:be.xX,color:"green"}),r().createElement(P.D,{headingLevel:"h2",size:"lg"},e("cost_models_wizard.review.title_success")),r().createElement(ne.B,null,e("cost_models_wizard.review.sub_title_success",{cost_model:n})),r().createElement(he.i,null,r().createElement(v.zx,{variant:"link",onClick:t},e("cost_models_wizard.review.close_button")))))))),Ce=(0,S.withTranslation)()((({t:e})=>r().createElement(T.Consumer,null,(({name:t,description:n,type:a,markup:l,sources:s,tiers:o,createError:c})=>r().createElement(r().Fragment,null,c&&r().createElement(_e.b,{variant:"danger",title:`${c}`}),r().createElement(N.K,{hasGutter:!0},r().createElement(F.v,null,r().createElement(P.D,{headingLevel:"h2",size:"xl"},e("cost_models_wizard.review.title_details"))),r().createElement(F.v,null,r().createElement(I.D,null,r().createElement(K.x,{component:K.q.h6},r().createElement(S.Trans,{i18nKey:"cost_models_wizard.review.sub_title_details"},r().createElement("strong",null,e("cost_models_wizard.review.create_button")),r().createElement("strong",null,e("cost_models_wizard.review.back_button")))))),r().createElement(F.v,null,r().createElement(I.D,null,r().createElement(Ee.G,{component:Ee.F.dl},r().createElement(ye.T,{component:ye.v.dt},e("name")),r().createElement(ye.T,{component:ye.v.dd},t),r().createElement(ye.T,{component:ye.v.dt},e("description")),r().createElement(ye.T,{component:ye.v.dd},n),"OCP"===a&&r().createElement(r().Fragment,null,r().createElement(ye.T,{component:ye.v.dt},e("cost_models_wizard.steps.price_list")),r().createElement(ye.T,{component:ye.v.dd},o.length>0?r().createElement(ce.y,{t:e,tiers:o}):e("cost_models_wizard.no_rates"))),r().createElement(ye.T,{component:ye.v.dt},e("cost_models_wizard.review.markup")),r().createElement(ye.T,{component:ye.v.dd},l,"%"),r().createElement(ye.T,{component:ye.v.dt},e("cost_models_wizard.review.sources")," ",s.find((e=>e.selected&&Boolean(e.costmodel)))&&r().createElement(ve.a,{text:e("cost_models_wizard.warning_override_sources")})),r().createElement(ye.T,{component:ye.v.dd},s.filter((e=>e.selected)).map((e=>e.name)).join(", "))))))))))),Pe=()=>r().createElement(T.Consumer,null,(({createSuccess:e})=>e?r().createElement(fe,null):r().createElement(Ce,null)));var we=n(52413),ze=n(27916),ke=n(93149),Se=n(83255),Oe=n(6934),xe=n(22860),De=n(10209),Te=n(35248),je=n(71070);const Ne=({id:e,placeholder:t="",value:n,onChange:a,onSearch:l})=>r().createElement(G.B,null,r().createElement(W.oi,{value:n,placeholder:t,id:e,onChange:a,onKeyPress:e=>{"Enter"===e.key&&""!==n&&l(e)}}),r().createElement(H.O,{style:{borderLeft:"0"}},r().createElement(je.W1,null))),Fe=(0,S.withTranslation)()((({t:e,filterInputProps:t,paginationProps:n,filter:a})=>r().createElement(m.o,{id:"assign-sources-toolbar",clearAllFilters:a.onClearAll},r().createElement(u.c,null,r().createElement(d.E,{variant:"search-filter"},r().createElement(Te.p,{deleteChip:a.onRemove,chips:a.query.name,categoryName:"name"},r().createElement(Ne,Object.assign({placeholder:e("cost_models_wizard.source_table.filter_placeholder")},t)))),r().createElement(d.E,{variant:"pagination"},r().createElement(p.t,{isCompact:n.isCompact,itemCount:n.itemCount,page:n.page,perPage:n.perPage,onSetPage:n.onSetPage,onPerPageSelect:n.onPerPageSelect})))))),qe=(0,S.withTranslation)()((({t:e})=>r().createElement(T.Consumer,null,(({loading:t,onSourceSelect:n,sources:a,perPage:l,page:s,type:o,query:c,fetchSources:i,filterName:m,onFilterChange:u})=>{const d="AZURE"===o?"Azure":o;return r().createElement(N.K,{hasGutter:!0},r().createElement(F.v,null,r().createElement(P.D,{headingLevel:"h2",size:"xl"},e("cost_models_wizard.source.title"))),r().createElement(F.v,null,r().createElement(I.D,null,r().createElement(K.x,{component:K.q.h6},e("cost_models_wizard.source.sub_title")))),r().createElement(F.v,null,r().createElement(I.D,null,r().createElement(K.x,{component:K.q.h3},e("cost_models_wizard.source.caption",{type:e(`source_details.type.${o}`)})))),r().createElement(F.v,null,r().createElement(Fe,{filter:{onRemove:(e,t)=>i(d,(0,De.fg)(c)(e,t),1,l),onClearAll:()=>i(d,{},1,l),query:c},filterInputProps:{id:"assign-source-search-input",value:m,onChange:u,onSearch:()=>{i(d,(0,De.xZ)(c)("name",m),1,l)}},paginationProps:{isCompact:!0,itemCount:a.length,perPage:l,page:s,onSetPage:(e,t)=>{i(d,c,t,l)},onPerPageSelect:(e,t)=>i(d,c,1,t)}}),t?r().createElement(we.G,null):r().createElement(Se.i,{"aria-label":e("cost_models_wizard.source_table.table_aria_label"),cells:["",e("name"),e("cost_models_wizard.source_table.column_cost_model")],rows:a.map(((t,a)=>({cells:[r().createElement(r().Fragment,null,r().createElement(ke.X,{onChange:e=>{n(a,e)},id:t.name,key:t.name,isChecked:t.selected,isDisabled:Boolean(t.costmodel)})),r().createElement(r().Fragment,null,t.name," ",Boolean(t.costmodel)&&r().createElement(ve.a,{key:`wrng-${t.name}`,text:e("cost_models_wizard.warning_source",{cost_model:t.costmodel})})),t.costmodel?t.costmodel:""],selected:t.selected})))},r().createElement(Oe.x,null),r().createElement(xe.R,null)),r().createElement(se.N,{"aria-label":"cost_models_wizard.source_table.pagination_section_aria_label",itemCount:a.length,perPage:l,page:s,onSetPage:(e,t)=>{i(d,c,t,l)},onPerPageSelect:(e,t)=>i(d,c,1,t)})))}))));class We extends r().Component{constructor(e){super(e),this.fetchData=()=>null,this.fetchData=()=>{const{type:e,query:t,page:n,perPage:a,fetchSources:l}=this.context;l("AZURE"===e?"Azure":e,t,n,a)}}componentDidMount(){const{dataFetched:e}=this.context;e||this.fetchData()}renderContent(){return this.context.loading?r().createElement(we.G,null):this.context.apiError?r().createElement(ze.Bu,{onRefresh:this.fetchData}):r().createElement(qe,null)}render(){return this.renderContent()}}We.contextType=T;const Le=We,Me=e=>0===e.length?"cost_models.required_field":e.length>100?"cost_models_wizard.general_info.name_too_long":null,Re=e=>e.length>500?"cost_models.description_too_long":null,Ae=e=>({"":[{id:1,name:e("cost_models_wizard.steps.general_info"),component:r().createElement($,null)}],AZURE:[{id:1,name:e("cost_models_wizard.steps.general_info"),component:r().createElement($,null)},{id:2,name:e("cost_models_wizard.steps.markup"),component:r().createElement(Z,null)},{id:3,name:e("cost_models_wizard.steps.sources"),component:r().createElement(Le,null)},{id:4,name:e("cost_models_wizard.steps.review"),component:r().createElement(Pe,null)}],AWS:[{id:1,name:e("cost_models_wizard.steps.general_info"),component:r().createElement($,null)},{id:2,name:e("cost_models_wizard.steps.markup"),component:r().createElement(Z,null)},{id:3,name:e("cost_models_wizard.steps.sources"),component:r().createElement(Le,null)},{id:4,name:e("cost_models_wizard.steps.review"),component:r().createElement(Pe,null)}],GCP:[{id:1,name:e("cost_models_wizard.steps.general_info"),component:r().createElement($,null)},{id:2,name:e("cost_models_wizard.steps.markup"),component:r().createElement(Z,null)},{id:3,name:e("cost_models_wizard.steps.sources"),component:r().createElement(Le,null)},{id:4,name:e("cost_models_wizard.steps.review"),component:r().createElement(Pe,null)}],OCP:[{id:1,name:e("cost_models_wizard.steps.general_info"),component:r().createElement($,null)},{id:2,name:e("cost_models_wizard.steps.price_list"),component:r().createElement(ge,null)},{id:3,name:e("cost_models_wizard.steps.markup"),component:r().createElement(Z,null)},{id:4,name:e("cost_models_wizard.steps.sources"),component:r().createElement(Le,null)},{id:5,name:e("cost_models_wizard.steps.review"),component:r().createElement(Pe,null)}]}),Be={"":[()=>!1],AWS:[e=>null===Me(e.name)&&null===Re(e.description)&&""!==e.type,e=>""!==e.markup&&!isNaN(Number(e.markup)),()=>!0,()=>!0],AZURE:[e=>null===Me(e.name)&&null===Re(e.description)&&""!==e.type,e=>""!==e.markup&&!isNaN(Number(e.markup)),()=>!0,()=>!0],GCP:[e=>null===Me(e.name)&&null===Re(e.description)&&""!==e.type,e=>""!==e.markup&&!isNaN(Number(e.markup)),()=>!0,()=>!0],OCP:[e=>null===Me(e.name)&&null===Re(e.description)&&""!==e.type,e=>e.priceListCurrent.justSaved,e=>""!==e.markup&&!isNaN(Number(e.markup)),()=>!0,()=>!0]},$e=(0,S.withTranslation)()((({t:e,isProcess:t,isSuccess:n,closeFnc:a,isOpen:l,onMove:s,validators:o,steps:c,current:i=1,context:m,setError:u,setSuccess:d,updateCostModel:p})=>{const g=c.map(((e,t)=>Object.assign(Object.assign({},e),{canJumpTo:i>t})));g[i-1].enableNext=o[i-1](m);const h="OCP"===m.type&&2===i&&!o[i-1](m);return i===c.length&&""!==m.type&&(g[i-1].nextButtonText=e("cost_models_wizard.review.create_button")),l?r().createElement(C.e,{isOpen:!0,title:e("cost_models_wizard.title"),description:e("cost_models_wizard.description"),steps:g,startAtStep:i,onNext:s,onBack:s,onGoToStep:s,onClose:a,footer:n||t||h?r().createElement("div",null):null,onSave:()=>{const{name:e,type:t,tiers:n,markup:a,description:l,sources:r}=m;(0,k.Rl)({name:e,source_type:t,description:l,rates:n,markup:{value:a,unit:"percent"},source_uuids:r.map((e=>e.uuid))}).then((()=>{d(),p()})).catch((e=>u((0,j.L)(e))))}}):null})),Ie={step:1,type:"",name:"",dirtyName:!1,description:"",markup:"0.00",filterName:"",sources:[],error:null,apiError:null,dataFetched:!1,query:{},page:1,perPage:10,total:0,loading:!1,tiers:[],priceListCurrent:{metric:"",measurement:"",rate:"",justSaved:!0},priceListPagination:{page:1,perPage:10},createError:null,createSuccess:!1,createProcess:!1,isDialogOpen:!1};class Ke extends r().Component{constructor(){super(...arguments),this.state=Ie}render(){const{metricsHash:e,t}=this.props,n=()=>{this.setState({isDialogOpen:!1},this.props.openWizard)},a=r().createElement(v.zx,{key:"cancel",variant:"link",onClick:n},t("cost_models_wizard.confirm.cancel")),l=r().createElement(v.zx,{key:"ok",variant:"primary",onClick:()=>this.setState(Object.assign({},Ie))},t("cost_models_wizard.confirm.ok"));return r().createElement(T.Provider,{value:{metricsHash:e,step:this.state.step,type:this.state.type,onTypeChange:e=>this.setState({type:e,dataFetched:!1,loading:!1}),name:this.state.name,dirtyName:this.state.dirtyName,onNameChange:e=>this.setState({name:e,dirtyName:!0}),description:this.state.description,onDescChange:e=>this.setState({description:e}),markup:this.state.markup,onMarkupChange:e=>{const t=Number(e),n=e.split("").findIndex((e=>"."===e));!isNaN(t)&&n>-1&&e.length-n-1>2?this.setState({markup:(0,x.Bw)(t,"markup",{fractionDigits:2})}):this.setState({markup:e})},error:this.state.error,apiError:this.state.apiError,sources:this.state.sources,dataFetched:this.state.dataFetched,setSources:e=>this.setState({sources:e,dataFetched:!0,loading:!1}),onSourceSelect:(e,t)=>{if(-1===e)return this.setState({sources:this.state.sources.map((e=>Object.assign(Object.assign({},e),{selected:t})))});const n=[...this.state.sources];return n[e].selected=t,this.setState({sources:n})},total:this.state.total,page:this.state.page,onPageChange:(e,t)=>this.setState({page:t}),onPerPageChange:(e,t)=>this.setState({page:1,perPage:t}),perPage:this.state.perPage,filterName:this.state.filterName,onFilterChange:e=>this.setState({filterName:e}),query:this.state.query,clearQuery:()=>this.setState({query:{}}),loading:this.state.loading,tiers:this.state.tiers,submitTiers:e=>{this.setState({tiers:e})},priceListPagination:{page:this.state.priceListPagination.page,perPage:this.state.priceListPagination.perPage,onPageSet:(e,t)=>this.setState({priceListPagination:Object.assign(Object.assign({},this.state.priceListPagination),{page:t})}),onPerPageSet:(e,t)=>this.setState({priceListPagination:{page:1,perPage:t}})},goToAddPL:e=>this.setState({priceListCurrent:Object.assign(Object.assign({},this.state.priceListCurrent),{justSaved:e||!1})}),fetchSources:(e,t,n,a)=>{this.setState({loading:!0,apiError:null,filterName:""},(()=>(({type:e,page:t,perPage:n,query:a})=>{const l=(t-1)*n,r=n,s=Object.keys(a).reduce(((e,t)=>e?`${e}&${t}=${a[t]}`:`${t}=${a[t]}`),"");return(0,D.l)(`type=${e}&limit=${r}&offset=${l}&${s}`).then((e=>e.data.data)).then((e=>e.map((e=>({name:e.name,uuid:e.uuid,costmodel:e.cost_models.map((e=>e.name)).join(","),selected:!1})))))})({type:e,query:t,page:n,perPage:a}).then((e=>this.setState({sources:e,query:t,page:n,perPage:a,loading:!1,dataFetched:!0,filterName:""}))).catch((e=>this.setState({apiError:e,loading:!1,dataFetched:!0,filterName:""})))))},createSuccess:this.state.createSuccess,createError:this.state.createError,createProcess:this.state.createProcess,onClose:()=>this.setState(Object.assign({},Ie),this.props.closeWizard)}},r().createElement($e,{metricsHash:e,isProcess:this.state.createProcess,isSuccess:this.state.createSuccess,closeFnc:()=>{"OCP"===this.state.type&&this.state.step>1&&this.state.tiers.length>0||"OCP"!==this.state.type&&this.state.step>2?this.setState({isDialogOpen:!0},this.props.closeWizard):this.setState(Object.assign({},Ie),this.props.closeWizard)},isOpen:this.props.isOpen,onMove:e=>this.setState({step:Number(e.id)}),steps:Ae(t)[this.state.type],current:this.state.step,validators:Be[this.state.type],setError:e=>this.setState({createError:e}),setSuccess:()=>this.setState({createError:null,createSuccess:!0}),updateCostModel:()=>this.props.fetch(),context:{name:this.state.name,type:this.state.type,description:this.state.description,markup:this.state.markup,tiers:this.state.tiers,priceListCurrent:this.state.priceListCurrent,sources:this.state.sources.filter((e=>e.selected))}}),r().createElement(w.u,{"aria-label":t("cost_models_wizard.confirm.title"),isOpen:this.state.isDialogOpen,header:r().createElement(P.D,{headingLevel:"h1",size:P.H["2xl"]},r().createElement(z.LP,{color:"orange"})," ",t("cost_models_wizard.confirm.title")),onClose:n,actions:[l,a],variant:"small"},t("cost_models_wizard.confirm.message")))}}const Ge=(0,s.connect)((0,O.X1)((e=>({metricsHash:c.qw.metrics(e)}))),{fetch:o.F0.fetchCostModels})((0,S.withTranslation)()(Ke)),He=(0,S.withTranslation)()((0,s.connect)((e=>({canWrite:i.c5.isCostModelWritePermission(e)})),(e=>({openWizard:()=>e(o.F0.setCostModelDialog({name:"createWizard",isOpen:!0})),closeWizard:()=>e(o.F0.setCostModelDialog({name:"createWizard",isOpen:!1}))})),((e,t,n)=>{const{t:a}=n,{canWrite:l}=e,{openWizard:s}=t;return{isDisabled:!l,tooltip:a("cost_models.read_only_tooltip"),children:r().createElement(v.zx,{isDisabled:!l,onClick:s},a("page_cost_models.create_cost_model"))}}))(f.j)),Ve=(0,s.connect)((e=>({isOpen:o.E6.isDialogOpen(e)("costmodel").createWizard})),(e=>({openWizard:()=>{e(o.F0.setCostModelDialog({name:"createWizard",isOpen:!0}))},closeWizard:()=>{e(o.F0.setCostModelDialog({name:"createWizard",isOpen:!1}))}})),((e,t)=>{const{isOpen:n}=e,{openWizard:a,closeWizard:l}=t;return{isOpen:n,openWizard:a,closeWizard:l}}))(Ge);function Ze({head:e,body:t,sources:n}){return r().createElement(N.K,{hasGutter:!0},r().createElement(F.v,null,r().createElement(I.D,null,r().createElement(K.x,null,e))),r().createElement(F.v,null,r().createElement(I.D,null,r().createElement(K.x,null,t),r().createElement(Ee.G,{component:Ee.F.ol},n.map((e=>r().createElement(ye.T,{key:e},e)))))))}const Ue=(0,S.withTranslation)()((0,s.connect)((e=>({isOpen:o.E6.isDialogOpen(e)("costmodel").deleteCostModel,isLoading:o.E6.deleteProcessing(e),deleteError:o.E6.deleteError(e),dialogData:o.E6.dialogData(e)})),(e=>({closeDialog:()=>e(o.F0.setCostModelDialog({name:"deleteCostModel",isOpen:!1})),deleteCostModel:t=>o.F0.deleteCostModel(t,"deleteCostModel")(e)})),((e,t,n)=>{const{t:a}=n,l=(s=e.isLoading,o=e.isOpen,c=e.deleteError,o?s?"loading":c?"failure":"open":"close");var s,o,c;const i=e.dialogData&&e.dialogData.costModel?e.dialogData.costModel:null,m=i?i.name:"",u=i?i.sources.map((e=>e.name)):[],d=i?i.uuid:"",p=function({status:e,deleteText:t,deleteAction:n,cancelText:a,cancelAction:l,sourcesNo:s}){let o=[];return"loading"===e&&(o=[r().createElement(v.zx,{key:"pending_delete",variant:v.Wu.danger,isDisabled:!0},t),r().createElement(v.zx,{key:"pending_cancel",variant:v.Wu.link,isDisabled:!0},a)]),["failure","open"].includes(e)&&s>0&&(o=[r().createElement(v.zx,{key:"sources_cancel",variant:v.Wu.link,onClick:l},a)]),["failure","open"].includes(e)&&0===s&&(o=[r().createElement(v.zx,{key:"delete",variant:v.Wu.danger,onClick:n},t),r().createElement(v.zx,{key:"cancel",variant:v.Wu.link,onClick:l},a)]),o}({status:l,deleteText:a("page_cost_models.delete_cost_model"),deleteAction:()=>t.deleteCostModel(d),cancelText:a("page_cost_models.cancel"),cancelAction:t.closeDialog,sourcesNo:u.length}),g=function({status:e,sources:t,error:n,cannotDeleteTitle:a,cannotDeleteBody:l,canDeleteBody:s}){return"close"!==e&&t.length>0?r().createElement(Ze,{head:a,body:l,sources:t}):"close"!==e&&0===t.length?r().createElement(N.K,{hasGutter:!0},"failure"===e?r().createElement(F.v,null,r().createElement(_e.b,{variant:_e.U.danger,title:n})):null,r().createElement(F.v,null,s)):void 0}({status:l,sources:u,error:e.deleteError,cannotDeleteTitle:a("page_cost_models.cannot_delete_description_head"),cannotDeleteBody:a("page_cost_models.cannot_delete_description_body",{name:m}),canDeleteBody:a("page_cost_models.can_delete_description",{name:m})});return{actions:p,isOpen:"close"!==l,variant:w.v.small,"aria-label":"delete-cost-model",title:a("page_cost_models.delete_title"),titleIconVariant:"warning",onClose:t.closeDialog,children:g}}))(w.u));var Je=n(37377),Xe=n(55795);const Qe=(0,S.withTranslation)()((0,s.connect)(((e,t)=>{const{t:n}=t;return{children:r().createElement(r().Fragment,null,n("page_cost_models.header_title"),r().createElement(Je.J,{"aria-label":"page header popver",bodyContent:r().createElement(S.Trans,{i18nKey:"page_cost_models.header_popover"},r().createElement("a",{href:n("docs.using_cost_models"),rel:"noreferrer",target:"_blank"})),enableFlip:!0},r().createElement(v.zx,{variant:v.Wu.plain},r().createElement(Xe.iC,null))))}}))((function({children:e}){return r().createElement(I.D,null,r().createElement(P.D,{headingLevel:"h1",size:"2xl"},e))})));var Ye=n(75863),et=n(7732),tt=n(20167),nt=n(40610),at=n(48507),lt=n.n(at);const rt=function(e){return r().createElement(ee.u,{className:"pf-m-redhat-font"},r().createElement(te.k,{icon:e.icon}),r().createElement(P.D,{headingLevel:"h2",size:"lg"},e.title),r().createElement(ne.B,null,e.description),e.actions?e.actions:null)},st=lt()((()=>{const{t:e}=(0,S.useTranslation)();return{title:e("page_cost_models.no_cost_models_title"),description:e("page_cost_models.no_cost_models_description"),icon:ae.wl,actions:r().createElement(r().Fragment,null,r().createElement(He,null),r().createElement("br",null),r().createElement("br",null),r().createElement("a",{href:e("docs.config_cost_models"),rel:"noreferrer",target:"_blank"},e("page_cost_models.no_cost_models_learn_more")))}}))(rt),ot=lt()((()=>{const{t:e}=(0,S.useTranslation)();return{title:e("empty_filter_state.title"),description:e("empty_filter_state.subtitle"),icon:je.W1}}))(rt),ct=(0,g.withRouter)((0,S.withTranslation)()((0,s.connect)((e=>({canWrite:i.c5.isCostModelWritePermission(e),query:o.E6.query(e),costData:o.E6.costModels(e),stateName:o.E6.stateName(e)})),(e=>{const t=o.F0.setCostModelDialog;return{openDeleteDialog:n=>e(t({name:"deleteCostModel",isOpen:!0,meta:n}))}}),((e,t,n)=>{const{t:a,history:{push:l}}=n,s=[{title:a("name"),transforms:[et.p],data:{orderName:"name"}},{title:a("description")},{title:a("page_cost_models.source_type"),transforms:[et.p],data:{orderName:"source_type"}},{title:a("page_cost_models.assigned_sources")},{title:a("page_cost_models.last_change"),transforms:[et.p],data:{orderName:"updated_timestamp"}}],o=function(e,t){const{ordering:n}=e;if(null===n)return{};const a="-"===n[0]?n.slice(1):n,l="-"===n[0]?h.B.desc:h.B.asc;return{index:t.findIndex((e=>e.data&&e.data.orderName===a)),direction:l}}(e.query,s),c=function(e,t,n){return function(a,l,r){const s=e[l]&&e[l].data?e[l].data.orderName:null;null!==s&&(r!==h.B.asc?n(E(Object.assign(Object.assign({},t),{ordering:`-${s}`}))):n(E(Object.assign(Object.assign({},t),{ordering:s}))))}}(s,e.query,l);return{"aria-label":"cost-models",cells:s,rows:function(e,t){let n=null;return"loading"===e&&(n=r().createElement(we.G,null)),"empty"===e&&(n=r().createElement(st,null)),"no-match"===e&&(n=r().createElement(ot,null)),"failure"===e&&(n=r().createElement(tt.Z,null)),null!==n?[{heightAuto:!0,cells:[{props:{colSpan:8},title:r().createElement(Y.b,null," ",n," ")}]}]:t.map((e=>({cells:[{title:r().createElement(g.Link,{to:`/cost-models/${e.uuid}`},e.name)},e.description,e.source_type,e.sources.length.toString(),(0,nt.relativeTime)(e.updated_timestamp)],data:{costModel:e}})))}(e.stateName,e.costData),sortBy:o,onSort:c,actions:(i=e.stateName,m=e.canWrite,u=[{title:a("page_cost_models.delete"),tooltip:a("cost_models.read_only_tooltip"),onClick:(e,n,a)=>{t.openDeleteDialog(a.data)}}],"success"!==i?[]:u.map((e=>Object.assign(Object.assign({},e),{isDisabled:!m,style:m?void 0:{pointerEvents:"auto"},tooltip:m?void 0:e.tooltip}))))};var i,m,u}))((function(e){return r().createElement(a.NP,{variant:a.Dk.light},r().createElement(Se.i,{gridBreakPoint:Ye.L.grid2xl,actions:e.actions,actionResolver:e.actionResolver,rows:e.rows,cells:e.cells,onSort:e.onSort,sortBy:e.sortBy,"aria-label":e["aria-label"]},r().createElement(Oe.x,null),r().createElement(xe.R,null)))}))));var it=n(33109),mt=n(56787),ut=n(75728),dt=n(84457);const pt=({placeholder:e="",value:t,onChange:n,onKeyPress:a})=>r().createElement(G.B,null,r().createElement(W.oi,{value:t,placeholder:e,onChange:n,onKeyPress:e=>{"Enter"===e.key&&""!==t&&a(e)}}),r().createElement(H.O,{style:{borderLeft:"0"}},r().createElement(je.W1,null))),gt=(e,t,n,a)=>l=>{if("Enter"===l.key&&""!==a.value){const l=a.value;e(E(Object.assign(Object.assign({},n),{[t]:n[t]?`${n[t]},${l}`:l}))),a.setValue("")}},ht=(e,t,n)=>(a,l)=>{const r=n[t]?n[t].split(",").filter((e=>e!==l)):null;e(E(Object.assign(Object.assign({},n),{[t]:null===r||0===r.length?null:r.join(",")})))},_t=(e,t,n)=>()=>{e(E(Object.assign(Object.assign({},t),{[n]:null})))},Et=(0,s.connect)((e=>({filterType:o.E6.currentFilterType(e),query:o.E6.query(e)})),void 0,((e,t,n)=>{const{t:a,value:l,setValue:s,history:{push:o}}=n,{filterType:c,query:i}=e,m="description"===c?r().createElement(pt,{placeholder:a("page_cost_models.filter_by_description"),value:l,onChange:e=>s(e),onKeyPress:gt(o,"description",Object.assign(Object.assign({},_),i),{value:l,setValue:s})}):null,u=i.description?i.description.split(","):[];return{deleteChip:ht(o,"description",Object.assign(Object.assign({},_),i)),deleteChipGroup:_t(o,Object.assign(Object.assign({},_),i),"description"),chips:u,categoryName:a("description"),children:m}}))(Te.p),yt=lt()((()=>{const[e,t]=r().useState("");return{value:e,setValue:t}}))((0,g.withRouter)((0,S.withTranslation)()(Et))),bt=(0,s.connect)((e=>({filterType:o.E6.currentFilterType(e),query:o.E6.query(e)})),void 0,((e,t,n)=>{const{t:a,setValue:l,value:s,history:{push:o}}=n,{filterType:c,query:i}=e,m="name"===c?r().createElement(pt,{placeholder:a("page_cost_models.filter_by_name"),value:s,onChange:e=>l(e),onKeyPress:gt(o,"name",Object.assign(Object.assign({},_),i),{value:s,setValue:l})}):null,u=i.name?i.name.split(","):[];return{deleteChip:ht(o,"name",Object.assign(Object.assign({},_),i)),deleteChipGroup:_t(o,Object.assign(Object.assign({},_),i),"name"),chips:u,categoryName:a("name"),children:m}}))(Te.p),vt=lt()((()=>{const[e,t]=r().useState("");return{value:e,setValue:t}}))((0,g.withRouter)((0,S.withTranslation)()(bt))),ft=(e,t)=>()=>{t(!1);const n=document.getElementById(e);n&&n.focus()},Ct=(0,s.connect)((e=>({filterType:o.E6.currentFilterType(e),query:o.E6.query(e)})),void 0,((e,t,n)=>{const a="source-type-filter",{t:l,isOpen:s,setIsOpen:o,history:{push:c}}=n,{filterType:i,query:m}=e,u=e=>c(E(Object.assign(Object.assign(Object.assign({},_),m),{source_type:e}))),d="sourceType"===i?r().createElement(mt.L,{onSelect:ft(a,o),isOpen:s,toggle:r().createElement(ut.Z,{onToggle:e=>{o(e)},id:a},l("page_cost_models.filter_by_source_type")),dropdownItems:[r().createElement(dt.h,{key:"aws",component:"button",onClick:()=>u("aws")},l("page_cost_models.aws")),r().createElement(dt.h,{key:"azure",component:"button",onClick:()=>u("azure")},l("page_cost_models.azure")),r().createElement(dt.h,{key:"ocp",component:"button",onClick:()=>u("ocp")},l("page_cost_models.ocp"))]}):null,p=m.source_type?[m.source_type]:[];return{deleteChip:_t(c,Object.assign(Object.assign({},_),m),"source_type"),chips:p,categoryName:l("page_cost_models.source_type"),children:d}}))(Te.p),Pt=lt()((()=>{const[e,t]=r().useState(!1);return{isOpen:e,setIsOpen:t}}))((0,g.withRouter)((0,S.withTranslation)()(Ct))),wt=(0,g.withRouter)((0,s.connect)((e=>({query:o.E6.query(e)})),void 0,((e,t,n)=>{const{history:{push:a}}=n,{query:l}=e;return{id:"cost-models-toolbar",clearAllFilters:()=>a(E(Object.assign(Object.assign(Object.assign({},_),l),{description:null,source_type:null,name:null}))),children:n.children}}))(m.o));var zt=n(92694),kt=n(64403),St=n(1211),Ot=n(8755);const xt=lt()((()=>{const[e,t]=r().useState(!1);return{isOpen:e,setIsOpen:t}}))((0,S.withTranslation)()((0,s.connect)((e=>({filterType:o.E6.currentFilterType(e)})),(e=>({updateFilterType:t=>{e(o.F0.updateFilterToolbar({currentFilterType:t}))}})),((e,t,n)=>{const{t:a}=n,l=[r().createElement(zt.$,{key:"name",value:"name"},a("name")),r().createElement(zt.$,{key:"description",value:"description"},a("description")),r().createElement(zt.$,{key:"sourceType",value:"sourceType"},a("page_cost_models.source_type"))];return{variant:kt.TM.single,selections:e.filterType,onToggle:n.setIsOpen,isOpen:n.isOpen,onSelect:(e,a)=>{t.updateFilterType(a),n.setIsOpen(!1)},children:l,toggleIcon:r().createElement(Ot.k1,null)}}))(St.P))),Dt=(0,g.withRouter)((0,s.connect)((e=>{const{count:t,page:n,perPage:a}=o.E6.pagination(e);return{count:t,page:n,perPage:a,query:o.E6.query(e)}}),void 0,((e,t,n)=>{const{history:{push:a}}=n,{count:l,page:r,perPage:s,query:o}=e;return{isCompact:!0,itemCount:l,page:r,perPage:s,variant:p.a.top,onSetPage:(e,t,n)=>{a(E(Object.assign(Object.assign(Object.assign({},_),o),{offset:y(t,n)})))},onPerPageSelect:(e,t)=>{a(E(Object.assign(Object.assign(Object.assign({},_),o),{limit:t,offset:0})))}}}))(p.t)),Tt=()=>r().createElement(wt,null,r().createElement(u.c,null,r().createElement(it.k,{variant:"filter-group"},r().createElement(d.E,null,r().createElement(xt,null)),r().createElement(d.E,null,r().createElement(vt,null),r().createElement(yt,null),r().createElement(Pt,null)),r().createElement(d.E,null,r().createElement(He,null))),r().createElement(d.E,{variant:d.A.pagination},r().createElement(Dt,null))));class jt extends r().Component{componentDidMount(){this.props.getCostModelsData(this.props.search.slice(1)),this.props.getRbacData(),this.props.getMetricsData()}componentDidUpdate(e){e.search!==this.props.search&&this.props.getCostModelsData(this.props.search.slice(1))}render(){return r().createElement(r().Fragment,null,r().createElement(a.NP,{variant:a.Dk.light},r().createElement(Qe,null)),r().createElement(a.NP,{isFilled:!0},r().createElement(Ve,null),r().createElement(Ue,null),r().createElement(Tt,null),r().createElement(ct,null),r().createElement(b,null)))}}const Nt=(0,s.connect)(((e,t)=>({search:t.location.search})),(e=>({getCostModelsData:t=>o.F0.fetchCostModels(t)(e),getRbacData:()=>i.O9.fetchRbac()(e),getMetricsData:()=>c.Wg.fetchMetrics()(e)})))(jt)}}]);
//# sourceMappingURL=4de65193ddbee5b0c12f.bundle.js.map