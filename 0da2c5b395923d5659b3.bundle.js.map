{"version":3,"sources":["webpack:///./node_modules/xstate/es/Actor.js","webpack:///./node_modules/xstate/es/serviceScope.js","webpack:///./node_modules/xstate/es/State.js","webpack:///./node_modules/xstate/es/scheduler.js","webpack:///./node_modules/xstate/es/registry.js","webpack:///./node_modules/xstate/es/devTools.js","webpack:///./node_modules/@babel/runtime/helpers/typeof.js","webpack:///./node_modules/html-parse-stringify2/index.js","webpack:///./node_modules/html-parse-stringify2/lib/parse.js","webpack:///./node_modules/html-parse-stringify2/lib/parse-tag.js","webpack:///./node_modules/void-elements/index.js","webpack:///./node_modules/html-parse-stringify2/lib/stringify.js","webpack:///./node_modules/react-i18next/dist/es/Translation.js","webpack:///./node_modules/xstate/es/interpreter.js","webpack:///./node_modules/react-i18next/dist/es/Trans.js","webpack:///./node_modules/xstate/es/invokeUtils.js","webpack:///./node_modules/xstate/es/StateNode.js","webpack:///./node_modules/xstate/es/Machine.js","webpack:///./node_modules/lodash/mergeWith.js","webpack:///./node_modules/lodash/isEqualWith.js","webpack:///./node_modules/xstate/es/_virtual/_tslib.js","webpack:///./node_modules/xstate/es/utils.js","webpack:///./node_modules/xstate/es/environment.js","webpack:///./node_modules/xstate/es/types.js","webpack:///./node_modules/xstate/es/actionTypes.js","webpack:///./node_modules/xstate/es/actions.js","webpack:///./node_modules/xstate/es/constants.js","webpack:///./node_modules/xstate/es/stateUtils.js"],"names":["createNullActor","id","send","subscribe","unsubscribe","toJSON","createInvocableActor","invokeDefinition","machine","context","_event","_a","invokeSrc","src","serviceCreator","options","services","type","resolvedData","data","undefined","tempActor","createDeferredActor","meta","entity","deferred","state","withContext","initialState","isActor","item","e","serviceStack","provide","service","fn","push","result","pop","consume","length","stateValuesEqual","a","b","aKeys","bKeys","every","key","isState","bindActionToState","action","exec","event","State","config","_this","this","actions","activities","events","value","_sessionid","historyValue","history","matches","bind","toStrings","configuration","transitions","children","done","Object","defineProperty","get","from","stateValue","create","inert","prototype","delimiter","valueKeys","concat","apply","map","s","parentStateValue","defaultOptions","deferEvents","Scheduler","processingEvent","queue","initialized","initialize","callback","schedule","process","flushEvents","task","Error","clear","nextCallback","shift","Map","sessionIdIndex","registry","bookId","register","actor","set","free","delete","registerService","window","devTools","w","__xstate__","getDevTools","_typeof","obj","Symbol","iterator","module","exports","constructor","parse","stringify","tagRE","parseTag","empty","pushTextNode","list","html","level","start","ignoreWhitespace","end","indexOf","content","slice","test","components","current","arr","byTag","inComponent","replace","tag","index","name","parent","isOpen","charAt","isComment","nextChar","voidElement","tagName","attrRE","voidElements","i","expectingValueAfterEquals","res","attrs","match","buff","doc","join","attrString","reduce","token","rootEl","Translation","props","ns","_useTranslation","_useTranslation2","t","i18n","ready","lng","language","InterpreterStatus","DEFAULT_SPAWN_OPTIONS","sync","autoForward","Interpreter","scheduler","delayedEventsMap","listeners","Set","contextListeners","stopListeners","doneListeners","eventListeners","sendListeners","_status","NotStarted","forwardTo","init","payload","batch","Stopped","JSON","Running","forward","nextState","update","_state","sendTo","to","isParent","Parent","target","origin","sessionId","resolvedOptions","clock","logger","resolvedId","_initialState","enumerable","configurable","execute","actionsConfig","e_1","_b","_c","next","e_1_1","error","return","call","e_2","e_3","e_4","e_5","_d","_e","_f","listener","e_2_1","_g","_h","e_3_1","_j","_k","contextListener","e_4_1","isDone","finalChildStateNode","find","sn","doneData","_l","_m","e_5_1","stop","onTransition","add","nextListenerOrObserver","_","completeListener","resolvedCompleteListener","complete","onDone","onEvent","onSend","onChange","onStop","off","resolvedState","resolveState","attachDev","e_6","e_7","e_8","e_9","e_10","e_6_1","e_7_1","e_8_1","_o","e_9_1","forEach","child","_p","_q","clearTimeout","e_10_1","e_11","batchChanged","batchedActions","_loop_1","event_1","transition","changed","events_1","events_1_1","e_11_1","sender","nextEvents","some","nextEvent","e_12","e_12_1","defer","sendAction","setTimeout","delay","cancel","sendId","actionFunctionMap","actionOrExec","err","activity","Invoke","invokeSource","source","spawnPromise","Promise","resolve","spawnCallback","spawnObservable","spawnMachine","spawnActivity","stopChild","label","removeChild","childId","spawn","spawnActor","childService","doneEvent","promise","canceled","then","response","errorData","errorEvent","strict","handleError","unsubscribed","callbackStop","receivers","newListener","receiver","subscription","implementation","dispose","spawnEffect","__REDUX_DEVTOOLS_EXTENSION__","devToolsOptions","connect","autoPause","stateSanitizer","features","jump","skip","global","ms","console","log","self","interpret","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","_objectSpread","arguments","getOwnPropertyDescriptors","defineProperties","hasChildren","node","checkLength","base","getChildren","getAsArray","Array","isArray","renderNodes","targetString","i18nOptions","combinedTOpts","keepArray","transKeepBasicHtmlNodesFor","emptyChildrenButNeedsHandling","RegExp","getData","childs","isValidElement","assign","interpolatedString","interpolator","interpolate","ast","renderInner","rootReactNode","mappedChildren","mapAST","toString","hasValidReactChildren","pushTranslatedJSX","inner","mem","dummy","cloneElement","reactNode","astNode","reactNodes","newTarget","translationContent","tmp","parseInt","isElement","isValidTranslationWithChildren","isEmptyTransWithHTML","isKnownComponent","hasOwnProperty","_inner","Number","isNaN","parseFloat","transSupportBasicHtmlNodes","createElement","_inner3","_inner4","Trans","_ref","count","i18nKey","tOptions","values","defaults","i18nFromProps","tFromProps","additionalProps","_ref2","i18nFromContext","defaultNSFromContext","defaultNS","k","reactI18nextOptions","react","namespaces","defaultValue","nodesToString","stringNode","childrenArray","childIndex","childPropsCount","shouldKeepChild","childChildren","i18nIsDynamicList","format","clone","transEmptyNodeValue","hashTransKey","interpolationOverride","interpolation","prefix","suffix","useAsParent","defaultTransParent","toInvokeSource","simpleSrc","toInvokeDefinition","invokeConfig","onError","invokeDef","EMPTY_OBJECT","isStateId","str","StateNode","order","__xstatenode","__cache","relativeValue","initialStateValue","on","candidates","delayedTransitions","idMap","guards","delays","_parent","_key","path","version","parallel","states","initial","stateConfig","stateNode","dfs","_transient","always","onEntry","entry","onExit","exit","invoke","_init","withConfig","definition","eventType","getDelayedTransitions","formatTransitions","getCandidates","eventName","transient","sameEventType","afterConfig","after","mutateEntryExit","delayRef","configTransition","resolvedTransition","resolvedDelay","delayedTransition","formatTransition","getStateNodes","getStateNode","subStateKeys","subStateKey","allSubStateNodes","subStateNode","handles","includes","transitionLeafNode","transitionCompoundNode","_transition","transitionParallelNode","transitionMap","subStateValue","stateTransitions","enabledTransitions","st","entryNodes","entrySet","exitSet","selectedTransition","nextStateNodes","candidate","cond","stateIn","in","resolvedContext","isInState","getStateNodeById","guardPassed","message","allNextStateNodes","getRelativeStateNodes","isInternal","internal","n","nodesFromChild","childStateNode","escapes","nodes","marker","getActions","currentContext","prevState","prevConfig","resolvedConfig","resolvedConfig_1","resolvedConfig_1_1","prevConfig_1","prevConfig_1_1","doneEvents","grandparent","parentNode","sort","entryStates","exitStates","entryActions","exitActions","currentState","resolvedStateValue","getResolvedPath","stateTransition","resolveTransition","resolveRaisedTransition","originalEvent","currentActions","unshift","actions_1","actions_1_1","resolvedActions","updatedContext","Internal","raisedEvents","nonRaisedActions","acc","resolvedConfiguration","didUpdateContext","maybeNextState","raisedEvent","stateKey","stateId","resolvedStateId","getStateNodeByPath","statePath","arrayStatePath","currentStateNode","stateIdentifier","getInitialState","historyConfig","relativeStateId","resolveHistory","initialStateNodes","initialStateNodePaths","initialPath","getFromRelativePath","relativePath","childStatePath","relativeStateValue","historyTarget","relativeChildPath","subHistoryValue","subStatePath","childStateIds","stateIds","ownEvents","resolveTarget","_target","isInternalTarget","resolvedTarget","transitionConfig","normalizedTarget","onConfig","wildcardConfigs","strictTransitionConfigs_1","transitionConfigArray","hasNonLastUnguardedTarget","eventText","validateArrayifiedTransitions","eventlessConfig","doneConfig","String","settleTransitions","formattedTransitions","delayedTransitions_1","delayedTransitions_1_1","Machine","initialContext","resolvedInitialContext","baseMerge","mergeWith","createAssigner","srcIndex","customizer","baseIsEqual","other","__assign","p","__rest","propertyIsEnumerable","__values","o","m","__read","r","ar","__spread","matchesState","parentStateId","childStateId","toStateValue","childStateValue","isString","getEventType","toStatePath","split","pathToStateValue","mapValues","collection","iteratee","collectionKeys","mapFilterValues","predicate","props_1","props_1_1","nestedPath","accessorProp","props_2","props_2_1","prop","toStatePaths","flatten","subPath","array","toArrayStrict","toArray","mapContext","mapper","isFunction","subMapper","isBuiltInEvent","isPromiseLike","partition","items","truthy","falsy","items_1","items_1_1","updateHistoryStates","hist","subHist","updateHistoryValue","updateContext","assignActions","warn","assignAction","assignment","partialUpdate","propAssignment","toGuard","condition","guardMap","isObservable","args","symbolObservable","observable","isMachine","uniqueId","currentId","toEventObject","toSCXMLEvent","scxmlEvent","$$type","eventObject","toTransitionConfigArray","configLike","transitionLike","normalizeTarget","reportUnhandledExceptionOnInvocation","originalError","currentError","originalStackTrace","stack","stackTrace","evaluateGuard","guard","guardMeta","condFn","IS_PRODUCTION","ActionTypes","SpecialTargets","Start","Stop","raise","Raise","Send","Cancel","nullEvent","NullEvent","Assign","After","DoneState","Log","Init","errorPlatform","ErrorExecution","ErrorPlatform","ErrorCustom","Update","choose","Choose","pure","Pure","initEvent","getActionFunction","actionType","toActionObject","actionObject","toActionObjects","subAction","toActivityDefinition","activityDef","idSuffix","doneInvoke","DoneInvoke","resolveActions","otherActions","ctx","delaysMap","resolvedEvent","configDelay","resolveSend","expr","resolveLog","matchedActions","conds","resolved","STATE_DELIMITER","EMPTY_ACTIVITY_MAP","DEFAULT_GUARD_TYPE","TARGETLESS_KEY","isLeafNode","getAllStateNodes","stateNodes","getConfiguration","prevStateNodes","prevAdjList","getAdjList","configuration_1","configuration_1_1","has","adjList","configuration_2","configuration_2_1","configuration_3","configuration_3_1","configuration_4","configuration_4_1","getValue","rootNode","getValueFromAdj","baseNode","childStateNodes","csn","iterable","member","isInFinalState"],"mappings":"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","file":"0da2c5b395923d5659b3.bundle.js","sourcesContent":["import { toInvokeSource, mapContext, isMachine } from './utils.js';\nimport { provide } from './serviceScope.js';\n\nfunction createNullActor(id) {\n  return {\n    id: id,\n    send: function () {\n      return void 0;\n    },\n    subscribe: function () {\n      return {\n        unsubscribe: function () {\n          return void 0;\n        }\n      };\n    },\n    toJSON: function () {\n      return {\n        id: id\n      };\n    }\n  };\n}\n/**\r\n * Creates a deferred actor that is able to be invoked given the provided\r\n * invocation information in its `.meta` value.\r\n *\r\n * @param invokeDefinition The meta information needed to invoke the actor.\r\n */\n\n\nfunction createInvocableActor(invokeDefinition, machine, context, _event) {\n  var _a;\n\n  var invokeSrc = toInvokeSource(invokeDefinition.src);\n  var serviceCreator = (_a = machine === null || machine === void 0 ? void 0 : machine.options.services) === null || _a === void 0 ? void 0 : _a[invokeSrc.type];\n  var resolvedData = invokeDefinition.data ? mapContext(invokeDefinition.data, context, _event) : undefined;\n  var tempActor = serviceCreator ? createDeferredActor(serviceCreator, invokeDefinition.id, resolvedData) : createNullActor(invokeDefinition.id);\n  tempActor.meta = invokeDefinition;\n  return tempActor;\n}\n\nfunction createDeferredActor(entity, id, data) {\n  var tempActor = createNullActor(id);\n  tempActor.deferred = true;\n\n  if (isMachine(entity)) {\n    // \"mute\" the existing service scope so potential spawned actors within the `.initialState` stay deferred here\n    tempActor.state = provide(undefined, function () {\n      return (data ? entity.withContext(data) : entity).initialState;\n    });\n  }\n\n  return tempActor;\n}\n\nfunction isActor(item) {\n  try {\n    return typeof item.send === 'function';\n  } catch (e) {\n    return false;\n  }\n}\n\nexport { createDeferredActor, createInvocableActor, createNullActor, isActor };","/**\r\n * Maintains a stack of the current service in scope.\r\n * This is used to provide the correct service to spawn().\r\n */\nvar serviceStack = [];\n\nvar provide = function (service, fn) {\n  serviceStack.push(service);\n  var result = fn(service);\n  serviceStack.pop();\n  return result;\n};\n\nvar consume = function (fn) {\n  return fn(serviceStack[serviceStack.length - 1]);\n};\n\nexport { consume, provide };","import { __spread, __rest, __assign } from './_virtual/_tslib.js';\nimport { EMPTY_ACTIVITY_MAP } from './constants.js';\nimport { isString, matchesState, keys } from './utils.js';\nimport { nextEvents } from './stateUtils.js';\nimport { initEvent } from './actions.js';\n\nfunction stateValuesEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a === undefined || b === undefined) {\n    return false;\n  }\n\n  if (isString(a) || isString(b)) {\n    return a === b;\n  }\n\n  var aKeys = keys(a);\n  var bKeys = keys(b);\n  return aKeys.length === bKeys.length && aKeys.every(function (key) {\n    return stateValuesEqual(a[key], b[key]);\n  });\n}\n\nfunction isState(state) {\n  if (isString(state)) {\n    return false;\n  }\n\n  return 'value' in state && 'history' in state;\n}\n\nfunction bindActionToState(action, state) {\n  var exec = action.exec;\n\n  var boundAction = __assign(__assign({}, action), {\n    exec: exec !== undefined ? function () {\n      return exec(state.context, state.event, {\n        action: action,\n        state: state,\n        _event: state._event\n      });\n    } : undefined\n  });\n\n  return boundAction;\n}\n\nvar State =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  /**\r\n   * Creates a new State instance.\r\n   * @param value The state value\r\n   * @param context The extended state\r\n   * @param historyValue The tree representing historical values of the state nodes\r\n   * @param history The previous state\r\n   * @param actions An array of action objects to execute as side-effects\r\n   * @param activities A mapping of activities and whether they are started (`true`) or stopped (`false`).\r\n   * @param meta\r\n   * @param events Internal event queue. Should be empty with run-to-completion semantics.\r\n   * @param configuration\r\n   */\n  function State(config) {\n    var _this = this;\n\n    this.actions = [];\n    this.activities = EMPTY_ACTIVITY_MAP;\n    this.meta = {};\n    this.events = [];\n    this.value = config.value;\n    this.context = config.context;\n    this._event = config._event;\n    this._sessionid = config._sessionid;\n    this.event = this._event.data;\n    this.historyValue = config.historyValue;\n    this.history = config.history;\n    this.actions = config.actions || [];\n    this.activities = config.activities || EMPTY_ACTIVITY_MAP;\n    this.meta = config.meta || {};\n    this.events = config.events || [];\n    this.matches = this.matches.bind(this);\n    this.toStrings = this.toStrings.bind(this);\n    this.configuration = config.configuration;\n    this.transitions = config.transitions;\n    this.children = config.children;\n    this.done = !!config.done;\n    Object.defineProperty(this, 'nextEvents', {\n      get: function () {\n        return nextEvents(_this.configuration);\n      }\n    });\n  }\n  /**\r\n   * Creates a new State instance for the given `stateValue` and `context`.\r\n   * @param stateValue\r\n   * @param context\r\n   */\n\n\n  State.from = function (stateValue, context) {\n    if (stateValue instanceof State) {\n      if (stateValue.context !== context) {\n        return new State({\n          value: stateValue.value,\n          context: context,\n          _event: stateValue._event,\n          _sessionid: null,\n          historyValue: stateValue.historyValue,\n          history: stateValue.history,\n          actions: [],\n          activities: stateValue.activities,\n          meta: {},\n          events: [],\n          configuration: [],\n          transitions: [],\n          children: {}\n        });\n      }\n\n      return stateValue;\n    }\n\n    var _event = initEvent;\n    return new State({\n      value: stateValue,\n      context: context,\n      _event: _event,\n      _sessionid: null,\n      historyValue: undefined,\n      history: undefined,\n      actions: [],\n      activities: undefined,\n      meta: undefined,\n      events: [],\n      configuration: [],\n      transitions: [],\n      children: {}\n    });\n  };\n  /**\r\n   * Creates a new State instance for the given `config`.\r\n   * @param config The state config\r\n   */\n\n\n  State.create = function (config) {\n    return new State(config);\n  };\n  /**\r\n   * Creates a new `State` instance for the given `stateValue` and `context` with no actions (side-effects).\r\n   * @param stateValue\r\n   * @param context\r\n   */\n\n\n  State.inert = function (stateValue, context) {\n    if (stateValue instanceof State) {\n      if (!stateValue.actions.length) {\n        return stateValue;\n      }\n\n      var _event = initEvent;\n      return new State({\n        value: stateValue.value,\n        context: context,\n        _event: _event,\n        _sessionid: null,\n        historyValue: stateValue.historyValue,\n        history: stateValue.history,\n        activities: stateValue.activities,\n        configuration: stateValue.configuration,\n        transitions: [],\n        children: {}\n      });\n    }\n\n    return State.from(stateValue, context);\n  };\n  /**\r\n   * Returns an array of all the string leaf state node paths.\r\n   * @param stateValue\r\n   * @param delimiter The character(s) that separate each subpath in the string state node path.\r\n   */\n\n\n  State.prototype.toStrings = function (stateValue, delimiter) {\n    var _this = this;\n\n    if (stateValue === void 0) {\n      stateValue = this.value;\n    }\n\n    if (delimiter === void 0) {\n      delimiter = '.';\n    }\n\n    if (isString(stateValue)) {\n      return [stateValue];\n    }\n\n    var valueKeys = keys(stateValue);\n    return valueKeys.concat.apply(valueKeys, __spread(valueKeys.map(function (key) {\n      return _this.toStrings(stateValue[key], delimiter).map(function (s) {\n        return key + delimiter + s;\n      });\n    })));\n  };\n\n  State.prototype.toJSON = function () {\n    var _a = this,\n        configuration = _a.configuration,\n        transitions = _a.transitions,\n        jsonValues = __rest(_a, [\"configuration\", \"transitions\"]);\n\n    return jsonValues;\n  };\n  /**\r\n   * Whether the current state value is a subset of the given parent state value.\r\n   * @param parentStateValue\r\n   */\n\n\n  State.prototype.matches = function (parentStateValue) {\n    return matchesState(parentStateValue, this.value);\n  };\n\n  return State;\n}();\n\nexport { State, bindActionToState, isState, stateValuesEqual };","import { __assign } from './_virtual/_tslib.js';\nvar defaultOptions = {\n  deferEvents: false\n};\n\nvar Scheduler =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  function Scheduler(options) {\n    this.processingEvent = false;\n    this.queue = [];\n    this.initialized = false;\n    this.options = __assign(__assign({}, defaultOptions), options);\n  }\n\n  Scheduler.prototype.initialize = function (callback) {\n    this.initialized = true;\n\n    if (callback) {\n      if (!this.options.deferEvents) {\n        this.schedule(callback);\n        return;\n      }\n\n      this.process(callback);\n    }\n\n    this.flushEvents();\n  };\n\n  Scheduler.prototype.schedule = function (task) {\n    if (!this.initialized || this.processingEvent) {\n      this.queue.push(task);\n      return;\n    }\n\n    if (this.queue.length !== 0) {\n      throw new Error('Event queue should be empty when it is not processing events');\n    }\n\n    this.process(task);\n    this.flushEvents();\n  };\n\n  Scheduler.prototype.clear = function () {\n    this.queue = [];\n  };\n\n  Scheduler.prototype.flushEvents = function () {\n    var nextCallback = this.queue.shift();\n\n    while (nextCallback) {\n      this.process(nextCallback);\n      nextCallback = this.queue.shift();\n    }\n  };\n\n  Scheduler.prototype.process = function (callback) {\n    this.processingEvent = true;\n\n    try {\n      callback();\n    } catch (e) {\n      // there is no use to keep the future events\n      // as the situation is not anymore the same\n      this.clear();\n      throw e;\n    } finally {\n      this.processingEvent = false;\n    }\n  };\n\n  return Scheduler;\n}();\n\nexport { Scheduler };","var children = /*#__PURE__*/new Map();\nvar sessionIdIndex = 0;\nvar registry = {\n  bookId: function () {\n    return \"x:\" + sessionIdIndex++;\n  },\n  register: function (id, actor) {\n    children.set(id, actor);\n    return id;\n  },\n  get: function (id) {\n    return children.get(id);\n  },\n  free: function (id) {\n    children.delete(id);\n  }\n};\nexport { registry };","import { IS_PRODUCTION } from './environment.js';\n\nfunction getDevTools() {\n  var w = window;\n\n  if (!!w.__xstate__) {\n    return w.__xstate__;\n  }\n\n  return undefined;\n}\n\nfunction registerService(service) {\n  if (IS_PRODUCTION || typeof window === 'undefined') {\n    return;\n  }\n\n  var devTools = getDevTools();\n\n  if (devTools) {\n    devTools.register(service);\n  }\n}\n\nexport { registerService };","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","module.exports = {\n    parse: require('./lib/parse'),\n    stringify: require('./lib/stringify')\n};\n","/*jshint -W030 */\nvar tagRE = /(?:<!--[\\S\\s]*?-->|<(?:\"[^\"]*\"['\"]*|'[^']*'['\"]*|[^'\">])+>)/g;\nvar parseTag = require('./parse-tag');\n// re-used obj for quick lookups of components\nvar empty = Object.create ? Object.create(null) : {};\n// common logic for pushing a child node onto a list\nfunction pushTextNode(list, html, level, start, ignoreWhitespace) {\n    // calculate correct end of the content slice in case there's\n    // no tag after the text node.\n    var end = html.indexOf('<', start);\n    var content = html.slice(start, end === -1 ? undefined : end);\n    // if a node is nothing but whitespace, collapse it as the spec states:\n    // https://www.w3.org/TR/html4/struct/text.html#h-9.1\n    if (/^\\s*$/.test(content)) {\n        content = ' ';\n    }\n    // don't add whitespace-only text nodes if they would be trailing text nodes\n    // or if they would be leading whitespace-only text nodes:\n    //  * end > -1 indicates this is not a trailing text node\n    //  * leading node is when level is -1 and list has length 0\n    if ((!ignoreWhitespace && end > -1 && level + list.length >= 0) || content !== ' ') {\n        list.push({\n            type: 'text',\n            content: content\n        });\n    }\n}\n\nmodule.exports = function parse(html, options) {\n    options || (options = {});\n    options.components || (options.components = empty);\n    var result = [];\n    var current;\n    var level = -1;\n    var arr = [];\n    var byTag = {};\n    var inComponent = false;\n\n    html.replace(tagRE, function (tag, index) {\n        if (inComponent) {\n            if (tag !== ('</' + current.name + '>')) {\n                return;\n            } else {\n                inComponent = false;\n            }\n        }\n\n        var isOpen = tag.charAt(1) !== '/';\n        var isComment = tag.indexOf('<!--') === 0;\n        var start = index + tag.length;\n        var nextChar = html.charAt(start);\n        var parent;\n\n        if (isOpen && !isComment) {\n            level++;\n\n            current = parseTag(tag);\n            if (current.type === 'tag' && options.components[current.name]) {\n                current.type = 'component';\n                inComponent = true;\n            }\n\n            if (!current.voidElement && !inComponent && nextChar && nextChar !== '<') {\n                pushTextNode(current.children, html, level, start, options.ignoreWhitespace);\n            }\n\n            byTag[current.tagName] = current;\n\n            // if we're at root, push new base node\n            if (level === 0) {\n                result.push(current);\n            }\n\n            parent = arr[level - 1];\n\n            if (parent) {\n                parent.children.push(current);\n            }\n\n            arr[level] = current;\n        }\n\n        if (isComment || !isOpen || current.voidElement) {\n            if (!isComment) {\n                level--;\n            }\n            if (!inComponent && nextChar !== '<' && nextChar) {\n                // trailing text node\n                // if we're at the root, push a base text node. otherwise add as\n                // a child to the current node.\n                parent = level === -1 ? result : arr[level].children;\n                pushTextNode(parent, html, level, start, options.ignoreWhitespace);\n            }\n        }\n    });\n\n    // If the \"html\" passed isn't actually html, add it as a text node.\n    if (!result.length && html.length) {\n        pushTextNode(result, html, 0, 0, options.ignoreWhitespace);\n    }\n\n    return result;\n};\n","var attrRE = /([\\w-]+)|=|(['\"])([.\\s\\S]*?)\\2/g;\nvar voidElements = require('void-elements');\n\nmodule.exports = function (tag) {\n    var i = 0;\n    var key;\n    var expectingValueAfterEquals = true;\n    var res = {\n        type: 'tag',\n        name: '',\n        voidElement: false,\n        attrs: {},\n        children: []\n    };\n\n    tag.replace(attrRE, function (match) {\n        if (match === '=') {\n            expectingValueAfterEquals = true;\n            i++;\n            return;\n        }\n\n        if (!expectingValueAfterEquals) {\n            if (key) {\n                res.attrs[key] = key; // boolean attribute\n            }\n            key=match;\n        } else {\n            if (i === 0) {\n                if (voidElements[match] || tag.charAt(tag.length - 2) === '/') {\n                    res.voidElement = true;\n                }\n                res.name = match;\n            } else {\n                res.attrs[key] = match.replace(/^['\"]|['\"]$/g, '');\n                key=undefined;\n            }\n        }\n        i++;\n        expectingValueAfterEquals = false;\n    });\n\n    return res;\n};\n","/**\n * This file automatically generated from `pre-publish.js`.\n * Do not manually edit.\n */\n\nmodule.exports = {\n  \"area\": true,\n  \"base\": true,\n  \"br\": true,\n  \"col\": true,\n  \"embed\": true,\n  \"hr\": true,\n  \"img\": true,\n  \"input\": true,\n  \"keygen\": true,\n  \"link\": true,\n  \"menuitem\": true,\n  \"meta\": true,\n  \"param\": true,\n  \"source\": true,\n  \"track\": true,\n  \"wbr\": true\n};\n","function attrString(attrs) {\n    var buff = [];\n    for (var key in attrs) {\n        buff.push(key + '=\"' + attrs[key] + '\"');\n    }\n    if (!buff.length) {\n        return '';\n    }\n    return ' ' + buff.join(' ');\n}\n\nfunction stringify(buff, doc) {\n    switch (doc.type) {\n    case 'text':\n        return buff + doc.content;\n    case 'tag':\n        buff += '<' + doc.name + (doc.attrs ? attrString(doc.attrs) : '') + (doc.voidElement ? '/>' : '>');\n        if (doc.voidElement) {\n            return buff;\n        }\n        return buff + doc.children.reduce(stringify, '') + '</' + doc.name + '>';\n    }\n}\n\nmodule.exports = function (doc) {\n    return doc.reduce(function (token, rootEl) {\n        return token + stringify('', rootEl);\n    }, '');\n};\n","import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport { useTranslation } from './useTranslation';\nexport function Translation(props) {\n  var ns = props.ns,\n      children = props.children,\n      options = _objectWithoutProperties(props, [\"ns\", \"children\"]);\n\n  var _useTranslation = useTranslation(ns, options),\n      _useTranslation2 = _slicedToArray(_useTranslation, 3),\n      t = _useTranslation2[0],\n      i18n = _useTranslation2[1],\n      ready = _useTranslation2[2];\n\n  return children(t, {\n    i18n: i18n,\n    lng: i18n.language\n  }, ready);\n}","import { __values, __assign, __spread } from './_virtual/_tslib.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { warn, mapContext, isFunction, keys, toSCXMLEvent, toInvokeSource, isPromiseLike, isObservable, isMachine, reportUnhandledExceptionOnInvocation, symbolObservable, isArray, toEventObject, isString, uniqueId } from './utils.js';\nimport { ActionTypes, SpecialTargets } from './types.js';\nimport { isInFinalState } from './stateUtils.js';\nimport { errorPlatform, log, stop, start, cancel, send, update, error as error$1 } from './actionTypes.js';\nimport { doneInvoke, initEvent, getActionFunction, error } from './actions.js';\nimport { isState, State, bindActionToState } from './State.js';\nimport { provide, consume } from './serviceScope.js';\nimport { isActor, createDeferredActor } from './Actor.js';\nimport { Scheduler } from './scheduler.js';\nimport { registry } from './registry.js';\nimport { registerService } from './devTools.js';\nvar DEFAULT_SPAWN_OPTIONS = {\n  sync: false,\n  autoForward: false\n};\nvar InterpreterStatus;\n\n(function (InterpreterStatus) {\n  InterpreterStatus[InterpreterStatus[\"NotStarted\"] = 0] = \"NotStarted\";\n  InterpreterStatus[InterpreterStatus[\"Running\"] = 1] = \"Running\";\n  InterpreterStatus[InterpreterStatus[\"Stopped\"] = 2] = \"Stopped\";\n})(InterpreterStatus || (InterpreterStatus = {}));\n\nvar Interpreter =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  /**\r\n   * Creates a new Interpreter instance (i.e., service) for the given machine with the provided options, if any.\r\n   *\r\n   * @param machine The machine to be interpreted\r\n   * @param options Interpreter options\r\n   */\n  function Interpreter(machine, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = Interpreter.defaultOptions;\n    }\n\n    this.machine = machine;\n    this.scheduler = new Scheduler();\n    this.delayedEventsMap = {};\n    this.listeners = new Set();\n    this.contextListeners = new Set();\n    this.stopListeners = new Set();\n    this.doneListeners = new Set();\n    this.eventListeners = new Set();\n    this.sendListeners = new Set();\n    /**\r\n     * Whether the service is started.\r\n     */\n\n    this.initialized = false;\n    this._status = InterpreterStatus.NotStarted;\n    this.children = new Map();\n    this.forwardTo = new Set();\n    /**\r\n     * Alias for Interpreter.prototype.start\r\n     */\n\n    this.init = this.start;\n    /**\r\n     * Sends an event to the running interpreter to trigger a transition.\r\n     *\r\n     * An array of events (batched) can be sent as well, which will send all\r\n     * batched events to the running interpreter. The listeners will be\r\n     * notified only **once** when all events are processed.\r\n     *\r\n     * @param event The event(s) to send\r\n     */\n\n    this.send = function (event, payload) {\n      if (isArray(event)) {\n        _this.batch(event);\n\n        return _this.state;\n      }\n\n      var _event = toSCXMLEvent(toEventObject(event, payload));\n\n      if (_this._status === InterpreterStatus.Stopped) {\n        // do nothing\n        if (!IS_PRODUCTION) {\n          warn(false, \"Event \\\"\" + _event.name + \"\\\" was sent to stopped service \\\"\" + _this.machine.id + \"\\\". This service has already reached its final state, and will not transition.\\nEvent: \" + JSON.stringify(_event.data));\n        }\n\n        return _this.state;\n      }\n\n      if (_this._status === InterpreterStatus.NotStarted && _this.options.deferEvents) {\n        // tslint:disable-next-line:no-console\n        if (!IS_PRODUCTION) {\n          warn(false, \"Event \\\"\" + _event.name + \"\\\" was sent to uninitialized service \\\"\" + _this.machine.id + \"\\\" and is deferred. Make sure .start() is called for this service.\\nEvent: \" + JSON.stringify(_event.data));\n        }\n      } else if (_this._status !== InterpreterStatus.Running) {\n        throw new Error(\"Event \\\"\" + _event.name + \"\\\" was sent to uninitialized service \\\"\" + _this.machine.id + \"\\\". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\\nEvent: \" + JSON.stringify(_event.data));\n      }\n\n      _this.scheduler.schedule(function () {\n        // Forward copy of event to child actors\n        _this.forward(_event);\n\n        var nextState = _this.nextState(_event);\n\n        _this.update(nextState, _event);\n      });\n\n      return _this._state; // TODO: deprecate (should return void)\n      // tslint:disable-next-line:semicolon\n    };\n\n    this.sendTo = function (event, to) {\n      var isParent = _this.parent && (to === SpecialTargets.Parent || _this.parent.id === to);\n      var target = isParent ? _this.parent : isActor(to) ? to : _this.children.get(to) || registry.get(to);\n\n      if (!target) {\n        if (!isParent) {\n          throw new Error(\"Unable to send event to child '\" + to + \"' from service '\" + _this.id + \"'.\");\n        } // tslint:disable-next-line:no-console\n\n\n        if (!IS_PRODUCTION) {\n          warn(false, \"Service '\" + _this.id + \"' has no parent: unable to send event \" + event.type);\n        }\n\n        return;\n      }\n\n      if ('machine' in target) {\n        // Send SCXML events to machines\n        target.send(__assign(__assign({}, event), {\n          name: event.name === error$1 ? \"\" + error(_this.id) : event.name,\n          origin: _this.sessionId\n        }));\n      } else {\n        // Send normal events to other targets\n        target.send(event.data);\n      }\n    };\n\n    var resolvedOptions = __assign(__assign({}, Interpreter.defaultOptions), options);\n\n    var clock = resolvedOptions.clock,\n        logger = resolvedOptions.logger,\n        parent = resolvedOptions.parent,\n        id = resolvedOptions.id;\n    var resolvedId = id !== undefined ? id : machine.id;\n    this.id = resolvedId;\n    this.logger = logger;\n    this.clock = clock;\n    this.parent = parent;\n    this.options = resolvedOptions;\n    this.scheduler = new Scheduler({\n      deferEvents: this.options.deferEvents\n    });\n    this.sessionId = registry.bookId();\n  }\n\n  Object.defineProperty(Interpreter.prototype, \"initialState\", {\n    get: function () {\n      var _this = this;\n\n      if (this._initialState) {\n        return this._initialState;\n      }\n\n      return provide(this, function () {\n        _this._initialState = _this.machine.initialState;\n        return _this._initialState;\n      });\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Interpreter.prototype, \"state\", {\n    get: function () {\n      if (!IS_PRODUCTION) {\n        warn(this._status !== InterpreterStatus.NotStarted, \"Attempted to read state from uninitialized service '\" + this.id + \"'. Make sure the service is started first.\");\n      }\n\n      return this._state;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Executes the actions of the given state, with that state's `context` and `event`.\r\n   *\r\n   * @param state The state whose actions will be executed\r\n   * @param actionsConfig The action implementations to use\r\n   */\n\n  Interpreter.prototype.execute = function (state, actionsConfig) {\n    var e_1, _a;\n\n    try {\n      for (var _b = __values(state.actions), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var action = _c.value;\n        this.exec(action, state, actionsConfig);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n\n  Interpreter.prototype.update = function (state, _event) {\n    var e_2, _a, e_3, _b, e_4, _c, e_5, _d;\n\n    var _this = this; // Attach session ID to state\n\n\n    state._sessionid = this.sessionId; // Update state\n\n    this._state = state; // Execute actions\n\n    if (this.options.execute) {\n      this.execute(this.state);\n    } // Dev tools\n\n\n    if (this.devTools) {\n      this.devTools.send(_event.data, state);\n    } // Execute listeners\n\n\n    if (state.event) {\n      try {\n        for (var _e = __values(this.eventListeners), _f = _e.next(); !_f.done; _f = _e.next()) {\n          var listener = _f.value;\n          listener(state.event);\n        }\n      } catch (e_2_1) {\n        e_2 = {\n          error: e_2_1\n        };\n      } finally {\n        try {\n          if (_f && !_f.done && (_a = _e.return)) _a.call(_e);\n        } finally {\n          if (e_2) throw e_2.error;\n        }\n      }\n    }\n\n    try {\n      for (var _g = __values(this.listeners), _h = _g.next(); !_h.done; _h = _g.next()) {\n        var listener = _h.value;\n        listener(state, state.event);\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (_h && !_h.done && (_b = _g.return)) _b.call(_g);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    try {\n      for (var _j = __values(this.contextListeners), _k = _j.next(); !_k.done; _k = _j.next()) {\n        var contextListener = _k.value;\n        contextListener(this.state.context, this.state.history ? this.state.history.context : undefined);\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (_k && !_k.done && (_c = _j.return)) _c.call(_j);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n\n    var isDone = isInFinalState(state.configuration || [], this.machine);\n\n    if (this.state.configuration && isDone) {\n      // get final child state node\n      var finalChildStateNode = state.configuration.find(function (sn) {\n        return sn.type === 'final' && sn.parent === _this.machine;\n      });\n      var doneData = finalChildStateNode && finalChildStateNode.doneData ? mapContext(finalChildStateNode.doneData, state.context, _event) : undefined;\n\n      try {\n        for (var _l = __values(this.doneListeners), _m = _l.next(); !_m.done; _m = _l.next()) {\n          var listener = _m.value;\n          listener(doneInvoke(this.id, doneData));\n        }\n      } catch (e_5_1) {\n        e_5 = {\n          error: e_5_1\n        };\n      } finally {\n        try {\n          if (_m && !_m.done && (_d = _l.return)) _d.call(_l);\n        } finally {\n          if (e_5) throw e_5.error;\n        }\n      }\n\n      this.stop();\n    }\n  };\n  /*\r\n   * Adds a listener that is notified whenever a state transition happens. The listener is called with\r\n   * the next state and the event object that caused the state transition.\r\n   *\r\n   * @param listener The state listener\r\n   */\n\n\n  Interpreter.prototype.onTransition = function (listener) {\n    this.listeners.add(listener); // Send current state to listener\n\n    if (this._status === InterpreterStatus.Running) {\n      listener(this.state, this.state.event);\n    }\n\n    return this;\n  };\n\n  Interpreter.prototype.subscribe = function (nextListenerOrObserver, _, // TODO: error listener\n  completeListener) {\n    var _this = this;\n\n    if (!nextListenerOrObserver) {\n      return {\n        unsubscribe: function () {\n          return void 0;\n        }\n      };\n    }\n\n    var listener;\n    var resolvedCompleteListener = completeListener;\n\n    if (typeof nextListenerOrObserver === 'function') {\n      listener = nextListenerOrObserver;\n    } else {\n      listener = nextListenerOrObserver.next.bind(nextListenerOrObserver);\n      resolvedCompleteListener = nextListenerOrObserver.complete.bind(nextListenerOrObserver);\n    }\n\n    this.listeners.add(listener); // Send current state to listener\n\n    if (this._status === InterpreterStatus.Running) {\n      listener(this.state);\n    }\n\n    if (resolvedCompleteListener) {\n      this.onDone(resolvedCompleteListener);\n    }\n\n    return {\n      unsubscribe: function () {\n        listener && _this.listeners.delete(listener);\n        resolvedCompleteListener && _this.doneListeners.delete(resolvedCompleteListener);\n      }\n    };\n  };\n  /**\r\n   * Adds an event listener that is notified whenever an event is sent to the running interpreter.\r\n   * @param listener The event listener\r\n   */\n\n\n  Interpreter.prototype.onEvent = function (listener) {\n    this.eventListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds an event listener that is notified whenever a `send` event occurs.\r\n   * @param listener The event listener\r\n   */\n\n\n  Interpreter.prototype.onSend = function (listener) {\n    this.sendListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a context listener that is notified whenever the state context changes.\r\n   * @param listener The context listener\r\n   */\n\n\n  Interpreter.prototype.onChange = function (listener) {\n    this.contextListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a listener that is notified when the machine is stopped.\r\n   * @param listener The listener\r\n   */\n\n\n  Interpreter.prototype.onStop = function (listener) {\n    this.stopListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a state listener that is notified when the statechart has reached its final state.\r\n   * @param listener The state listener\r\n   */\n\n\n  Interpreter.prototype.onDone = function (listener) {\n    this.doneListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Removes a listener.\r\n   * @param listener The listener to remove\r\n   */\n\n\n  Interpreter.prototype.off = function (listener) {\n    this.listeners.delete(listener);\n    this.eventListeners.delete(listener);\n    this.sendListeners.delete(listener);\n    this.stopListeners.delete(listener);\n    this.doneListeners.delete(listener);\n    this.contextListeners.delete(listener);\n    return this;\n  };\n  /**\r\n   * Starts the interpreter from the given state, or the initial state.\r\n   * @param initialState The state to start the statechart from\r\n   */\n\n\n  Interpreter.prototype.start = function (initialState) {\n    var _this = this;\n\n    if (this._status === InterpreterStatus.Running) {\n      // Do not restart the service if it is already started\n      return this;\n    }\n\n    registry.register(this.sessionId, this);\n    this.initialized = true;\n    this._status = InterpreterStatus.Running;\n    var resolvedState = initialState === undefined ? this.initialState : provide(this, function () {\n      return isState(initialState) ? _this.machine.resolveState(initialState) : _this.machine.resolveState(State.from(initialState, _this.machine.context));\n    });\n\n    if (this.options.devTools) {\n      this.attachDev();\n    }\n\n    this.scheduler.initialize(function () {\n      _this.update(resolvedState, initEvent);\n    });\n    return this;\n  };\n  /**\r\n   * Stops the interpreter and unsubscribe all listeners.\r\n   *\r\n   * This will also notify the `onStop` listeners.\r\n   */\n\n\n  Interpreter.prototype.stop = function () {\n    var e_6, _a, e_7, _b, e_8, _c, e_9, _d, e_10, _e;\n\n    try {\n      for (var _f = __values(this.listeners), _g = _f.next(); !_g.done; _g = _f.next()) {\n        var listener = _g.value;\n        this.listeners.delete(listener);\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (_g && !_g.done && (_a = _f.return)) _a.call(_f);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n\n    try {\n      for (var _h = __values(this.stopListeners), _j = _h.next(); !_j.done; _j = _h.next()) {\n        var listener = _j.value; // call listener, then remove\n\n        listener();\n        this.stopListeners.delete(listener);\n      }\n    } catch (e_7_1) {\n      e_7 = {\n        error: e_7_1\n      };\n    } finally {\n      try {\n        if (_j && !_j.done && (_b = _h.return)) _b.call(_h);\n      } finally {\n        if (e_7) throw e_7.error;\n      }\n    }\n\n    try {\n      for (var _k = __values(this.contextListeners), _l = _k.next(); !_l.done; _l = _k.next()) {\n        var listener = _l.value;\n        this.contextListeners.delete(listener);\n      }\n    } catch (e_8_1) {\n      e_8 = {\n        error: e_8_1\n      };\n    } finally {\n      try {\n        if (_l && !_l.done && (_c = _k.return)) _c.call(_k);\n      } finally {\n        if (e_8) throw e_8.error;\n      }\n    }\n\n    try {\n      for (var _m = __values(this.doneListeners), _o = _m.next(); !_o.done; _o = _m.next()) {\n        var listener = _o.value;\n        this.doneListeners.delete(listener);\n      }\n    } catch (e_9_1) {\n      e_9 = {\n        error: e_9_1\n      };\n    } finally {\n      try {\n        if (_o && !_o.done && (_d = _m.return)) _d.call(_m);\n      } finally {\n        if (e_9) throw e_9.error;\n      }\n    } // Stop all children\n\n\n    this.children.forEach(function (child) {\n      if (isFunction(child.stop)) {\n        child.stop();\n      }\n    });\n\n    try {\n      // Cancel all delayed events\n      for (var _p = __values(keys(this.delayedEventsMap)), _q = _p.next(); !_q.done; _q = _p.next()) {\n        var key = _q.value;\n        this.clock.clearTimeout(this.delayedEventsMap[key]);\n      }\n    } catch (e_10_1) {\n      e_10 = {\n        error: e_10_1\n      };\n    } finally {\n      try {\n        if (_q && !_q.done && (_e = _p.return)) _e.call(_p);\n      } finally {\n        if (e_10) throw e_10.error;\n      }\n    }\n\n    this.scheduler.clear();\n    this.initialized = false;\n    this._status = InterpreterStatus.Stopped;\n    registry.free(this.sessionId);\n    return this;\n  };\n\n  Interpreter.prototype.batch = function (events) {\n    var _this = this;\n\n    if (this._status === InterpreterStatus.NotStarted && this.options.deferEvents) {\n      // tslint:disable-next-line:no-console\n      if (!IS_PRODUCTION) {\n        warn(false, events.length + \" event(s) were sent to uninitialized service \\\"\" + this.machine.id + \"\\\" and are deferred. Make sure .start() is called for this service.\\nEvent: \" + JSON.stringify(event));\n      }\n    } else if (this._status !== InterpreterStatus.Running) {\n      throw new Error( // tslint:disable-next-line:max-line-length\n      events.length + \" event(s) were sent to uninitialized service \\\"\" + this.machine.id + \"\\\". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\");\n    }\n\n    this.scheduler.schedule(function () {\n      var e_11, _a;\n\n      var nextState = _this.state;\n      var batchChanged = false;\n      var batchedActions = [];\n\n      var _loop_1 = function (event_1) {\n        var _event = toSCXMLEvent(event_1);\n\n        _this.forward(_event);\n\n        nextState = provide(_this, function () {\n          return _this.machine.transition(nextState, _event);\n        });\n        batchedActions.push.apply(batchedActions, __spread(nextState.actions.map(function (a) {\n          return bindActionToState(a, nextState);\n        })));\n        batchChanged = batchChanged || !!nextState.changed;\n      };\n\n      try {\n        for (var events_1 = __values(events), events_1_1 = events_1.next(); !events_1_1.done; events_1_1 = events_1.next()) {\n          var event_1 = events_1_1.value;\n\n          _loop_1(event_1);\n        }\n      } catch (e_11_1) {\n        e_11 = {\n          error: e_11_1\n        };\n      } finally {\n        try {\n          if (events_1_1 && !events_1_1.done && (_a = events_1.return)) _a.call(events_1);\n        } finally {\n          if (e_11) throw e_11.error;\n        }\n      }\n\n      nextState.changed = batchChanged;\n      nextState.actions = batchedActions;\n\n      _this.update(nextState, toSCXMLEvent(events[events.length - 1]));\n    });\n  };\n  /**\r\n   * Returns a send function bound to this interpreter instance.\r\n   *\r\n   * @param event The event to be sent by the sender.\r\n   */\n\n\n  Interpreter.prototype.sender = function (event) {\n    return this.send.bind(this, event);\n  };\n  /**\r\n   * Returns the next state given the interpreter's current state and the event.\r\n   *\r\n   * This is a pure method that does _not_ update the interpreter's state.\r\n   *\r\n   * @param event The event to determine the next state\r\n   */\n\n\n  Interpreter.prototype.nextState = function (event) {\n    var _this = this;\n\n    var _event = toSCXMLEvent(event);\n\n    if (_event.name.indexOf(errorPlatform) === 0 && !this.state.nextEvents.some(function (nextEvent) {\n      return nextEvent.indexOf(errorPlatform) === 0;\n    })) {\n      throw _event.data.data;\n    }\n\n    var nextState = provide(this, function () {\n      return _this.machine.transition(_this.state, _event);\n    });\n    return nextState;\n  };\n\n  Interpreter.prototype.forward = function (event) {\n    var e_12, _a;\n\n    try {\n      for (var _b = __values(this.forwardTo), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var id = _c.value;\n        var child = this.children.get(id);\n\n        if (!child) {\n          throw new Error(\"Unable to forward event '\" + event + \"' from interpreter '\" + this.id + \"' to nonexistant child '\" + id + \"'.\");\n        }\n\n        child.send(event);\n      }\n    } catch (e_12_1) {\n      e_12 = {\n        error: e_12_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_12) throw e_12.error;\n      }\n    }\n  };\n\n  Interpreter.prototype.defer = function (sendAction) {\n    var _this = this;\n\n    this.delayedEventsMap[sendAction.id] = this.clock.setTimeout(function () {\n      if (sendAction.to) {\n        _this.sendTo(sendAction._event, sendAction.to);\n      } else {\n        _this.send(sendAction._event);\n      }\n    }, sendAction.delay);\n  };\n\n  Interpreter.prototype.cancel = function (sendId) {\n    this.clock.clearTimeout(this.delayedEventsMap[sendId]);\n    delete this.delayedEventsMap[sendId];\n  };\n\n  Interpreter.prototype.exec = function (action, state, actionFunctionMap) {\n    if (actionFunctionMap === void 0) {\n      actionFunctionMap = this.machine.options.actions;\n    }\n\n    var context = state.context,\n        _event = state._event;\n    var actionOrExec = action.exec || getActionFunction(action.type, actionFunctionMap);\n    var exec = isFunction(actionOrExec) ? actionOrExec : actionOrExec ? actionOrExec.exec : action.exec;\n\n    if (exec) {\n      try {\n        return exec(context, _event.data, {\n          action: action,\n          state: this.state,\n          _event: _event\n        });\n      } catch (err) {\n        if (this.parent) {\n          this.parent.send({\n            type: 'xstate.error',\n            data: err\n          });\n        }\n\n        throw err;\n      }\n    }\n\n    switch (action.type) {\n      case send:\n        var sendAction = action;\n\n        if (typeof sendAction.delay === 'number') {\n          this.defer(sendAction);\n          return;\n        } else {\n          if (sendAction.to) {\n            this.sendTo(sendAction._event, sendAction.to);\n          } else {\n            this.send(sendAction._event);\n          }\n        }\n\n        break;\n\n      case cancel:\n        this.cancel(action.sendId);\n        break;\n\n      case start:\n        {\n          var activity = action.activity; // If the activity will be stopped right after it's started\n          // (such as in transient states)\n          // don't bother starting the activity.\n\n          if (!this.state.activities[activity.id || activity.type]) {\n            break;\n          } // Invoked services\n\n\n          if (activity.type === ActionTypes.Invoke) {\n            var invokeSource = toInvokeSource(activity.src);\n            var serviceCreator = this.machine.options.services ? this.machine.options.services[invokeSource.type] : undefined;\n            var id = activity.id,\n                data = activity.data;\n\n            if (!IS_PRODUCTION) {\n              warn(!('forward' in activity), // tslint:disable-next-line:max-line-length\n              \"`forward` property is deprecated (found in invocation of '\" + activity.src + \"' in in machine '\" + this.machine.id + \"'). \" + \"Please use `autoForward` instead.\");\n            }\n\n            var autoForward = 'autoForward' in activity ? activity.autoForward : !!activity.forward;\n\n            if (!serviceCreator) {\n              // tslint:disable-next-line:no-console\n              if (!IS_PRODUCTION) {\n                warn(false, \"No service found for invocation '\" + activity.src + \"' in machine '\" + this.machine.id + \"'.\");\n              }\n\n              return;\n            }\n\n            var resolvedData = data ? mapContext(data, context, _event) : undefined;\n            var source = isFunction(serviceCreator) ? serviceCreator(context, _event.data, {\n              data: resolvedData,\n              src: invokeSource\n            }) : serviceCreator;\n\n            if (isPromiseLike(source)) {\n              this.state.children[id] = this.spawnPromise(Promise.resolve(source), id);\n            } else if (isFunction(source)) {\n              this.state.children[id] = this.spawnCallback(source, id);\n            } else if (isObservable(source)) {\n              this.state.children[id] = this.spawnObservable(source, id);\n            } else if (isMachine(source)) {\n              // TODO: try/catch here\n              this.state.children[id] = this.spawnMachine(resolvedData ? source.withContext(resolvedData) : source, {\n                id: id,\n                autoForward: autoForward\n              });\n            }\n          } else {\n            this.spawnActivity(activity);\n          }\n\n          break;\n        }\n\n      case stop:\n        {\n          this.stopChild(action.activity.id);\n          break;\n        }\n\n      case log:\n        var label = action.label,\n            value = action.value;\n\n        if (label) {\n          this.logger(label, value);\n        } else {\n          this.logger(value);\n        }\n\n        break;\n\n      default:\n        if (!IS_PRODUCTION) {\n          warn(false, \"No implementation found for action type '\" + action.type + \"'\");\n        }\n\n        break;\n    }\n\n    return undefined;\n  };\n\n  Interpreter.prototype.removeChild = function (childId) {\n    this.children.delete(childId);\n    this.forwardTo.delete(childId);\n    delete this.state.children[childId];\n  };\n\n  Interpreter.prototype.stopChild = function (childId) {\n    var child = this.children.get(childId);\n\n    if (!child) {\n      return;\n    }\n\n    this.removeChild(childId);\n\n    if (isFunction(child.stop)) {\n      child.stop();\n    }\n  };\n\n  Interpreter.prototype.spawn = function (entity, name, options) {\n    if (isPromiseLike(entity)) {\n      return this.spawnPromise(Promise.resolve(entity), name);\n    } else if (isFunction(entity)) {\n      return this.spawnCallback(entity, name);\n    } else if (isActor(entity)) {\n      return this.spawnActor(entity);\n    } else if (isObservable(entity)) {\n      return this.spawnObservable(entity, name);\n    } else if (isMachine(entity)) {\n      return this.spawnMachine(entity, __assign(__assign({}, options), {\n        id: name\n      }));\n    } else {\n      throw new Error(\"Unable to spawn entity \\\"\" + name + \"\\\" of type \\\"\" + typeof entity + \"\\\".\");\n    }\n  };\n\n  Interpreter.prototype.spawnMachine = function (machine, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    var childService = new Interpreter(machine, __assign(__assign({}, this.options), {\n      parent: this,\n      id: options.id || machine.id\n    }));\n\n    var resolvedOptions = __assign(__assign({}, DEFAULT_SPAWN_OPTIONS), options);\n\n    if (resolvedOptions.sync) {\n      childService.onTransition(function (state) {\n        _this.send(update, {\n          state: state,\n          id: childService.id\n        });\n      });\n    }\n\n    var actor = childService;\n    this.children.set(childService.id, actor);\n\n    if (resolvedOptions.autoForward) {\n      this.forwardTo.add(childService.id);\n    }\n\n    childService.onDone(function (doneEvent) {\n      _this.removeChild(childService.id);\n\n      _this.send(toSCXMLEvent(doneEvent, {\n        origin: childService.id\n      }));\n    }).start();\n    return actor;\n  };\n\n  Interpreter.prototype.spawnPromise = function (promise, id) {\n    var _this = this;\n\n    var canceled = false;\n    promise.then(function (response) {\n      if (!canceled) {\n        _this.removeChild(id);\n\n        _this.send(toSCXMLEvent(doneInvoke(id, response), {\n          origin: id\n        }));\n      }\n    }, function (errorData) {\n      if (!canceled) {\n        _this.removeChild(id);\n\n        var errorEvent = error(id, errorData);\n\n        try {\n          // Send \"error.platform.id\" to this (parent).\n          _this.send(toSCXMLEvent(errorEvent, {\n            origin: id\n          }));\n        } catch (error) {\n          reportUnhandledExceptionOnInvocation(errorData, error, id);\n\n          if (_this.devTools) {\n            _this.devTools.send(errorEvent, _this.state);\n          }\n\n          if (_this.machine.strict) {\n            // it would be better to always stop the state machine if unhandled\n            // exception/promise rejection happens but because we don't want to\n            // break existing code so enforce it on strict mode only especially so\n            // because documentation says that onError is optional\n            _this.stop();\n          }\n        }\n      }\n    });\n    var actor = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function (next, handleError, complete) {\n        var unsubscribed = false;\n        promise.then(function (response) {\n          if (unsubscribed) {\n            return;\n          }\n\n          next && next(response);\n\n          if (unsubscribed) {\n            return;\n          }\n\n          complete && complete();\n        }, function (err) {\n          if (unsubscribed) {\n            return;\n          }\n\n          handleError(err);\n        });\n        return {\n          unsubscribe: function () {\n            return unsubscribed = true;\n          }\n        };\n      },\n      stop: function () {\n        canceled = true;\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    };\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnCallback = function (callback, id) {\n    var _this = this;\n\n    var canceled = false;\n    var receivers = new Set();\n    var listeners = new Set();\n\n    var receive = function (e) {\n      listeners.forEach(function (listener) {\n        return listener(e);\n      });\n\n      if (canceled) {\n        return;\n      }\n\n      _this.send(e);\n    };\n\n    var callbackStop;\n\n    try {\n      callbackStop = callback(receive, function (newListener) {\n        receivers.add(newListener);\n      });\n    } catch (err) {\n      this.send(error(id, err));\n    }\n\n    if (isPromiseLike(callbackStop)) {\n      // it turned out to be an async function, can't reliably check this before calling `callback`\n      // because transpiled async functions are not recognizable\n      return this.spawnPromise(callbackStop, id);\n    }\n\n    var actor = {\n      id: id,\n      send: function (event) {\n        return receivers.forEach(function (receiver) {\n          return receiver(event);\n        });\n      },\n      subscribe: function (next) {\n        listeners.add(next);\n        return {\n          unsubscribe: function () {\n            listeners.delete(next);\n          }\n        };\n      },\n      stop: function () {\n        canceled = true;\n\n        if (isFunction(callbackStop)) {\n          callbackStop();\n        }\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    };\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnObservable = function (source, id) {\n    var _this = this;\n\n    var subscription = source.subscribe(function (value) {\n      _this.send(toSCXMLEvent(value, {\n        origin: id\n      }));\n    }, function (err) {\n      _this.removeChild(id);\n\n      _this.send(toSCXMLEvent(error(id, err), {\n        origin: id\n      }));\n    }, function () {\n      _this.removeChild(id);\n\n      _this.send(toSCXMLEvent(doneInvoke(id), {\n        origin: id\n      }));\n    });\n    var actor = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function (next, handleError, complete) {\n        return source.subscribe(next, handleError, complete);\n      },\n      stop: function () {\n        return subscription.unsubscribe();\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    };\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnActor = function (actor) {\n    this.children.set(actor.id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnActivity = function (activity) {\n    var implementation = this.machine.options && this.machine.options.activities ? this.machine.options.activities[activity.type] : undefined;\n\n    if (!implementation) {\n      if (!IS_PRODUCTION) {\n        warn(false, \"No implementation found for activity '\" + activity.type + \"'\");\n      } // tslint:disable-next-line:no-console\n\n\n      return;\n    } // Start implementation\n\n\n    var dispose = implementation(this.state.context, activity);\n    this.spawnEffect(activity.id, dispose);\n  };\n\n  Interpreter.prototype.spawnEffect = function (id, dispose) {\n    this.children.set(id, {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function () {\n        return {\n          unsubscribe: function () {\n            return void 0;\n          }\n        };\n      },\n      stop: dispose || undefined,\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    });\n  };\n\n  Interpreter.prototype.attachDev = function () {\n    if (this.options.devTools && typeof window !== 'undefined') {\n      if (window.__REDUX_DEVTOOLS_EXTENSION__) {\n        var devToolsOptions = typeof this.options.devTools === 'object' ? this.options.devTools : undefined;\n        this.devTools = window.__REDUX_DEVTOOLS_EXTENSION__.connect(__assign(__assign({\n          name: this.id,\n          autoPause: true,\n          stateSanitizer: function (state) {\n            return {\n              value: state.value,\n              context: state.context,\n              actions: state.actions\n            };\n          }\n        }, devToolsOptions), {\n          features: __assign({\n            jump: false,\n            skip: false\n          }, devToolsOptions ? devToolsOptions.features : undefined)\n        }), this.machine);\n        this.devTools.init(this.state);\n      } // add XState-specific dev tooling hook\n\n\n      registerService(this);\n    }\n  };\n\n  Interpreter.prototype.toJSON = function () {\n    return {\n      id: this.id\n    };\n  };\n\n  Interpreter.prototype[symbolObservable] = function () {\n    return this;\n  };\n  /**\r\n   * The default interpreter options:\r\n   *\r\n   * - `clock` uses the global `setTimeout` and `clearTimeout` functions\r\n   * - `logger` uses the global `console.log()` method\r\n   */\n\n\n  Interpreter.defaultOptions = /*#__PURE__*/function (global) {\n    return {\n      execute: true,\n      deferEvents: true,\n      clock: {\n        setTimeout: function (fn, ms) {\n          return global.setTimeout.call(null, fn, ms);\n        },\n        clearTimeout: function (id) {\n          return global.clearTimeout.call(null, id);\n        }\n      },\n      logger: global.console.log.bind(console),\n      devTools: false\n    };\n  }(typeof self !== 'undefined' ? self : global);\n\n  Interpreter.interpret = interpret;\n  return Interpreter;\n}();\n\nvar resolveSpawnOptions = function (nameOrOptions) {\n  if (isString(nameOrOptions)) {\n    return __assign(__assign({}, DEFAULT_SPAWN_OPTIONS), {\n      name: nameOrOptions\n    });\n  }\n\n  return __assign(__assign(__assign({}, DEFAULT_SPAWN_OPTIONS), {\n    name: uniqueId()\n  }), nameOrOptions);\n};\n\nfunction spawn(entity, nameOrOptions) {\n  var resolvedOptions = resolveSpawnOptions(nameOrOptions);\n  return consume(function (service) {\n    if (!IS_PRODUCTION) {\n      var isLazyEntity = isMachine(entity) || isFunction(entity);\n      warn(!!service || isLazyEntity, \"Attempted to spawn an Actor (ID: \\\"\" + (isMachine(entity) ? entity.id : 'undefined') + \"\\\") outside of a service. This will have no effect.\");\n    }\n\n    if (service) {\n      return service.spawn(entity, resolvedOptions.name, resolvedOptions);\n    } else {\n      return createDeferredActor(entity, resolvedOptions.name);\n    }\n  });\n}\n/**\r\n * Creates a new Interpreter instance for the given machine with the provided options, if any.\r\n *\r\n * @param machine The machine to interpret\r\n * @param options Interpreter options\r\n */\n\n\nfunction interpret(machine, options) {\n  var interpreter = new Interpreter(machine, options);\n  return interpreter;\n}\n\nexport { Interpreter, interpret, spawn };","import _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _typeof from \"@babel/runtime/helpers/typeof\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useContext } from 'react';\nimport HTML from 'html-parse-stringify2';\nimport { getI18n, I18nContext, getDefaults } from './context';\nimport { warn, warnOnce } from './utils';\n\nfunction hasChildren(node, checkLength) {\n  if (!node) return false;\n  var base = node.props ? node.props.children : node.children;\n  if (checkLength) return base.length > 0;\n  return !!base;\n}\n\nfunction getChildren(node) {\n  if (!node) return [];\n  return node && node.children ? node.children : node.props && node.props.children;\n}\n\nfunction hasValidReactChildren(children) {\n  if (Object.prototype.toString.call(children) !== '[object Array]') return false;\n  return children.every(function (child) {\n    return React.isValidElement(child);\n  });\n}\n\nfunction getAsArray(data) {\n  return Array.isArray(data) ? data : [data];\n}\n\nfunction mergeProps(source, target) {\n  var newTarget = _objectSpread({}, target);\n\n  newTarget.props = Object.assign(source.props, target.props);\n  return newTarget;\n}\n\nexport function nodesToString(children, i18nOptions) {\n  if (!children) return '';\n  var stringNode = '';\n  var childrenArray = getAsArray(children);\n  var keepArray = i18nOptions.transKeepBasicHtmlNodesFor || [];\n  childrenArray.forEach(function (child, childIndex) {\n    if (typeof child === 'string') {\n      stringNode += \"\".concat(child);\n    } else if (React.isValidElement(child)) {\n      var childPropsCount = Object.keys(child.props).length;\n      var shouldKeepChild = keepArray.indexOf(child.type) > -1;\n      var childChildren = child.props.children;\n\n      if (!childChildren && shouldKeepChild && childPropsCount === 0) {\n        stringNode += \"<\".concat(child.type, \"/>\");\n      } else if (!childChildren && (!shouldKeepChild || childPropsCount !== 0)) {\n        stringNode += \"<\".concat(childIndex, \"></\").concat(childIndex, \">\");\n      } else if (child.props.i18nIsDynamicList) {\n        stringNode += \"<\".concat(childIndex, \"></\").concat(childIndex, \">\");\n      } else if (shouldKeepChild && childPropsCount === 1 && typeof childChildren === 'string') {\n        stringNode += \"<\".concat(child.type, \">\").concat(childChildren, \"</\").concat(child.type, \">\");\n      } else {\n        var content = nodesToString(childChildren, i18nOptions);\n        stringNode += \"<\".concat(childIndex, \">\").concat(content, \"</\").concat(childIndex, \">\");\n      }\n    } else if (_typeof(child) === 'object') {\n      var format = child.format,\n          clone = _objectWithoutProperties(child, [\"format\"]);\n\n      var keys = Object.keys(clone);\n\n      if (keys.length === 1) {\n        var value = format ? \"\".concat(keys[0], \", \").concat(format) : keys[0];\n        stringNode += \"{{\".concat(value, \"}}\");\n      } else {\n        warn(\"react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.\", child);\n      }\n    } else {\n      warn(\"Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.\", child);\n    }\n  });\n  return stringNode;\n}\n\nfunction renderNodes(children, targetString, i18n, i18nOptions, combinedTOpts) {\n  if (targetString === '') return [];\n  var keepArray = i18nOptions.transKeepBasicHtmlNodesFor || [];\n  var emptyChildrenButNeedsHandling = targetString && new RegExp(keepArray.join('|')).test(targetString);\n  if (!children && !emptyChildrenButNeedsHandling) return [targetString];\n  var data = {};\n\n  function getData(childs) {\n    var childrenArray = getAsArray(childs);\n    childrenArray.forEach(function (child) {\n      if (typeof child === 'string') return;\n      if (hasChildren(child)) getData(getChildren(child));else if (_typeof(child) === 'object' && !React.isValidElement(child)) Object.assign(data, child);\n    });\n  }\n\n  getData(children);\n  var interpolatedString = i18n.services.interpolator.interpolate(targetString, _objectSpread(_objectSpread({}, data), combinedTOpts), i18n.language);\n  var ast = HTML.parse(\"<0>\".concat(interpolatedString, \"</0>\"));\n\n  function renderInner(child, node, rootReactNode) {\n    var childs = getChildren(child);\n    var mappedChildren = mapAST(childs, node.children, rootReactNode);\n    return hasValidReactChildren(childs) && mappedChildren.length === 0 ? childs : mappedChildren;\n  }\n\n  function pushTranslatedJSX(child, inner, mem, i) {\n    if (child.dummy) child.children = inner;\n    mem.push(React.cloneElement(child, _objectSpread(_objectSpread({}, child.props), {}, {\n      key: i\n    }), inner));\n  }\n\n  function mapAST(reactNode, astNode, rootReactNode) {\n    var reactNodes = getAsArray(reactNode);\n    var astNodes = getAsArray(astNode);\n    return astNodes.reduce(function (mem, node, i) {\n      var translationContent = node.children && node.children[0] && node.children[0].content;\n\n      if (node.type === 'tag') {\n        var tmp = reactNodes[parseInt(node.name, 10)];\n        if (!tmp && rootReactNode.length === 1 && rootReactNode[0][node.name]) tmp = rootReactNode[0][node.name];\n        if (!tmp) tmp = {};\n        var child = Object.keys(node.attrs).length !== 0 ? mergeProps({\n          props: node.attrs\n        }, tmp) : tmp;\n        var isElement = React.isValidElement(child);\n        var isValidTranslationWithChildren = isElement && hasChildren(node, true) && !node.voidElement;\n        var isEmptyTransWithHTML = emptyChildrenButNeedsHandling && _typeof(child) === 'object' && child.dummy && !isElement;\n        var isKnownComponent = _typeof(children) === 'object' && children !== null && Object.hasOwnProperty.call(children, node.name);\n\n        if (typeof child === 'string') {\n          mem.push(child);\n        } else if (hasChildren(child) || isValidTranslationWithChildren) {\n            var inner = renderInner(child, node, rootReactNode);\n            pushTranslatedJSX(child, inner, mem, i);\n          } else if (isEmptyTransWithHTML) {\n          var _inner = mapAST(reactNodes, node.children, rootReactNode);\n\n          mem.push(React.cloneElement(child, _objectSpread(_objectSpread({}, child.props), {}, {\n            key: i\n          }), _inner));\n        } else if (Number.isNaN(parseFloat(node.name))) {\n          if (isKnownComponent) {\n            var _inner2 = renderInner(child, node, rootReactNode);\n\n            pushTranslatedJSX(child, _inner2, mem, i);\n          } else if (i18nOptions.transSupportBasicHtmlNodes && keepArray.indexOf(node.name) > -1) {\n            if (node.voidElement) {\n              mem.push(React.createElement(node.name, {\n                key: \"\".concat(node.name, \"-\").concat(i)\n              }));\n            } else {\n              var _inner3 = mapAST(reactNodes, node.children, rootReactNode);\n\n              mem.push(React.createElement(node.name, {\n                key: \"\".concat(node.name, \"-\").concat(i)\n              }, _inner3));\n            }\n          } else if (node.voidElement) {\n            mem.push(\"<\".concat(node.name, \" />\"));\n          } else {\n            var _inner4 = mapAST(reactNodes, node.children, rootReactNode);\n\n            mem.push(\"<\".concat(node.name, \">\").concat(_inner4, \"</\").concat(node.name, \">\"));\n          }\n        } else if (_typeof(child) === 'object' && !isElement) {\n          var content = node.children[0] ? translationContent : null;\n          if (content) mem.push(content);\n        } else if (node.children.length === 1 && translationContent) {\n          mem.push(React.cloneElement(child, _objectSpread(_objectSpread({}, child.props), {}, {\n            key: i\n          }), translationContent));\n        } else {\n          mem.push(React.cloneElement(child, _objectSpread(_objectSpread({}, child.props), {}, {\n            key: i\n          })));\n        }\n      } else if (node.type === 'text') {\n        mem.push(node.content);\n      }\n\n      return mem;\n    }, []);\n  }\n\n  var result = mapAST([{\n    dummy: true,\n    children: children\n  }], ast, getAsArray(children || []));\n  return getChildren(result[0]);\n}\n\nexport function Trans(_ref) {\n  var children = _ref.children,\n      count = _ref.count,\n      parent = _ref.parent,\n      i18nKey = _ref.i18nKey,\n      tOptions = _ref.tOptions,\n      values = _ref.values,\n      defaults = _ref.defaults,\n      components = _ref.components,\n      ns = _ref.ns,\n      i18nFromProps = _ref.i18n,\n      tFromProps = _ref.t,\n      additionalProps = _objectWithoutProperties(_ref, [\"children\", \"count\", \"parent\", \"i18nKey\", \"tOptions\", \"values\", \"defaults\", \"components\", \"ns\", \"i18n\", \"t\"]);\n\n  var _ref2 = useContext(I18nContext) || {},\n      i18nFromContext = _ref2.i18n,\n      defaultNSFromContext = _ref2.defaultNS;\n\n  var i18n = i18nFromProps || i18nFromContext || getI18n();\n\n  if (!i18n) {\n    warnOnce('You will need to pass in an i18next instance by using i18nextReactModule');\n    return children;\n  }\n\n  var t = tFromProps || i18n.t.bind(i18n) || function (k) {\n    return k;\n  };\n\n  var reactI18nextOptions = _objectSpread(_objectSpread({}, getDefaults()), i18n.options && i18n.options.react);\n\n  var namespaces = ns || t.ns || defaultNSFromContext || i18n.options && i18n.options.defaultNS;\n  namespaces = typeof namespaces === 'string' ? [namespaces] : namespaces || ['translation'];\n  var defaultValue = defaults || nodesToString(children, reactI18nextOptions) || reactI18nextOptions.transEmptyNodeValue || i18nKey;\n  var hashTransKey = reactI18nextOptions.hashTransKey;\n  var key = i18nKey || (hashTransKey ? hashTransKey(defaultValue) : defaultValue);\n  var interpolationOverride = values ? {} : {\n    interpolation: {\n      prefix: '#$?',\n      suffix: '?$#'\n    }\n  };\n\n  var combinedTOpts = _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, tOptions), {}, {\n    count: count\n  }, values), interpolationOverride), {}, {\n    defaultValue: defaultValue,\n    ns: namespaces\n  });\n\n  var translation = key ? t(key, combinedTOpts) : defaultValue;\n  var content = renderNodes(components || children, translation, i18n, reactI18nextOptions, combinedTOpts);\n  var useAsParent = parent !== undefined ? parent : reactI18nextOptions.defaultTransParent;\n  return useAsParent ? React.createElement(useAsParent, additionalProps, content) : content;\n}","import { __assign, __rest } from './_virtual/_tslib.js';\nimport { invoke } from './actionTypes.js';\nimport './actions.js';\n\nfunction toInvokeSource(src) {\n  if (typeof src === 'string') {\n    var simpleSrc = {\n      type: src\n    };\n\n    simpleSrc.toString = function () {\n      return src;\n    }; // v4 compat - TODO: remove in v5\n\n\n    return simpleSrc;\n  }\n\n  return src;\n}\n\nfunction toInvokeDefinition(invokeConfig) {\n  return __assign(__assign({\n    type: invoke\n  }, invokeConfig), {\n    toJSON: function () {\n      var onDone = invokeConfig.onDone,\n          onError = invokeConfig.onError,\n          invokeDef = __rest(invokeConfig, [\"onDone\", \"onError\"]);\n\n      return __assign(__assign({}, invokeDef), {\n        type: invoke,\n        src: toInvokeSource(invokeConfig.src)\n      });\n    }\n  });\n}\n\nexport { toInvokeDefinition, toInvokeSource };","import { __assign, __values, __spread, __read, __rest } from './_virtual/_tslib.js';\nimport { STATE_DELIMITER } from './constants.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { mapValues, isArray, flatten, keys, toArray, toStateValue, isString, getEventType, matchesState, path, evaluateGuard, mapContext, toSCXMLEvent, pathToStateValue, isBuiltInEvent, partition, updateHistoryValue, toStatePath, mapFilterValues, warn, toStatePaths, nestedPath, normalizeTarget, toGuard, toTransitionConfigArray, isMachine, isFunction } from './utils.js';\nimport { SpecialTargets } from './types.js';\nimport { getAllStateNodes, getConfiguration, has, getChildren, isInFinalState, getValue, isLeafNode } from './stateUtils.js';\nimport { start as start$1, stop as stop$1, invoke, update, nullEvent, raise as raise$1, send as send$1 } from './actionTypes.js';\nimport { done, start, raise, stop, toActionObjects, resolveActions, doneInvoke, error, toActionObject, toActivityDefinition, after, send, cancel, initEvent } from './actions.js';\nimport { State, stateValuesEqual } from './State.js';\nimport { createInvocableActor } from './Actor.js';\nimport { toInvokeDefinition } from './invokeUtils.js';\nvar NULL_EVENT = '';\nvar STATE_IDENTIFIER = '#';\nvar WILDCARD = '*';\nvar EMPTY_OBJECT = {};\n\nvar isStateId = function (str) {\n  return str[0] === STATE_IDENTIFIER;\n};\n\nvar createDefaultOptions = function () {\n  return {\n    actions: {},\n    guards: {},\n    services: {},\n    activities: {},\n    delays: {}\n  };\n};\n\nvar validateArrayifiedTransitions = function (stateNode, event, transitions) {\n  var hasNonLastUnguardedTarget = transitions.slice(0, -1).some(function (transition) {\n    return !('cond' in transition) && !('in' in transition) && (isString(transition.target) || isMachine(transition.target));\n  });\n  var eventText = event === NULL_EVENT ? 'the transient event' : \"event '\" + event + \"'\";\n  warn(!hasNonLastUnguardedTarget, \"One or more transitions for \" + eventText + \" on state '\" + stateNode.id + \"' are unreachable. \" + \"Make sure that the default transition is the last one defined.\");\n};\n\nvar StateNode =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  function StateNode(\n  /**\r\n   * The raw config used to create the machine.\r\n   */\n  config, options,\n  /**\r\n   * The initial extended state\r\n   */\n  context) {\n    var _this = this;\n\n    this.config = config;\n    this.context = context;\n    /**\r\n     * The order this state node appears. Corresponds to the implicit SCXML document order.\r\n     */\n\n    this.order = -1;\n    this.__xstatenode = true;\n    this.__cache = {\n      events: undefined,\n      relativeValue: new Map(),\n      initialStateValue: undefined,\n      initialState: undefined,\n      on: undefined,\n      transitions: undefined,\n      candidates: {},\n      delayedTransitions: undefined\n    };\n    this.idMap = {};\n    this.options = Object.assign(createDefaultOptions(), options);\n    this.parent = this.options._parent;\n    this.key = this.config.key || this.options._key || this.config.id || '(machine)';\n    this.machine = this.parent ? this.parent.machine : this;\n    this.path = this.parent ? this.parent.path.concat(this.key) : [];\n    this.delimiter = this.config.delimiter || (this.parent ? this.parent.delimiter : STATE_DELIMITER);\n    this.id = this.config.id || __spread([this.machine.key], this.path).join(this.delimiter);\n    this.version = this.parent ? this.parent.version : this.config.version;\n    this.type = this.config.type || (this.config.parallel ? 'parallel' : this.config.states && keys(this.config.states).length ? 'compound' : this.config.history ? 'history' : 'atomic');\n\n    if (!IS_PRODUCTION) {\n      warn(!('parallel' in this.config), \"The \\\"parallel\\\" property is deprecated and will be removed in version 4.1. \" + (this.config.parallel ? \"Replace with `type: 'parallel'`\" : \"Use `type: '\" + this.type + \"'`\") + \" in the config for state node '\" + this.id + \"' instead.\");\n    }\n\n    this.initial = this.config.initial;\n    this.states = this.config.states ? mapValues(this.config.states, function (stateConfig, key) {\n      var _a;\n\n      var stateNode = new StateNode(stateConfig, {\n        _parent: _this,\n        _key: key\n      });\n      Object.assign(_this.idMap, __assign((_a = {}, _a[stateNode.id] = stateNode, _a), stateNode.idMap));\n      return stateNode;\n    }) : EMPTY_OBJECT; // Document order\n\n    var order = 0;\n\n    function dfs(stateNode) {\n      var e_1, _a;\n\n      stateNode.order = order++;\n\n      try {\n        for (var _b = __values(getChildren(stateNode)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var child = _c.value;\n          dfs(child);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n    }\n\n    dfs(this); // History config\n\n    this.history = this.config.history === true ? 'shallow' : this.config.history || false;\n    this._transient = !!this.config.always || (!this.config.on ? false : Array.isArray(this.config.on) ? this.config.on.some(function (_a) {\n      var event = _a.event;\n      return event === NULL_EVENT;\n    }) : NULL_EVENT in this.config.on);\n    this.strict = !!this.config.strict; // TODO: deprecate (entry)\n\n    this.onEntry = toArray(this.config.entry || this.config.onEntry).map(function (action) {\n      return toActionObject(action);\n    }); // TODO: deprecate (exit)\n\n    this.onExit = toArray(this.config.exit || this.config.onExit).map(function (action) {\n      return toActionObject(action);\n    });\n    this.meta = this.config.meta;\n    this.doneData = this.type === 'final' ? this.config.data : undefined;\n    this.invoke = toArray(this.config.invoke).map(function (invokeConfig, i) {\n      var _a, _b;\n\n      if (isMachine(invokeConfig)) {\n        _this.machine.options.services = __assign((_a = {}, _a[invokeConfig.id] = invokeConfig, _a), _this.machine.options.services);\n        return toInvokeDefinition({\n          src: invokeConfig.id,\n          id: invokeConfig.id\n        });\n      } else if (isString(invokeConfig.src)) {\n        return toInvokeDefinition(__assign(__assign({}, invokeConfig), {\n          id: invokeConfig.id || invokeConfig.src,\n          src: invokeConfig.src\n        }));\n      } else if (isMachine(invokeConfig.src) || isFunction(invokeConfig.src)) {\n        var invokeSrc = _this.id + \":invocation[\" + i + \"]\"; // TODO: util function\n\n        _this.machine.options.services = __assign((_b = {}, _b[invokeSrc] = invokeConfig.src, _b), _this.machine.options.services);\n        return toInvokeDefinition(__assign(__assign({\n          id: invokeSrc\n        }, invokeConfig), {\n          src: invokeSrc\n        }));\n      } else {\n        var invokeSource = invokeConfig.src;\n        return toInvokeDefinition(__assign(__assign({\n          id: invokeSource.type\n        }, invokeConfig), {\n          src: invokeSource\n        }));\n      }\n    });\n    this.activities = toArray(this.config.activities).concat(this.invoke).map(function (activity) {\n      return toActivityDefinition(activity);\n    });\n    this.transition = this.transition.bind(this); // TODO: this is the real fix for initialization once\n    // state node getters are deprecated\n    // if (!this.parent) {\n    //   this._init();\n    // }\n  }\n\n  StateNode.prototype._init = function () {\n    if (this.__cache.transitions) {\n      return;\n    }\n\n    getAllStateNodes(this).forEach(function (stateNode) {\n      return stateNode.on;\n    });\n  };\n  /**\r\n   * Clones this state machine with custom options and context.\r\n   *\r\n   * @param options Options (actions, guards, activities, services) to recursively merge with the existing options.\r\n   * @param context Custom context (will override predefined context)\r\n   */\n\n\n  StateNode.prototype.withConfig = function (options, context) {\n    if (context === void 0) {\n      context = this.context;\n    }\n\n    var _a = this.options,\n        actions = _a.actions,\n        activities = _a.activities,\n        guards = _a.guards,\n        services = _a.services,\n        delays = _a.delays;\n    return new StateNode(this.config, {\n      actions: __assign(__assign({}, actions), options.actions),\n      activities: __assign(__assign({}, activities), options.activities),\n      guards: __assign(__assign({}, guards), options.guards),\n      services: __assign(__assign({}, services), options.services),\n      delays: __assign(__assign({}, delays), options.delays)\n    }, context);\n  };\n  /**\r\n   * Clones this state machine with custom context.\r\n   *\r\n   * @param context Custom context (will override predefined context, not recursive)\r\n   */\n\n\n  StateNode.prototype.withContext = function (context) {\n    return new StateNode(this.config, this.options, context);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"definition\", {\n    /**\r\n     * The well-structured state node definition.\r\n     */\n    get: function () {\n      return {\n        id: this.id,\n        key: this.key,\n        version: this.version,\n        context: this.context,\n        type: this.type,\n        initial: this.initial,\n        history: this.history,\n        states: mapValues(this.states, function (state) {\n          return state.definition;\n        }),\n        on: this.on,\n        transitions: this.transitions,\n        entry: this.onEntry,\n        exit: this.onExit,\n        activities: this.activities || [],\n        meta: this.meta,\n        order: this.order || -1,\n        data: this.doneData,\n        invoke: this.invoke\n      };\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateNode.prototype.toJSON = function () {\n    return this.definition;\n  };\n\n  Object.defineProperty(StateNode.prototype, \"on\", {\n    /**\r\n     * The mapping of events to transitions.\r\n     */\n    get: function () {\n      if (this.__cache.on) {\n        return this.__cache.on;\n      }\n\n      var transitions = this.transitions;\n      return this.__cache.on = transitions.reduce(function (map, transition) {\n        map[transition.eventType] = map[transition.eventType] || [];\n        map[transition.eventType].push(transition);\n        return map;\n      }, {});\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"after\", {\n    get: function () {\n      return this.__cache.delayedTransitions || (this.__cache.delayedTransitions = this.getDelayedTransitions(), this.__cache.delayedTransitions);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"transitions\", {\n    /**\r\n     * All the transitions that can be taken from this state node.\r\n     */\n    get: function () {\n      return this.__cache.transitions || (this.__cache.transitions = this.formatTransitions(), this.__cache.transitions);\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateNode.prototype.getCandidates = function (eventName) {\n    if (this.__cache.candidates[eventName]) {\n      return this.__cache.candidates[eventName];\n    }\n\n    var transient = eventName === NULL_EVENT;\n    var candidates = this.transitions.filter(function (transition) {\n      var sameEventType = transition.eventType === eventName; // null events should only match against eventless transitions\n\n      return transient ? sameEventType : sameEventType || transition.eventType === WILDCARD;\n    });\n    this.__cache.candidates[eventName] = candidates;\n    return candidates;\n  };\n  /**\r\n   * All delayed transitions from the config.\r\n   */\n\n\n  StateNode.prototype.getDelayedTransitions = function () {\n    var _this = this;\n\n    var afterConfig = this.config.after;\n\n    if (!afterConfig) {\n      return [];\n    }\n\n    var mutateEntryExit = function (delay, i) {\n      var delayRef = isFunction(delay) ? _this.id + \":delay[\" + i + \"]\" : delay;\n      var eventType = after(delayRef, _this.id);\n\n      _this.onEntry.push(send(eventType, {\n        delay: delay\n      }));\n\n      _this.onExit.push(cancel(eventType));\n\n      return eventType;\n    };\n\n    var delayedTransitions = isArray(afterConfig) ? afterConfig.map(function (transition, i) {\n      var eventType = mutateEntryExit(transition.delay, i);\n      return __assign(__assign({}, transition), {\n        event: eventType\n      });\n    }) : flatten(keys(afterConfig).map(function (delay, i) {\n      var configTransition = afterConfig[delay];\n      var resolvedTransition = isString(configTransition) ? {\n        target: configTransition\n      } : configTransition;\n      var resolvedDelay = !isNaN(+delay) ? +delay : delay;\n      var eventType = mutateEntryExit(resolvedDelay, i);\n      return toArray(resolvedTransition).map(function (transition) {\n        return __assign(__assign({}, transition), {\n          event: eventType,\n          delay: resolvedDelay\n        });\n      });\n    }));\n    return delayedTransitions.map(function (delayedTransition) {\n      var delay = delayedTransition.delay;\n      return __assign(__assign({}, _this.formatTransition(delayedTransition)), {\n        delay: delay\n      });\n    });\n  };\n  /**\r\n   * Returns the state nodes represented by the current state value.\r\n   *\r\n   * @param state The state value or State instance\r\n   */\n\n\n  StateNode.prototype.getStateNodes = function (state) {\n    var _a;\n\n    var _this = this;\n\n    if (!state) {\n      return [];\n    }\n\n    var stateValue = state instanceof State ? state.value : toStateValue(state, this.delimiter);\n\n    if (isString(stateValue)) {\n      var initialStateValue = this.getStateNode(stateValue).initial;\n      return initialStateValue !== undefined ? this.getStateNodes((_a = {}, _a[stateValue] = initialStateValue, _a)) : [this.states[stateValue]];\n    }\n\n    var subStateKeys = keys(stateValue);\n    var subStateNodes = subStateKeys.map(function (subStateKey) {\n      return _this.getStateNode(subStateKey);\n    });\n    return subStateNodes.concat(subStateKeys.reduce(function (allSubStateNodes, subStateKey) {\n      var subStateNode = _this.getStateNode(subStateKey).getStateNodes(stateValue[subStateKey]);\n\n      return allSubStateNodes.concat(subStateNode);\n    }, []));\n  };\n  /**\r\n   * Returns `true` if this state node explicitly handles the given event.\r\n   *\r\n   * @param event The event in question\r\n   */\n\n\n  StateNode.prototype.handles = function (event) {\n    var eventType = getEventType(event);\n    return this.events.includes(eventType);\n  };\n  /**\r\n   * Resolves the given `state` to a new `State` instance relative to this machine.\r\n   *\r\n   * This ensures that `.events` and `.nextEvents` represent the correct values.\r\n   *\r\n   * @param state The state to resolve\r\n   */\n\n\n  StateNode.prototype.resolveState = function (state) {\n    var configuration = Array.from(getConfiguration([], this.getStateNodes(state.value)));\n    return new State(__assign(__assign({}, state), {\n      value: this.resolve(state.value),\n      configuration: configuration\n    }));\n  };\n\n  StateNode.prototype.transitionLeafNode = function (stateValue, state, _event) {\n    var stateNode = this.getStateNode(stateValue);\n    var next = stateNode.next(state, _event);\n\n    if (!next || !next.transitions.length) {\n      return this.next(state, _event);\n    }\n\n    return next;\n  };\n\n  StateNode.prototype.transitionCompoundNode = function (stateValue, state, _event) {\n    var subStateKeys = keys(stateValue);\n    var stateNode = this.getStateNode(subStateKeys[0]);\n\n    var next = stateNode._transition(stateValue[subStateKeys[0]], state, _event);\n\n    if (!next || !next.transitions.length) {\n      return this.next(state, _event);\n    }\n\n    return next;\n  };\n\n  StateNode.prototype.transitionParallelNode = function (stateValue, state, _event) {\n    var e_2, _a;\n\n    var transitionMap = {};\n\n    try {\n      for (var _b = __values(keys(stateValue)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var subStateKey = _c.value;\n        var subStateValue = stateValue[subStateKey];\n\n        if (!subStateValue) {\n          continue;\n        }\n\n        var subStateNode = this.getStateNode(subStateKey);\n\n        var next = subStateNode._transition(subStateValue, state, _event);\n\n        if (next) {\n          transitionMap[subStateKey] = next;\n        }\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    var stateTransitions = keys(transitionMap).map(function (key) {\n      return transitionMap[key];\n    });\n    var enabledTransitions = flatten(stateTransitions.map(function (st) {\n      return st.transitions;\n    }));\n    var willTransition = stateTransitions.some(function (st) {\n      return st.transitions.length > 0;\n    });\n\n    if (!willTransition) {\n      return this.next(state, _event);\n    }\n\n    var entryNodes = flatten(stateTransitions.map(function (t) {\n      return t.entrySet;\n    }));\n    var configuration = flatten(keys(transitionMap).map(function (key) {\n      return transitionMap[key].configuration;\n    }));\n    return {\n      transitions: enabledTransitions,\n      entrySet: entryNodes,\n      exitSet: flatten(stateTransitions.map(function (t) {\n        return t.exitSet;\n      })),\n      configuration: configuration,\n      source: state,\n      actions: flatten(keys(transitionMap).map(function (key) {\n        return transitionMap[key].actions;\n      }))\n    };\n  };\n\n  StateNode.prototype._transition = function (stateValue, state, _event) {\n    // leaf node\n    if (isString(stateValue)) {\n      return this.transitionLeafNode(stateValue, state, _event);\n    } // hierarchical node\n\n\n    if (keys(stateValue).length === 1) {\n      return this.transitionCompoundNode(stateValue, state, _event);\n    } // orthogonal node\n\n\n    return this.transitionParallelNode(stateValue, state, _event);\n  };\n\n  StateNode.prototype.next = function (state, _event) {\n    var e_3, _a;\n\n    var _this = this;\n\n    var eventName = _event.name;\n    var actions = [];\n    var nextStateNodes = [];\n    var selectedTransition;\n\n    try {\n      for (var _b = __values(this.getCandidates(eventName)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var candidate = _c.value;\n        var cond = candidate.cond,\n            stateIn = candidate.in;\n        var resolvedContext = state.context;\n        var isInState = stateIn ? isString(stateIn) && isStateId(stateIn) ? // Check if in state by ID\n        state.matches(toStateValue(this.getStateNodeById(stateIn).path, this.delimiter)) : // Check if in state by relative grandparent\n        matchesState(toStateValue(stateIn, this.delimiter), path(this.path.slice(0, -2))(state.value)) : true;\n        var guardPassed = false;\n\n        try {\n          guardPassed = !cond || evaluateGuard(this.machine, cond, resolvedContext, _event, state);\n        } catch (err) {\n          throw new Error(\"Unable to evaluate guard '\" + (cond.name || cond.type) + \"' in transition for event '\" + eventName + \"' in state node '\" + this.id + \"':\\n\" + err.message);\n        }\n\n        if (guardPassed && isInState) {\n          if (candidate.target !== undefined) {\n            nextStateNodes = candidate.target;\n          }\n\n          actions.push.apply(actions, __spread(candidate.actions));\n          selectedTransition = candidate;\n          break;\n        }\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    if (!selectedTransition) {\n      return undefined;\n    }\n\n    if (!nextStateNodes.length) {\n      return {\n        transitions: [selectedTransition],\n        entrySet: [],\n        exitSet: [],\n        configuration: state.value ? [this] : [],\n        source: state,\n        actions: actions\n      };\n    }\n\n    var allNextStateNodes = flatten(nextStateNodes.map(function (stateNode) {\n      return _this.getRelativeStateNodes(stateNode, state.historyValue);\n    }));\n    var isInternal = !!selectedTransition.internal;\n    var reentryNodes = isInternal ? [] : flatten(allNextStateNodes.map(function (n) {\n      return _this.nodesFromChild(n);\n    }));\n    return {\n      transitions: [selectedTransition],\n      entrySet: reentryNodes,\n      exitSet: isInternal ? [] : [this],\n      configuration: allNextStateNodes,\n      source: state,\n      actions: actions\n    };\n  };\n\n  StateNode.prototype.nodesFromChild = function (childStateNode) {\n    if (childStateNode.escapes(this)) {\n      return [];\n    }\n\n    var nodes = [];\n    var marker = childStateNode;\n\n    while (marker && marker !== this) {\n      nodes.push(marker);\n      marker = marker.parent;\n    }\n\n    nodes.push(this); // inclusive\n\n    return nodes;\n  };\n  /**\r\n   * Whether the given state node \"escapes\" this state node. If the `stateNode` is equal to or the parent of\r\n   * this state node, it does not escape.\r\n   */\n\n\n  StateNode.prototype.escapes = function (stateNode) {\n    if (this === stateNode) {\n      return false;\n    }\n\n    var parent = this.parent;\n\n    while (parent) {\n      if (parent === stateNode) {\n        return false;\n      }\n\n      parent = parent.parent;\n    }\n\n    return true;\n  };\n\n  StateNode.prototype.getActions = function (transition, currentContext, _event, prevState) {\n    var e_4, _a, e_5, _b;\n\n    var prevConfig = getConfiguration([], prevState ? this.getStateNodes(prevState.value) : [this]);\n    var resolvedConfig = transition.configuration.length ? getConfiguration(prevConfig, transition.configuration) : prevConfig;\n\n    try {\n      for (var resolvedConfig_1 = __values(resolvedConfig), resolvedConfig_1_1 = resolvedConfig_1.next(); !resolvedConfig_1_1.done; resolvedConfig_1_1 = resolvedConfig_1.next()) {\n        var sn = resolvedConfig_1_1.value;\n\n        if (!has(prevConfig, sn)) {\n          transition.entrySet.push(sn);\n        }\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (resolvedConfig_1_1 && !resolvedConfig_1_1.done && (_a = resolvedConfig_1.return)) _a.call(resolvedConfig_1);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n\n    try {\n      for (var prevConfig_1 = __values(prevConfig), prevConfig_1_1 = prevConfig_1.next(); !prevConfig_1_1.done; prevConfig_1_1 = prevConfig_1.next()) {\n        var sn = prevConfig_1_1.value;\n\n        if (!has(resolvedConfig, sn) || has(transition.exitSet, sn.parent)) {\n          transition.exitSet.push(sn);\n        }\n      }\n    } catch (e_5_1) {\n      e_5 = {\n        error: e_5_1\n      };\n    } finally {\n      try {\n        if (prevConfig_1_1 && !prevConfig_1_1.done && (_b = prevConfig_1.return)) _b.call(prevConfig_1);\n      } finally {\n        if (e_5) throw e_5.error;\n      }\n    }\n\n    if (!transition.source) {\n      transition.exitSet = []; // Ensure that root StateNode (machine) is entered\n\n      transition.entrySet.push(this);\n    }\n\n    var doneEvents = flatten(transition.entrySet.map(function (sn) {\n      var events = [];\n\n      if (sn.type !== 'final') {\n        return events;\n      }\n\n      var parent = sn.parent;\n\n      if (!parent.parent) {\n        return events;\n      }\n\n      events.push(done(sn.id, sn.doneData), // TODO: deprecate - final states should not emit done events for their own state.\n      done(parent.id, sn.doneData ? mapContext(sn.doneData, currentContext, _event) : undefined));\n      var grandparent = parent.parent;\n\n      if (grandparent.type === 'parallel') {\n        if (getChildren(grandparent).every(function (parentNode) {\n          return isInFinalState(transition.configuration, parentNode);\n        })) {\n          events.push(done(grandparent.id));\n        }\n      }\n\n      return events;\n    }));\n    transition.exitSet.sort(function (a, b) {\n      return b.order - a.order;\n    });\n    transition.entrySet.sort(function (a, b) {\n      return a.order - b.order;\n    });\n    var entryStates = new Set(transition.entrySet);\n    var exitStates = new Set(transition.exitSet);\n\n    var _c = __read([flatten(Array.from(entryStates).map(function (stateNode) {\n      return __spread(stateNode.activities.map(function (activity) {\n        return start(activity);\n      }), stateNode.onEntry);\n    })).concat(doneEvents.map(raise)), flatten(Array.from(exitStates).map(function (stateNode) {\n      return __spread(stateNode.onExit, stateNode.activities.map(function (activity) {\n        return stop(activity);\n      }));\n    }))], 2),\n        entryActions = _c[0],\n        exitActions = _c[1];\n\n    var actions = toActionObjects(exitActions.concat(transition.actions).concat(entryActions), this.machine.options.actions);\n    return actions;\n  };\n  /**\r\n   * Determines the next state given the current `state` and sent `event`.\r\n   *\r\n   * @param state The current State instance or state value\r\n   * @param event The event that was sent at the current state\r\n   * @param context The current context (extended state) of the current state\r\n   */\n\n\n  StateNode.prototype.transition = function (state, event, context) {\n    if (state === void 0) {\n      state = this.initialState;\n    }\n\n    var _event = toSCXMLEvent(event);\n\n    var currentState;\n\n    if (state instanceof State) {\n      currentState = context === undefined ? state : this.resolveState(State.from(state, context));\n    } else {\n      var resolvedStateValue = isString(state) ? this.resolve(pathToStateValue(this.getResolvedPath(state))) : this.resolve(state);\n      var resolvedContext = context ? context : this.machine.context;\n      currentState = this.resolveState(State.from(resolvedStateValue, resolvedContext));\n    }\n\n    if (!IS_PRODUCTION && _event.name === WILDCARD) {\n      throw new Error(\"An event cannot have the wildcard type ('\" + WILDCARD + \"')\");\n    }\n\n    if (this.strict) {\n      if (!this.events.includes(_event.name) && !isBuiltInEvent(_event.name)) {\n        throw new Error(\"Machine '\" + this.id + \"' does not accept event '\" + _event.name + \"'\");\n      }\n    }\n\n    var stateTransition = this._transition(currentState.value, currentState, _event) || {\n      transitions: [],\n      configuration: [],\n      entrySet: [],\n      exitSet: [],\n      source: currentState,\n      actions: []\n    };\n    var prevConfig = getConfiguration([], this.getStateNodes(currentState.value));\n    var resolvedConfig = stateTransition.configuration.length ? getConfiguration(prevConfig, stateTransition.configuration) : prevConfig;\n    stateTransition.configuration = __spread(resolvedConfig);\n    return this.resolveTransition(stateTransition, currentState, _event);\n  };\n\n  StateNode.prototype.resolveRaisedTransition = function (state, _event, originalEvent) {\n    var _a;\n\n    var currentActions = state.actions;\n    state = this.transition(state, _event); // Save original event to state\n    // TODO: this should be the raised event! Delete in V5 (breaking)\n\n    state._event = originalEvent;\n    state.event = originalEvent.data;\n\n    (_a = state.actions).unshift.apply(_a, __spread(currentActions));\n\n    return state;\n  };\n\n  StateNode.prototype.resolveTransition = function (stateTransition, currentState, _event, context) {\n    var e_6, _a;\n\n    var _this = this;\n\n    if (_event === void 0) {\n      _event = initEvent;\n    }\n\n    if (context === void 0) {\n      context = this.machine.context;\n    }\n\n    var configuration = stateTransition.configuration; // Transition will \"apply\" if:\n    // - this is the initial state (there is no current state)\n    // - OR there are transitions\n\n    var willTransition = !currentState || stateTransition.transitions.length > 0;\n    var resolvedStateValue = willTransition ? getValue(this.machine, configuration) : undefined;\n    var historyValue = currentState ? currentState.historyValue ? currentState.historyValue : stateTransition.source ? this.machine.historyValue(currentState.value) : undefined : undefined;\n    var currentContext = currentState ? currentState.context : context;\n    var actions = this.getActions(stateTransition, currentContext, _event, currentState);\n    var activities = currentState ? __assign({}, currentState.activities) : {};\n\n    try {\n      for (var actions_1 = __values(actions), actions_1_1 = actions_1.next(); !actions_1_1.done; actions_1_1 = actions_1.next()) {\n        var action = actions_1_1.value;\n\n        if (action.type === start$1) {\n          activities[action.activity.id || action.activity.type] = action;\n        } else if (action.type === stop$1) {\n          activities[action.activity.id || action.activity.type] = false;\n        }\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (actions_1_1 && !actions_1_1.done && (_a = actions_1.return)) _a.call(actions_1);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n\n    var _b = __read(resolveActions(this, currentState, currentContext, _event, actions), 2),\n        resolvedActions = _b[0],\n        updatedContext = _b[1];\n\n    var _c = __read(partition(resolvedActions, function (action) {\n      return action.type === raise$1 || action.type === send$1 && action.to === SpecialTargets.Internal;\n    }), 2),\n        raisedEvents = _c[0],\n        nonRaisedActions = _c[1];\n\n    var invokeActions = resolvedActions.filter(function (action) {\n      return action.type === start$1 && action.activity.type === invoke;\n    });\n    var children = invokeActions.reduce(function (acc, action) {\n      acc[action.activity.id] = createInvocableActor(action.activity, _this.machine, updatedContext, _event);\n      return acc;\n    }, currentState ? __assign({}, currentState.children) : {});\n    var resolvedConfiguration = resolvedStateValue ? stateTransition.configuration : currentState ? currentState.configuration : [];\n    var meta = resolvedConfiguration.reduce(function (acc, stateNode) {\n      if (stateNode.meta !== undefined) {\n        acc[stateNode.id] = stateNode.meta;\n      }\n\n      return acc;\n    }, {});\n    var isDone = isInFinalState(resolvedConfiguration, this);\n    var nextState = new State({\n      value: resolvedStateValue || currentState.value,\n      context: updatedContext,\n      _event: _event,\n      // Persist _sessionid between states\n      _sessionid: currentState ? currentState._sessionid : null,\n      historyValue: resolvedStateValue ? historyValue ? updateHistoryValue(historyValue, resolvedStateValue) : undefined : currentState ? currentState.historyValue : undefined,\n      history: !resolvedStateValue || stateTransition.source ? currentState : undefined,\n      actions: resolvedStateValue ? nonRaisedActions : [],\n      activities: resolvedStateValue ? activities : currentState ? currentState.activities : {},\n      meta: resolvedStateValue ? meta : currentState ? currentState.meta : undefined,\n      events: [],\n      configuration: resolvedConfiguration,\n      transitions: stateTransition.transitions,\n      children: children,\n      done: isDone\n    });\n    var didUpdateContext = currentContext !== updatedContext;\n    nextState.changed = _event.name === update || didUpdateContext; // Dispose of penultimate histories to prevent memory leaks\n\n    var history = nextState.history;\n\n    if (history) {\n      delete history.history;\n    }\n\n    if (!resolvedStateValue) {\n      return nextState;\n    }\n\n    var maybeNextState = nextState;\n\n    if (!isDone) {\n      var isTransient = this._transient || configuration.some(function (stateNode) {\n        return stateNode._transient;\n      });\n\n      if (isTransient) {\n        maybeNextState = this.resolveRaisedTransition(maybeNextState, {\n          type: nullEvent\n        }, _event);\n      }\n\n      while (raisedEvents.length) {\n        var raisedEvent = raisedEvents.shift();\n        maybeNextState = this.resolveRaisedTransition(maybeNextState, raisedEvent._event, _event);\n      }\n    } // Detect if state changed\n\n\n    var changed = maybeNextState.changed || (history ? !!maybeNextState.actions.length || didUpdateContext || typeof history.value !== typeof maybeNextState.value || !stateValuesEqual(maybeNextState.value, history.value) : undefined);\n    maybeNextState.changed = changed; // Preserve original history after raised events\n\n    maybeNextState.historyValue = nextState.historyValue;\n    maybeNextState.history = history;\n    return maybeNextState;\n  };\n  /**\r\n   * Returns the child state node from its relative `stateKey`, or throws.\r\n   */\n\n\n  StateNode.prototype.getStateNode = function (stateKey) {\n    if (isStateId(stateKey)) {\n      return this.machine.getStateNodeById(stateKey);\n    }\n\n    if (!this.states) {\n      throw new Error(\"Unable to retrieve child state '\" + stateKey + \"' from '\" + this.id + \"'; no child states exist.\");\n    }\n\n    var result = this.states[stateKey];\n\n    if (!result) {\n      throw new Error(\"Child state '\" + stateKey + \"' does not exist on '\" + this.id + \"'\");\n    }\n\n    return result;\n  };\n  /**\r\n   * Returns the state node with the given `stateId`, or throws.\r\n   *\r\n   * @param stateId The state ID. The prefix \"#\" is removed.\r\n   */\n\n\n  StateNode.prototype.getStateNodeById = function (stateId) {\n    var resolvedStateId = isStateId(stateId) ? stateId.slice(STATE_IDENTIFIER.length) : stateId;\n\n    if (resolvedStateId === this.id) {\n      return this;\n    }\n\n    var stateNode = this.machine.idMap[resolvedStateId];\n\n    if (!stateNode) {\n      throw new Error(\"Child state node '#\" + resolvedStateId + \"' does not exist on machine '\" + this.id + \"'\");\n    }\n\n    return stateNode;\n  };\n  /**\r\n   * Returns the relative state node from the given `statePath`, or throws.\r\n   *\r\n   * @param statePath The string or string array relative path to the state node.\r\n   */\n\n\n  StateNode.prototype.getStateNodeByPath = function (statePath) {\n    if (typeof statePath === 'string' && isStateId(statePath)) {\n      try {\n        return this.getStateNodeById(statePath.slice(1));\n      } catch (e) {// try individual paths\n        // throw e;\n      }\n    }\n\n    var arrayStatePath = toStatePath(statePath, this.delimiter).slice();\n    var currentStateNode = this;\n\n    while (arrayStatePath.length) {\n      var key = arrayStatePath.shift();\n\n      if (!key.length) {\n        break;\n      }\n\n      currentStateNode = currentStateNode.getStateNode(key);\n    }\n\n    return currentStateNode;\n  };\n  /**\r\n   * Resolves a partial state value with its full representation in this machine.\r\n   *\r\n   * @param stateValue The partial state value to resolve.\r\n   */\n\n\n  StateNode.prototype.resolve = function (stateValue) {\n    var _a;\n\n    var _this = this;\n\n    if (!stateValue) {\n      return this.initialStateValue || EMPTY_OBJECT; // TODO: type-specific properties\n    }\n\n    switch (this.type) {\n      case 'parallel':\n        return mapValues(this.initialStateValue, function (subStateValue, subStateKey) {\n          return subStateValue ? _this.getStateNode(subStateKey).resolve(stateValue[subStateKey] || subStateValue) : EMPTY_OBJECT;\n        });\n\n      case 'compound':\n        if (isString(stateValue)) {\n          var subStateNode = this.getStateNode(stateValue);\n\n          if (subStateNode.type === 'parallel' || subStateNode.type === 'compound') {\n            return _a = {}, _a[stateValue] = subStateNode.initialStateValue, _a;\n          }\n\n          return stateValue;\n        }\n\n        if (!keys(stateValue).length) {\n          return this.initialStateValue || {};\n        }\n\n        return mapValues(stateValue, function (subStateValue, subStateKey) {\n          return subStateValue ? _this.getStateNode(subStateKey).resolve(subStateValue) : EMPTY_OBJECT;\n        });\n\n      default:\n        return stateValue || EMPTY_OBJECT;\n    }\n  };\n\n  StateNode.prototype.getResolvedPath = function (stateIdentifier) {\n    if (isStateId(stateIdentifier)) {\n      var stateNode = this.machine.idMap[stateIdentifier.slice(STATE_IDENTIFIER.length)];\n\n      if (!stateNode) {\n        throw new Error(\"Unable to find state node '\" + stateIdentifier + \"'\");\n      }\n\n      return stateNode.path;\n    }\n\n    return toStatePath(stateIdentifier, this.delimiter);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialStateValue\", {\n    get: function () {\n      var _a;\n\n      if (this.__cache.initialStateValue) {\n        return this.__cache.initialStateValue;\n      }\n\n      var initialStateValue;\n\n      if (this.type === 'parallel') {\n        initialStateValue = mapFilterValues(this.states, function (state) {\n          return state.initialStateValue || EMPTY_OBJECT;\n        }, function (stateNode) {\n          return !(stateNode.type === 'history');\n        });\n      } else if (this.initial !== undefined) {\n        if (!this.states[this.initial]) {\n          throw new Error(\"Initial state '\" + this.initial + \"' not found on '\" + this.key + \"'\");\n        }\n\n        initialStateValue = isLeafNode(this.states[this.initial]) ? this.initial : (_a = {}, _a[this.initial] = this.states[this.initial].initialStateValue, _a);\n      }\n\n      this.__cache.initialStateValue = initialStateValue;\n      return this.__cache.initialStateValue;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateNode.prototype.getInitialState = function (stateValue, context) {\n    var configuration = this.getStateNodes(stateValue);\n    return this.resolveTransition({\n      configuration: configuration,\n      entrySet: configuration,\n      exitSet: [],\n      transitions: [],\n      source: undefined,\n      actions: []\n    }, undefined, undefined, context);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialState\", {\n    /**\r\n     * The initial State instance, which includes all actions to be executed from\r\n     * entering the initial state.\r\n     */\n    get: function () {\n      this._init(); // TODO: this should be in the constructor (see note in constructor)\n\n\n      var initialStateValue = this.initialStateValue;\n\n      if (!initialStateValue) {\n        throw new Error(\"Cannot retrieve initial state from simple state '\" + this.id + \"'.\");\n      }\n\n      return this.getInitialState(initialStateValue);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"target\", {\n    /**\r\n     * The target state value of the history state node, if it exists. This represents the\r\n     * default state value to transition to if no history value exists yet.\r\n     */\n    get: function () {\n      var target;\n\n      if (this.type === 'history') {\n        var historyConfig = this.config;\n\n        if (isString(historyConfig.target)) {\n          target = isStateId(historyConfig.target) ? pathToStateValue(this.machine.getStateNodeById(historyConfig.target).path.slice(this.path.length - 1)) : historyConfig.target;\n        } else {\n          target = historyConfig.target;\n        }\n      }\n\n      return target;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Returns the leaf nodes from a state path relative to this state node.\r\n   *\r\n   * @param relativeStateId The relative state path to retrieve the state nodes\r\n   * @param history The previous state to retrieve history\r\n   * @param resolve Whether state nodes should resolve to initial child state nodes\r\n   */\n\n  StateNode.prototype.getRelativeStateNodes = function (relativeStateId, historyValue, resolve) {\n    if (resolve === void 0) {\n      resolve = true;\n    }\n\n    return resolve ? relativeStateId.type === 'history' ? relativeStateId.resolveHistory(historyValue) : relativeStateId.initialStateNodes : [relativeStateId];\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialStateNodes\", {\n    get: function () {\n      var _this = this;\n\n      if (isLeafNode(this)) {\n        return [this];\n      } // Case when state node is compound but no initial state is defined\n\n\n      if (this.type === 'compound' && !this.initial) {\n        if (!IS_PRODUCTION) {\n          warn(false, \"Compound state node '\" + this.id + \"' has no initial state.\");\n        }\n\n        return [this];\n      }\n\n      var initialStateNodePaths = toStatePaths(this.initialStateValue);\n      return flatten(initialStateNodePaths.map(function (initialPath) {\n        return _this.getFromRelativePath(initialPath);\n      }));\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Retrieves state nodes from a relative path to this state node.\r\n   *\r\n   * @param relativePath The relative path from this state node\r\n   * @param historyValue\r\n   */\n\n  StateNode.prototype.getFromRelativePath = function (relativePath) {\n    if (!relativePath.length) {\n      return [this];\n    }\n\n    var _a = __read(relativePath),\n        stateKey = _a[0],\n        childStatePath = _a.slice(1);\n\n    if (!this.states) {\n      throw new Error(\"Cannot retrieve subPath '\" + stateKey + \"' from node with no states\");\n    }\n\n    var childStateNode = this.getStateNode(stateKey);\n\n    if (childStateNode.type === 'history') {\n      return childStateNode.resolveHistory();\n    }\n\n    if (!this.states[stateKey]) {\n      throw new Error(\"Child state '\" + stateKey + \"' does not exist on '\" + this.id + \"'\");\n    }\n\n    return this.states[stateKey].getFromRelativePath(childStatePath);\n  };\n\n  StateNode.prototype.historyValue = function (relativeStateValue) {\n    if (!keys(this.states).length) {\n      return undefined;\n    }\n\n    return {\n      current: relativeStateValue || this.initialStateValue,\n      states: mapFilterValues(this.states, function (stateNode, key) {\n        if (!relativeStateValue) {\n          return stateNode.historyValue();\n        }\n\n        var subStateValue = isString(relativeStateValue) ? undefined : relativeStateValue[key];\n        return stateNode.historyValue(subStateValue || stateNode.initialStateValue);\n      }, function (stateNode) {\n        return !stateNode.history;\n      })\n    };\n  };\n  /**\r\n   * Resolves to the historical value(s) of the parent state node,\r\n   * represented by state nodes.\r\n   *\r\n   * @param historyValue\r\n   */\n\n\n  StateNode.prototype.resolveHistory = function (historyValue) {\n    var _this = this;\n\n    if (this.type !== 'history') {\n      return [this];\n    }\n\n    var parent = this.parent;\n\n    if (!historyValue) {\n      var historyTarget = this.target;\n      return historyTarget ? flatten(toStatePaths(historyTarget).map(function (relativeChildPath) {\n        return parent.getFromRelativePath(relativeChildPath);\n      })) : parent.initialStateNodes;\n    }\n\n    var subHistoryValue = nestedPath(parent.path, 'states')(historyValue).current;\n\n    if (isString(subHistoryValue)) {\n      return [parent.getStateNode(subHistoryValue)];\n    }\n\n    return flatten(toStatePaths(subHistoryValue).map(function (subStatePath) {\n      return _this.history === 'deep' ? parent.getFromRelativePath(subStatePath) : [parent.states[subStatePath[0]]];\n    }));\n  };\n\n  Object.defineProperty(StateNode.prototype, \"stateIds\", {\n    /**\r\n     * All the state node IDs of this state node and its descendant state nodes.\r\n     */\n    get: function () {\n      var _this = this;\n\n      var childStateIds = flatten(keys(this.states).map(function (stateKey) {\n        return _this.states[stateKey].stateIds;\n      }));\n      return [this.id].concat(childStateIds);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"events\", {\n    /**\r\n     * All the event types accepted by this state node and its descendants.\r\n     */\n    get: function () {\n      var e_7, _a, e_8, _b;\n\n      if (this.__cache.events) {\n        return this.__cache.events;\n      }\n\n      var states = this.states;\n      var events = new Set(this.ownEvents);\n\n      if (states) {\n        try {\n          for (var _c = __values(keys(states)), _d = _c.next(); !_d.done; _d = _c.next()) {\n            var stateId = _d.value;\n            var state = states[stateId];\n\n            if (state.states) {\n              try {\n                for (var _e = (e_8 = void 0, __values(state.events)), _f = _e.next(); !_f.done; _f = _e.next()) {\n                  var event_1 = _f.value;\n                  events.add(\"\" + event_1);\n                }\n              } catch (e_8_1) {\n                e_8 = {\n                  error: e_8_1\n                };\n              } finally {\n                try {\n                  if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n                } finally {\n                  if (e_8) throw e_8.error;\n                }\n              }\n            }\n          }\n        } catch (e_7_1) {\n          e_7 = {\n            error: e_7_1\n          };\n        } finally {\n          try {\n            if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n          } finally {\n            if (e_7) throw e_7.error;\n          }\n        }\n      }\n\n      return this.__cache.events = Array.from(events);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"ownEvents\", {\n    /**\r\n     * All the events that have transitions directly from this state node.\r\n     *\r\n     * Excludes any inert events.\r\n     */\n    get: function () {\n      var events = new Set(this.transitions.filter(function (transition) {\n        return !(!transition.target && !transition.actions.length && transition.internal);\n      }).map(function (transition) {\n        return transition.eventType;\n      }));\n      return Array.from(events);\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateNode.prototype.resolveTarget = function (_target) {\n    var _this = this;\n\n    if (_target === undefined) {\n      // an undefined target signals that the state node should not transition from that state when receiving that event\n      return undefined;\n    }\n\n    return _target.map(function (target) {\n      if (!isString(target)) {\n        return target;\n      }\n\n      var isInternalTarget = target[0] === _this.delimiter; // If internal target is defined on machine,\n      // do not include machine key on target\n\n      if (isInternalTarget && !_this.parent) {\n        return _this.getStateNodeByPath(target.slice(1));\n      }\n\n      var resolvedTarget = isInternalTarget ? _this.key + target : target;\n\n      if (_this.parent) {\n        try {\n          var targetStateNode = _this.parent.getStateNodeByPath(resolvedTarget);\n\n          return targetStateNode;\n        } catch (err) {\n          throw new Error(\"Invalid transition definition for state node '\" + _this.id + \"':\\n\" + err.message);\n        }\n      } else {\n        return _this.getStateNodeByPath(resolvedTarget);\n      }\n    });\n  };\n\n  StateNode.prototype.formatTransition = function (transitionConfig) {\n    var _this = this;\n\n    var normalizedTarget = normalizeTarget(transitionConfig.target);\n    var internal = 'internal' in transitionConfig ? transitionConfig.internal : normalizedTarget ? normalizedTarget.some(function (_target) {\n      return isString(_target) && _target[0] === _this.delimiter;\n    }) : true;\n    var guards = this.machine.options.guards;\n    var target = this.resolveTarget(normalizedTarget);\n\n    var transition = __assign(__assign({}, transitionConfig), {\n      actions: toActionObjects(toArray(transitionConfig.actions)),\n      cond: toGuard(transitionConfig.cond, guards),\n      target: target,\n      source: this,\n      internal: internal,\n      eventType: transitionConfig.event,\n      toJSON: function () {\n        return __assign(__assign({}, transition), {\n          target: transition.target ? transition.target.map(function (t) {\n            return \"#\" + t.id;\n          }) : undefined,\n          source: \"#\" + _this.id\n        });\n      }\n    });\n\n    return transition;\n  };\n\n  StateNode.prototype.formatTransitions = function () {\n    var e_9, _a;\n\n    var _this = this;\n\n    var onConfig;\n\n    if (!this.config.on) {\n      onConfig = [];\n    } else if (Array.isArray(this.config.on)) {\n      onConfig = this.config.on;\n    } else {\n      var _b = this.config.on,\n          _c = WILDCARD,\n          _d = _b[_c],\n          wildcardConfigs = _d === void 0 ? [] : _d,\n          strictTransitionConfigs_1 = __rest(_b, [typeof _c === \"symbol\" ? _c : _c + \"\"]);\n\n      onConfig = flatten(keys(strictTransitionConfigs_1).map(function (key) {\n        if (!IS_PRODUCTION && key === NULL_EVENT) {\n          warn(false, \"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. \" + (\"Please check the `on` configuration for \\\"#\" + _this.id + \"\\\".\"));\n        }\n\n        var transitionConfigArray = toTransitionConfigArray(key, strictTransitionConfigs_1[key]);\n\n        if (!IS_PRODUCTION) {\n          validateArrayifiedTransitions(_this, key, transitionConfigArray);\n        }\n\n        return transitionConfigArray;\n      }).concat(toTransitionConfigArray(WILDCARD, wildcardConfigs)));\n    }\n\n    var eventlessConfig = this.config.always ? toTransitionConfigArray('', this.config.always) : [];\n    var doneConfig = this.config.onDone ? toTransitionConfigArray(String(done(this.id)), this.config.onDone) : [];\n\n    if (!IS_PRODUCTION) {\n      warn(!(this.config.onDone && !this.parent), \"Root nodes cannot have an \\\".onDone\\\" transition. Please check the config of \\\"\" + this.id + \"\\\".\");\n    }\n\n    var invokeConfig = flatten(this.invoke.map(function (invokeDef) {\n      var settleTransitions = [];\n\n      if (invokeDef.onDone) {\n        settleTransitions.push.apply(settleTransitions, __spread(toTransitionConfigArray(String(doneInvoke(invokeDef.id)), invokeDef.onDone)));\n      }\n\n      if (invokeDef.onError) {\n        settleTransitions.push.apply(settleTransitions, __spread(toTransitionConfigArray(String(error(invokeDef.id)), invokeDef.onError)));\n      }\n\n      return settleTransitions;\n    }));\n    var delayedTransitions = this.after;\n    var formattedTransitions = flatten(__spread(doneConfig, invokeConfig, onConfig, eventlessConfig).map(function (transitionConfig) {\n      return toArray(transitionConfig).map(function (transition) {\n        return _this.formatTransition(transition);\n      });\n    }));\n\n    try {\n      for (var delayedTransitions_1 = __values(delayedTransitions), delayedTransitions_1_1 = delayedTransitions_1.next(); !delayedTransitions_1_1.done; delayedTransitions_1_1 = delayedTransitions_1.next()) {\n        var delayedTransition = delayedTransitions_1_1.value;\n        formattedTransitions.push(delayedTransition);\n      }\n    } catch (e_9_1) {\n      e_9 = {\n        error: e_9_1\n      };\n    } finally {\n      try {\n        if (delayedTransitions_1_1 && !delayedTransitions_1_1.done && (_a = delayedTransitions_1.return)) _a.call(delayedTransitions_1);\n      } finally {\n        if (e_9) throw e_9.error;\n      }\n    }\n\n    return formattedTransitions;\n  };\n\n  return StateNode;\n}();\n\nexport { StateNode };","import { StateNode } from './StateNode.js';\n\nfunction Machine(config, options, initialContext) {\n  if (initialContext === void 0) {\n    initialContext = config.context;\n  }\n\n  var resolvedInitialContext = typeof initialContext === 'function' ? initialContext() : initialContext;\n  return new StateNode(config, options, resolvedInitialContext);\n}\n\nfunction createMachine(config, options) {\n  var resolvedInitialContext = typeof config.context === 'function' ? config.context() : config.context;\n  return new StateNode(config, options, resolvedInitialContext);\n}\n\nexport { Machine, createMachine };","var baseMerge = require('./_baseMerge'),\n    createAssigner = require('./_createAssigner');\n\n/**\n * This method is like `_.merge` except that it accepts `customizer` which\n * is invoked to produce the merged values of the destination and source\n * properties. If `customizer` returns `undefined`, merging is handled by the\n * method instead. The `customizer` is invoked with six arguments:\n * (objValue, srcValue, key, object, source, stack).\n *\n * **Note:** This method mutates `object`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Object\n * @param {Object} object The destination object.\n * @param {...Object} sources The source objects.\n * @param {Function} customizer The function to customize assigned values.\n * @returns {Object} Returns `object`.\n * @example\n *\n * function customizer(objValue, srcValue) {\n *   if (_.isArray(objValue)) {\n *     return objValue.concat(srcValue);\n *   }\n * }\n *\n * var object = { 'a': [1], 'b': [2] };\n * var other = { 'a': [3], 'b': [4] };\n *\n * _.mergeWith(object, other, customizer);\n * // => { 'a': [1, 3], 'b': [2, 4] }\n */\nvar mergeWith = createAssigner(function(object, source, srcIndex, customizer) {\n  baseMerge(object, source, srcIndex, customizer);\n});\n\nmodule.exports = mergeWith;\n","var baseIsEqual = require('./_baseIsEqual');\n\n/**\n * This method is like `_.isEqual` except that it accepts `customizer` which\n * is invoked to compare values. If `customizer` returns `undefined`, comparisons\n * are handled by the method instead. The `customizer` is invoked with up to\n * six arguments: (objValue, othValue [, index|key, object, other, stack]).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @param {Function} [customizer] The function to customize comparisons.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * function isGreeting(value) {\n *   return /^h(?:i|ello)$/.test(value);\n * }\n *\n * function customizer(objValue, othValue) {\n *   if (isGreeting(objValue) && isGreeting(othValue)) {\n *     return true;\n *   }\n * }\n *\n * var array = ['hello', 'goodbye'];\n * var other = ['hi', 'goodbye'];\n *\n * _.isEqualWith(array, other, customizer);\n * // => true\n */\nfunction isEqualWith(value, other, customizer) {\n  customizer = typeof customizer == 'function' ? customizer : undefined;\n  var result = customizer ? customizer(value, other) : undefined;\n  return result === undefined ? baseIsEqual(value, other, undefined, customizer) : !!result;\n}\n\nmodule.exports = isEqualWith;\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nfunction __rest(s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n}\n\nfunction __values(o) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator],\n      i = 0;\n  if (m) return m.call(o);\n  return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n}\n\nfunction __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n}\n\nfunction __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n}\n\nexport { __assign, __read, __rest, __spread, __values };","import { __spread, __values, __read, __assign } from './_virtual/_tslib.js';\nimport { DEFAULT_GUARD_TYPE, TARGETLESS_KEY, STATE_DELIMITER } from './constants.js';\nimport { IS_PRODUCTION } from './environment.js';\n\nfunction keys(value) {\n  return Object.keys(value);\n}\n\nfunction matchesState(parentStateId, childStateId, delimiter) {\n  if (delimiter === void 0) {\n    delimiter = STATE_DELIMITER;\n  }\n\n  var parentStateValue = toStateValue(parentStateId, delimiter);\n  var childStateValue = toStateValue(childStateId, delimiter);\n\n  if (isString(childStateValue)) {\n    if (isString(parentStateValue)) {\n      return childStateValue === parentStateValue;\n    } // Parent more specific than child\n\n\n    return false;\n  }\n\n  if (isString(parentStateValue)) {\n    return parentStateValue in childStateValue;\n  }\n\n  return keys(parentStateValue).every(function (key) {\n    if (!(key in childStateValue)) {\n      return false;\n    }\n\n    return matchesState(parentStateValue[key], childStateValue[key]);\n  });\n}\n\nfunction getEventType(event) {\n  try {\n    return isString(event) || typeof event === 'number' ? \"\" + event : event.type;\n  } catch (e) {\n    throw new Error('Events must be strings or objects with a string event.type property.');\n  }\n}\n\nfunction toStatePath(stateId, delimiter) {\n  try {\n    if (isArray(stateId)) {\n      return stateId;\n    }\n\n    return stateId.toString().split(delimiter);\n  } catch (e) {\n    throw new Error(\"'\" + stateId + \"' is not a valid state path.\");\n  }\n}\n\nfunction isStateLike(state) {\n  return typeof state === 'object' && 'value' in state && 'context' in state && 'event' in state && '_event' in state;\n}\n\nfunction toStateValue(stateValue, delimiter) {\n  if (isStateLike(stateValue)) {\n    return stateValue.value;\n  }\n\n  if (isArray(stateValue)) {\n    return pathToStateValue(stateValue);\n  }\n\n  if (typeof stateValue !== 'string') {\n    return stateValue;\n  }\n\n  var statePath = toStatePath(stateValue, delimiter);\n  return pathToStateValue(statePath);\n}\n\nfunction pathToStateValue(statePath) {\n  if (statePath.length === 1) {\n    return statePath[0];\n  }\n\n  var value = {};\n  var marker = value;\n\n  for (var i = 0; i < statePath.length - 1; i++) {\n    if (i === statePath.length - 2) {\n      marker[statePath[i]] = statePath[i + 1];\n    } else {\n      marker[statePath[i]] = {};\n      marker = marker[statePath[i]];\n    }\n  }\n\n  return value;\n}\n\nfunction mapValues(collection, iteratee) {\n  var result = {};\n  var collectionKeys = keys(collection);\n\n  for (var i = 0; i < collectionKeys.length; i++) {\n    var key = collectionKeys[i];\n    result[key] = iteratee(collection[key], key, collection, i);\n  }\n\n  return result;\n}\n\nfunction mapFilterValues(collection, iteratee, predicate) {\n  var e_1, _a;\n\n  var result = {};\n\n  try {\n    for (var _b = __values(keys(collection)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var key = _c.value;\n      var item = collection[key];\n\n      if (!predicate(item)) {\n        continue;\n      }\n\n      result[key] = iteratee(item, key, collection);\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return result;\n}\n/**\r\n * Retrieves a value at the given path.\r\n * @param props The deep path to the prop of the desired value\r\n */\n\n\nvar path = function (props) {\n  return function (object) {\n    var e_2, _a;\n\n    var result = object;\n\n    try {\n      for (var props_1 = __values(props), props_1_1 = props_1.next(); !props_1_1.done; props_1_1 = props_1.next()) {\n        var prop = props_1_1.value;\n        result = result[prop];\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (props_1_1 && !props_1_1.done && (_a = props_1.return)) _a.call(props_1);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    return result;\n  };\n};\n/**\r\n * Retrieves a value at the given path via the nested accessor prop.\r\n * @param props The deep path to the prop of the desired value\r\n */\n\n\nfunction nestedPath(props, accessorProp) {\n  return function (object) {\n    var e_3, _a;\n\n    var result = object;\n\n    try {\n      for (var props_2 = __values(props), props_2_1 = props_2.next(); !props_2_1.done; props_2_1 = props_2.next()) {\n        var prop = props_2_1.value;\n        result = result[accessorProp][prop];\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (props_2_1 && !props_2_1.done && (_a = props_2.return)) _a.call(props_2);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    return result;\n  };\n}\n\nfunction toStatePaths(stateValue) {\n  if (!stateValue) {\n    return [[]];\n  }\n\n  if (isString(stateValue)) {\n    return [[stateValue]];\n  }\n\n  var result = flatten(keys(stateValue).map(function (key) {\n    var subStateValue = stateValue[key];\n\n    if (typeof subStateValue !== 'string' && (!subStateValue || !Object.keys(subStateValue).length)) {\n      return [[key]];\n    }\n\n    return toStatePaths(stateValue[key]).map(function (subPath) {\n      return [key].concat(subPath);\n    });\n  }));\n  return result;\n}\n\nfunction flatten(array) {\n  var _a;\n\n  return (_a = []).concat.apply(_a, __spread(array));\n}\n\nfunction toArrayStrict(value) {\n  if (isArray(value)) {\n    return value;\n  }\n\n  return [value];\n}\n\nfunction toArray(value) {\n  if (value === undefined) {\n    return [];\n  }\n\n  return toArrayStrict(value);\n}\n\nfunction mapContext(mapper, context, _event) {\n  var e_5, _a;\n\n  if (isFunction(mapper)) {\n    return mapper(context, _event.data);\n  }\n\n  var result = {};\n\n  try {\n    for (var _b = __values(Object.keys(mapper)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var key = _c.value;\n      var subMapper = mapper[key];\n\n      if (isFunction(subMapper)) {\n        result[key] = subMapper(context, _event.data);\n      } else {\n        result[key] = subMapper;\n      }\n    }\n  } catch (e_5_1) {\n    e_5 = {\n      error: e_5_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_5) throw e_5.error;\n    }\n  }\n\n  return result;\n}\n\nfunction isBuiltInEvent(eventType) {\n  return /^(done|error)\\./.test(eventType);\n}\n\nfunction isPromiseLike(value) {\n  if (value instanceof Promise) {\n    return true;\n  } // Check if shape matches the Promise/A+ specification for a \"thenable\".\n\n\n  if (value !== null && (isFunction(value) || typeof value === 'object') && isFunction(value.then)) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction partition(items, predicate) {\n  var e_6, _a;\n\n  var _b = __read([[], []], 2),\n      truthy = _b[0],\n      falsy = _b[1];\n\n  try {\n    for (var items_1 = __values(items), items_1_1 = items_1.next(); !items_1_1.done; items_1_1 = items_1.next()) {\n      var item = items_1_1.value;\n\n      if (predicate(item)) {\n        truthy.push(item);\n      } else {\n        falsy.push(item);\n      }\n    }\n  } catch (e_6_1) {\n    e_6 = {\n      error: e_6_1\n    };\n  } finally {\n    try {\n      if (items_1_1 && !items_1_1.done && (_a = items_1.return)) _a.call(items_1);\n    } finally {\n      if (e_6) throw e_6.error;\n    }\n  }\n\n  return [truthy, falsy];\n}\n\nfunction updateHistoryStates(hist, stateValue) {\n  return mapValues(hist.states, function (subHist, key) {\n    if (!subHist) {\n      return undefined;\n    }\n\n    var subStateValue = (isString(stateValue) ? undefined : stateValue[key]) || (subHist ? subHist.current : undefined);\n\n    if (!subStateValue) {\n      return undefined;\n    }\n\n    return {\n      current: subStateValue,\n      states: updateHistoryStates(subHist, subStateValue)\n    };\n  });\n}\n\nfunction updateHistoryValue(hist, stateValue) {\n  return {\n    current: stateValue,\n    states: updateHistoryStates(hist, stateValue)\n  };\n}\n\nfunction updateContext(context, _event, assignActions, state) {\n  if (!IS_PRODUCTION) {\n    warn(!!context, 'Attempting to update undefined context');\n  }\n\n  var updatedContext = context ? assignActions.reduce(function (acc, assignAction) {\n    var e_7, _a;\n\n    var assignment = assignAction.assignment;\n    var meta = {\n      state: state,\n      action: assignAction,\n      _event: _event\n    };\n    var partialUpdate = {};\n\n    if (isFunction(assignment)) {\n      partialUpdate = assignment(acc, _event.data, meta);\n    } else {\n      try {\n        for (var _b = __values(keys(assignment)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var key = _c.value;\n          var propAssignment = assignment[key];\n          partialUpdate[key] = isFunction(propAssignment) ? propAssignment(acc, _event.data, meta) : propAssignment;\n        }\n      } catch (e_7_1) {\n        e_7 = {\n          error: e_7_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_7) throw e_7.error;\n        }\n      }\n    }\n\n    return Object.assign({}, acc, partialUpdate);\n  }, context) : context;\n  return updatedContext;\n} // tslint:disable-next-line:no-empty\n\n\nvar warn = function () {};\n\nif (!IS_PRODUCTION) {\n  warn = function (condition, message) {\n    var error = condition instanceof Error ? condition : undefined;\n\n    if (!error && condition) {\n      return;\n    }\n\n    if (console !== undefined) {\n      var args = [\"Warning: \" + message];\n\n      if (error) {\n        args.push(error);\n      } // tslint:disable-next-line:no-console\n\n\n      console.warn.apply(console, args);\n    }\n  };\n}\n\nfunction isArray(value) {\n  return Array.isArray(value);\n} // tslint:disable-next-line:ban-types\n\n\nfunction isFunction(value) {\n  return typeof value === 'function';\n}\n\nfunction isString(value) {\n  return typeof value === 'string';\n} // export function memoizedGetter<T, TP extends { prototype: object }>(\n//   o: TP,\n//   property: string,\n//   getter: () => T\n// ): void {\n//   Object.defineProperty(o.prototype, property, {\n//     get: getter,\n//     enumerable: false,\n//     configurable: false\n//   });\n// }\n\n\nfunction toGuard(condition, guardMap) {\n  if (!condition) {\n    return undefined;\n  }\n\n  if (isString(condition)) {\n    return {\n      type: DEFAULT_GUARD_TYPE,\n      name: condition,\n      predicate: guardMap ? guardMap[condition] : undefined\n    };\n  }\n\n  if (isFunction(condition)) {\n    return {\n      type: DEFAULT_GUARD_TYPE,\n      name: condition.name,\n      predicate: condition\n    };\n  }\n\n  return condition;\n}\n\nfunction isObservable(value) {\n  try {\n    return 'subscribe' in value && isFunction(value.subscribe);\n  } catch (e) {\n    return false;\n  }\n}\n\nvar symbolObservable = /*#__PURE__*/function () {\n  return typeof Symbol === 'function' && Symbol.observable || '@@observable';\n}();\n\nfunction isMachine(value) {\n  try {\n    return '__xstatenode' in value;\n  } catch (e) {\n    return false;\n  }\n}\n\nvar uniqueId = /*#__PURE__*/function () {\n  var currentId = 0;\n  return function () {\n    currentId++;\n    return currentId.toString(16);\n  };\n}();\n\nfunction toEventObject(event, payload // id?: TEvent['type']\n) {\n  if (isString(event) || typeof event === 'number') {\n    return __assign({\n      type: event\n    }, payload);\n  }\n\n  return event;\n}\n\nfunction toSCXMLEvent(event, scxmlEvent) {\n  if (!isString(event) && '$$type' in event && event.$$type === 'scxml') {\n    return event;\n  }\n\n  var eventObject = toEventObject(event);\n  return __assign({\n    name: eventObject.type,\n    data: eventObject,\n    $$type: 'scxml',\n    type: 'external'\n  }, scxmlEvent);\n}\n\nfunction toTransitionConfigArray(event, configLike) {\n  var transitions = toArrayStrict(configLike).map(function (transitionLike) {\n    if (typeof transitionLike === 'undefined' || typeof transitionLike === 'string' || isMachine(transitionLike)) {\n      return {\n        target: transitionLike,\n        event: event\n      };\n    }\n\n    return __assign(__assign({}, transitionLike), {\n      event: event\n    });\n  });\n  return transitions;\n}\n\nfunction normalizeTarget(target) {\n  if (target === undefined || target === TARGETLESS_KEY) {\n    return undefined;\n  }\n\n  return toArray(target);\n}\n\nfunction reportUnhandledExceptionOnInvocation(originalError, currentError, id) {\n  if (!IS_PRODUCTION) {\n    var originalStackTrace = originalError.stack ? \" Stacktrace was '\" + originalError.stack + \"'\" : '';\n\n    if (originalError === currentError) {\n      // tslint:disable-next-line:no-console\n      console.error(\"Missing onError handler for invocation '\" + id + \"', error was '\" + originalError + \"'.\" + originalStackTrace);\n    } else {\n      var stackTrace = currentError.stack ? \" Stacktrace was '\" + currentError.stack + \"'\" : ''; // tslint:disable-next-line:no-console\n\n      console.error(\"Missing onError handler and/or unhandled exception/promise rejection for invocation '\" + id + \"'. \" + (\"Original error: '\" + originalError + \"'. \" + originalStackTrace + \" Current error is '\" + currentError + \"'.\" + stackTrace));\n    }\n  }\n}\n\nfunction evaluateGuard(machine, guard, context, _event, state) {\n  var guards = machine.options.guards;\n  var guardMeta = {\n    state: state,\n    cond: guard,\n    _event: _event\n  }; // TODO: do not hardcode!\n\n  if (guard.type === DEFAULT_GUARD_TYPE) {\n    return guard.predicate(context, _event.data, guardMeta);\n  }\n\n  var condFn = guards[guard.type];\n\n  if (!condFn) {\n    throw new Error(\"Guard '\" + guard.type + \"' is not implemented on machine '\" + machine.id + \"'.\");\n  }\n\n  return condFn(context, _event.data, guardMeta);\n}\n\nfunction toInvokeSource(src) {\n  if (typeof src === 'string') {\n    return {\n      type: src\n    };\n  }\n\n  return src;\n}\n\nexport { evaluateGuard, flatten, getEventType, isArray, isBuiltInEvent, isFunction, isMachine, isObservable, isPromiseLike, isStateLike, isString, keys, mapContext, mapFilterValues, mapValues, matchesState, nestedPath, normalizeTarget, partition, path, pathToStateValue, reportUnhandledExceptionOnInvocation, symbolObservable, toArray, toArrayStrict, toEventObject, toGuard, toInvokeSource, toSCXMLEvent, toStatePath, toStatePaths, toStateValue, toTransitionConfigArray, uniqueId, updateContext, updateHistoryStates, updateHistoryValue, warn };","var IS_PRODUCTION = process.env.NODE_ENV === 'production';\nexport { IS_PRODUCTION };","var ActionTypes;\n\n(function (ActionTypes) {\n  ActionTypes[\"Start\"] = \"xstate.start\";\n  ActionTypes[\"Stop\"] = \"xstate.stop\";\n  ActionTypes[\"Raise\"] = \"xstate.raise\";\n  ActionTypes[\"Send\"] = \"xstate.send\";\n  ActionTypes[\"Cancel\"] = \"xstate.cancel\";\n  ActionTypes[\"NullEvent\"] = \"\";\n  ActionTypes[\"Assign\"] = \"xstate.assign\";\n  ActionTypes[\"After\"] = \"xstate.after\";\n  ActionTypes[\"DoneState\"] = \"done.state\";\n  ActionTypes[\"DoneInvoke\"] = \"done.invoke\";\n  ActionTypes[\"Log\"] = \"xstate.log\";\n  ActionTypes[\"Init\"] = \"xstate.init\";\n  ActionTypes[\"Invoke\"] = \"xstate.invoke\";\n  ActionTypes[\"ErrorExecution\"] = \"error.execution\";\n  ActionTypes[\"ErrorCommunication\"] = \"error.communication\";\n  ActionTypes[\"ErrorPlatform\"] = \"error.platform\";\n  ActionTypes[\"ErrorCustom\"] = \"xstate.error\";\n  ActionTypes[\"Update\"] = \"xstate.update\";\n  ActionTypes[\"Pure\"] = \"xstate.pure\";\n  ActionTypes[\"Choose\"] = \"xstate.choose\";\n})(ActionTypes || (ActionTypes = {}));\n\nvar SpecialTargets;\n\n(function (SpecialTargets) {\n  SpecialTargets[\"Parent\"] = \"#_parent\";\n  SpecialTargets[\"Internal\"] = \"#_internal\";\n})(SpecialTargets || (SpecialTargets = {}));\n\nexport { ActionTypes, SpecialTargets };","import { ActionTypes } from './types.js'; // xstate-specific action types\n\nvar start = ActionTypes.Start;\nvar stop = ActionTypes.Stop;\nvar raise = ActionTypes.Raise;\nvar send = ActionTypes.Send;\nvar cancel = ActionTypes.Cancel;\nvar nullEvent = ActionTypes.NullEvent;\nvar assign = ActionTypes.Assign;\nvar after = ActionTypes.After;\nvar doneState = ActionTypes.DoneState;\nvar log = ActionTypes.Log;\nvar init = ActionTypes.Init;\nvar invoke = ActionTypes.Invoke;\nvar errorExecution = ActionTypes.ErrorExecution;\nvar errorPlatform = ActionTypes.ErrorPlatform;\nvar error = ActionTypes.ErrorCustom;\nvar update = ActionTypes.Update;\nvar choose = ActionTypes.Choose;\nvar pure = ActionTypes.Pure;\nexport { after, assign, cancel, choose, doneState, error, errorExecution, errorPlatform, init, invoke, log, nullEvent, pure, raise, send, start, stop, update };","import { __assign, __read } from './_virtual/_tslib.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { toSCXMLEvent, isFunction, toEventObject, getEventType, isString, partition, updateContext, flatten, toArray, toGuard, evaluateGuard, warn, isArray } from './utils.js';\nimport { SpecialTargets, ActionTypes } from './types.js';\nimport { send as send$1, update, assign as assign$1, init, raise as raise$1, log as log$1, cancel as cancel$1, error as error$1, pure as pure$1, choose as choose$1 } from './actionTypes.js';\nvar initEvent = /*#__PURE__*/toSCXMLEvent({\n  type: init\n});\n\nfunction getActionFunction(actionType, actionFunctionMap) {\n  return actionFunctionMap ? actionFunctionMap[actionType] || undefined : undefined;\n}\n\nfunction toActionObject(action, actionFunctionMap) {\n  var actionObject;\n\n  if (isString(action) || typeof action === 'number') {\n    var exec = getActionFunction(action, actionFunctionMap);\n\n    if (isFunction(exec)) {\n      actionObject = {\n        type: action,\n        exec: exec\n      };\n    } else if (exec) {\n      actionObject = exec;\n    } else {\n      actionObject = {\n        type: action,\n        exec: undefined\n      };\n    }\n  } else if (isFunction(action)) {\n    actionObject = {\n      // Convert action to string if unnamed\n      type: action.name || action.toString(),\n      exec: action\n    };\n  } else {\n    var exec = getActionFunction(action.type, actionFunctionMap);\n\n    if (isFunction(exec)) {\n      actionObject = __assign(__assign({}, action), {\n        exec: exec\n      });\n    } else if (exec) {\n      var actionType = exec.type || action.type;\n      actionObject = __assign(__assign(__assign({}, exec), action), {\n        type: actionType\n      });\n    } else {\n      actionObject = action;\n    }\n  }\n\n  Object.defineProperty(actionObject, 'toString', {\n    value: function () {\n      return actionObject.type;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return actionObject;\n}\n\nvar toActionObjects = function (action, actionFunctionMap) {\n  if (!action) {\n    return [];\n  }\n\n  var actions = isArray(action) ? action : [action];\n  return actions.map(function (subAction) {\n    return toActionObject(subAction, actionFunctionMap);\n  });\n};\n\nfunction toActivityDefinition(action) {\n  var actionObject = toActionObject(action);\n  return __assign(__assign({\n    id: isString(action) ? action : actionObject.id\n  }, actionObject), {\n    type: actionObject.type\n  });\n}\n/**\r\n * Raises an event. This places the event in the internal event queue, so that\r\n * the event is immediately consumed by the machine in the current step.\r\n *\r\n * @param eventType The event to raise.\r\n */\n\n\nfunction raise(event) {\n  if (!isString(event)) {\n    return send(event, {\n      to: SpecialTargets.Internal\n    });\n  }\n\n  return {\n    type: raise$1,\n    event: event\n  };\n}\n\nfunction resolveRaise(action) {\n  return {\n    type: raise$1,\n    _event: toSCXMLEvent(action.event)\n  };\n}\n/**\r\n * Sends an event. This returns an action that will be read by an interpreter to\r\n * send the event in the next step, after the current step is finished executing.\r\n *\r\n * @param event The event to send.\r\n * @param options Options to pass into the send event:\r\n *  - `id` - The unique send event identifier (used with `cancel()`).\r\n *  - `delay` - The number of milliseconds to delay the sending of the event.\r\n *  - `to` - The target of this event (by default, the machine the event was sent from).\r\n */\n\n\nfunction send(event, options) {\n  return {\n    to: options ? options.to : undefined,\n    type: send$1,\n    event: isFunction(event) ? event : toEventObject(event),\n    delay: options ? options.delay : undefined,\n    id: options && options.id !== undefined ? options.id : isFunction(event) ? event.name : getEventType(event)\n  };\n}\n\nfunction resolveSend(action, ctx, _event, delaysMap) {\n  var meta = {\n    _event: _event\n  }; // TODO: helper function for resolving Expr\n\n  var resolvedEvent = toSCXMLEvent(isFunction(action.event) ? action.event(ctx, _event.data, meta) : action.event);\n  var resolvedDelay;\n\n  if (isString(action.delay)) {\n    var configDelay = delaysMap && delaysMap[action.delay];\n    resolvedDelay = isFunction(configDelay) ? configDelay(ctx, _event.data, meta) : configDelay;\n  } else {\n    resolvedDelay = isFunction(action.delay) ? action.delay(ctx, _event.data, meta) : action.delay;\n  }\n\n  var resolvedTarget = isFunction(action.to) ? action.to(ctx, _event.data, meta) : action.to;\n  return __assign(__assign({}, action), {\n    to: resolvedTarget,\n    _event: resolvedEvent,\n    event: resolvedEvent.data,\n    delay: resolvedDelay\n  });\n}\n/**\r\n * Sends an event to this machine's parent.\r\n *\r\n * @param event The event to send to the parent machine.\r\n * @param options Options to pass into the send event.\r\n */\n\n\nfunction sendParent(event, options) {\n  return send(event, __assign(__assign({}, options), {\n    to: SpecialTargets.Parent\n  }));\n}\n/**\r\n * Sends an update event to this machine's parent.\r\n */\n\n\nfunction sendUpdate() {\n  return sendParent(update);\n}\n/**\r\n * Sends an event back to the sender of the original event.\r\n *\r\n * @param event The event to send back to the sender\r\n * @param options Options to pass into the send event\r\n */\n\n\nfunction respond(event, options) {\n  return send(event, __assign(__assign({}, options), {\n    to: function (_, __, _a) {\n      var _event = _a._event;\n      return _event.origin; // TODO: handle when _event.origin is undefined\n    }\n  }));\n}\n\nvar defaultLogExpr = function (context, event) {\n  return {\n    context: context,\n    event: event\n  };\n};\n/**\r\n *\r\n * @param expr The expression function to evaluate which will be logged.\r\n *  Takes in 2 arguments:\r\n *  - `ctx` - the current state context\r\n *  - `event` - the event that caused this action to be executed.\r\n * @param label The label to give to the logged expression.\r\n */\n\n\nfunction log(expr, label) {\n  if (expr === void 0) {\n    expr = defaultLogExpr;\n  }\n\n  return {\n    type: log$1,\n    label: label,\n    expr: expr\n  };\n}\n\nvar resolveLog = function (action, ctx, _event) {\n  return __assign(__assign({}, action), {\n    value: isString(action.expr) ? action.expr : action.expr(ctx, _event.data, {\n      _event: _event\n    })\n  });\n};\n/**\r\n * Cancels an in-flight `send(...)` action. A canceled sent action will not\r\n * be executed, nor will its event be sent, unless it has already been sent\r\n * (e.g., if `cancel(...)` is called after the `send(...)` action's `delay`).\r\n *\r\n * @param sendId The `id` of the `send(...)` action to cancel.\r\n */\n\n\nvar cancel = function (sendId) {\n  return {\n    type: cancel$1,\n    sendId: sendId\n  };\n};\n/**\r\n * Starts an activity.\r\n *\r\n * @param activity The activity to start.\r\n */\n\n\nfunction start(activity) {\n  var activityDef = toActivityDefinition(activity);\n  return {\n    type: ActionTypes.Start,\n    activity: activityDef,\n    exec: undefined\n  };\n}\n/**\r\n * Stops an activity.\r\n *\r\n * @param activity The activity to stop.\r\n */\n\n\nfunction stop(activity) {\n  var activityDef = toActivityDefinition(activity);\n  return {\n    type: ActionTypes.Stop,\n    activity: activityDef,\n    exec: undefined\n  };\n}\n/**\r\n * Updates the current context of the machine.\r\n *\r\n * @param assignment An object that represents the partial context to update.\r\n */\n\n\nvar assign = function (assignment) {\n  return {\n    type: assign$1,\n    assignment: assignment\n  };\n};\n/**\r\n * Returns an event type that represents an implicit event that\r\n * is sent after the specified `delay`.\r\n *\r\n * @param delayRef The delay in milliseconds\r\n * @param id The state node ID where this event is handled\r\n */\n\n\nfunction after(delayRef, id) {\n  var idSuffix = id ? \"#\" + id : '';\n  return ActionTypes.After + \"(\" + delayRef + \")\" + idSuffix;\n}\n/**\r\n * Returns an event that represents that a final state node\r\n * has been reached in the parent state node.\r\n *\r\n * @param id The final state node's parent state node `id`\r\n * @param data The data to pass into the event\r\n */\n\n\nfunction done(id, data) {\n  var type = ActionTypes.DoneState + \".\" + id;\n  var eventObject = {\n    type: type,\n    data: data\n  };\n\n  eventObject.toString = function () {\n    return type;\n  };\n\n  return eventObject;\n}\n/**\r\n * Returns an event that represents that an invoked service has terminated.\r\n *\r\n * An invoked service is terminated when it has reached a top-level final state node,\r\n * but not when it is canceled.\r\n *\r\n * @param id The final state node ID\r\n * @param data The data to pass into the event\r\n */\n\n\nfunction doneInvoke(id, data) {\n  var type = ActionTypes.DoneInvoke + \".\" + id;\n  var eventObject = {\n    type: type,\n    data: data\n  };\n\n  eventObject.toString = function () {\n    return type;\n  };\n\n  return eventObject;\n}\n\nfunction error(id, data) {\n  var type = ActionTypes.ErrorPlatform + \".\" + id;\n  var eventObject = {\n    type: type,\n    data: data\n  };\n\n  eventObject.toString = function () {\n    return type;\n  };\n\n  return eventObject;\n}\n\nfunction pure(getActions) {\n  return {\n    type: ActionTypes.Pure,\n    get: getActions\n  };\n}\n/**\r\n * Forwards (sends) an event to a specified service.\r\n *\r\n * @param target The target service to forward the event to.\r\n * @param options Options to pass into the send action creator.\r\n */\n\n\nfunction forwardTo(target, options) {\n  return send(function (_, event) {\n    return event;\n  }, __assign(__assign({}, options), {\n    to: target\n  }));\n}\n/**\r\n * Escalates an error by sending it as an event to this machine's parent.\r\n *\r\n * @param errorData The error data to send, or the expression function that\r\n * takes in the `context`, `event`, and `meta`, and returns the error data to send.\r\n * @param options Options to pass into the send action creator.\r\n */\n\n\nfunction escalate(errorData, options) {\n  return sendParent(function (context, event, meta) {\n    return {\n      type: error$1,\n      data: isFunction(errorData) ? errorData(context, event, meta) : errorData\n    };\n  }, __assign(__assign({}, options), {\n    to: SpecialTargets.Parent\n  }));\n}\n\nfunction choose(conds) {\n  return {\n    type: ActionTypes.Choose,\n    conds: conds\n  };\n}\n\nfunction resolveActions(machine, currentState, currentContext, _event, actions) {\n  var _a = __read(partition(actions, function (action) {\n    return action.type === assign$1;\n  }), 2),\n      assignActions = _a[0],\n      otherActions = _a[1];\n\n  var updatedContext = assignActions.length ? updateContext(currentContext, _event, assignActions, currentState) : currentContext;\n  var resolvedActions = flatten(otherActions.map(function (actionObject) {\n    var _a;\n\n    switch (actionObject.type) {\n      case raise$1:\n        return resolveRaise(actionObject);\n\n      case send$1:\n        var sendAction = resolveSend(actionObject, updatedContext, _event, machine.options.delays); // TODO: fix ActionTypes.Init\n\n        if (!IS_PRODUCTION) {\n          // warn after resolving as we can create better contextual message here\n          warn(!isString(actionObject.delay) || typeof sendAction.delay === 'number', // tslint:disable-next-line:max-line-length\n          \"No delay reference for delay expression '\" + actionObject.delay + \"' was found on machine '\" + machine.id + \"'\");\n        }\n\n        return sendAction;\n\n      case log$1:\n        return resolveLog(actionObject, updatedContext, _event);\n\n      case choose$1:\n        {\n          var chooseAction = actionObject;\n          var matchedActions = (_a = chooseAction.conds.find(function (condition) {\n            var guard = toGuard(condition.cond, machine.options.guards);\n            return !guard || evaluateGuard(machine, guard, updatedContext, _event, currentState);\n          })) === null || _a === void 0 ? void 0 : _a.actions;\n\n          if (!matchedActions) {\n            return [];\n          }\n\n          var resolved = resolveActions(machine, currentState, updatedContext, _event, toActionObjects(toArray(matchedActions), machine.options.actions));\n          updatedContext = resolved[1];\n          return resolved[0];\n        }\n\n      case pure$1:\n        {\n          var matchedActions = actionObject.get(updatedContext, _event.data);\n\n          if (!matchedActions) {\n            return [];\n          }\n\n          var resolved = resolveActions(machine, currentState, updatedContext, _event, toActionObjects(toArray(matchedActions), machine.options.actions));\n          updatedContext = resolved[1];\n          return resolved[0];\n        }\n\n      default:\n        return toActionObject(actionObject, machine.options.actions);\n    }\n  }));\n  return [resolvedActions, updatedContext];\n}\n\nexport { after, assign, cancel, choose, done, doneInvoke, error, escalate, forwardTo, getActionFunction, initEvent, log, pure, raise, resolveActions, resolveLog, resolveRaise, resolveSend, respond, send, sendParent, sendUpdate, start, stop, toActionObject, toActionObjects, toActivityDefinition };","var STATE_DELIMITER = '.';\nvar EMPTY_ACTIVITY_MAP = {};\nvar DEFAULT_GUARD_TYPE = 'xstate.guard';\nvar TARGETLESS_KEY = '';\nexport { DEFAULT_GUARD_TYPE, EMPTY_ACTIVITY_MAP, STATE_DELIMITER, TARGETLESS_KEY };","import { __values, __spread } from './_virtual/_tslib.js';\nimport { keys, flatten } from './utils.js';\n\nvar isLeafNode = function (stateNode) {\n  return stateNode.type === 'atomic' || stateNode.type === 'final';\n};\n\nfunction getChildren(stateNode) {\n  return keys(stateNode.states).map(function (key) {\n    return stateNode.states[key];\n  });\n}\n\nfunction getAllStateNodes(stateNode) {\n  var stateNodes = [stateNode];\n\n  if (isLeafNode(stateNode)) {\n    return stateNodes;\n  }\n\n  return stateNodes.concat(flatten(getChildren(stateNode).map(getAllStateNodes)));\n}\n\nfunction getConfiguration(prevStateNodes, stateNodes) {\n  var e_1, _a, e_2, _b, e_3, _c, e_4, _d;\n\n  var prevConfiguration = new Set(prevStateNodes);\n  var prevAdjList = getAdjList(prevConfiguration);\n  var configuration = new Set(stateNodes);\n\n  try {\n    // add all ancestors\n    for (var configuration_1 = __values(configuration), configuration_1_1 = configuration_1.next(); !configuration_1_1.done; configuration_1_1 = configuration_1.next()) {\n      var s = configuration_1_1.value;\n      var m = s.parent;\n\n      while (m && !configuration.has(m)) {\n        configuration.add(m);\n        m = m.parent;\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configuration_1_1 && !configuration_1_1.done && (_a = configuration_1.return)) _a.call(configuration_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  var adjList = getAdjList(configuration);\n\n  try {\n    // add descendants\n    for (var configuration_2 = __values(configuration), configuration_2_1 = configuration_2.next(); !configuration_2_1.done; configuration_2_1 = configuration_2.next()) {\n      var s = configuration_2_1.value; // if previously active, add existing child nodes\n\n      if (s.type === 'compound' && (!adjList.get(s) || !adjList.get(s).length)) {\n        if (prevAdjList.get(s)) {\n          prevAdjList.get(s).forEach(function (sn) {\n            return configuration.add(sn);\n          });\n        } else {\n          s.initialStateNodes.forEach(function (sn) {\n            return configuration.add(sn);\n          });\n        }\n      } else {\n        if (s.type === 'parallel') {\n          try {\n            for (var _e = (e_3 = void 0, __values(getChildren(s))), _f = _e.next(); !_f.done; _f = _e.next()) {\n              var child = _f.value;\n\n              if (child.type === 'history') {\n                continue;\n              }\n\n              if (!configuration.has(child)) {\n                configuration.add(child);\n\n                if (prevAdjList.get(child)) {\n                  prevAdjList.get(child).forEach(function (sn) {\n                    return configuration.add(sn);\n                  });\n                } else {\n                  child.initialStateNodes.forEach(function (sn) {\n                    return configuration.add(sn);\n                  });\n                }\n              }\n            }\n          } catch (e_3_1) {\n            e_3 = {\n              error: e_3_1\n            };\n          } finally {\n            try {\n              if (_f && !_f.done && (_c = _e.return)) _c.call(_e);\n            } finally {\n              if (e_3) throw e_3.error;\n            }\n          }\n        }\n      }\n    }\n  } catch (e_2_1) {\n    e_2 = {\n      error: e_2_1\n    };\n  } finally {\n    try {\n      if (configuration_2_1 && !configuration_2_1.done && (_b = configuration_2.return)) _b.call(configuration_2);\n    } finally {\n      if (e_2) throw e_2.error;\n    }\n  }\n\n  try {\n    // add all ancestors\n    for (var configuration_3 = __values(configuration), configuration_3_1 = configuration_3.next(); !configuration_3_1.done; configuration_3_1 = configuration_3.next()) {\n      var s = configuration_3_1.value;\n      var m = s.parent;\n\n      while (m && !configuration.has(m)) {\n        configuration.add(m);\n        m = m.parent;\n      }\n    }\n  } catch (e_4_1) {\n    e_4 = {\n      error: e_4_1\n    };\n  } finally {\n    try {\n      if (configuration_3_1 && !configuration_3_1.done && (_d = configuration_3.return)) _d.call(configuration_3);\n    } finally {\n      if (e_4) throw e_4.error;\n    }\n  }\n\n  return configuration;\n}\n\nfunction getValueFromAdj(baseNode, adjList) {\n  var childStateNodes = adjList.get(baseNode);\n\n  if (!childStateNodes) {\n    return {}; // todo: fix?\n  }\n\n  if (baseNode.type === 'compound') {\n    var childStateNode = childStateNodes[0];\n\n    if (childStateNode) {\n      if (isLeafNode(childStateNode)) {\n        return childStateNode.key;\n      }\n    } else {\n      return {};\n    }\n  }\n\n  var stateValue = {};\n  childStateNodes.forEach(function (csn) {\n    stateValue[csn.key] = getValueFromAdj(csn, adjList);\n  });\n  return stateValue;\n}\n\nfunction getAdjList(configuration) {\n  var e_5, _a;\n\n  var adjList = new Map();\n\n  try {\n    for (var configuration_4 = __values(configuration), configuration_4_1 = configuration_4.next(); !configuration_4_1.done; configuration_4_1 = configuration_4.next()) {\n      var s = configuration_4_1.value;\n\n      if (!adjList.has(s)) {\n        adjList.set(s, []);\n      }\n\n      if (s.parent) {\n        if (!adjList.has(s.parent)) {\n          adjList.set(s.parent, []);\n        }\n\n        adjList.get(s.parent).push(s);\n      }\n    }\n  } catch (e_5_1) {\n    e_5 = {\n      error: e_5_1\n    };\n  } finally {\n    try {\n      if (configuration_4_1 && !configuration_4_1.done && (_a = configuration_4.return)) _a.call(configuration_4);\n    } finally {\n      if (e_5) throw e_5.error;\n    }\n  }\n\n  return adjList;\n}\n\nfunction getValue(rootNode, configuration) {\n  var config = getConfiguration([rootNode], configuration);\n  return getValueFromAdj(rootNode, getAdjList(config));\n}\n\nfunction has(iterable, item) {\n  if (Array.isArray(iterable)) {\n    return iterable.some(function (member) {\n      return member === item;\n    });\n  }\n\n  if (iterable instanceof Set) {\n    return iterable.has(item);\n  }\n\n  return false; // TODO: fix\n}\n\nfunction nextEvents(configuration) {\n  return flatten(__spread(new Set(configuration.map(function (sn) {\n    return sn.ownEvents;\n  }))));\n}\n\nfunction isInFinalState(configuration, stateNode) {\n  if (stateNode.type === 'compound') {\n    return getChildren(stateNode).some(function (s) {\n      return s.type === 'final' && has(configuration, s);\n    });\n  }\n\n  if (stateNode.type === 'parallel') {\n    return getChildren(stateNode).every(function (sn) {\n      return isInFinalState(configuration, sn);\n    });\n  }\n\n  return false;\n}\n\nexport { getAdjList, getAllStateNodes, getChildren, getConfiguration, getValue, has, isInFinalState, isLeafNode, nextEvents };"],"sourceRoot":""}