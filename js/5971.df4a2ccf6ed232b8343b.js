"use strict";(self.webpackChunkkoku_ui=self.webpackChunkkoku_ui||[]).push([[5971],{55246:(e,t,r)=>{r.d(t,{C:()=>pe});var a=r(90154),s=r(97027),i=r(92950),n=r.n(i),o=r(74806),l=r(52471),c=r(55672),u=r(2985),p=r(47947),m=r(19727),h=r(86482),d=r(1156),g=r(5842),y=r(98499);const f={content:{paddingBottom:y.ZP.value,paddingLeft:y.ZP.value,paddingRight:y.ZP.value,paddingTop:y.ZP.value}};var b=r(71973),v=r(39333),C=r(77760),E=r(39836),T=r(91919),S=r(6279),D=r(6450),Z=r(38935),O=r(97698),P=r(55785),L=r(50081),x=r(37269),k=r(48949),R=r(14483),M=r(23992),w=r(11331),_=r(48196);const j={dataListHeading:{fontWeight:M.ZP.value},groupByHeading:{marginBottom:y.ZP.value},tagLink:{marginLeft:_.ZP.value},tagsContainer:{marginRight:w.ZP.value,marginTop:_.ZP.value}};class V extends n().Component{constructor(){super(...arguments),this.getDataListItems=()=>{const{tagReport:e}=this.props,t=[];if(e)for(const r of e.data)for(const e of r.values){const s=`${r.key}:${e}`;t.push(n().createElement(a.DataListItem,{"aria-labelledby":s,key:`${s}-item`},n().createElement(a.DataListItemRow,null,n().createElement(a.DataListItemCells,{dataListCells:[n().createElement(a.DataListCell,{key:`${s}-cell1`},n().createElement("span",{id:s},r.key)),n().createElement(a.DataListCell,{key:`${s}-cell2`},e)]}))))}return t}}render(){const{groupBy:e,groupByValue:t,intl:r}=this.props,i=this.getDataListItems();return n().createElement(n().Fragment,null,n().createElement("div",null,n().createElement("span",{style:j.dataListHeading},r.formatMessage(s.Z.groupByValues,{value:e,count:1}))),n().createElement("div",{style:j.groupByHeading},n().createElement("span",null,t)),n().createElement(a.DataList,{"aria-label":r.formatMessage(s.Z.tagNames),isCompact:!0},n().createElement(a.DataListItem,{"aria-labelledby":"heading1"},n().createElement(a.DataListItemRow,null,n().createElement(a.DataListItemCells,{dataListCells:[n().createElement(a.DataListCell,{key:"primary content"},n().createElement("span",{id:"heading1",style:j.dataListHeading},r.formatMessage(s.Z.tagHeadingKey))),n().createElement(a.DataListCell,{key:"secondary content"},n().createElement("span",{id:"heading2",style:j.dataListHeading},r.formatMessage(s.Z.tagHeadingValue)))]}))),i.map((e=>e))))}}const B=(0,o.ZP)((0,C.connect)()(V)),U=L.Q.tag;class F extends n().Component{constructor(e){super(e),this.getTagValueCount=()=>{const{tagReport:e}=this.props;let t=0;if(e)for(const r of e.data)r.values&&(t+=r.values.length);return t},this.handleClose=()=>{this.props.onClose(!1)},this.handleClose=this.handleClose.bind(this)}componentDidMount(){const{fetchTag:e,tagPathsType:t,tagQueryString:r}=this.props;e(t,U,r)}componentDidUpdate(e){const{fetchTag:t,tagPathsType:r,tagQueryString:a}=this.props;e.tagQueryString!==a&&t(r,U,a)}shouldComponentUpdate(e){const{groupByValue:t,isOpen:r}=this.props;return e.groupByValue!==t||e.isOpen!==r}render(){const{groupBy:e,intl:t,isOpen:r,query:i,tagReport:o}=this.props,l=i&&i.filter&&i.filter.account?i.filter.account:this.props.groupByValue;return n().createElement(a.Modal,{isOpen:r,onClose:this.handleClose,title:t.formatMessage(s.Z.tagHeadingTitle,{value:this.getTagValueCount()}),width:"50%"},n().createElement(B,{groupBy:e,groupByValue:this.props.isPlatformCosts?R.rx:l,tagReport:o}))}}const z=(0,d.X1)(((e,{router:t,tagPathsType:r})=>{const a=(0,v.mB)(t.location.search),s=(0,v.fU)(a),i=(0,x.OA)(a),n=i?R.dV:(0,x.VL)(a),o=i||(0,x.pe)(a),l=s&&s.filter_by?s.filter_by:{};for(const e of Object.keys(l))-1!==e.indexOf(R.P)&&(l[e]=void 0);const c=Object.assign({},a),u={filter:{resolution:"monthly",time_scope_units:"month",time_scope_value:-1},filter_by:Object.assign(Object.assign(Object.assign(Object.assign({},l),a&&a.isPlatformCosts&&{category:R.rx}),a&&a.filter&&a.filter.account&&{[`${R.Sq}account`]:a.filter.account}),n&&"*"!==o&&-1===n.indexOf(R.P)&&{[n]:o})},p=(0,v.pm)(u),m=k.ux.selectTag(e,r,U,p),h=k.ux.selectTagFetchStatus(e,r,U,p);return{groupBy:n,groupByValue:o,isPlatformCosts:a&&a.isPlatformCosts,query:c,tagReport:m,tagReportFetchStatus:h,tagQueryString:p}})),N={fetchTag:k.xr.Xt},Q=(0,o.ZP)((0,g.E)((0,C.connect)(z,N)(F))),A=L.Q.tag;class I extends n().Component{constructor(e){super(e),this.defaultState={isOpen:!1},this.state=Object.assign({},this.defaultState),this.handleClose=e=>{this.setState({isOpen:e})},this.handleOpen=e=>(this.setState({isOpen:!0}),e.preventDefault(),!1),this.handleClose=this.handleClose.bind(this),this.handleOpen=this.handleOpen.bind(this)}componentDidMount(){const{fetchTag:e,tagPathsType:t,tagQueryString:r}=this.props;e(t,A,r)}componentDidUpdate(e){const{fetchTag:t,tagPathsType:r,tagQueryString:a}=this.props;e.tagQueryString!==a&&t(r,A,a)}render(){const{id:e,tagReport:t,tagPathsType:r}=this.props,{isOpen:a}=this.state;let s=0;if(t)for(const e of t.data)e.values&&(s+=e.values.length);return n().createElement("div",{style:j.tagsContainer,id:e},s>0&&n().createElement(n().Fragment,null,n().createElement(P.lO,null),n().createElement("a",{"data-testid":"tag-lnk",href:"#/",onClick:this.handleOpen,style:j.tagLink},s)),n().createElement(Q,{isOpen:a,onClose:this.handleClose,tagPathsType:r}))}}const q=(0,d.X1)(((e,{router:t,tagPathsType:r})=>{const a=(0,v.mB)(t.location.search),s=(0,v.fU)(a),i=(0,x.OA)(a),n=i?R.dV:(0,x.VL)(a),o=i||(0,x.pe)(a),l=s&&s.filter_by?s.filter_by:{};for(const e of Object.keys(l))-1!==e.indexOf(R.P)&&(l[e]=void 0);const c=Object.assign({},a),u={filter:{resolution:"monthly",time_scope_units:"month",time_scope_value:-1},filter_by:Object.assign(Object.assign(Object.assign(Object.assign({},l),a&&a.isPlatformCosts&&{category:R.rx}),a&&a.filter&&a.filter.account&&{[`${R.Sq}account`]:a.filter.account}),n&&"*"!==o&&-1===n.indexOf(R.P)&&{[n]:o})},p=(0,v.pm)(u);return{groupBy:n,groupByValue:o,query:c,tagReport:k.ux.selectTag(e,r,A,p),tagReportFetchStatus:k.ux.selectTagFetchStatus(e,r,A,p),tagQueryString:p}})),W={fetchTag:k.xr.Xt},G=(0,o.ZP)((0,g.E)((0,C.connect)(q,W)(I)));var $=r(22369),H=r(45087),X=r(91778),J=r(68025),K=r(72892),Y=r(12289),ee=r(40794),te=r(32412),re=r(57640),ae=r(43789);const se={cost:{marginTop:re.ZP.var},costDistribution:{marginTop:te.ZP.var},costLabel:{marginTop:ae.ZP.var},costValue:{marginTop:0,marginBottom:0,textAlign:"right"},costLabelDate:{textAlign:"right"},costType:{marginTop:te.ZP.var},header:{backgroundColor:K.ZP.var,paddingLeft:y.ZP.var,paddingRight:y.ZP.var,paddingTop:y.ZP.var},headerContent:{display:"flex",justifyContent:"space-between"},headerContentRight:{display:"flex"},infoDescription:{color:Y.ZP.value,fontSize:ee.ZP.value},tabs:{display:"flex"},tag:{marginLeft:y.ZP.var},title:{paddingBottom:y.ZP.var,paddingTop:ae.ZP.var}};class ie extends n().Component{constructor(){super(...arguments),this.buildDetailsLink=e=>{const{groupBy:t,isOptimizationsPath:r,query:a}=this.props;let s=t,i="*";a[R.dV]&&(s=R.dV,i=a[R.dV]);const n=a.state?window.atob(a.state):void 0,o=Object.assign(Object.assign({},n&&JSON.parse(n)),!r&&{group_by:{[s]:i}});return`${e}?${(0,v.IV)(o)}`},this.getBackToLink=e=>{const{detailsURL:t,intl:r,isOptimizationsPath:a,tagPathsType:i}=this.props;return a?n().createElement(E.Link,{to:this.buildDetailsLink((0,J.dI)(T._.optimizations.path))},r.formatMessage(s.Z.breakdownBackToOptimizations)):n().createElement(E.Link,{to:this.buildDetailsLink(t)},r.formatMessage(s.Z.breakdownBackToDetails,{value:r.formatMessage(s.Z.breakdownBackToTitles,{value:i}),groupBy:e}))},this.getTotalCost=()=>{const{costDistribution:e,report:t}=this.props,r=e||Z.Qf.total,a=t&&t.meta&&t.meta.total&&t.meta.total.cost&&t.meta.total.cost[r];return(0,X.xG)(a?t.meta.total.cost[r].value:0,a?t.meta.total.cost[r].units:"USD")}}render(){const{costDistribution:e,costType:t,currency:r,description:i,groupBy:o,intl:l,isCostDistributionFeatureEnabled:c,onCostDistributionSelected:u,onCostTypeSelected:p,onCurrencySelected:m,query:h,showCostDistribution:d,showCostType:g,tabs:y,tagPathsType:f,title:v}=this.props,C=h&&h.filter?h.filter.account:void 0,E=(0,x.Sn)(h),T=(0,x.OA)(h),Z=(0,x.qV)(h),P=C||"account"===o||"gcp_project"===o||"payer_tenant_id"===o||"project"===o||"subscription_guid"===o,L=C?"account":E?R.tZ:Z?R.up:T?R.dV:o;return n().createElement("header",{style:se.header},n().createElement("div",{style:se.headerContent},n().createElement("nav",{"aria-label":l.formatMessage(s.Z.breakdownBackToDetailsAriaLabel),className:"breadcrumbOverride"},n().createElement("ol",{className:"pf-c-breadcrumb__list"},n().createElement("li",{className:"pf-c-breadcrumb__item"},n().createElement("span",{className:"pf-c-breadcrumb__item-divider"},n().createElement(b.fP,null)),this.getBackToLink(L)))),n().createElement("div",{style:se.headerContentRight},n().createElement(D.F,{currency:r,onSelect:m}))),n().createElement("div",{style:se.headerContent},n().createElement("div",{style:se.title},n().createElement(a.Title,{headingLevel:"h1",size:a.TitleSizes["2xl"]},l.formatMessage(s.Z.breakdownTitle,{value:v}),i&&n().createElement("div",{style:se.infoDescription},i)),d&&c&&n().createElement("div",{style:se.costDistribution},n().createElement(O.N,{costDistribution:e,onSelect:u})),g&&n().createElement("div",{style:se.costType},n().createElement(S.T,{onSelect:p,costType:t}))),n().createElement("div",{style:se.cost},n().createElement("div",{style:se.costLabel},n().createElement(a.Title,{headingLevel:"h2",style:se.costValue,size:a.TitleSizes["4xl"]},n().createElement("span",null,this.getTotalCost()))),n().createElement("div",{style:se.costLabelDate},(0,H.Y$)(l.formatMessage(s.Z.groupByValuesTitleCase,{value:L,count:2}))))),n().createElement("div",null,n().createElement("div",{style:se.tabs},y,n().createElement("div",{style:se.tag},P&&n().createElement(G,{id:"tags",tagPathsType:f})))))}}const ne=(0,d.X1)(((e,{router:t})=>{const r=(0,v.mB)(t.location.search);return{isCostDistributionFeatureEnabled:$.iJ.selectIsCostDistributionFeatureEnabled(e),isOptimizationsPath:void 0!==r.optimizationsPath}})),oe=(0,o.ZP)((0,g.E)((0,C.connect)(ne,{})(ie)));var le;!function(e){e.costOverview="cost-overview",e.historicalData="historical-data",e.optimizations="optimizations"}(le||(le={}));const ce=e=>{switch(e){case le.costOverview:return"cost-overview";case le.historicalData:return"historical-data";case le.optimizations:return"optimizations"}};class ue extends n().Component{constructor(){super(...arguments),this.defaultState={activeTabKey:this.props.isOptimizationsTab?2:0},this.state=Object.assign({},this.defaultState),this.getAvailableTabs=()=>{const{costOverviewComponent:e,historicalDataComponent:t,isRosFeatureEnabled:r,optimizationsBadgeComponent:a,optimizationsComponent:s}=this.props,i=[];return e&&i.push({contentRef:n().createRef(),tab:le.costOverview}),t&&i.push({contentRef:n().createRef(),tab:le.historicalData}),s&&r&&i.push({badge:a,contentRef:n().createRef(),tab:le.optimizations}),i},this.getTab=(e,t,r,s)=>n().createElement(a.Tab,{eventKey:s,key:`${ce(e)}-tab`,tabContentId:`tab-${s}`,tabContentRef:t,title:n().createElement(n().Fragment,null,n().createElement(a.TabTitleText,null,this.getTabTitle(e)),r&&n().createElement("span",null,r))}),this.getTabContent=e=>e.map(((e,t)=>n().createElement(a.TabContent,{eventKey:t,key:`${ce(e.tab)}-tabContent`,id:`tab-${t}`,ref:e.contentRef},this.getTabItem(e.tab,t)))),this.getTabItem=(e,t)=>{const{costOverviewComponent:r,historicalDataComponent:a,optimizationsComponent:s}=this.props,{activeTabKey:i}=this.state,o=n().createElement(n().Fragment,null);if(i!==t)return o;const l=ce(e);return l===le.costOverview?r:l===le.historicalData?a:l===le.optimizations?s:o},this.getTabs=e=>{const{activeTabKey:t}=this.state;return n().createElement(a.Tabs,{activeKey:t,onSelect:this.handleTabClick},e.map(((e,t)=>this.getTab(e.tab,e.contentRef,e.badge,t))))},this.getTabTitle=e=>{const{intl:t}=this.props;return e===le.costOverview?t.formatMessage(s.Z.breakdownCostOverviewTitle):e===le.historicalData?t.formatMessage(s.Z.breakdownHistoricalDataTitle):e===le.optimizations?t.formatMessage(s.Z.optimizations):void 0},this.handleTabClick=(e,t)=>{const{closeOptimizationsDrawer:r}=this.props,{activeTabKey:a}=this.state;a!==t&&this.setState({activeTabKey:t},(()=>{r&&r()}))},this.updateReport=()=>{const{fetchReport:e,reportPathsType:t,reportType:r,reportQueryString:a}=this.props;e(t,r,a)}}componentDidMount(){this.updateReport()}componentDidUpdate(e){const{report:t,reportError:r,reportQueryString:a,router:s}=this.props,i=e.reportQueryString!==a,n=!t&&!r,o=!s.location.search;(i||n||o)&&this.updateReport()}render(){const{costDistribution:e,costType:t,currency:r,description:a,detailsURL:s,emptyStateTitle:i,groupBy:o,providers:g,providersFetchStatus:y,providerType:b,query:v,report:C,reportError:E,reportFetchStatus:T,router:S,showCostDistribution:D,showCostType:Z,tagPathsType:O,title:P}=this.props,L=this.getAvailableTabs();if(E)return n().createElement(p.W,{title:i});if(y===d.iF.inProgress&&T===d.iF.inProgress)return n().createElement(l.g,{title:i});if(y===d.iF.complete&&T===d.iF.complete){if(g&&g.meta&&0===g.meta.count&&y===d.iF.complete)return n().createElement(u.L,{providerType:b,title:i});if(!(0,h.g8)(g))return n().createElement(c.J,{title:P})}return n().createElement(n().Fragment,null,n().createElement(oe,{costDistribution:e,costType:t,currency:r,description:a,detailsURL:s,groupBy:o,onCostDistributionSelected:e=>(0,m.bU)(v,S,e),onCostTypeSelected:e=>(0,m.ft)(v,S,e),onCurrencySelected:e=>(0,m.LB)(v,S,e),query:v,report:C,showCostDistribution:D,showCostType:Z,tabs:this.getTabs(L),tagPathsType:O,title:P}),n().createElement("div",{style:f.content},this.getTabContent(L)))}}const pe=(0,o.ZP)((0,g.E)(ue))},27769:(e,t,r)=>{r.d(t,{X:()=>be});var a=r(90154),s=r(91290),i=r(97027),n=r(92950),o=r.n(n),l=r(74806),c=r(69511),u=r(11331),p=r(48196);const m={clustersContainer:{marginRight:u.ZP.value,marginTop:p.ZP.value}};class h extends o().Component{render(){const{clusters:e=[]}=this.props;return 0===e.length?null:e.map(((e,t)=>o().createElement("div",{key:`cluster-${t}`},e)))}}const d=(0,l.ZP)(h),g={modal:{height:"700px",width:"600px"},subTitle:{marginTop:r(91707).ZP.value,textAlign:"right"}};class y extends o().Component{constructor(e){super(e),this.handleClose=()=>{this.props.onClose(!1)},this.handleClose=this.handleClose.bind(this)}shouldComponentUpdate(e){const{clusters:t,isOpen:r}=this.props;return e.clusters!==t||e.isOpen!==r}render(){const{clusters:e,groupBy:t,intl:r,isOpen:s,title:n}=this.props;return o().createElement(a.Modal,{className:"modalOverride",style:g.modal,isOpen:s,onClose:this.handleClose,title:r.formatMessage(i.Z.detailsClustersModalTitle,{groupBy:t,name:n}),width:"50%"},o().createElement(d,{clusters:e}))}}const f=(0,l.ZP)(y);class b extends o().Component{constructor(e){super(e),this.defaultState={isOpen:!1,showAll:!1},this.state=Object.assign({},this.defaultState),this.handleClose=e=>{this.setState({isOpen:e})},this.handleOpen=e=>(this.setState({isOpen:!0}),e.preventDefault(),!1),this.handleClose=this.handleClose.bind(this),this.handleOpen=this.handleOpen.bind(this)}render(){const{groupBy:e,intl:t,report:r,title:s}=this.props,{isOpen:n,showAll:l}=this.state,u=[],p=[],h=(0,c.R)({report:r,idKey:e}),d=[];if(h.map((e=>{e.clusters&&e.clusters.map((e=>{d.includes(e)||d.push(e)}))})),0===d.length)return null;d.sort(((e,t)=>e<t?-1:e>t?1:0));for(const e of d){let t=u.length>0?`, ${e}`:e;l?u.push(t):u.length<2&&(t.length>45?(t=t.slice(0,45).trim().concat("..."),u.push(o().createElement(a.Tooltip,{content:e,enableFlip:!0},o().createElement("span",null,t)))):u.push(t)),p.push(e)}return o().createElement("div",{style:m.clustersContainer},u&&u.map(((e,t)=>o().createElement("span",{key:t},e))),u.length<p.length&&o().createElement("a",{"data-testid":"cluster-lnk",href:"#/",onClick:this.handleOpen},t.formatMessage(i.Z.detailsMoreClusters,{value:p.length-u.length})),o().createElement(f,{clusters:d,groupBy:e,isOpen:n,onClose:this.handleClose,title:s}))}}const v=(0,l.ZP)(b);var C=r(10310),E=r(80469),T=r(34502),S=r(30950),D=r(1156),Z=r(91778),O=r(20513),P=r(23992),L=r(32412);const x={chartHeight:150,chartWidth:475,subTitle:{fontWeight:P.ZP.value}},k={chartSkeleton:{height:"125px",marginBottom:L.ZP.value,marginTop:u.ZP.value}};class R extends o().Component{constructor(){super(...arguments),this.getLegendLabel=()=>e=>{var{values:t}=e,r=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(r[a[s]]=e[a[s]])}return r}(e,["values"]);return o().createElement(C.Df,Object.assign({},r,{style:[{fontWeight:x.subTitle.fontWeight},{}],text:[t[r.index],r.text]}))},this.getSkeleton=()=>o().createElement(o().Fragment,null,o().createElement(a.Skeleton,{style:k.chartSkeleton,width:O.N.md}))}render(){const{name:e,report:t,reportFetchStatus:r,intl:a}=this.props,s=t&&t.meta&&t.meta.total&&t.meta.total.cost,n=s&&t.meta.total.cost.markup,l=s&&t.meta.total.cost.raw,c=s&&t.meta.total.cost.usage,u=n?t.meta.total.cost.markup.units:"USD",p=l?t.meta.total.cost.raw.units:"USD",m=c?t.meta.total.cost.usage.units:"USD",h=n?t.meta.total.cost.markup.value:0,d=l?t.meta.total.cost.raw.value:0,g=c?t.meta.total.cost.usage.value:0,y=(0,Z.xG)(n?t.meta.total.cost.markup.value:0,u),f=(0,Z.xG)(l?t.meta.total.cost.raw.value:0,p),b=(0,Z.xG)(c?t.meta.total.cost.usage.value:0,m),v=a.formatMessage(i.Z.markupTitle),C=a.formatMessage(i.Z.rawCostTitle),O=a.formatMessage(i.Z.usageCostTitle),P=this.getLegendLabel(),L=o().createElement(E.Qk,{gutter:80,itemsPerRow:2,labelComponent:o().createElement(P,{dy:10,lineHeight:1.5,values:[f,y,b]}),rowGutter:20});return o().createElement("div",{style:{height:x.chartHeight,width:x.chartWidth}},r===D.iF.inProgress?this.getSkeleton():o().createElement(T.Td,{ariaDesc:a.formatMessage(i.Z.costBreakdownAriaDesc),ariaTitle:a.formatMessage(i.Z.costBreakdownTitle),constrainToVisibleArea:!0,data:[{x:C,y:d,units:p},{x:v,y:h,units:u},{x:O,y:g,units:m}],height:x.chartHeight,labels:({datum:e})=>a.formatMessage(i.Z.costBreakdownTooltip,{name:e.x,value:(0,Z.xG)(e.y,e.units)}),legendComponent:L,legendData:[{name:C},{name:v},{name:O}],legendOrientation:"vertical",legendPosition:"right",name:e,padding:{bottom:20,left:0,right:275,top:20},themeColor:S.nz.green,width:x.chartWidth}))}}const M=(0,l.ZP)(R);var w=r(38935);const _={chartHeight:150,chartWidth:525,subTitle:{fontWeight:P.ZP.value}},j={chartSkeleton:{height:"125px",marginBottom:L.ZP.value,marginTop:u.ZP.value}};class V extends o().Component{constructor(){super(...arguments),this.getLegendLabel=()=>e=>{var{values:t}=e,r=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(r[a[s]]=e[a[s]])}return r}(e,["values"]);return o().createElement(C.Df,Object.assign({},r,{style:[{fontWeight:_.subTitle.fontWeight},{}],text:[t[r.index],r.text]}))},this.getSkeleton=()=>o().createElement(o().Fragment,null,o().createElement(a.Skeleton,{style:j.chartSkeleton,width:O.N.md}))}render(){const{costDistribution:e,name:t,report:r,reportFetchStatus:a,intl:s}=this.props,n=r&&r.meta&&r.meta.total&&r.meta.total.cost,l=n&&e===w.Qf.distributed&&r.meta.total.cost.platform_distributed,c=n&&e===w.Qf.distributed&&r.meta.total.cost.worker_unallocated_distributed,u=n&&r.meta.total.cost.total,p=l?r.meta.total.cost.platform_distributed.units:"USD",m=c?r.meta.total.cost.worker_unallocated_distributed.units:"USD",h=u?r.meta.total.cost.total.units:"USD",d=l&&r.meta.total.cost.platform_distributed.value>0?r.meta.total.cost.platform_distributed.value:0,g=c&&r.meta.total.cost.worker_unallocated_distributed.value>0?r.meta.total.cost.worker_unallocated_distributed.value:0,y=u?r.meta.total.cost.total.value:0,f=(0,Z.xG)(d,p),b=(0,Z.xG)(g,m),v=(0,Z.xG)(y,h),C=s.formatMessage(i.Z.platformDistributed),O=s.formatMessage(i.Z.workerUnallocated),P=s.formatMessage(i.Z.allOtherProjectCosts),L=this.getLegendLabel(),x=o().createElement(E.Qk,{gutter:30,itemsPerRow:2,labelComponent:o().createElement(L,{dy:10,lineHeight:1.5,values:[f,b,v]}),rowGutter:20});return o().createElement("div",{style:{height:_.chartHeight,width:_.chartWidth}},a===D.iF.inProgress?this.getSkeleton():o().createElement(T.Td,{ariaDesc:s.formatMessage(i.Z.costDistributionAriaDesc),ariaTitle:s.formatMessage(i.Z.costDistributionTitle),constrainToVisibleArea:!0,data:[{x:C,y:d,units:p},{x:O,y:g,units:m},{x:P,y,units:h}],height:_.chartHeight,labels:({datum:e})=>s.formatMessage(i.Z.costBreakdownTooltip,{name:e.x,value:(0,Z.xG)(e.y,e.units)}),legendComponent:x,legendData:[{name:C},{name:O},{name:P}],legendOrientation:"vertical",legendPosition:"right",name:t,padding:{bottom:20,left:0,right:325,top:20},themeColor:S.nz.green,width:_.chartWidth}))}}const B=(0,l.ZP)(V);var U=r(39333),F=r(77760),z=r(38470),N=r(6456),Q=r(37269),A=r(15920),I=r(14483),q=r(5842);const W={mainContent:{marginTop:r(57640).ZP.value},subTitle:{textAlign:"right"}},G=N.C.cost;class $ extends o().Component{constructor(e){super(e),this.updateReport=()=>{const{fetchReport:e,reportQueryString:t,reportPathsType:r}=this.props;e(r,G,t)}}componentDidMount(){this.updateReport()}componentDidUpdate(e){const{reportQueryString:t}=this.props;e.reportQueryString!==t&&this.updateReport()}render(){const{costDistribution:e,intl:t,report:r,reportGroupBy:s,reportFetchStatus:n}=this.props,l=e||w.Qf.total,c=r&&r.meta&&r.meta.total,u=(0,Z.xG)(c?r.meta.total.cost[l].value:0,c?r.meta.total.cost[l].units:"USD");return o().createElement(o().Fragment,null,o().createElement("div",{style:W.subTitle},o().createElement(a.Title,{headingLevel:"h2",size:a.TitleSizes.xl},t.formatMessage(i.Z.detailsCostValue,{value:u}))),o().createElement("div",{style:W.mainContent},o().createElement(z.mZ,{idKey:s,report:r,status:n},(({items:e})=>e.map((e=>o().createElement(z.EH,{key:e.id,formatOptions:{},label:e.label?e.label.toString():"",totalValue:r.meta.total.cost[l].value,units:r.meta.total.cost[l].units,value:e.cost[l].value})))))))}}const H=(0,D.X1)(((e,{costType:t,currency:r,reportGroupBy:a,reportPathsType:s,router:i})=>{const n=(0,U.mB)(i.location.search),o=(0,U.fU)(n),l=(0,Q.OA)(n),c=l?I.dV:(0,Q.VL)(n),u=l||(0,Q.pe)(n),p={cost_type:t,currency:r,filter:{time_scope_units:"month",time_scope_value:-1,resolution:"monthly"},filter_by:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o&&o.filter_by&&o.filter_by),n&&n.isPlatformCosts&&{category:I.rx}),n&&n.filter&&n.filter.account&&{[`${I.Sq}account`]:n.filter.account}),c&&"*"!==u&&{[c]:u}),o&&o.filter_by&&o.filter_by[I.dV]&&{[`${I.pi}${I.dV}`]:o.filter_by[I.dV],[I.dV]:void 0}),exclude:Object.assign({},o&&o.exclude&&o.exclude),group_by:Object.assign({},a&&{[a]:"*"})},m=(0,U.pm)(p);return{report:A.ZV.selectReport(e,s,G,m),reportError:A.ZV.selectReportError(e,s,G,m),reportFetchStatus:A.ZV.selectReportFetchStatus(e,s,G,m),reportQueryString:m}})),X={fetchReport:A.nx.fetchReport},J=(0,l.ZP)((0,q.E)((0,F.connect)(H,X)($)));class K extends o().Component{constructor(e){super(e),this.handleClose=()=>{this.props.onClose(!1)},this.handleClose=this.handleClose.bind(this)}shouldComponentUpdate(e){const{groupByValue:t,isOpen:r}=this.props;return e.groupByValue!==t||e.isOpen!==r}render(){const{costDistribution:e,costType:t,currency:r,groupByValue:s,intl:n,isOpen:l,reportGroupBy:c,reportPathsType:u}=this.props;return o().createElement(a.Modal,{className:"modalOverride",isOpen:l,onClose:this.handleClose,title:n.formatMessage(i.Z.detailsSummaryModalTitle,{groupBy:c,name:s}),variant:"large"},o().createElement(J,{costDistribution:e,costType:t,currency:r,reportGroupBy:c,reportPathsType:u}))}}const Y=(0,l.ZP)(K),ee={card:{},skeleton:{marginTop:L.ZP.value},viewAllContainer:{marginLeft:"-15px"}};class te extends o().Component{constructor(){super(...arguments),this.state={isBulletChartModalOpen:!1},this.getItems=()=>{const{report:e,reportGroupBy:t}=this.props;return(0,c.R)({report:e,idKey:t})},this.getSummary=()=>{const{costDistribution:e,report:t,reportGroupBy:r,reportFetchStatus:a}=this.props,s=e||w.Qf.total;return o().createElement(z.mZ,{idKey:r,report:t,status:a},(({items:e})=>e.map((e=>o().createElement(z.EH,{formatOptions:{},key:`${e.id}-item`,label:e.label?e.label.toString():void 0,totalValue:t.meta.total.cost[s].value,units:t.meta.total.cost[s].units,value:e.cost[s].value})))))},this.getViewAll=()=>{const{costDistribution:e,costType:t,currency:r,groupBy:s,intl:n,isPlatformCosts:l,query:c,reportGroupBy:u,reportPathsType:p}=this.props,{isBulletChartModalOpen:m}=this.state;if(-1!==this.getItems().findIndex((e=>{const t=e.id;if(t&&null!==t)return"Other"===t||"Others"===t}))){const h=c&&c.filter&&c.filter.account?c.filter.account:this.props.groupByValue;return o().createElement("div",{style:ee.viewAllContainer},o().createElement(a.Button,{ouiaId:"view-all-btn",onClick:this.handleBulletChartModalOpen,type:a.ButtonType.button,variant:a.ButtonVariant.link},n.formatMessage(i.Z.detailsViewAll,{value:u})),o().createElement(Y,{costDistribution:e,costType:t,currency:r,groupBy:s,groupByValue:l?I.rx:h,isOpen:m,onClose:this.handleBulletChartModalClose,query:c,reportGroupBy:u,reportPathsType:p}))}return null},this.handleBulletChartModalClose=e=>{this.setState({isBulletChartModalOpen:e})},this.handleBulletChartModalOpen=e=>{this.setState({isBulletChartModalOpen:!0}),e.preventDefault()},this.updateReport=()=>{const{fetchReport:e,reportPathsType:t,reportQueryString:r,reportType:a}=this.props;e(t,a,r)}}componentDidMount(){this.updateReport()}componentDidUpdate(e){const{costType:t,currency:r,reportQueryString:a}=this.props;e.reportQueryString===a&&e.costType===t&&e.currency===r||this.updateReport()}render(){const{intl:e,isPlatformCosts:t,reportGroupBy:r,reportFetchStatus:s}=this.props,n=e.formatMessage(i.Z.breakdownSummaryTitle,{value:t?I.rx.toLowerCase():r});return o().createElement(a.Card,{style:ee.card},o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:a.TitleSizes.lg},n)),o().createElement(a.CardBody,null,s===D.iF.inProgress?o().createElement(o().Fragment,null,o().createElement(a.Skeleton,{width:O.N.md}),o().createElement(a.Skeleton,{style:ee.skeleton,width:O.N.md}),o().createElement(a.Skeleton,{style:ee.skeleton,width:O.N.md}),o().createElement(a.Skeleton,{style:ee.skeleton,width:O.N.md})):this.getSummary()),o().createElement(a.CardFooter,null,this.getViewAll()))}}const re=(0,D.X1)(((e,{costType:t,currency:r,reportGroupBy:a,reportPathsType:s,reportType:i,router:n})=>{const o=(0,U.mB)(n.location.search),l=(0,U.fU)(o),c=(0,Q.OA)(o),u=c?I.dV:(0,Q.VL)(o),p=c||(0,Q.pe)(o),m=Object.assign({},o),h={cost_type:t,currency:r,filter:{limit:3,resolution:"monthly",time_scope_units:"month",time_scope_value:-1},filter_by:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l&&l.filter_by&&l.filter_by),o&&o.isPlatformCosts&&{category:I.rx}),o&&o.filter&&o.filter.account&&{[`${I.Sq}account`]:o.filter.account}),u&&"*"!==p&&{[u]:p}),l&&l.filter_by&&l.filter_by[I.dV]&&{[`${I.pi}${I.dV}`]:l.filter_by[I.dV],[I.dV]:void 0}),exclude:Object.assign({},l&&l.exclude&&l.exclude),group_by:Object.assign({},a&&{[a]:"*"})},d=(0,U.pm)(h);return{groupBy:u,groupByValue:p,query:m,report:A.ZV.selectReport(e,s,i,d),reportError:A.ZV.selectReportError(e,s,i,d),reportFetchStatus:A.ZV.selectReportFetchStatus(e,s,i,d),reportQueryString:d}})),ae={fetchReport:A.nx.fetchReport},se=(0,l.ZP)((0,q.E)((0,F.connect)(re,ae)(te)));var ie=r(762),ne=r(79112),oe=r(45351),le=r(43902);const ce={chartSkeleton:{marginBottom:L.ZP.value},capacity:{fontWeight:P.ZP.value},legendSkeleton:{marginTop:L.ZP.value}};class ue extends o().Component{constructor(){super(...arguments),this.containerRef=o().createRef(),this.observer=le.Z,this.state={width:0},this.handleResize=()=>{const{width:e}=this.state,{clientWidth:t=0}=this.containerRef.current||{};t!==e&&this.setState({width:t})},this.getChart=()=>{const{groupBy:e,name:t,reportFetchStatus:r,report:a}=this.props,{width:s}=this.state,i=this.getChartDatum();return a&&0!==i.usage.length?o().createElement("div",{className:"chartOverride"},r===D.iF.inProgress?this.getSkeleton():o().createElement(o().Fragment,null,"cluster"===e&&this.getFreeSpace(),o().createElement(ie.n,{comparativeErrorMeasureData:i.limit.value?[{tooltip:i.limit.tooltip,y:i.limit.value}]:[],comparativeErrorMeasureLegendData:i.limit.value?[{name:i.limit.legend}]:[],height:this.getChartHeight(),labels:({datum:e})=>`${e.tooltip}`,legendPosition:"bottom-left",legendItemsPerRow:this.getItemsPerRow(),maxDomain:this.isDatumEmpty(i)?100:void 0,minDomain:0,name:t,padding:{bottom:75,left:10,right:50,top:0},primarySegmentedMeasureData:i.usage.length?i.usage.map((e=>({tooltip:e.tooltip,y:e.value}))):[],primarySegmentedMeasureLegendData:i.usage.length?i.usage.map((e=>({name:e.legend}))):[],qualitativeRangeData:i.ranges.length?[{tooltip:i.ranges[0].tooltip,y:i.ranges[0].value}]:[],qualitativeRangeLegendData:i.ranges.length?[{name:i.ranges[0].legend}]:[],width:s}))):null},this.getChartHeight=()=>{const{groupBy:e}=this.props,{width:t}=this.state;return"cluster"===e?t>950?115:t>450?150:210:t>700?115:t>450?150:180},this.getItemsPerRow=()=>{const{width:e}=this.state;return e>950?4:e>700?3:e>450?2:1},this.getSkeleton=()=>o().createElement(o().Fragment,null,o().createElement(a.Skeleton,{style:ce.chartSkeleton,width:O.N.md}),o().createElement(a.Skeleton,{style:ce.legendSkeleton,width:O.N.xs})),this.isDatumEmpty=e=>{let t=!1;for(const r of e.ranges)if(r.value){t=!0;break}let r=!1;for(const t of e.usage)if(t.value){r=!0;break}return!(e.limit.value||t||r)},this.updateReport=()=>{const{fetchReport:e,reportPathsType:t,reportType:r,reportQueryString:a}=this.props;e(t,r,a)}}componentDidMount(){this.observer=(0,oe.pP)(this.containerRef.current,this.handleResize),this.updateReport()}componentDidUpdate(e){const{reportQueryString:t}=this.props;e.reportQueryString!==t&&this.updateReport()}componentWillUnmount(){this.observer&&this.observer()}getChartDatum(){const{groupBy:e,report:t,intl:r,reportType:a}=this.props,s={limit:{},ranges:[],usage:[]},n=t&&t.meta&&t.meta.total,o=n&&t.meta.total.limit&&null!==t.meta.total.limit,l=Math.trunc(o?t.meta.total.limit.value:0),c=r.formatMessage(i.Z.units,{units:(0,Z.ZV)(o?t.meta.total.limit.units:void 0)});if(s.limit={legend:r.formatMessage(i.Z.detailsUsageLimit,{value:l,units:c}),tooltip:r.formatMessage(i.Z.detailsUsageLimit,{value:l,units:c}),value:Math.trunc(l)},"cluster"===e||a===N.C.volume){const e=n&&t.meta.total.capacity&&null!==t.meta.total.capacity,a=Math.trunc(e?t.meta.total.capacity.value:0),o=r.formatMessage(i.Z.units,{units:(0,Z.ZV)(e?t.meta.total.capacity.units:void 0)});s.ranges=[{legend:r.formatMessage(i.Z.detailsUsageCapacity,{value:a,units:o}),tooltip:r.formatMessage(i.Z.detailsUsageCapacity,{value:a,units:o}),value:Math.trunc(a)}]}const u=n&&t.meta.total.request&&null!==t.meta.total.request,p=n&&t.meta.total.usage&&null!==t.meta.total.usage,m=Math.trunc(u?t.meta.total.request.value:0),h=r.formatMessage(i.Z.units,{units:(0,Z.ZV)(u?t.meta.total.request.units:void 0)}),d=Math.trunc(p?t.meta.total.usage.value:0),g=r.formatMessage(i.Z.units,{units:(0,Z.ZV)(p?t.meta.total.usage.units:void 0)});return s.usage=[{legend:r.formatMessage(i.Z.detailsUsageUsage,{value:d,units:g}),tooltip:r.formatMessage(i.Z.detailsUsageUsage,{value:d,units:g}),value:Math.trunc(d)},{legend:r.formatMessage(i.Z.detailsUsageRequests,{value:m,units:h}),tooltip:r.formatMessage(i.Z.detailsUsageRequests,{value:m,units:h}),value:Math.trunc(m)}],s}getFreeSpace(){const{report:e,intl:t}=this.props,r=e&&e.meta&&e.meta.total,s=r&&e.meta.total.capacity&&null!==e.meta.total.capacity,n=r&&e.meta.total.request&&null!==e.meta.total.request,l=r&&e.meta.total.usage&&null!==e.meta.total.usage,c=Math.trunc(s?e.meta.total.capacity.value:0),u=Math.trunc(n?e.meta.total.request.value:0),p=t.formatMessage(i.Z.units,{units:(0,Z.ZV)(n?e.meta.total.request.units:void 0)}),m=Math.trunc(l?e.meta.total.usage.value:0),h=t.formatMessage(i.Z.units,{units:(0,Z.ZV)(l?e.meta.total.usage.units:void 0)}),d=c-u,g=c-m;let y=u>0?u/c*100:0;y>100&&(y=100-y);let f=c>m?m/c*100:0;return f>100&&(f=100-f),o().createElement(a.Grid,{hasGutter:!0},o().createElement(a.GridItem,{md:12,lg:6},o().createElement("div",null,t.formatMessage(i.Z.detailsUnusedUsageLabel)),o().createElement("div",{style:ce.capacity},(0,Z.bM)(g,h)),o().createElement("div",null,t.formatMessage(i.Z.detailsUnusedUnits,{percentage:(0,Z.rl)(f,{minimumFractionDigits:0,maximumFractionDigits:0}),units:h}))),o().createElement(a.GridItem,{md:12,lg:6},o().createElement("div",null,t.formatMessage(i.Z.detailsUnusedRequestsLabel)),o().createElement("div",{style:ce.capacity},(0,Z.bM)(d,p)),o().createElement("div",null,t.formatMessage(i.Z.detailsUnusedUnits,{percentage:(0,Z.rl)(y,{minimumFractionDigits:0,maximumFractionDigits:0}),units:p}))))}render(){return o().createElement("div",{className:"chartOverride",ref:this.containerRef},this.getChart())}}const pe=(0,D.X1)(((e,{reportPathsType:t,reportType:r,router:a})=>{const s=(0,ne.mB)(a.location.search),i=(0,U.fU)(s),n=(0,Q.VL)(s),o=(0,Q.pe)(s),l=Object.assign({},s),c={filter:{time_scope_units:"month",time_scope_value:-1,resolution:"monthly"},filter_by:Object.assign(Object.assign(Object.assign({},i&&i.filter_by&&i.filter_by),s&&s.isPlatformCosts&&{category:I.rx}),n&&"*"!==o&&{[n]:void 0}),exclude:Object.assign({},i&&i.exclude&&i.exclude),group_by:Object.assign({},n&&{[n]:o})},u=(0,U.pm)(c);return{groupBy:n,query:l,report:A.ZV.selectReport(e,t,r,u),reportFetchStatus:A.ZV.selectReportFetchStatus(e,t,r,u),reportQueryString:u}})),me={fetchReport:A.nx.fetchReport},he=(0,l.ZP)((0,q.E)((0,F.connect)(pe,me)(ue)));var de=r(33748),ge=r(51581);const ye="placeholder";class fe extends o().Component{constructor(){super(...arguments),this.getClusterCard=e=>{const{groupBy:t,intl:r,report:s,title:n}=this.props;let l=!1;for(const r of e.cluster.showWidgetOnGroupBy)if(r===t||r===I.P&&t&&-1!==t.indexOf(I.P)){l=!0;break}return l?o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:a.TitleSizes.lg},r.formatMessage(i.Z.clusters))),o().createElement(a.CardBody,null,o().createElement(v,{groupBy:e.cluster.reportGroupBy,report:s,title:n}))):ye},this.getCostChart=e=>{const{report:t,intl:r}=this.props;return o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:a.TitleSizes.lg},r.formatMessage(i.Z.costBreakdownTitle),o().createElement(a.Popover,{"aria-label":r.formatMessage(i.Z.costBreakdownAriaLabel),enableFlip:!0,bodyContent:o().createElement(o().Fragment,null,o().createElement("p",{style:de.W.infoTitle},r.formatMessage(i.Z.rawCostTitle)),o().createElement("p",null,r.formatMessage(i.Z.rawCostDesc)),o().createElement("br",null),o().createElement("p",{style:de.W.infoTitle},r.formatMessage(i.Z.usageCostTitle)),o().createElement("p",null,r.formatMessage(i.Z.usageCostDesc)),o().createElement("br",null),o().createElement("p",{style:de.W.infoTitle},r.formatMessage(i.Z.markupTitle)),o().createElement("p",null,r.formatMessage(i.Z.markupDesc)),o().createElement("br",null),o().createElement("a",{href:r.formatMessage(i.Z.docsCostModelTerminology),rel:"noreferrer",target:"_blank"},r.formatMessage(i.Z.learnMore)))},o().createElement(a.Button,{variant:a.ButtonVariant.plain},o().createElement(s.iC,{style:de.W.info}))))),o().createElement(a.CardBody,null,o().createElement(M,{name:e.chartName,report:t})))},this.getCostDistributionChart=e=>{const{costDistribution:t,intl:r,isCostDistributionFeatureEnabled:n,report:l}=this.props;return t&&n?o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:a.TitleSizes.lg},r.formatMessage(i.Z.costDistributionTitle),o().createElement(a.Popover,{"aria-label":r.formatMessage(i.Z.costDistributionAriaLabel),enableFlip:!0,bodyContent:o().createElement(o().Fragment,null,o().createElement("p",{style:de.W.infoTitle},r.formatMessage(i.Z.platformDistributed)),o().createElement("p",null,r.formatMessage(i.Z.platformDesc)),o().createElement("br",null),o().createElement("p",{style:de.W.infoTitle},r.formatMessage(i.Z.workerUnallocated)),o().createElement("p",null,r.formatMessage(i.Z.workerUnallocatedDesc)),o().createElement("br",null),o().createElement("a",{href:r.formatMessage(i.Z.docsCostModelTerminology),rel:"noreferrer",target:"_blank"},r.formatMessage(i.Z.learnMore)))},o().createElement(a.Button,{variant:a.ButtonVariant.plain},o().createElement(s.iC,{style:de.W.info}))))),o().createElement(a.CardBody,null,o().createElement(B,{costDistribution:t,name:e.chartName,report:l}))):null},this.getCpuUsageChart=e=>{const{intl:t}=this.props;return o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:a.TitleSizes.lg},t.formatMessage(i.Z.cpuTitle))),o().createElement(a.CardBody,null,o().createElement(he,{name:e.chartName,reportPathsType:e.reportPathsType,reportType:e.reportType})))},this.getMemoryUsageChart=e=>{const{intl:t}=this.props;return o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:a.TitleSizes.lg},t.formatMessage(i.Z.memoryTitle))),o().createElement(a.CardBody,null,o().createElement(he,{name:e.chartName,reportPathsType:e.reportPathsType,reportType:e.reportType})))},this.getSummaryCard=e=>{const{costDistribution:t,costType:r,currency:a,groupBy:s,isPlatformCosts:i,query:n}=this.props,l=(0,Q.Sn)(n),c=(0,Q.OA)(n),u=(0,Q.qV)(n);let p=!1;if(e.reportSummary.showWidgetOnGroupBy)for(const t of e.reportSummary.showWidgetOnGroupBy)if(t===s||l||c||u){p=!0;break}if(!p&&e.reportSummary.showWidgetOnPlatformCategory)for(const t of e.reportSummary.showWidgetOnPlatformCategory)if(i&&t===I.rx){p=!0;break}return p?o().createElement(se,{costDistribution:t,costType:r,currency:a,isPlatformCosts:i,reportGroupBy:e.reportSummary.reportGroupBy,reportPathsType:e.reportPathsType,reportType:e.reportType}):e.reportSummary.usePlaceholder?ye:null},this.getVolumeUsageChart=e=>{const{intl:t}=this.props;return o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:a.TitleSizes.lg},t.formatMessage(i.Z.volumeTitle))),o().createElement(a.CardBody,null,o().createElement(he,{name:e.chartName,reportPathsType:e.reportPathsType,reportType:e.reportType})))},this.getWidgetsColumns=()=>{const{selectWidgets:e,widgets:t}=this.props,r=[];t.map((t=>{const a=e[t],s=this.renderWidget(a);null!==s&&r.push(s)}));const a=Math.floor(r.length/2)+r.length%2,s=[],i=[];for(let e=0;e<a;e++)r[e]!==ye&&s.push(r[e]),e+a<r.length&&r[e+a]!==ye&&i.push(r[e+a]);return{leftColumnWidgets:s,rightColumnWidgets:i}}}renderWidget(e){switch(e.type){case ge.S.cluster:return this.getClusterCard(e);case ge.S.cost:return this.getCostChart(e);case ge.S.costDistribution:return this.getCostDistributionChart(e);case ge.S.cpuUsage:return this.getCpuUsageChart(e);case ge.S.memoryUsage:return this.getMemoryUsageChart(e);case ge.S.reportSummary:return this.getSummaryCard(e);case ge.S.volumeUsage:return this.getVolumeUsageChart(e);default:return null}}render(){const{leftColumnWidgets:e,rightColumnWidgets:t}=this.getWidgetsColumns();return o().createElement(a.Grid,{hasGutter:!0},o().createElement(a.GridItem,{xl:12,xl2:6},o().createElement(a.Grid,{hasGutter:!0},e.map(((e,t)=>o().createElement(a.GridItem,{key:`widget-${t}`},e))))),o().createElement(a.GridItem,{xl:12,xl2:6},o().createElement(a.Grid,{hasGutter:!0},t.map(((e,t)=>o().createElement(a.GridItem,{key:`widget-${t}`},e))))))}}const be=(0,l.ZP)(fe)},87935:(e,t,r)=>{r.d(t,{f:()=>fe});var a=r(90154),s=r(6456),i=r(97027),n=r(92950),o=r.n(n),l=r(74806),c=r(41829),u=r(39333),p=r(77760),m=r(4996),h=r(21094),d=r(2311),g=r(80469),y=r(84154),f=r(48629),b=r(52109),v=r(2370),C=r(55855),E=r(58395),T=r(45351),S=r(43902),D=r(27765),Z=r(19960),O=r(84076),P=r(18131),L=r(24656),x=r(84615),k=r(70698),R=r(72021),M=r(21768),w=r(41534),_=r(98499),j=r(48196);const V={currentCapacityData:{fill:"none"},currentColorScale:[M.CH.value,R.R0.value,k.t6.value,x.S7.value,w.iM.value],currentInfrastructureCostData:{fill:"none",strokeDasharray:"3,3"},currentCostData:{fill:"none"},itemsPerRow:0,previousCapacityData:{fill:"none"},previousColorScale:[D.O6.value,Z.OS.value,O.iY.value,P.cQ.value,L.DD.value],previousInfrastructureCostData:{fill:"none",strokeDasharray:"3,3"},previousCostData:{fill:"none"},yAxis:{axisLabel:{padding:15},grid:{stroke:"none"},ticks:{stroke:"none"},tickLabels:{fontSize:0}},xAxis:{axisLabel:{padding:40},grid:{stroke:"none"},ticks:{stroke:"none"}}},B={chart:{marginTop:j.S1.value},title:{marginLeft:"-"+_.Js.value}};class U extends o().Component{constructor(){super(...arguments),this.containerRef=o().createRef(),this.observer=S.Z,this.state={hiddenSeries:new Set,width:0},this.initDatum=()=>{const{currentCostData:e,previousCostData:t}=this.props,r=i.Z.chartCostLegendLabel,a=i.Z.chartCostLegendTooltip,s=[{childName:"previousCost",data:t,legendItem:{name:(0,m.uL)(t,r,!0,!0,1,i.Z.chartCostLegendNoDataLabel),symbol:{fill:V.previousColorScale[0],type:"minus"},tooltip:(0,m.ml)(t,a,!1,!1,1)},style:{data:Object.assign(Object.assign({},V.previousCostData),{stroke:V.previousColorScale[0]})}},{childName:"currentCost",data:e,legendItem:{name:(0,m.uL)(e,r,!0,!1,0,i.Z.chartCostLegendNoDataLabel),symbol:{fill:V.currentColorScale[0],type:"minus"},tooltip:(0,m.ml)(e,a,!1,!1)},style:{data:Object.assign(Object.assign({},V.currentCostData),{stroke:V.currentColorScale[0]})}}],n=this.getCursorVoronoiContainer();this.setState({cursorVoronoiContainer:n,series:s})},this.getChart=(e,t)=>{const{hiddenSeries:r}=this.state;return o().createElement(h.A,{data:r.has(t)?[{y:null}]:e.data,interpolation:"monotoneX",key:e.childName,name:e.childName,style:e.style})},this.getCursorVoronoiContainer=()=>{const{formatter:e,formatOptions:t}=this.props,r=(0,d.f)("voronoi","cursor");return o().createElement(r,{cursorDimension:"x",labels:({datum:r})=>(0,T.zj)(r,e,t),mouseFollowTooltips:!0,voronoiDimension:"x",voronoiPadding:{bottom:120,left:8,right:8,top:8}})},this.getLegend=()=>{const{legendItemsPerRow:e,name:t=""}=this.props,{hiddenSeries:r,series:a,width:s}=this.state,i=e||(s>725?V.itemsPerRow:2);return o().createElement(g.Qk,{data:(0,T.oX)(a,r),height:25,gutter:20,itemsPerRow:i,name:`${t}-legend`})},this.handleLegendClick=e=>{const t=(0,T.nV)(this.state.series,this.state.hiddenSeries,e);this.setState({hiddenSeries:t})},this.handleResize=()=>{const{width:e}=this.state,{clientWidth:t=0}=this.containerRef.current||{};t!==e&&this.setState({width:t})}}componentDidMount(){this.initDatum(),this.observer=(0,T.pP)(this.containerRef.current,this.handleResize)}componentDidUpdate(e){e.currentCostData===this.props.currentCostData&&e.currentInfrastructureCostData===this.props.currentInfrastructureCostData&&e.previousCostData===this.props.previousCostData&&e.previousInfrastructureCostData===this.props.previousInfrastructureCostData||this.initDatum()}componentWillUnmount(){this.observer&&this.observer()}getEndDate(){const{currentInfrastructureCostData:e,previousInfrastructureCostData:t}=this.props,r=e?(0,C.Z)((0,m.Y_)(e,!0,!0)[1]):0,a=t?(0,C.Z)((0,m.Y_)(t,!0,!0)[1]):0;return r>0||a>0?Math.max(r,a):31}getEvents(){const{name:e=""}=this.props,{hiddenSeries:t,series:r}=this.state,a=(0,y.u)({chartNames:(0,T.bC)(r),isHidden:e=>(0,T.Yt)(t,e),legendName:`${e}-legend`,onLegendClick:e=>this.handleLegendClick(e.index)});return a}render(){const{adjustContainerHeight:e,height:t,containerHeight:r=t,intl:s,name:n,padding:l={bottom:120,left:8,right:8,top:8},title:c,xAxisLabel:u,yAxisLabel:p}=this.props,{cursorVoronoiContainer:m,hiddenSeries:h,series:d,width:g}=this.state,y=(0,T.ge)(d,h),C=this.getEndDate(),S=Math.floor(C/2),D=e&&g>725?r-25:r,Z=m?o().cloneElement(m,{disable:!(0,T.TW)(d,h),labelComponent:o().createElement(f.M,{legendData:(0,T.oX)(d,h,!0),title:e=>s.formatMessage(i.Z.chartDayOfTheMonth,{day:e.x})})}):void 0;return o().createElement("div",{className:"chartOverride",ref:this.containerRef},o().createElement(a.Title,{headingLevel:"h2",style:B.title,size:a.TitleSizes.xl},c),o().createElement("div",{style:Object.assign(Object.assign({},B.chart),{height:D})},o().createElement("div",{style:{height:t,width:g},"data-testid":"historical-chart-wrapper"},o().createElement(b.k,{containerComponent:Z,domain:y,events:this.getEvents(),height:t,legendComponent:this.getLegend(),legendData:(0,T.oX)(d,h),legendPosition:"bottom",name:n,padding:l,theme:E.Z,width:g},d&&d.map(((e,t)=>this.getChart(e,t))),o().createElement(v.C,{label:u,style:V.xAxis,tickValues:[1,S,C]}),o().createElement(v.C,{dependentAxis:!0,label:p,style:V.yAxis})))))}}const F=(0,l.ZP)(U);var z=r(37269),N=r(1156),Q=r(15920),A=r(91778),I=r(14483),q=r(5842),W=r(20513),G=r(11331),$=r(32412);const H={chartContainer:{marginLeft:_.ZP.value},chartSkeleton:{height:"125px",marginBottom:$.ZP.value,marginTop:G.ZP.value},costChart:{marginBottom:j.ZP.value,marginTop:j.ZP.value},legendSkeleton:{marginTop:$.ZP.value},trendChart:{marginBottom:j.ZP.value,marginTop:j.ZP.value},usageChart:{marginTop:j.ZP.value}};class X extends o().Component{constructor(){super(...arguments),this.getSkeleton=()=>o().createElement(o().Fragment,null,o().createElement(a.Skeleton,{style:H.chartSkeleton,width:W.N.md}),o().createElement(a.Skeleton,{style:H.legendSkeleton,width:W.N.xs})),this.updateReport=()=>{const{fetchReport:e,currentQueryString:t,previousQueryString:r,reportPathsType:a,reportType:s}=this.props;e(a,s,t),e(a,s,r)}}componentDidMount(){this.updateReport()}componentDidUpdate(e){const{costType:t,currency:r,currentQueryString:a,previousQueryString:s}=this.props;e.currentQueryString===a&&e.previousQueryString===s&&e.costType===t&&e.currency===r||this.updateReport()}render(){const{chartName:e,costDistribution:t,currentReport:r,currentReportFetchStatus:a,previousReport:s,previousReportFetchStatus:n,intl:l}=this.props,c=t||m.Qf.total,u=(0,m.zJ)(r,m.yZ.cumulative,"date","cost",c),p=(0,m.zJ)(r,m.yZ.cumulative,"date","infrastructure"),h=(0,m.zJ)(s,m.yZ.cumulative,"date","cost",c),d=(0,m.zJ)(s,m.yZ.cumulative,"date","infrastructure"),g=r&&r.meta&&r.meta.total&&r.meta.total.cost?r.meta.total.cost[c].units:"USD",y=l.formatMessage(i.Z.currencyUnits,{units:g});return o().createElement("div",{style:H.chartContainer},o().createElement("div",{style:H.costChart},a===N.iF.inProgress&&n===N.iF.inProgress?this.getSkeleton():o().createElement(F,{adjustContainerHeight:!0,containerHeight:275,currentCostData:u,currentInfrastructureCostData:p,formatOptions:{},formatter:A.bM,height:300,name:e,previousCostData:h,previousInfrastructureCostData:d,xAxisLabel:l.formatMessage(i.Z.historicalChartDayOfMonthLabel),yAxisLabel:l.formatMessage(i.Z.historicalChartCostLabel,{units:y})})))}}const J=(0,N.X1)(((e,{costType:t,currency:r,reportPathsType:a,reportType:s,router:i})=>{const n=(0,u.mB)(i.location.search),o=(0,u.fU)(n),l=(0,z.VL)(n),c=(0,z.pe)(n),p={filter_by:Object.assign(Object.assign(Object.assign({},o&&o.filter_by&&o.filter_by),n&&n.isPlatformCosts&&{category:I.rx}),o&&o.filter_by&&o.filter_by[I.dV]&&{[`${I.pi}${I.dV}`]:o.filter_by[I.dV],[I.dV]:void 0}),exclude:Object.assign({},o&&o.exclude&&o.exclude),group_by:Object.assign({},l&&{[l]:c})},m=Object.assign(Object.assign({},p),{cost_type:t,currency:r,filter:{resolution:"daily",time_scope_units:"month",time_scope_value:-1},filter_by:Object.assign(Object.assign({},p.filter_by),l&&"*"!==c&&{[l]:void 0})}),h=(0,u.pm)(m),d=Q.ZV.selectReport(e,a,s,h),g=Q.ZV.selectReportFetchStatus(e,a,s,h),y=Object.assign(Object.assign({},p),{cost_type:t,currency:r,filter:{resolution:"daily",time_scope_units:"month",time_scope_value:-2},filter_by:Object.assign(Object.assign({},p.filter_by),l&&"*"!==c&&{[l]:void 0})}),f=(0,u.pm)(y);return{currentQuery:m,currentQueryString:h,currentReport:d,currentReportFetchStatus:g,previousQuery:y,previousQueryString:f,previousReport:Q.ZV.selectReport(e,a,s,f),previousReportFetchStatus:Q.ZV.selectReportFetchStatus(e,a,s,f)}})),K={fetchReport:Q.nx.fetchReport},Y=(0,l.ZP)((0,q.E)((0,p.connect)(J,K)(X))),ee={currentColorScale:[M.CH.value,R.R0.value,k.t6.value,x.S7.value,w.iM.value],currentMonthData:{fill:"none"},itemsPerRow:0,previousColorScale:[D.O6.value,Z.OS.value,O.iY.value,P.cQ.value,L.DD.value],previousMonthData:{fill:"none"},yAxis:{axisLabel:{padding:15},grid:{stroke:"none"},ticks:{stroke:"none"},tickLabels:{fontSize:0}},xAxis:{axisLabel:{padding:40},grid:{stroke:"none"},ticks:{stroke:"none"}}},te={chart:{marginTop:j.S1.value},title:{marginLeft:"-"+_.Js.value}};class re extends o().Component{constructor(){super(...arguments),this.containerRef=o().createRef(),this.observer=S.Z,this.state={hiddenSeries:new Set,width:0},this.initDatum=()=>{const{currentData:e,previousData:t,showUsageLegendLabel:r=!1}=this.props,a=r?i.Z.chartUsageLegendLabel:i.Z.chartCostLegendLabel,s=r?i.Z.chartUsageLegendTooltip:i.Z.chartCostLegendTooltip,n=[{childName:"previousCost",data:t,legendItem:{name:(0,m.uL)(t,a,!0,!0,1,i.Z.chartUsageLegendNoDataLabel),symbol:{fill:ee.previousColorScale[0],type:"minus"},tooltip:(0,m.ml)(t,s,!1,!1,1)},style:{data:Object.assign(Object.assign({},ee.previousMonthData),{stroke:ee.previousColorScale[0]})}},{childName:"currentCost",data:e,legendItem:{name:(0,m.uL)(e,a,!0,!1,0,i.Z.chartUsageLegendNoDataLabel),symbol:{fill:ee.currentColorScale[1],type:"minus"},tooltip:(0,m.ml)(e,s,!1,!1)},style:{data:Object.assign(Object.assign({},ee.currentMonthData),{stroke:ee.currentColorScale[1]})}}],o=this.getCursorVoronoiContainer();this.setState({cursorVoronoiContainer:o,series:n})},this.getChart=(e,t)=>{const{hiddenSeries:r}=this.state;return o().createElement(h.A,{data:r.has(t)?[{y:null}]:e.data,interpolation:"monotoneX",key:e.childName,name:e.childName,style:e.style})},this.getCursorVoronoiContainer=()=>{const{formatter:e,formatOptions:t}=this.props,r=(0,d.f)("voronoi","cursor");return o().createElement(r,{cursorDimension:"x",labels:({datum:r})=>(0,T.zj)(r,e,t),mouseFollowTooltips:!0,voronoiDimension:"x",voronoiPadding:{bottom:120,left:8,right:8,top:8}})},this.getLegend=()=>{const{legendItemsPerRow:e,name:t=""}=this.props,{hiddenSeries:r,series:a}=this.state;return o().createElement(g.Qk,{data:(0,T.oX)(a,r),height:25,gutter:20,itemsPerRow:e,name:`${t}-legend`})},this.handleLegendClick=e=>{const t=(0,T.nV)(this.state.series,this.state.hiddenSeries,e);this.setState({hiddenSeries:t})},this.handleResize=()=>{const{width:e}=this.state,{clientWidth:t=0}=this.containerRef.current||{};t!==e&&this.setState({width:t})}}componentDidMount(){this.initDatum(),this.observer=(0,T.pP)(this.containerRef.current,this.handleResize)}componentDidUpdate(e){e.currentData===this.props.currentData&&e.previousData===this.props.previousData||this.initDatum()}componentWillUnmount(){this.observer&&this.observer()}getEndDate(){const{currentData:e,previousData:t}=this.props,r=t?(0,C.Z)((0,m.Y_)(t,!0,!0)[1]):0,a=e?(0,C.Z)((0,m.Y_)(e,!0,!0)[1]):0;return a>0||r>0?Math.max(a,r):31}getEvents(){const{name:e=""}=this.props,{hiddenSeries:t,series:r}=this.state,a=(0,y.u)({chartNames:(0,T.bC)(r),isHidden:e=>(0,T.Yt)(t,e),legendName:`${e}-legend`,onLegendClick:e=>this.handleLegendClick(e.index)});return a}render(){const{height:e,containerHeight:t=e,intl:r,name:s,padding:n={bottom:120,left:8,right:8,top:8},title:l,xAxisLabel:c,yAxisLabel:u}=this.props,{cursorVoronoiContainer:p,hiddenSeries:m,series:h,width:d}=this.state,g=(0,T.ge)(h,m),y=this.getEndDate(),C=Math.floor(y/2),S=p?o().cloneElement(p,{disable:!(0,T.TW)(h,m),labelComponent:o().createElement(f.M,{legendData:(0,T.oX)(h,m,!0),title:e=>r.formatMessage(i.Z.chartDayOfTheMonth,{day:e.x})})}):void 0;return o().createElement("div",{className:"chartOverride",ref:this.containerRef},o().createElement(a.Title,{headingLevel:"h2",style:te.title,size:a.TitleSizes.xl},l),o().createElement("div",{style:Object.assign(Object.assign({},te.chart),{height:t})},o().createElement("div",{style:{height:e,width:d},"data-testid":"historical-chart-wrapper"},o().createElement(b.k,{containerComponent:S,domain:g,events:this.getEvents(),height:e,legendComponent:this.getLegend(),legendData:(0,T.oX)(h,m),legendPosition:"bottom",name:s,padding:n,theme:E.Z,width:d},h&&h.map(((e,t)=>this.getChart(e,t))),o().createElement(v.C,{label:c,style:ee.xAxis,tickValues:[1,C,y]}),o().createElement(v.C,{dependentAxis:!0,label:u,style:ee.yAxis})))))}}const ae=(0,l.ZP)(re);class se extends o().Component{constructor(){super(...arguments),this.getSkeleton=()=>o().createElement(o().Fragment,null,o().createElement(a.Skeleton,{style:H.chartSkeleton,width:W.N.md}),o().createElement(a.Skeleton,{style:H.legendSkeleton,width:W.N.xs})),this.updateReport=()=>{const{fetchReport:e,currentQueryString:t,previousQueryString:r,reportPathsType:a,reportType:s}=this.props;e(a,s,t),e(a,s,r)}}componentDidMount(){this.updateReport()}componentDidUpdate(e){const{costType:t,currency:r,currentQueryString:a,previousQueryString:s}=this.props;e.currentQueryString===a&&e.previousQueryString===s&&e.costType===t&&e.currency===r||this.updateReport()}render(){const{chartName:e,currentReport:t,currentReportFetchStatus:r,previousReport:a,previousReportFetchStatus:n,reportType:l,intl:c}=this.props,u=l===s.C.cost,p=(0,m.zJ)(t,u?m.yZ.cumulative:m.yZ.rolling,"date",u?"cost":"usage"),h=(0,m.zJ)(a,u?m.yZ.cumulative:m.yZ.rolling,"date",u?"cost":"usage"),d=t&&t.meta&&t.meta.total&&t.meta.total.cost?t.meta.total.cost.total.units:"USD",g=t&&t.meta&&t.meta.total&&t.meta.total.usage?t.meta.total.usage.units:void 0;let y;if(u){const e=c.formatMessage(i.Z.currencyUnits,{units:d});y=c.formatMessage(i.Z.historicalChartCostLabel,{units:e})}else if(g&&Number.isNaN(Number(t.meta.total.usage.units)))y=c.formatMessage(i.Z.units,{units:(0,A.ZV)(g)});else{const e=c.formatMessage(i.Z.historicalChartUsageLabel,{value:l});y=c.formatMessage(i.Z.units,{units:(0,A.ZV)(e)})}return o().createElement("div",{style:H.chartContainer},o().createElement("div",{style:H.trendChart},r===N.iF.inProgress&&n===N.iF.inProgress?this.getSkeleton():o().createElement(ae,{containerHeight:250,currentData:p,formatOptions:{},formatter:A.bM,height:300,name:e,previousData:h,units:u?d:g,xAxisLabel:c.formatMessage(i.Z.historicalChartDayOfMonthLabel),yAxisLabel:y})))}}const ie=(0,N.X1)(((e,{costType:t,currency:r,reportPathsType:a,reportType:s,router:i})=>{const n=(0,u.mB)(i.location.search),o=(0,u.fU)(n),l=(0,z.OA)(n),c=l?I.dV:(0,z.VL)(n),p=l||(0,z.pe)(n),m={filter_by:Object.assign(Object.assign(Object.assign(Object.assign({},o&&o.filter_by&&o.filter_by),n&&n.isPlatformCosts&&{category:I.rx}),n&&n.filter&&n.filter.account&&{[`${I.Sq}account`]:n.filter.account}),o&&o.filter_by&&o.filter_by[I.dV]&&{[`${I.pi}${I.dV}`]:o.filter_by[I.dV],[I.dV]:void 0}),exclude:Object.assign({},o&&o.exclude&&o.exclude),group_by:Object.assign({},c&&{[c]:p})},h=Object.assign(Object.assign({},m),{cost_type:t,currency:r,filter:{resolution:"daily",time_scope_units:"month",time_scope_value:-1},filter_by:Object.assign(Object.assign({},m.filter_by),c&&"*"!==p&&{[c]:void 0})}),d=(0,u.pm)(h),g=Q.ZV.selectReport(e,a,s,d),y=Q.ZV.selectReportFetchStatus(e,a,s,d),f=Object.assign(Object.assign({},m),{cost_type:t,currency:r,filter:{resolution:"daily",time_scope_units:"month",time_scope_value:-2},filter_by:Object.assign(Object.assign({},m.filter_by),c&&"*"!==p&&{[c]:void 0})}),b=(0,u.pm)(f);return{currentQuery:h,currentQueryString:d,currentReport:g,currentReportFetchStatus:y,previousQuery:f,previousQueryString:b,previousReport:Q.ZV.selectReport(e,a,s,b),previousReportFetchStatus:Q.ZV.selectReportFetchStatus(e,a,s,b)}})),ne={fetchReport:Q.nx.fetchReport},oe=(0,l.ZP)((0,q.E)((0,p.connect)(ie,ne)(se))),le={currentCapacityData:{fill:"none"},currentColorScale:[M.CH.value,R.R0.value,k.t6.value,x.S7.value,w.iM.value],currentLimitData:{fill:"none"},currentRequestData:{fill:"none",strokeDasharray:"3,3"},currentUsageData:{fill:"none"},itemsPerRow:0,previousCapacityData:{fill:"none"},previousColorScale:[D.O6.value,Z.OS.value,O.iY.value,P.cQ.value,L.DD.value],previousLimitData:{fill:"none"},previousRequestData:{fill:"none",strokeDasharray:"3,3"},previousUsageData:{fill:"none"},yAxis:{axisLabel:{padding:15},grid:{stroke:"none"},ticks:{stroke:"none"},tickLabels:{fontSize:0}},xAxis:{axisLabel:{padding:40},grid:{stroke:"none"},ticks:{stroke:"none"}}},ce={chart:{marginTop:j.S1.value},title:{marginLeft:"-"+_.Js.value}};class ue extends o().Component{constructor(){super(...arguments),this.containerRef=o().createRef(),this.observer=S.Z,this.state={hiddenSeries:new Set,width:0},this.initDatum=()=>{const{currentLimitData:e,currentRequestData:t,currentUsageData:r,previousLimitData:a,previousRequestData:s,previousUsageData:n}=this.props,o=i.Z.chartLimitLegendLabel,l=i.Z.chartLimitLegendTooltip,c=i.Z.chartRequestsLegendLabel,u=i.Z.chartRequestsLegendTooltip,p=i.Z.chartUsageLegendLabel,h=i.Z.chartUsageLegendTooltip,d=[{childName:"previousUsage",data:n,legendItem:{name:(0,m.Fs)(n,p,!0,!0,1,i.Z.chartUsageLegendNoDataLabel),symbol:{fill:le.previousColorScale[0],type:"minus"},tooltip:(0,m.I6)(n,h,!1,!1,1)},style:{data:Object.assign(Object.assign({},le.previousUsageData),{stroke:le.previousColorScale[0]})}},{childName:"currentUsage",data:r,legendItem:{name:(0,m.Fs)(r,p,!0,!1,0,i.Z.chartUsageLegendNoDataLabel),symbol:{fill:le.currentColorScale[0],type:"minus"},tooltip:(0,m.I6)(r,h,!1,!1)},style:{data:Object.assign(Object.assign({},le.currentUsageData),{stroke:le.currentColorScale[0]})}},{childName:"previousRequest",data:s,legendItem:{name:(0,m.Fs)(s,c,!0,!0,1,i.Z.chartRequestsLegendNoDataLabel),symbol:{fill:le.previousColorScale[1],type:"dash"},tooltip:(0,m.I6)(s,u,!1,!1,1)},style:{data:Object.assign(Object.assign({},le.previousRequestData),{stroke:le.previousColorScale[1]})}},{childName:"currentRequest",data:t,legendItem:{name:(0,m.Fs)(t,c,!0,!1,0,i.Z.chartRequestsLegendNoDataLabel),symbol:{fill:le.currentColorScale[1],type:"dash"},tooltip:(0,m.I6)(t,u,!1,!1)},style:{data:Object.assign(Object.assign({},le.currentRequestData),{stroke:le.currentColorScale[1]})}},{childName:"previousLimit",data:a,legendItem:{name:(0,m.Fs)(a,o,!0,!0,1,i.Z.chartLimitLegendNoDataLabel),symbol:{fill:le.previousColorScale[2],type:"minus"},tooltip:(0,m.I6)(a,l,!1,!1,1)},style:{data:Object.assign(Object.assign({},le.previousLimitData),{stroke:le.previousColorScale[2]})}},{childName:"currentLimit",data:e,legendItem:{name:(0,m.Fs)(e,o,!0,!1,0,i.Z.chartLimitLegendNoDataLabel),symbol:{fill:le.currentColorScale[2],type:"minus"},tooltip:(0,m.I6)(e,l,!1,!1)},style:{data:Object.assign(Object.assign({},le.currentLimitData),{stroke:le.currentColorScale[2]})}}],g=this.getCursorVoronoiContainer();this.setState({cursorVoronoiContainer:g,series:d})},this.getChart=(e,t)=>{const{hiddenSeries:r}=this.state;return o().createElement(h.A,{data:r.has(t)?[{y:null}]:e.data,interpolation:"monotoneX",key:e.childName,name:e.childName,style:e.style})},this.getCursorVoronoiContainer=()=>{const{formatter:e,formatOptions:t}=this.props,r=(0,d.f)("voronoi","cursor");return o().createElement(r,{cursorDimension:"x",labels:({datum:r})=>(0,T.zj)(r,e,t),mouseFollowTooltips:!0,voronoiDimension:"x",voronoiPadding:{bottom:130,left:8,right:8,top:8}})},this.getLegend=()=>{const{legendItemsPerRow:e,name:t=""}=this.props,{hiddenSeries:r,series:a,width:s}=this.state,i=e||(s>925?le.itemsPerRow:2);return o().createElement(g.Qk,{data:(0,T.oX)(a,r),height:25,gutter:20,itemsPerRow:i,name:`${t}-legend`})},this.handleLegendClick=e=>{const t=(0,T.nV)(this.state.series,this.state.hiddenSeries,e);this.setState({hiddenSeries:t})},this.handleResize=()=>{const{width:e}=this.state,{clientWidth:t=0}=this.containerRef.current||{};t!==e&&this.setState({width:t})}}componentDidMount(){this.initDatum(),this.observer=(0,T.pP)(this.containerRef.current,this.handleResize)}componentDidUpdate(e){e.currentLimitData===this.props.currentLimitData&&e.currentRequestData===this.props.currentRequestData&&e.currentUsageData===this.props.currentUsageData&&e.previousLimitData===this.props.previousLimitData&&e.previousRequestData===this.props.previousRequestData&&e.previousUsageData===this.props.previousUsageData||this.initDatum()}componentWillUnmount(){this.observer&&this.observer()}getEndDate(){const{currentRequestData:e,currentUsageData:t,previousRequestData:r,previousUsageData:a}=this.props,s=e?(0,C.Z)((0,m.Y_)(e,!0,!0)[1]):0,i=t?(0,C.Z)((0,m.Y_)(t,!0,!0)[1]):0,n=r?(0,C.Z)((0,m.Y_)(r,!0,!0)[1]):0,o=a?(0,C.Z)((0,m.Y_)(a,!0,!0)[1]):0;return s>0||i>0||n>0||o>0?Math.max(s,i,n,o):31}getEvents(){const{name:e=""}=this.props,{hiddenSeries:t,series:r}=this.state,a=(0,y.u)({chartNames:(0,T.bC)(r),isHidden:e=>(0,T.Yt)(t,e),legendName:`${e}-legend`,onLegendClick:e=>this.handleLegendClick(e.index)});return a}render(){const{adjustContainerHeight:e,height:t,containerHeight:r=t,intl:s,name:n,padding:l={bottom:130,left:8,right:8,top:8},title:c,xAxisLabel:u,yAxisLabel:p}=this.props,{cursorVoronoiContainer:m,hiddenSeries:h,series:d,width:g}=this.state,y=(0,T.ge)(d,h),C=this.getEndDate(),S=Math.floor(C/2),D=e&&g>925?r-50:r,Z=m?o().cloneElement(m,{disable:!(0,T.TW)(d,h),labelComponent:o().createElement(f.M,{legendData:(0,T.oX)(d,h,!0),title:e=>s.formatMessage(i.Z.chartDayOfTheMonth,{day:e.x})})}):void 0;return o().createElement("div",{className:"chartOverride",ref:this.containerRef},o().createElement(a.Title,{headingLevel:"h2",style:ce.title,size:a.TitleSizes.xl},c),o().createElement("div",{style:Object.assign(Object.assign({},ce.chart),{height:D})},o().createElement("div",{style:{height:t,width:g},"data-testid":"historical-chart-wrapper"},o().createElement(b.k,{containerComponent:Z,domain:y,events:this.getEvents(),height:t,legendComponent:this.getLegend(),legendData:(0,T.oX)(d,h),legendPosition:"bottom",name:n,padding:l,theme:E.Z,width:g},d&&d.map(((e,t)=>this.getChart(e,t))),o().createElement(v.C,{label:u,style:le.xAxis,tickValues:[1,S,C]}),o().createElement(v.C,{dependentAxis:!0,label:p,style:le.yAxis})))))}}const pe=(0,l.ZP)(ue);class me extends o().Component{constructor(){super(...arguments),this.getSkeleton=()=>o().createElement(o().Fragment,null,o().createElement(a.Skeleton,{style:H.chartSkeleton,width:W.N.md}),o().createElement(a.Skeleton,{style:H.legendSkeleton,width:W.N.xs})),this.updateReport=()=>{const{fetchReport:e,currentQueryString:t,previousQueryString:r,reportPathsType:a,reportType:s}=this.props;e(a,s,t),e(a,s,r)}}componentDidMount(){this.updateReport()}componentDidUpdate(e){const{currentQueryString:t,previousQueryString:r}=this.props;e.currentQueryString===t&&e.previousQueryString===r||this.updateReport()}render(){const{chartName:e,currentReport:t,currentReportFetchStatus:r,previousReport:a,previousReportFetchStatus:s,intl:n}=this.props,l=(0,m.zJ)(t,m.yZ.rolling,"date","limit"),c=(0,m.zJ)(t,m.yZ.rolling,"date","request"),u=(0,m.zJ)(t,m.yZ.rolling,"date","usage"),p=(0,m.zJ)(a,m.yZ.rolling,"date","limit"),h=(0,m.zJ)(a,m.yZ.rolling,"date","request"),d=(0,m.zJ)(a,m.yZ.rolling,"date","usage"),g=t&&t.meta&&t.meta.total&&t.meta.total.usage?t.meta.total.usage.units:"";return o().createElement("div",{style:H.chartContainer},o().createElement("div",{style:H.usageChart},r===N.iF.inProgress&&s===N.iF.inProgress?this.getSkeleton():o().createElement(pe,{adjustContainerHeight:!0,containerHeight:300,currentLimitData:l,currentRequestData:c,currentUsageData:u,formatter:A.bM,formatOptions:{},height:300,name:e,previousLimitData:p,previousRequestData:h,previousUsageData:d,xAxisLabel:n.formatMessage(i.Z.historicalChartDayOfMonthLabel),yAxisLabel:n.formatMessage(i.Z.units,{units:(0,A.ZV)(g)})})))}}const he=(0,N.X1)(((e,{reportPathsType:t,reportType:r,router:a})=>{const i=(0,u.mB)(a.location.search),n=(0,u.fU)(i),o=(0,z.OA)(i),l=(0,z.VL)(i),c=(0,z.pe)(i),p=r===s.C.instanceType||r===s.C.storage,m={filter_by:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n&&n.filter_by&&n.filter_by),i&&i.isPlatformCosts&&{category:I.rx}),i&&i.filter&&i.filter.account&&{[`${I.Sq}account`]:i.filter.account}),o&&p&&{[I.dV]:o}),n&&n.filter_by&&n.filter_by[I.dV]&&{[`${I.pi}${I.dV}`]:n.filter_by[I.dV],[I.dV]:void 0}),exclude:Object.assign({},n&&n.exclude&&n.exclude),group_by:Object.assign(Object.assign({},o&&!p&&{[I.dV]:o}),l&&!o&&{[l]:c})},h=Object.assign(Object.assign({},m),{filter:{resolution:"daily",time_scope_units:"month",time_scope_value:-1},filter_by:Object.assign(Object.assign({},m.filter_by),l&&"*"!==c&&{[l]:void 0})}),d=(0,u.pm)(h),g=Q.ZV.selectReport(e,t,r,d),y=Q.ZV.selectReportFetchStatus(e,t,r,d),f=Object.assign(Object.assign({},m),{filter:{resolution:"daily",time_scope_units:"month",time_scope_value:-2},filter_by:Object.assign(Object.assign({},m.filter_by),l&&"*"!==c&&{[l]:void 0})}),b=(0,u.pm)(f);return{currentQuery:h,currentQueryString:d,currentReport:g,currentReportFetchStatus:y,previousQuery:f,previousQueryString:b,previousReport:Q.ZV.selectReport(e,t,r,b),previousReportFetchStatus:Q.ZV.selectReportFetchStatus(e,t,r,b)}})),de={fetchReport:Q.nx.fetchReport},ge=(0,l.ZP)((0,q.E)((0,p.connect)(he,de)(me)));class ye extends o().Component{constructor(){super(...arguments),this.getTitleKey=(e,t)=>e===s.K.azure?t===s.C.instanceType?"virtual_machine":t:t===s.C.instanceType?"instance_type":t,this.getCostChart=e=>{const{costDistribution:t,costType:r,currency:s,intl:n}=this.props;return o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:a.TitleSizes.lg},n.formatMessage(i.Z.historicalChartTitle,{value:this.getTitleKey(e.reportPathsType,e.reportType)}))),o().createElement(a.CardBody,null,o().createElement(Y,{chartName:e.chartName,costDistribution:t,costType:r,currency:s,reportPathsType:e.reportPathsType,reportType:e.reportType})))},this.getTrendChart=e=>{const{costType:t,currency:r,intl:s}=this.props;return o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:a.TitleSizes.lg},s.formatMessage(i.Z.historicalChartTitle,{value:this.getTitleKey(e.reportPathsType,e.reportType)}))),o().createElement(a.CardBody,null,o().createElement(oe,{chartName:e.chartName,costType:t,currency:r,reportPathsType:e.reportPathsType,reportType:e.reportType})))},this.getUsageChart=e=>{const{intl:t}=this.props;return o().createElement(a.Card,null,o().createElement(a.CardTitle,null,o().createElement(a.Title,{headingLevel:"h2",size:a.TitleSizes.lg},t.formatMessage(i.Z.historicalChartTitle,{value:this.getTitleKey(e.reportPathsType,e.reportType)}))),o().createElement(a.CardBody,null,o().createElement(ge,{chartName:e.chartName,reportPathsType:e.reportPathsType,reportType:e.reportType})))}}renderWidget(e){switch(e.type){case c.b.cost:return this.getCostChart(e);case c.b.trend:return this.getTrendChart(e);case c.b.usage:return this.getUsageChart(e);default:return null}}render(){const{selectWidgets:e,widgets:t}=this.props;return o().createElement(a.Grid,{hasGutter:!0},t.map((t=>{const r=e[t];return o().createElement(a.GridItem,{key:`widget-${t}`},this.renderWidget(r))})))}}const fe=(0,l.ZP)(ye)},33748:(e,t,r)=>{r.d(t,{W:()=>c});var a=r(49382),s=r(33605),i=r(17918),n=r(54881),o=r(98499),l=r(48196);const c={costDistribution:{display:"flex",marginLeft:o.ZP.var},costValue:{marginTop:o.ZP.var,marginBottom:0},costLabelUnit:{fontSize:n.ZP.value,color:s.ZP.var},dateTitle:{textAlign:"end"},header:{backgroundColor:a.ZP.var,padding:o.ZP.var},headerContent:{display:"flex",justifyContent:"space-between"},headerContentLeft:{display:"flex",minHeight:"90px"},headerContentRight:{display:"flex"},info:{verticalAlign:"middle"},infoIcon:{fontSize:i.ZP.value},infoTitle:{fontWeight:"bold"},title:{paddingBottom:l.ZP.var}}}}]);