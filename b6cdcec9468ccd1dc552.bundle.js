(self.webpackChunkkoku_ui=self.webpackChunkkoku_ui||[]).push([[8775,913],{80913:(t,e,n)=>{(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};e.r(r),e.d(r,{FlagContext:()=>s,FlagProvider:()=>a,InMemoryStorageProvider:()=>o.InMemoryStorageProvider,LocalStorageProvider:()=>o.LocalStorageProvider,UnleashClient:()=>o.UnleashClient,default:()=>p,useFlag:()=>c,useFlagsStatus:()=>u,useUnleashClient:()=>f,useUnleashContext:()=>h,useVariant:()=>l});const o=n(69942),i=n(92950),s=e.n(i)().createContext(null),a=function(t){var e=t.config,n=t.children,r=t.unleashClient,a=t.startClient,c=void 0===a||a,u=i.useRef(r),l=i.useState(!1),h=l[0],f=l[1],p=i.useState(null),d=p[0],v=p[1];e||r||console.warn("You must provide either a config or an unleash client to the flag provider. If you are initializing the client in useEffect, you can avoid this warning by\n      checking if the client exists before rendering."),u.current||(u.current=new o.UnleashClient(e)),u.current.on("ready",(function(){f(!0)})),u.current.on("error",(function(t){v(t)})),i.useEffect((function(){(c||!r)&&u.current.start()}),[]);var y=function(t){return n=function(){return function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,(function(e){switch(e.label){case 0:return[4,u.current.updateContext(t)];case 1:return e.sent(),[2]}}))},new((e=void 0)||(e=Promise))((function(t,r){function o(t){try{s(n.next(t))}catch(t){r(t)}}function i(t){try{s(n.throw(t))}catch(t){r(t)}}function s(n){var r;n.done?t(n.value):(r=n.value,r instanceof e?r:new e((function(t){t(r)}))).then(o,i)}s((n=n.apply(void 0,[])).next())}));var e,n},g=function(t){return u.current.isEnabled(t)},m=function(t){return u.current.getVariant(t)},b=function(t,e,n){return u.current.on(t,e,n)},w=i.useMemo((function(){return{on:b,updateContext:y,isEnabled:g,getVariant:m,client:u.current,flagsReady:h,flagsError:d,setFlagsReady:f,setFlagsError:v}}),[h,d]);return i.createElement(s.Provider,{value:w},n)},c=function(t){var e=(0,i.useContext)(s),n=e.isEnabled,r=e.client,o=(0,i.useState)(!!n(t)),a=o[0],c=o[1],u=(0,i.useRef)();return u.current=a,(0,i.useEffect)((function(){r&&(r.on("update",(function(){var e=n(t);e!==u.current&&(u.current=e,c(!!e))})),r.on("ready",(function(){var e=n(t);c(e)})))}),[r]),a},u=function(){var t=(0,i.useContext)(s);return{flagsReady:t.flagsReady,flagsError:t.flagsError}},l=function(t){var e=(0,i.useContext)(s),n=e.getVariant,r=e.client,o=(0,i.useState)(n(t)),a=o[0],c=o[1],u=(0,i.useRef)();return u.current=a,(0,i.useEffect)((function(){r&&(r.on("update",(function(){var e=n(t);u.current.name===e.name&&u.current.enabled===e.enabled||(c(e),u.current=e)})),r.on("ready",(function(){var e=n(t);c(e)})))}),[r]),a||{}},h=function(){return(0,i.useContext)(s).updateContext},f=function(){return(0,i.useContext)(s).client},p=a;t.exports=r})()},69942:function(t,e){!function(t){"use strict";function e(t,e,n,r){function o(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){t.done?n(t.value):o(t.value).then(s,a)}c((r=r.apply(t,e||[])).next())}))}function n(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!((s=0<(s=c.trys).length&&s[s.length-1])||6!==n[0]&&2!==n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(t){n=[6,t],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function r(){}function o(){return v>d.length-16&&(p.randomFillSync(d),v=0),d.slice(v,v+=16)}function i(t,e=0){const n=(g[t[e+0]]+g[t[e+1]]+g[t[e+2]]+g[t[e+3]]+"-"+g[t[e+4]]+g[t[e+5]]+"-"+g[t[e+6]]+g[t[e+7]]+"-"+g[t[e+8]]+g[t[e+9]]+"-"+g[t[e+10]]+g[t[e+11]]+g[t[e+12]]+g[t[e+13]]+g[t[e+14]]+g[t[e+15]]).toLowerCase();if(!function(t){return"string"==typeof t&&y.test(t)}(n))throw TypeError("Stringified UUID is invalid");return n}function s(t,e,n){const r=(t=t||{}).random||(t.rng||o)();if(r[6]=64|15&r[6],r[8]=128|63&r[8],e){n=n||0;for(let t=0;16>t;++t)e[n+t]=r[t];return e}return i(r)}var a=function(t,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},a(t,e)},c=function(){return c=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},c.apply(this,arguments)};r.prototype={on:function(t,e,n){var r=this.e||(this.e={});return(r[t]||(r[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){function r(){o.off(t,r),e.apply(n,arguments)}var o=this;return r._=e,this.on(t,r,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),r=0,o=n.length;r<o;r++)n[r].fn.apply(n[r].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),r=n[t],o=[];if(r&&e)for(var i=0,s=r.length;i<s;i++)r[i].fn!==e&&r[i].fn._!==e&&o.push(r[i]);return o.length?n[t]=o:delete n[t],this}};var u=r;r.TinyEmitter=u;var l=function(){function t(t){var e=t.onError,n=t.appName,r=t.metricsInterval,o=t.disableMetrics,i=t.url,s=t.clientKey,a=t.fetch,c=t.headerName;this.onError=e,this.disabled=void 0!==o&&o,this.metricsInterval=1e3*r,this.appName=n,this.url=i instanceof URL?i:new URL(i),this.clientKey=s,this.bucket=this.createEmptyBucket(),this.fetch=a,this.headerName=c}return t.prototype.start=function(){var t=this;return!this.disabled&&void("number"==typeof this.metricsInterval&&0<this.metricsInterval&&setTimeout((function(){t.startTimer(),t.sendMetrics()}),2e3))},t.prototype.stop=function(){this.timer&&(clearTimeout(this.timer),delete this.timer)},t.prototype.createEmptyBucket=function(){return{start:new Date,stop:null,toggles:{}}},t.prototype.sendMetrics=function(){return e(this,void 0,void 0,(function(){var t,e,r,o;return n(this,(function(n){switch(n.label){case 0:if(t="".concat(this.url,"/client/metrics"),e=this.getPayload(),this.bucketIsEmpty(e))return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.fetch(t,{cache:"no-cache",method:"POST",headers:(o={},o[this.headerName]=this.clientKey,o.Accept="application/json",o["Content-Type"]="application/json",o),body:JSON.stringify(e)})];case 2:return n.sent(),[3,4];case 3:return r=n.sent(),console.error("Unleash: unable to send feature metrics",r),this.onError(r),[3,4];case 4:return[2]}}))}))},t.prototype.count=function(t,e){return!this.disabled&&this.bucket&&(this.assertBucket(t),this.bucket.toggles[t][e?"yes":"no"]++,!0)},t.prototype.assertBucket=function(t){return!this.disabled&&this.bucket&&void(!this.bucket.toggles[t]&&(this.bucket.toggles[t]={yes:0,no:0}))},t.prototype.startTimer=function(){var t=this;this.timer=setInterval((function(){t.sendMetrics()}),this.metricsInterval)},t.prototype.bucketIsEmpty=function(t){return 0===Object.keys(t.bucket.toggles).length},t.prototype.getPayload=function(){var t=c(c({},this.bucket),{stop:new Date});return this.bucket=this.createEmptyBucket(),{bucket:t,appName:this.appName,instanceId:"browser"}},t}(),h=function(){function t(){this.store=new Map}return t.prototype.save=function(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(){return this.store.set(t,r),[2]}))}))},t.prototype.get=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(){return[2,this.store.get(t)]}))}))},t}(),f=function(){function t(){this.prefix="unleash:repository"}return t.prototype.save=function(t,r){return e(this,void 0,void 0,(function(){var e,o;return n(this,(function(){e=JSON.stringify(r),o="".concat(this.prefix,":").concat(t);try{window.localStorage.setItem(o,e)}catch(t){console.error(t)}return[2]}))}))},t.prototype.get=function(t){try{var e="".concat(this.prefix,":").concat(t),n=window.localStorage.getItem(e);return n?JSON.parse(n):void 0}catch(t){console.error(t)}},t}(),p={};const d=new Uint8Array(256);let v=d.length;var y=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const g=[];for(let t=0;256>t;++t)g.push((t+256).toString(16).substr(1));var m=function(){function t(){}return t.prototype.generateEventId=function(){return s()},t.prototype.createImpressionEvent=function(t,e,n,r,o){var i=this.createBaseEvent(t,e,n,r);return o?c(c({},i),{variant:o}):i},t.prototype.createBaseEvent=function(t,e,n,r){return{eventType:r,eventId:this.generateEventId(),context:t,enabled:e,featureName:n}},t}(),b=function(t){return null!=t[1]},w=["userId","sessionId","remoteAddress"],E={INIT:"initialized",ERROR:"error",READY:"ready",UPDATE:"update",IMPRESSION:"impression"},x="isEnabled",I="getVariant",S={name:"disabled",enabled:!1},R="repo",k=function(){try{if("fetch"in window)return fetch.bind(window);if("fetch"in globalThis)return fetch.bind(globalThis)}catch(t){console.error('Unleash failed to resolve "fetch"',t)}},O=function(t){function r(e){var n=e.storageProvider,r=e.url,o=e.clientKey,i=e.disableRefresh,s=e.refreshInterval,a=void 0===s?30:s,u=e.metricsInterval,h=void 0===u?30:u,p=e.disableMetrics,d=e.appName,v=e.environment,y=void 0===v?"default":v,g=e.context,b=e.fetch,w=void 0===b?k():b,x=e.bootstrap,I=e.bootstrapOverride,S=e.headerName,R=void 0===S?"Authorization":S,O=e.customHeaders,T=void 0===O?{}:O,N=t.call(this)||this;if(N.toggles=[],N.etag="",N.readyEventEmitted=!1,!r)throw new Error("url is required");if(!o)throw new Error("clientKey is required");if(!d)throw new Error("appName is required.");return N.eventsHandler=new m,N.toggles=x&&0<x.length?x:[],N.url=r instanceof URL?r:new URL(r),N.clientKey=o,N.headerName=R,N.customHeaders=T,N.storage=n||new f,N.refreshInterval=void 0!==i&&i?0:1e3*a,N.context=c({appName:d,environment:y},g),N.ready=new Promise((function(t){N.init().then(t).catch((function(e){console.error(e),N.emit(E.ERROR,e),t()}))})),w||console.error('Unleash: You must either provide your own "fetch" implementation or run in an environment where "fetch" is available.'),N.fetch=w,N.bootstrap=x&&0<x.length?x:void 0,N.bootstrapOverride=void 0===I||I,N.metrics=new l({onError:N.emit.bind(N,E.ERROR),appName:d,metricsInterval:h,disableMetrics:void 0!==p&&p,url:N.url,clientKey:o,fetch:w,headerName:R}),N}return function(t,e){function n(){this.constructor=t}if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+e+" is not a constructor or null");a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(r,t),r.prototype.getAllToggles=function(){return function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([],this.toggles,!0)},r.prototype.isEnabled=function(t){var e=this.toggles.find((function(e){return e.name===t})),n=!!e&&e.enabled;if(this.metrics.count(t,n),null==e?void 0:e.impressionData){var r=this.eventsHandler.createImpressionEvent(this.context,n,t,x);this.emit(E.IMPRESSION,r)}return n},r.prototype.getVariant=function(t){var e=this.toggles.find((function(e){return e.name===t}));if(e){if(this.metrics.count(t,!0),e.impressionData){var n=this.eventsHandler.createImpressionEvent(this.context,e.enabled,t,I,e.variant.name);this.emit(E.IMPRESSION,n)}return e.variant}return this.metrics.count(t,!1),S},r.prototype.updateContext=function(t){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return(t.appName||t.environment)&&console.warn("appName and environment are static. They can't be updated with updateContext."),e={environment:this.context.environment,appName:this.context.appName},this.context=c(c({},e),t),this.timerRef?[4,this.fetchToggles()]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},r.prototype.getContext=function(){return c({},this.context)},r.prototype.setContextField=function(t,e){var n,r;if(w.includes(t))this.context=c(c({},this.context),((n={})[t]=e,n));else{var o=c(c({},this.context.properties),((r={})[t]=e,r));this.context=c(c({},this.context),{properties:o})}this.timerRef&&this.fetchToggles()},r.prototype.init=function(){return e(this,void 0,void 0,(function(){var t,e;return n(this,(function(n){switch(n.label){case 0:return[4,this.resolveSessionId()];case 1:return t=n.sent(),this.context=c({sessionId:t},this.context),e=this,[4,this.storage.get(R)];case 2:return e.toggles=n.sent()||[],this.bootstrap&&(this.bootstrapOverride||0===this.toggles.length)?[4,this.storage.save(R,this.bootstrap)]:[3,4];case 3:n.sent(),this.toggles=this.bootstrap,this.emit(E.READY),n.label=4;case 4:return this.emit(E.INIT),[2]}}))}))},r.prototype.start=function(){return e(this,void 0,void 0,(function(){var t,e=this;return n(this,(function(n){switch(n.label){case 0:return this.timerRef?(console.error("Unleash SDK has already started, if you want to restart the SDK you should call client.stop() before starting again."),[2]):[4,this.ready];case 1:return n.sent(),this.metrics.start(),t=this.refreshInterval,[4,this.fetchToggles()];case 2:return n.sent(),0<t&&(this.timerRef=setInterval((function(){return e.fetchToggles()}),t)),[2]}}))}))},r.prototype.stop=function(){this.timerRef&&(clearInterval(this.timerRef),this.timerRef=void 0),this.metrics.stop()},r.prototype.resolveSessionId=function(){return e(this,void 0,void 0,(function(){var t;return n(this,(function(e){var n=Math.floor;switch(e.label){case 0:return this.context.sessionId?[2,this.context.sessionId]:[3,1];case 1:return[4,this.storage.get("sessionId")];case 2:return(t=e.sent())?[3,4]:(t=n(1e9*Math.random()),[4,this.storage.save("sessionId",t)]);case 3:e.sent(),e.label=4;case 4:return[2,t]}}))}))},r.prototype.getHeaders=function(){var t,e=((t={})[this.headerName]=this.clientKey,t.Accept="application/json",t["Content-Type"]="application/json",t["If-None-Match"]=this.etag,t);return Object.entries(this.customHeaders).filter(b).forEach((function(t){var n=t[0],r=t[1];return e[n]=r})),e},r.prototype.storeToggles=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this.toggles=t,this.emit(E.UPDATE),[4,this.storage.save(R,t)];case 1:return e.sent(),[2]}}))}))},r.prototype.fetchToggles=function(){return e(this,void 0,void 0,(function(){var t,e,r,o,i;return n(this,(function(n){switch(n.label){case 0:if(!this.fetch)return[3,8];n.label=1;case 1:return n.trys.push([1,7,,8]),t=this.context,e=new URL(this.url.toString()),Object.entries(t).filter(b).forEach((function(t){var n=t[0],r=t[1];"properties"===n&&r?Object.entries(r).filter(b).forEach((function(t){var n=t[0],r=t[1];return e.searchParams.append("properties[".concat(n,"]"),r)})):e.searchParams.append(n,r)})),[4,this.fetch(e.toString(),{cache:"no-cache",headers:this.getHeaders()})];case 2:return(r=n.sent()).ok&&304!==r.status?(this.etag=r.headers.get("ETag")||"",[4,r.json()]):[3,5];case 3:return o=n.sent(),[4,this.storeToggles(o.toggles)];case 4:return n.sent(),this.bootstrap||this.readyEventEmitted||(this.emit(E.READY),this.readyEventEmitted=!0),[3,6];case 5:r.ok||(console.error("Unleash: Fetching feature toggles did not have an ok response"),this.emit(E.ERROR,{type:"HttpError",code:r.status})),n.label=6;case 6:return[3,8];case 7:return i=n.sent(),console.error("Unleash: unable to fetch feature toggles",i),this.emit(E.ERROR,i),[3,8];case 8:return[2]}}))}))},r}(u);t.EVENTS=E,t.InMemoryStorageProvider=h,t.LocalStorageProvider=f,t.UnleashClient=O,t.resolveFetch=k,Object.defineProperty(t,"__esModule",{value:!0})}(e)}}]);
//# sourceMappingURL=b6cdcec9468ccd1dc552.bundle.js.map