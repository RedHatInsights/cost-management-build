{"version":3,"sources":["webpack:///./node_modules/xstate/es/environment.js","webpack:///./node_modules/xstate/es/types.js","webpack:///./node_modules/xstate/es/constants.js","webpack:///./node_modules/xstate/es/stateUtils.js","webpack:///./node_modules/xstate/es/actions.js","webpack:///./node_modules/xstate/es/actionTypes.js","webpack:///./node_modules/xstate/es/State.js","webpack:///./node_modules/xstate/es/Actor.js","webpack:///./node_modules/xstate/es/scheduler.js","webpack:///./node_modules/xstate/es/registry.js","webpack:///./node_modules/xstate/es/devTools.js","webpack:///./node_modules/xstate/es/interpreter.js","webpack:///./node_modules/xstate/es/StateNode.js","webpack:///./node_modules/xstate/es/Machine.js","webpack:///./node_modules/xstate/es/_virtual/_tslib.js","webpack:///./node_modules/xstate/es/utils.js"],"names":["IS_PRODUCTION","ActionTypes","SpecialTargets","STATE_DELIMITER","EMPTY_ACTIVITY_MAP","DEFAULT_GUARD_TYPE","TARGETLESS_KEY","isLeafNode","stateNode","type","getChildren","states","map","key","getAllStateNodes","stateNodes","concat","getConfiguration","prevStateNodes","e_1","_a","e_2","_b","e_3","_c","e_4","_d","prevAdjList","getAdjList","Set","configuration","configuration_1","configuration_1_1","next","done","m","s","value","parent","has","add","e_1_1","error","return","call","adjList","configuration_2","configuration_2_1","get","length","_e","_f","child","forEach","sn","initialStateNodes","e_3_1","e_2_1","configuration_3","configuration_3_1","e_4_1","e_5","Map","configuration_4","configuration_4_1","set","push","e_5_1","getValue","rootNode","getValueFromAdj","baseNode","childStateNodes","childStateNode","stateValue","csn","iterable","item","Array","isArray","some","member","nextEvents","ownEvents","isInFinalState","every","initEvent","getActionFunction","actionType","actionFunctionMap","undefined","toActionObject","action","actionObject","exec","name","toString","other","Object","defineProperty","enumerable","configurable","toActionObjects","subAction","toActivityDefinition","id","raise","event","send","to","Internal","options","delay","cancel","sendId","start","activity","activityDef","Start","stop","Stop","assign","assignment","after","delayRef","idSuffix","After","data","DoneState","eventObject","doneInvoke","DoneInvoke","ErrorPlatform","resolveActions","machine","currentState","currentContext","_event","actions","assignActions","otherActions","updatedContext","sendAction","ctx","delaysMap","resolvedDelay","meta","resolvedEvent","configDelay","resolvedTarget","resolveSend","delays","expr","resolveLog","matchedActions","conds","find","condition","guard","cond","guards","resolved","Raise","Send","Cancel","nullEvent","NullEvent","Assign","log","Log","init","Init","invoke","Invoke","errorPlatform","ErrorExecution","ErrorCustom","update","Update","choose","Choose","pure","Pure","stateValuesEqual","a","b","aKeys","bKeys","isState","state","bindActionToState","context","State","config","_this","this","activities","events","_sessionid","historyValue","history","matches","bind","toStrings","transitions","children","from","create","inert","prototype","delimiter","valueKeys","apply","toJSON","parentStateValue","createInvocableActor","invokeDefinition","tempActor","subscribe","unsubscribe","serviceCreator","services","src","deferred","initialState","isActor","e","defaultOptions","deferEvents","Scheduler","processingEvent","queue","initialized","initialize","callback","schedule","process","flushEvents","task","Error","clear","nextCallback","shift","sessionIdIndex","registry","bookId","register","actor","free","delete","registerService","service","window","devTools","w","__xstate__","getDevTools","InterpreterStatus","DEFAULT_SPAWN_OPTIONS","sync","autoForward","withServiceScope","serviceStack","fn","result","pop","Interpreter","scheduler","delayedEventsMap","listeners","contextListeners","stopListeners","doneListeners","eventListeners","sendListeners","_status","NotStarted","forwardTo","payload","batch","Stopped","JSON","stringify","Running","forward","nextState","_state","sendTo","isParent","Parent","target","origin","sessionId","resolvedOptions","clock","logger","resolvedId","_initialState","execute","actionsConfig","listener","_g","_h","_j","_k","contextListener","isDone","finalChildStateNode","doneData","_l","_m","onTransition","nextListenerOrObserver","errorListener","completeListener","resolvedCompleteListener","complete","onDone","onEvent","onSend","onChange","onStop","off","resolvedState","resolveState","attachDev","e_6","e_7","e_8","e_9","e_10","e_6_1","e_7_1","e_8_1","_o","e_9_1","_p","_q","clearTimeout","e_10_1","e_11","batchChanged","batchedActions","_loop_1","event_1","transition","changed","events_1","events_1_1","e_11_1","sender","indexOf","nextEvent","e_12","e_12_1","defer","setTimeout","actionOrExec","err","resolvedData","source","spawnPromise","Promise","resolve","spawnCallback","spawnObservable","spawnMachine","withContext","spawnActivity","stopChild","label","removeChild","childId","spawn","entity","spawnActor","childService","doneEvent","promise","canceled","then","response","errorData","errorEvent","strict","handleError","unsubscribed","callbackStop","receivers","newListener","receiver","subscription","implementation","dispose","spawnEffect","__REDUX_DEVTOOLS_EXTENSION__","devToolsOptions","connect","autoPause","stateSanitizer","features","jump","skip","global","ms","console","interpret","EMPTY_OBJECT","isStateId","str","StateNode","order","__xstatenode","__cache","relativeValue","initialStateValue","on","candidates","delayedTransitions","idMap","_parent","_key","path","join","version","parallel","initial","stateConfig","dfs","_transient","always","onEntry","entry","onExit","exit","invokeConfig","i","invokeSrc","_init","withConfig","definition","reduce","eventType","getDelayedTransitions","formatTransitions","getCandidates","eventName","transient","filter","sameEventType","afterConfig","mutateEntryExit","configTransition","resolvedTransition","isNaN","delayedTransition","formatTransition","getStateNodes","getStateNode","subStateKeys","subStateKey","allSubStateNodes","subStateNode","handles","includes","transitionLeafNode","transitionCompoundNode","_transition","transitionParallelNode","transitionMap","subStateValue","stateTransitions","enabledTransitions","st","entryNodes","t","entrySet","exitSet","selectedTransition","nextStateNodes","candidate","stateIn","in","resolvedContext","isInState","getStateNodeById","slice","guardPassed","message","allNextStateNodes","getRelativeStateNodes","isInternal","internal","n","nodesFromChild","escapes","nodes","marker","getActions","prevState","prevConfig","resolvedConfig","resolvedConfig_1","resolvedConfig_1_1","prevConfig_1","prevConfig_1_1","doneEvents","grandparent","parentNode","sort","entryStates","exitStates","entryActions","exitActions","resolvedStateValue","getResolvedPath","stateTransition","resolveTransition","resolveRaisedTransition","originalEvent","currentActions","unshift","actions_1","actions_1_1","resolvedActions","raisedEvents","nonRaisedActions","acc","resolvedConfiguration","didUpdateContext","maybeNextState","raisedEvent","stateKey","stateId","resolvedStateId","getStateNodeByPath","statePath","arrayStatePath","currentStateNode","stateIdentifier","getInitialState","historyConfig","relativeStateId","resolveHistory","initialStateNodePaths","initialPath","getFromRelativePath","relativePath","childStatePath","relativeStateValue","current","historyTarget","relativeChildPath","subHistoryValue","subStatePath","childStateIds","stateIds","resolveTarget","_target","isInternalTarget","transitionConfig","normalizedTarget","onConfig","wildcardConfigs","strictTransitionConfigs_1","transitionConfigArray","hasNonLastUnguardedTarget","eventText","validateArrayifiedTransitions","eventlessConfig","doneConfig","String","invokeDef","settleTransitions","onError","formattedTransitions","delayedTransitions_1","delayedTransitions_1_1","Machine","initialContext","resolvedInitialContext","__assign","arguments","p","hasOwnProperty","__rest","getOwnPropertySymbols","propertyIsEnumerable","__values","o","Symbol","iterator","__read","r","ar","__spread","keys","matchesState","parentStateId","childStateId","toStateValue","childStateValue","isString","getEventType","toStatePath","split","pathToStateValue","mapValues","collection","iteratee","collectionKeys","mapFilterValues","predicate","props","object","props_1","props_1_1","nestedPath","accessorProp","props_2","props_2_1","prop","toStatePaths","flatten","subPath","array","toArrayStrict","toArray","mapContext","mapper","isFunction","subMapper","isBuiltInEvent","test","isPromiseLike","partition","items","truthy","falsy","items_1","items_1_1","updateHistoryStates","hist","subHist","updateHistoryValue","updateContext","warn","assignAction","partialUpdate","propAssignment","toGuard","guardMap","isObservable","args","symbolObservable","observable","isMachine","uniqueId","currentId","toEventObject","toSCXMLEvent","scxmlEvent","$$type","toTransitionConfigArray","configLike","transitionLike","normalizeTarget","reportUnhandledExceptionOnInvocation","originalError","currentError","originalStackTrace","stack","stackTrace","evaluateGuard","guardMeta","condFn"],"mappings":"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","file":"22107042957e0986df33.bundle.js","sourcesContent":["var IS_PRODUCTION = process.env.NODE_ENV === 'production';\nexport { IS_PRODUCTION };","var ActionTypes;\n\n(function (ActionTypes) {\n  ActionTypes[\"Start\"] = \"xstate.start\";\n  ActionTypes[\"Stop\"] = \"xstate.stop\";\n  ActionTypes[\"Raise\"] = \"xstate.raise\";\n  ActionTypes[\"Send\"] = \"xstate.send\";\n  ActionTypes[\"Cancel\"] = \"xstate.cancel\";\n  ActionTypes[\"NullEvent\"] = \"\";\n  ActionTypes[\"Assign\"] = \"xstate.assign\";\n  ActionTypes[\"After\"] = \"xstate.after\";\n  ActionTypes[\"DoneState\"] = \"done.state\";\n  ActionTypes[\"DoneInvoke\"] = \"done.invoke\";\n  ActionTypes[\"Log\"] = \"xstate.log\";\n  ActionTypes[\"Init\"] = \"xstate.init\";\n  ActionTypes[\"Invoke\"] = \"xstate.invoke\";\n  ActionTypes[\"ErrorExecution\"] = \"error.execution\";\n  ActionTypes[\"ErrorCommunication\"] = \"error.communication\";\n  ActionTypes[\"ErrorPlatform\"] = \"error.platform\";\n  ActionTypes[\"ErrorCustom\"] = \"xstate.error\";\n  ActionTypes[\"Update\"] = \"xstate.update\";\n  ActionTypes[\"Pure\"] = \"xstate.pure\";\n  ActionTypes[\"Choose\"] = \"xstate.choose\";\n})(ActionTypes || (ActionTypes = {}));\n\nvar SpecialTargets;\n\n(function (SpecialTargets) {\n  SpecialTargets[\"Parent\"] = \"#_parent\";\n  SpecialTargets[\"Internal\"] = \"#_internal\";\n})(SpecialTargets || (SpecialTargets = {}));\n\nexport { ActionTypes, SpecialTargets };","var STATE_DELIMITER = '.';\nvar EMPTY_ACTIVITY_MAP = {};\nvar DEFAULT_GUARD_TYPE = 'xstate.guard';\nvar TARGETLESS_KEY = '';\nexport { DEFAULT_GUARD_TYPE, EMPTY_ACTIVITY_MAP, STATE_DELIMITER, TARGETLESS_KEY };","import { __values, __spread } from './_virtual/_tslib.js';\nimport { keys, flatten } from './utils.js';\n\nvar isLeafNode = function (stateNode) {\n  return stateNode.type === 'atomic' || stateNode.type === 'final';\n};\n\nfunction getChildren(stateNode) {\n  return keys(stateNode.states).map(function (key) {\n    return stateNode.states[key];\n  });\n}\n\nfunction getAllStateNodes(stateNode) {\n  var stateNodes = [stateNode];\n\n  if (isLeafNode(stateNode)) {\n    return stateNodes;\n  }\n\n  return stateNodes.concat(flatten(getChildren(stateNode).map(getAllStateNodes)));\n}\n\nfunction getConfiguration(prevStateNodes, stateNodes) {\n  var e_1, _a, e_2, _b, e_3, _c, e_4, _d;\n\n  var prevConfiguration = new Set(prevStateNodes);\n  var prevAdjList = getAdjList(prevConfiguration);\n  var configuration = new Set(stateNodes);\n\n  try {\n    // add all ancestors\n    for (var configuration_1 = __values(configuration), configuration_1_1 = configuration_1.next(); !configuration_1_1.done; configuration_1_1 = configuration_1.next()) {\n      var s = configuration_1_1.value;\n      var m = s.parent;\n\n      while (m && !configuration.has(m)) {\n        configuration.add(m);\n        m = m.parent;\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configuration_1_1 && !configuration_1_1.done && (_a = configuration_1.return)) _a.call(configuration_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  var adjList = getAdjList(configuration);\n\n  try {\n    // add descendants\n    for (var configuration_2 = __values(configuration), configuration_2_1 = configuration_2.next(); !configuration_2_1.done; configuration_2_1 = configuration_2.next()) {\n      var s = configuration_2_1.value; // if previously active, add existing child nodes\n\n      if (s.type === 'compound' && (!adjList.get(s) || !adjList.get(s).length)) {\n        if (prevAdjList.get(s)) {\n          prevAdjList.get(s).forEach(function (sn) {\n            return configuration.add(sn);\n          });\n        } else {\n          s.initialStateNodes.forEach(function (sn) {\n            return configuration.add(sn);\n          });\n        }\n      } else {\n        if (s.type === 'parallel') {\n          try {\n            for (var _e = (e_3 = void 0, __values(getChildren(s))), _f = _e.next(); !_f.done; _f = _e.next()) {\n              var child = _f.value;\n\n              if (child.type === 'history') {\n                continue;\n              }\n\n              if (!configuration.has(child)) {\n                configuration.add(child);\n\n                if (prevAdjList.get(child)) {\n                  prevAdjList.get(child).forEach(function (sn) {\n                    return configuration.add(sn);\n                  });\n                } else {\n                  child.initialStateNodes.forEach(function (sn) {\n                    return configuration.add(sn);\n                  });\n                }\n              }\n            }\n          } catch (e_3_1) {\n            e_3 = {\n              error: e_3_1\n            };\n          } finally {\n            try {\n              if (_f && !_f.done && (_c = _e.return)) _c.call(_e);\n            } finally {\n              if (e_3) throw e_3.error;\n            }\n          }\n        }\n      }\n    }\n  } catch (e_2_1) {\n    e_2 = {\n      error: e_2_1\n    };\n  } finally {\n    try {\n      if (configuration_2_1 && !configuration_2_1.done && (_b = configuration_2.return)) _b.call(configuration_2);\n    } finally {\n      if (e_2) throw e_2.error;\n    }\n  }\n\n  try {\n    // add all ancestors\n    for (var configuration_3 = __values(configuration), configuration_3_1 = configuration_3.next(); !configuration_3_1.done; configuration_3_1 = configuration_3.next()) {\n      var s = configuration_3_1.value;\n      var m = s.parent;\n\n      while (m && !configuration.has(m)) {\n        configuration.add(m);\n        m = m.parent;\n      }\n    }\n  } catch (e_4_1) {\n    e_4 = {\n      error: e_4_1\n    };\n  } finally {\n    try {\n      if (configuration_3_1 && !configuration_3_1.done && (_d = configuration_3.return)) _d.call(configuration_3);\n    } finally {\n      if (e_4) throw e_4.error;\n    }\n  }\n\n  return configuration;\n}\n\nfunction getValueFromAdj(baseNode, adjList) {\n  var childStateNodes = adjList.get(baseNode);\n\n  if (!childStateNodes) {\n    return {}; // todo: fix?\n  }\n\n  if (baseNode.type === 'compound') {\n    var childStateNode = childStateNodes[0];\n\n    if (childStateNode) {\n      if (isLeafNode(childStateNode)) {\n        return childStateNode.key;\n      }\n    } else {\n      return {};\n    }\n  }\n\n  var stateValue = {};\n  childStateNodes.forEach(function (csn) {\n    stateValue[csn.key] = getValueFromAdj(csn, adjList);\n  });\n  return stateValue;\n}\n\nfunction getAdjList(configuration) {\n  var e_5, _a;\n\n  var adjList = new Map();\n\n  try {\n    for (var configuration_4 = __values(configuration), configuration_4_1 = configuration_4.next(); !configuration_4_1.done; configuration_4_1 = configuration_4.next()) {\n      var s = configuration_4_1.value;\n\n      if (!adjList.has(s)) {\n        adjList.set(s, []);\n      }\n\n      if (s.parent) {\n        if (!adjList.has(s.parent)) {\n          adjList.set(s.parent, []);\n        }\n\n        adjList.get(s.parent).push(s);\n      }\n    }\n  } catch (e_5_1) {\n    e_5 = {\n      error: e_5_1\n    };\n  } finally {\n    try {\n      if (configuration_4_1 && !configuration_4_1.done && (_a = configuration_4.return)) _a.call(configuration_4);\n    } finally {\n      if (e_5) throw e_5.error;\n    }\n  }\n\n  return adjList;\n}\n\nfunction getValue(rootNode, configuration) {\n  var config = getConfiguration([rootNode], configuration);\n  return getValueFromAdj(rootNode, getAdjList(config));\n}\n\nfunction has(iterable, item) {\n  if (Array.isArray(iterable)) {\n    return iterable.some(function (member) {\n      return member === item;\n    });\n  }\n\n  if (iterable instanceof Set) {\n    return iterable.has(item);\n  }\n\n  return false; // TODO: fix\n}\n\nfunction nextEvents(configuration) {\n  return flatten(__spread(new Set(configuration.map(function (sn) {\n    return sn.ownEvents;\n  }))));\n}\n\nfunction isInFinalState(configuration, stateNode) {\n  if (stateNode.type === 'compound') {\n    return getChildren(stateNode).some(function (s) {\n      return s.type === 'final' && has(configuration, s);\n    });\n  }\n\n  if (stateNode.type === 'parallel') {\n    return getChildren(stateNode).every(function (sn) {\n      return isInFinalState(configuration, sn);\n    });\n  }\n\n  return false;\n}\n\nexport { getAdjList, getAllStateNodes, getChildren, getConfiguration, getValue, has, isInFinalState, isLeafNode, nextEvents };","import { __assign, __read, __rest } from './_virtual/_tslib.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { toSCXMLEvent, isFunction, toEventObject, getEventType, isString, partition, updateContext, flatten, toArray, toGuard, evaluateGuard, warn, isArray } from './utils.js';\nimport { SpecialTargets, ActionTypes } from './types.js';\nimport { send as send$1, update, assign as assign$1, init, raise as raise$1, log as log$1, cancel as cancel$1, error as error$1, pure as pure$1, choose as choose$1 } from './actionTypes.js';\nvar initEvent = /*#__PURE__*/toSCXMLEvent({\n  type: init\n});\n\nfunction getActionFunction(actionType, actionFunctionMap) {\n  return actionFunctionMap ? actionFunctionMap[actionType] || undefined : undefined;\n}\n\nfunction toActionObject(action, actionFunctionMap) {\n  var actionObject;\n\n  if (isString(action) || typeof action === 'number') {\n    var exec = getActionFunction(action, actionFunctionMap);\n\n    if (isFunction(exec)) {\n      actionObject = {\n        type: action,\n        exec: exec\n      };\n    } else if (exec) {\n      actionObject = exec;\n    } else {\n      actionObject = {\n        type: action,\n        exec: undefined\n      };\n    }\n  } else if (isFunction(action)) {\n    actionObject = {\n      // Convert action to string if unnamed\n      type: action.name || action.toString(),\n      exec: action\n    };\n  } else {\n    var exec = getActionFunction(action.type, actionFunctionMap);\n\n    if (isFunction(exec)) {\n      actionObject = __assign(__assign({}, action), {\n        exec: exec\n      });\n    } else if (exec) {\n      var type = action.type,\n          other = __rest(action, [\"type\"]);\n\n      actionObject = __assign(__assign({\n        type: type\n      }, exec), other);\n    } else {\n      actionObject = action;\n    }\n  }\n\n  Object.defineProperty(actionObject, 'toString', {\n    value: function () {\n      return actionObject.type;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return actionObject;\n}\n\nvar toActionObjects = function (action, actionFunctionMap) {\n  if (!action) {\n    return [];\n  }\n\n  var actions = isArray(action) ? action : [action];\n  return actions.map(function (subAction) {\n    return toActionObject(subAction, actionFunctionMap);\n  });\n};\n\nfunction toActivityDefinition(action) {\n  var actionObject = toActionObject(action);\n  return __assign(__assign({\n    id: isString(action) ? action : actionObject.id\n  }, actionObject), {\n    type: actionObject.type\n  });\n}\n/**\r\n * Raises an event. This places the event in the internal event queue, so that\r\n * the event is immediately consumed by the machine in the current step.\r\n *\r\n * @param eventType The event to raise.\r\n */\n\n\nfunction raise(event) {\n  if (!isString(event)) {\n    return send(event, {\n      to: SpecialTargets.Internal\n    });\n  }\n\n  return {\n    type: raise$1,\n    event: event\n  };\n}\n\nfunction resolveRaise(action) {\n  return {\n    type: raise$1,\n    _event: toSCXMLEvent(action.event)\n  };\n}\n/**\r\n * Sends an event. This returns an action that will be read by an interpreter to\r\n * send the event in the next step, after the current step is finished executing.\r\n *\r\n * @param event The event to send.\r\n * @param options Options to pass into the send event:\r\n *  - `id` - The unique send event identifier (used with `cancel()`).\r\n *  - `delay` - The number of milliseconds to delay the sending of the event.\r\n *  - `to` - The target of this event (by default, the machine the event was sent from).\r\n */\n\n\nfunction send(event, options) {\n  return {\n    to: options ? options.to : undefined,\n    type: send$1,\n    event: isFunction(event) ? event : toEventObject(event),\n    delay: options ? options.delay : undefined,\n    id: options && options.id !== undefined ? options.id : isFunction(event) ? event.name : getEventType(event)\n  };\n}\n\nfunction resolveSend(action, ctx, _event, delaysMap) {\n  var meta = {\n    _event: _event\n  }; // TODO: helper function for resolving Expr\n\n  var resolvedEvent = toSCXMLEvent(isFunction(action.event) ? action.event(ctx, _event.data, meta) : action.event);\n  var resolvedDelay;\n\n  if (isString(action.delay)) {\n    var configDelay = delaysMap && delaysMap[action.delay];\n    resolvedDelay = isFunction(configDelay) ? configDelay(ctx, _event.data, meta) : configDelay;\n  } else {\n    resolvedDelay = isFunction(action.delay) ? action.delay(ctx, _event.data, meta) : action.delay;\n  }\n\n  var resolvedTarget = isFunction(action.to) ? action.to(ctx, _event.data, meta) : action.to;\n  return __assign(__assign({}, action), {\n    to: resolvedTarget,\n    _event: resolvedEvent,\n    event: resolvedEvent.data,\n    delay: resolvedDelay\n  });\n}\n/**\r\n * Sends an event to this machine's parent.\r\n *\r\n * @param event The event to send to the parent machine.\r\n * @param options Options to pass into the send event.\r\n */\n\n\nfunction sendParent(event, options) {\n  return send(event, __assign(__assign({}, options), {\n    to: SpecialTargets.Parent\n  }));\n}\n/**\r\n * Sends an update event to this machine's parent.\r\n */\n\n\nfunction sendUpdate() {\n  return sendParent(update);\n}\n/**\r\n * Sends an event back to the sender of the original event.\r\n *\r\n * @param event The event to send back to the sender\r\n * @param options Options to pass into the send event\r\n */\n\n\nfunction respond(event, options) {\n  return send(event, __assign(__assign({}, options), {\n    to: function (_, __, _a) {\n      var _event = _a._event;\n      return _event.origin; // TODO: handle when _event.origin is undefined\n    }\n  }));\n}\n\nvar defaultLogExpr = function (context, event) {\n  return {\n    context: context,\n    event: event\n  };\n};\n/**\r\n *\r\n * @param expr The expression function to evaluate which will be logged.\r\n *  Takes in 2 arguments:\r\n *  - `ctx` - the current state context\r\n *  - `event` - the event that caused this action to be executed.\r\n * @param label The label to give to the logged expression.\r\n */\n\n\nfunction log(expr, label) {\n  if (expr === void 0) {\n    expr = defaultLogExpr;\n  }\n\n  return {\n    type: log$1,\n    label: label,\n    expr: expr\n  };\n}\n\nvar resolveLog = function (action, ctx, _event) {\n  return __assign(__assign({}, action), {\n    value: isString(action.expr) ? action.expr : action.expr(ctx, _event.data, {\n      _event: _event\n    })\n  });\n};\n/**\r\n * Cancels an in-flight `send(...)` action. A canceled sent action will not\r\n * be executed, nor will its event be sent, unless it has already been sent\r\n * (e.g., if `cancel(...)` is called after the `send(...)` action's `delay`).\r\n *\r\n * @param sendId The `id` of the `send(...)` action to cancel.\r\n */\n\n\nvar cancel = function (sendId) {\n  return {\n    type: cancel$1,\n    sendId: sendId\n  };\n};\n/**\r\n * Starts an activity.\r\n *\r\n * @param activity The activity to start.\r\n */\n\n\nfunction start(activity) {\n  var activityDef = toActivityDefinition(activity);\n  return {\n    type: ActionTypes.Start,\n    activity: activityDef,\n    exec: undefined\n  };\n}\n/**\r\n * Stops an activity.\r\n *\r\n * @param activity The activity to stop.\r\n */\n\n\nfunction stop(activity) {\n  var activityDef = toActivityDefinition(activity);\n  return {\n    type: ActionTypes.Stop,\n    activity: activityDef,\n    exec: undefined\n  };\n}\n/**\r\n * Updates the current context of the machine.\r\n *\r\n * @param assignment An object that represents the partial context to update.\r\n */\n\n\nvar assign = function (assignment) {\n  return {\n    type: assign$1,\n    assignment: assignment\n  };\n};\n/**\r\n * Returns an event type that represents an implicit event that\r\n * is sent after the specified `delay`.\r\n *\r\n * @param delayRef The delay in milliseconds\r\n * @param id The state node ID where this event is handled\r\n */\n\n\nfunction after(delayRef, id) {\n  var idSuffix = id ? \"#\" + id : '';\n  return ActionTypes.After + \"(\" + delayRef + \")\" + idSuffix;\n}\n/**\r\n * Returns an event that represents that a final state node\r\n * has been reached in the parent state node.\r\n *\r\n * @param id The final state node's parent state node `id`\r\n * @param data The data to pass into the event\r\n */\n\n\nfunction done(id, data) {\n  var type = ActionTypes.DoneState + \".\" + id;\n  var eventObject = {\n    type: type,\n    data: data\n  };\n\n  eventObject.toString = function () {\n    return type;\n  };\n\n  return eventObject;\n}\n/**\r\n * Returns an event that represents that an invoked service has terminated.\r\n *\r\n * An invoked service is terminated when it has reached a top-level final state node,\r\n * but not when it is canceled.\r\n *\r\n * @param id The final state node ID\r\n * @param data The data to pass into the event\r\n */\n\n\nfunction doneInvoke(id, data) {\n  var type = ActionTypes.DoneInvoke + \".\" + id;\n  var eventObject = {\n    type: type,\n    data: data\n  };\n\n  eventObject.toString = function () {\n    return type;\n  };\n\n  return eventObject;\n}\n\nfunction error(id, data) {\n  var type = ActionTypes.ErrorPlatform + \".\" + id;\n  var eventObject = {\n    type: type,\n    data: data\n  };\n\n  eventObject.toString = function () {\n    return type;\n  };\n\n  return eventObject;\n}\n\nfunction pure(getActions) {\n  return {\n    type: ActionTypes.Pure,\n    get: getActions\n  };\n}\n/**\r\n * Forwards (sends) an event to a specified service.\r\n *\r\n * @param target The target service to forward the event to.\r\n * @param options Options to pass into the send action creator.\r\n */\n\n\nfunction forwardTo(target, options) {\n  return send(function (_, event) {\n    return event;\n  }, __assign(__assign({}, options), {\n    to: target\n  }));\n}\n/**\r\n * Escalates an error by sending it as an event to this machine's parent.\r\n *\r\n * @param errorData The error data to send, or the expression function that\r\n * takes in the `context`, `event`, and `meta`, and returns the error data to send.\r\n * @param options Options to pass into the send action creator.\r\n */\n\n\nfunction escalate(errorData, options) {\n  return sendParent(function (context, event, meta) {\n    return {\n      type: error$1,\n      data: isFunction(errorData) ? errorData(context, event, meta) : errorData\n    };\n  }, __assign(__assign({}, options), {\n    to: SpecialTargets.Parent\n  }));\n}\n\nfunction choose(conds) {\n  return {\n    type: ActionTypes.Choose,\n    conds: conds\n  };\n}\n\nfunction resolveActions(machine, currentState, currentContext, _event, actions) {\n  var _a = __read(partition(actions, function (action) {\n    return action.type === assign$1;\n  }), 2),\n      assignActions = _a[0],\n      otherActions = _a[1];\n\n  var updatedContext = assignActions.length ? updateContext(currentContext, _event, assignActions, currentState) : currentContext;\n  var resolvedActions = flatten(otherActions.map(function (actionObject) {\n    var _a;\n\n    switch (actionObject.type) {\n      case raise$1:\n        return resolveRaise(actionObject);\n\n      case send$1:\n        var sendAction = resolveSend(actionObject, updatedContext, _event, machine.options.delays); // TODO: fix ActionTypes.Init\n\n        if (!IS_PRODUCTION) {\n          // warn after resolving as we can create better contextual message here\n          warn(!isString(actionObject.delay) || typeof sendAction.delay === 'number', // tslint:disable-next-line:max-line-length\n          \"No delay reference for delay expression '\" + actionObject.delay + \"' was found on machine '\" + machine.id + \"'\");\n        }\n\n        return sendAction;\n\n      case log$1:\n        return resolveLog(actionObject, updatedContext, _event);\n\n      case choose$1:\n        {\n          var chooseAction = actionObject;\n          var matchedActions = (_a = chooseAction.conds.find(function (condition) {\n            var guard = toGuard(condition.cond, machine.options.guards);\n            return !guard || evaluateGuard(machine, guard, updatedContext, _event, currentState);\n          })) === null || _a === void 0 ? void 0 : _a.actions;\n\n          if (!matchedActions) {\n            return [];\n          }\n\n          var resolved = resolveActions(machine, currentState, updatedContext, _event, toActionObjects(toArray(matchedActions), machine.options.actions));\n          updatedContext = resolved[1];\n          return resolved[0];\n        }\n\n      case pure$1:\n        {\n          var matchedActions = actionObject.get(updatedContext, _event.data);\n\n          if (!matchedActions) {\n            return [];\n          }\n\n          var resolved = resolveActions(machine, currentState, updatedContext, _event, toActionObjects(toArray(matchedActions), machine.options.actions));\n          updatedContext = resolved[1];\n          return resolved[0];\n        }\n\n      default:\n        return toActionObject(actionObject, machine.options.actions);\n    }\n  }));\n  return [resolvedActions, updatedContext];\n}\n\nexport { after, assign, cancel, choose, done, doneInvoke, error, escalate, forwardTo, getActionFunction, initEvent, log, pure, raise, resolveActions, resolveLog, resolveRaise, resolveSend, respond, send, sendParent, sendUpdate, start, stop, toActionObject, toActionObjects, toActivityDefinition };","import { ActionTypes } from './types.js'; // xstate-specific action types\n\nvar start = ActionTypes.Start;\nvar stop = ActionTypes.Stop;\nvar raise = ActionTypes.Raise;\nvar send = ActionTypes.Send;\nvar cancel = ActionTypes.Cancel;\nvar nullEvent = ActionTypes.NullEvent;\nvar assign = ActionTypes.Assign;\nvar after = ActionTypes.After;\nvar doneState = ActionTypes.DoneState;\nvar log = ActionTypes.Log;\nvar init = ActionTypes.Init;\nvar invoke = ActionTypes.Invoke;\nvar errorExecution = ActionTypes.ErrorExecution;\nvar errorPlatform = ActionTypes.ErrorPlatform;\nvar error = ActionTypes.ErrorCustom;\nvar update = ActionTypes.Update;\nvar choose = ActionTypes.Choose;\nvar pure = ActionTypes.Pure;\nexport { after, assign, cancel, choose, doneState, error, errorExecution, errorPlatform, init, invoke, log, nullEvent, pure, raise, send, start, stop, update };","import { __spread, __rest, __assign } from './_virtual/_tslib.js';\nimport { EMPTY_ACTIVITY_MAP } from './constants.js';\nimport { isString, matchesState, keys } from './utils.js';\nimport { nextEvents } from './stateUtils.js';\nimport { initEvent } from './actions.js';\n\nfunction stateValuesEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a === undefined || b === undefined) {\n    return false;\n  }\n\n  if (isString(a) || isString(b)) {\n    return a === b;\n  }\n\n  var aKeys = keys(a);\n  var bKeys = keys(b);\n  return aKeys.length === bKeys.length && aKeys.every(function (key) {\n    return stateValuesEqual(a[key], b[key]);\n  });\n}\n\nfunction isState(state) {\n  if (isString(state)) {\n    return false;\n  }\n\n  return 'value' in state && 'history' in state;\n}\n\nfunction bindActionToState(action, state) {\n  var exec = action.exec;\n\n  var boundAction = __assign(__assign({}, action), {\n    exec: exec !== undefined ? function () {\n      return exec(state.context, state.event, {\n        action: action,\n        state: state,\n        _event: state._event\n      });\n    } : undefined\n  });\n\n  return boundAction;\n}\n\nvar State =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  /**\r\n   * Creates a new State instance.\r\n   * @param value The state value\r\n   * @param context The extended state\r\n   * @param historyValue The tree representing historical values of the state nodes\r\n   * @param history The previous state\r\n   * @param actions An array of action objects to execute as side-effects\r\n   * @param activities A mapping of activities and whether they are started (`true`) or stopped (`false`).\r\n   * @param meta\r\n   * @param events Internal event queue. Should be empty with run-to-completion semantics.\r\n   * @param configuration\r\n   */\n  function State(config) {\n    var _this = this;\n\n    this.actions = [];\n    this.activities = EMPTY_ACTIVITY_MAP;\n    this.meta = {};\n    this.events = [];\n    this.value = config.value;\n    this.context = config.context;\n    this._event = config._event;\n    this._sessionid = config._sessionid;\n    this.event = this._event.data;\n    this.historyValue = config.historyValue;\n    this.history = config.history;\n    this.actions = config.actions || [];\n    this.activities = config.activities || EMPTY_ACTIVITY_MAP;\n    this.meta = config.meta || {};\n    this.events = config.events || [];\n    this.matches = this.matches.bind(this);\n    this.toStrings = this.toStrings.bind(this);\n    this.configuration = config.configuration;\n    this.transitions = config.transitions;\n    this.children = config.children;\n    this.done = !!config.done;\n    Object.defineProperty(this, 'nextEvents', {\n      get: function () {\n        return nextEvents(_this.configuration);\n      }\n    });\n  }\n  /**\r\n   * Creates a new State instance for the given `stateValue` and `context`.\r\n   * @param stateValue\r\n   * @param context\r\n   */\n\n\n  State.from = function (stateValue, context) {\n    if (stateValue instanceof State) {\n      if (stateValue.context !== context) {\n        return new State({\n          value: stateValue.value,\n          context: context,\n          _event: stateValue._event,\n          _sessionid: null,\n          historyValue: stateValue.historyValue,\n          history: stateValue.history,\n          actions: [],\n          activities: stateValue.activities,\n          meta: {},\n          events: [],\n          configuration: [],\n          transitions: [],\n          children: {}\n        });\n      }\n\n      return stateValue;\n    }\n\n    var _event = initEvent;\n    return new State({\n      value: stateValue,\n      context: context,\n      _event: _event,\n      _sessionid: null,\n      historyValue: undefined,\n      history: undefined,\n      actions: [],\n      activities: undefined,\n      meta: undefined,\n      events: [],\n      configuration: [],\n      transitions: [],\n      children: {}\n    });\n  };\n  /**\r\n   * Creates a new State instance for the given `config`.\r\n   * @param config The state config\r\n   */\n\n\n  State.create = function (config) {\n    return new State(config);\n  };\n  /**\r\n   * Creates a new `State` instance for the given `stateValue` and `context` with no actions (side-effects).\r\n   * @param stateValue\r\n   * @param context\r\n   */\n\n\n  State.inert = function (stateValue, context) {\n    if (stateValue instanceof State) {\n      if (!stateValue.actions.length) {\n        return stateValue;\n      }\n\n      var _event = initEvent;\n      return new State({\n        value: stateValue.value,\n        context: context,\n        _event: _event,\n        _sessionid: null,\n        historyValue: stateValue.historyValue,\n        history: stateValue.history,\n        activities: stateValue.activities,\n        configuration: stateValue.configuration,\n        transitions: [],\n        children: {}\n      });\n    }\n\n    return State.from(stateValue, context);\n  };\n  /**\r\n   * Returns an array of all the string leaf state node paths.\r\n   * @param stateValue\r\n   * @param delimiter The character(s) that separate each subpath in the string state node path.\r\n   */\n\n\n  State.prototype.toStrings = function (stateValue, delimiter) {\n    var _this = this;\n\n    if (stateValue === void 0) {\n      stateValue = this.value;\n    }\n\n    if (delimiter === void 0) {\n      delimiter = '.';\n    }\n\n    if (isString(stateValue)) {\n      return [stateValue];\n    }\n\n    var valueKeys = keys(stateValue);\n    return valueKeys.concat.apply(valueKeys, __spread(valueKeys.map(function (key) {\n      return _this.toStrings(stateValue[key], delimiter).map(function (s) {\n        return key + delimiter + s;\n      });\n    })));\n  };\n\n  State.prototype.toJSON = function () {\n    var _a = this,\n        configuration = _a.configuration,\n        transitions = _a.transitions,\n        jsonValues = __rest(_a, [\"configuration\", \"transitions\"]);\n\n    return jsonValues;\n  };\n  /**\r\n   * Whether the current state value is a subset of the given parent state value.\r\n   * @param parentStateValue\r\n   */\n\n\n  State.prototype.matches = function (parentStateValue) {\n    return matchesState(parentStateValue, this.value);\n  };\n\n  return State;\n}();\n\nexport { State, bindActionToState, isState, stateValuesEqual };","import { isMachine } from './utils.js';\n\nfunction createNullActor(id) {\n  return {\n    id: id,\n    send: function () {\n      return void 0;\n    },\n    subscribe: function () {\n      return {\n        unsubscribe: function () {\n          return void 0;\n        }\n      };\n    },\n    toJSON: function () {\n      return {\n        id: id\n      };\n    }\n  };\n}\n/**\r\n * Creates a deferred actor that is able to be invoked given the provided\r\n * invocation information in its `.meta` value.\r\n *\r\n * @param invokeDefinition The meta information needed to invoke the actor.\r\n */\n\n\nfunction createInvocableActor(invokeDefinition, machine) {\n  var _a;\n\n  var tempActor = createNullActor(invokeDefinition.id);\n  var serviceCreator = (_a = machine.options.services) === null || _a === void 0 ? void 0 : _a[invokeDefinition.src];\n  tempActor.deferred = true;\n\n  if (isMachine(serviceCreator)) {\n    tempActor.state = serviceCreator.initialState;\n  }\n\n  tempActor.meta = invokeDefinition;\n  return tempActor;\n}\n\nfunction isActor(item) {\n  try {\n    return typeof item.send === 'function';\n  } catch (e) {\n    return false;\n  }\n}\n\nexport { createInvocableActor, createNullActor, isActor };","import { __assign } from './_virtual/_tslib.js';\nvar defaultOptions = {\n  deferEvents: false\n};\n\nvar Scheduler =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  function Scheduler(options) {\n    this.processingEvent = false;\n    this.queue = [];\n    this.initialized = false;\n    this.options = __assign(__assign({}, defaultOptions), options);\n  }\n\n  Scheduler.prototype.initialize = function (callback) {\n    this.initialized = true;\n\n    if (callback) {\n      if (!this.options.deferEvents) {\n        this.schedule(callback);\n        return;\n      }\n\n      this.process(callback);\n    }\n\n    this.flushEvents();\n  };\n\n  Scheduler.prototype.schedule = function (task) {\n    if (!this.initialized || this.processingEvent) {\n      this.queue.push(task);\n      return;\n    }\n\n    if (this.queue.length !== 0) {\n      throw new Error('Event queue should be empty when it is not processing events');\n    }\n\n    this.process(task);\n    this.flushEvents();\n  };\n\n  Scheduler.prototype.clear = function () {\n    this.queue = [];\n  };\n\n  Scheduler.prototype.flushEvents = function () {\n    var nextCallback = this.queue.shift();\n\n    while (nextCallback) {\n      this.process(nextCallback);\n      nextCallback = this.queue.shift();\n    }\n  };\n\n  Scheduler.prototype.process = function (callback) {\n    this.processingEvent = true;\n\n    try {\n      callback();\n    } catch (e) {\n      // there is no use to keep the future events\n      // as the situation is not anymore the same\n      this.clear();\n      throw e;\n    } finally {\n      this.processingEvent = false;\n    }\n  };\n\n  return Scheduler;\n}();\n\nexport { Scheduler };","var children = /*#__PURE__*/new Map();\nvar sessionIdIndex = 0;\nvar registry = {\n  bookId: function () {\n    return \"x:\" + sessionIdIndex++;\n  },\n  register: function (id, actor) {\n    children.set(id, actor);\n    return id;\n  },\n  get: function (id) {\n    return children.get(id);\n  },\n  free: function (id) {\n    children.delete(id);\n  }\n};\nexport { registry };","import { IS_PRODUCTION } from './environment.js';\n\nfunction getDevTools() {\n  var w = window;\n\n  if (!!w.__xstate__) {\n    return w.__xstate__;\n  }\n\n  return undefined;\n}\n\nfunction registerService(service) {\n  if (IS_PRODUCTION || typeof window === 'undefined') {\n    return;\n  }\n\n  var devTools = getDevTools();\n\n  if (devTools) {\n    devTools.register(service);\n  }\n}\n\nexport { registerService };","import { __values, __assign, __spread } from './_virtual/_tslib.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { warn, mapContext, isFunction, keys, toSCXMLEvent, isPromiseLike, isObservable, isMachine, reportUnhandledExceptionOnInvocation, symbolObservable, isArray, toEventObject, isString, uniqueId } from './utils.js';\nimport { ActionTypes, SpecialTargets } from './types.js';\nimport { isInFinalState } from './stateUtils.js';\nimport { errorPlatform, log, stop, start, cancel, send, update, error as error$1 } from './actionTypes.js';\nimport { doneInvoke, initEvent, getActionFunction, error } from './actions.js';\nimport { isState, State, bindActionToState } from './State.js';\nimport { isActor } from './Actor.js';\nimport { Scheduler } from './scheduler.js';\nimport { registry } from './registry.js';\nimport { registerService } from './devTools.js';\nvar DEFAULT_SPAWN_OPTIONS = {\n  sync: false,\n  autoForward: false\n};\n/**\r\n * Maintains a stack of the current service in scope.\r\n * This is used to provide the correct service to spawn().\r\n *\r\n * @private\r\n */\n\nvar withServiceScope = /*#__PURE__*/function () {\n  var serviceStack = [];\n  return function (service, fn) {\n    service && serviceStack.push(service);\n    var result = fn(service || serviceStack[serviceStack.length - 1]);\n    service && serviceStack.pop();\n    return result;\n  };\n}();\n\nvar InterpreterStatus;\n\n(function (InterpreterStatus) {\n  InterpreterStatus[InterpreterStatus[\"NotStarted\"] = 0] = \"NotStarted\";\n  InterpreterStatus[InterpreterStatus[\"Running\"] = 1] = \"Running\";\n  InterpreterStatus[InterpreterStatus[\"Stopped\"] = 2] = \"Stopped\";\n})(InterpreterStatus || (InterpreterStatus = {}));\n\nvar Interpreter =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  /**\r\n   * Creates a new Interpreter instance (i.e., service) for the given machine with the provided options, if any.\r\n   *\r\n   * @param machine The machine to be interpreted\r\n   * @param options Interpreter options\r\n   */\n  function Interpreter(machine, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = Interpreter.defaultOptions;\n    }\n\n    this.machine = machine;\n    this.scheduler = new Scheduler();\n    this.delayedEventsMap = {};\n    this.listeners = new Set();\n    this.contextListeners = new Set();\n    this.stopListeners = new Set();\n    this.doneListeners = new Set();\n    this.eventListeners = new Set();\n    this.sendListeners = new Set();\n    /**\r\n     * Whether the service is started.\r\n     */\n\n    this.initialized = false;\n    this._status = InterpreterStatus.NotStarted;\n    this.children = new Map();\n    this.forwardTo = new Set();\n    /**\r\n     * Alias for Interpreter.prototype.start\r\n     */\n\n    this.init = this.start;\n    /**\r\n     * Sends an event to the running interpreter to trigger a transition.\r\n     *\r\n     * An array of events (batched) can be sent as well, which will send all\r\n     * batched events to the running interpreter. The listeners will be\r\n     * notified only **once** when all events are processed.\r\n     *\r\n     * @param event The event(s) to send\r\n     */\n\n    this.send = function (event, payload) {\n      if (isArray(event)) {\n        _this.batch(event);\n\n        return _this.state;\n      }\n\n      var _event = toSCXMLEvent(toEventObject(event, payload));\n\n      if (_this._status === InterpreterStatus.Stopped) {\n        // do nothing\n        if (!IS_PRODUCTION) {\n          warn(false, \"Event \\\"\" + _event.name + \"\\\" was sent to stopped service \\\"\" + _this.machine.id + \"\\\". This service has already reached its final state, and will not transition.\\nEvent: \" + JSON.stringify(_event.data));\n        }\n\n        return _this.state;\n      }\n\n      if (_this._status === InterpreterStatus.NotStarted && _this.options.deferEvents) {\n        // tslint:disable-next-line:no-console\n        if (!IS_PRODUCTION) {\n          warn(false, \"Event \\\"\" + _event.name + \"\\\" was sent to uninitialized service \\\"\" + _this.machine.id + \"\\\" and is deferred. Make sure .start() is called for this service.\\nEvent: \" + JSON.stringify(_event.data));\n        }\n      } else if (_this._status !== InterpreterStatus.Running) {\n        throw new Error(\"Event \\\"\" + _event.name + \"\\\" was sent to uninitialized service \\\"\" + _this.machine.id + \"\\\". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\\nEvent: \" + JSON.stringify(_event.data));\n      }\n\n      _this.scheduler.schedule(function () {\n        // Forward copy of event to child actors\n        _this.forward(_event);\n\n        var nextState = _this.nextState(_event);\n\n        _this.update(nextState, _event);\n      });\n\n      return _this._state; // TODO: deprecate (should return void)\n      // tslint:disable-next-line:semicolon\n    };\n\n    this.sendTo = function (event, to) {\n      var isParent = _this.parent && (to === SpecialTargets.Parent || _this.parent.id === to);\n      var target = isParent ? _this.parent : isActor(to) ? to : _this.children.get(to) || registry.get(to);\n\n      if (!target) {\n        if (!isParent) {\n          throw new Error(\"Unable to send event to child '\" + to + \"' from service '\" + _this.id + \"'.\");\n        } // tslint:disable-next-line:no-console\n\n\n        if (!IS_PRODUCTION) {\n          warn(false, \"Service '\" + _this.id + \"' has no parent: unable to send event \" + event.type);\n        }\n\n        return;\n      }\n\n      if ('machine' in target) {\n        // Send SCXML events to machines\n        target.send(__assign(__assign({}, event), {\n          name: event.name === error$1 ? \"\" + error(_this.id) : event.name,\n          origin: _this.sessionId\n        }));\n      } else {\n        // Send normal events to other targets\n        target.send(event.data);\n      }\n    };\n\n    var resolvedOptions = __assign(__assign({}, Interpreter.defaultOptions), options);\n\n    var clock = resolvedOptions.clock,\n        logger = resolvedOptions.logger,\n        parent = resolvedOptions.parent,\n        id = resolvedOptions.id;\n    var resolvedId = id !== undefined ? id : machine.id;\n    this.id = resolvedId;\n    this.logger = logger;\n    this.clock = clock;\n    this.parent = parent;\n    this.options = resolvedOptions;\n    this.scheduler = new Scheduler({\n      deferEvents: this.options.deferEvents\n    });\n    this.sessionId = registry.bookId();\n  }\n\n  Object.defineProperty(Interpreter.prototype, \"initialState\", {\n    get: function () {\n      var _this = this;\n\n      if (this._initialState) {\n        return this._initialState;\n      }\n\n      return withServiceScope(this, function () {\n        _this._initialState = _this.machine.initialState;\n        return _this._initialState;\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Interpreter.prototype, \"state\", {\n    get: function () {\n      if (!IS_PRODUCTION) {\n        warn(this._status !== InterpreterStatus.NotStarted, \"Attempted to read state from uninitialized service '\" + this.id + \"'. Make sure the service is started first.\");\n      }\n\n      return this._state;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Executes the actions of the given state, with that state's `context` and `event`.\r\n   *\r\n   * @param state The state whose actions will be executed\r\n   * @param actionsConfig The action implementations to use\r\n   */\n\n  Interpreter.prototype.execute = function (state, actionsConfig) {\n    var e_1, _a;\n\n    try {\n      for (var _b = __values(state.actions), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var action = _c.value;\n        this.exec(action, state, actionsConfig);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n\n  Interpreter.prototype.update = function (state, _event) {\n    var e_2, _a, e_3, _b, e_4, _c, e_5, _d;\n\n    var _this = this; // Attach session ID to state\n\n\n    state._sessionid = this.sessionId; // Update state\n\n    this._state = state; // Execute actions\n\n    if (this.options.execute) {\n      this.execute(this.state);\n    } // Dev tools\n\n\n    if (this.devTools) {\n      this.devTools.send(_event.data, state);\n    } // Execute listeners\n\n\n    if (state.event) {\n      try {\n        for (var _e = __values(this.eventListeners), _f = _e.next(); !_f.done; _f = _e.next()) {\n          var listener = _f.value;\n          listener(state.event);\n        }\n      } catch (e_2_1) {\n        e_2 = {\n          error: e_2_1\n        };\n      } finally {\n        try {\n          if (_f && !_f.done && (_a = _e.return)) _a.call(_e);\n        } finally {\n          if (e_2) throw e_2.error;\n        }\n      }\n    }\n\n    try {\n      for (var _g = __values(this.listeners), _h = _g.next(); !_h.done; _h = _g.next()) {\n        var listener = _h.value;\n        listener(state, state.event);\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (_h && !_h.done && (_b = _g.return)) _b.call(_g);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    try {\n      for (var _j = __values(this.contextListeners), _k = _j.next(); !_k.done; _k = _j.next()) {\n        var contextListener = _k.value;\n        contextListener(this.state.context, this.state.history ? this.state.history.context : undefined);\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (_k && !_k.done && (_c = _j.return)) _c.call(_j);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n\n    var isDone = isInFinalState(state.configuration || [], this.machine);\n\n    if (this.state.configuration && isDone) {\n      // get final child state node\n      var finalChildStateNode = state.configuration.find(function (sn) {\n        return sn.type === 'final' && sn.parent === _this.machine;\n      });\n      var doneData = finalChildStateNode && finalChildStateNode.doneData ? mapContext(finalChildStateNode.doneData, state.context, _event) : undefined;\n\n      try {\n        for (var _l = __values(this.doneListeners), _m = _l.next(); !_m.done; _m = _l.next()) {\n          var listener = _m.value;\n          listener(doneInvoke(this.id, doneData));\n        }\n      } catch (e_5_1) {\n        e_5 = {\n          error: e_5_1\n        };\n      } finally {\n        try {\n          if (_m && !_m.done && (_d = _l.return)) _d.call(_l);\n        } finally {\n          if (e_5) throw e_5.error;\n        }\n      }\n\n      this.stop();\n    }\n  };\n  /*\r\n   * Adds a listener that is notified whenever a state transition happens. The listener is called with\r\n   * the next state and the event object that caused the state transition.\r\n   *\r\n   * @param listener The state listener\r\n   */\n\n\n  Interpreter.prototype.onTransition = function (listener) {\n    this.listeners.add(listener); // Send current state to listener\n\n    if (this._status === InterpreterStatus.Running) {\n      listener(this.state, this.state.event);\n    }\n\n    return this;\n  };\n\n  Interpreter.prototype.subscribe = function (nextListenerOrObserver, // @ts-ignore\n  errorListener, completeListener) {\n    var _this = this;\n\n    if (!nextListenerOrObserver) {\n      return {\n        unsubscribe: function () {\n          return void 0;\n        }\n      };\n    }\n\n    var listener;\n    var resolvedCompleteListener = completeListener;\n\n    if (typeof nextListenerOrObserver === 'function') {\n      listener = nextListenerOrObserver;\n    } else {\n      listener = nextListenerOrObserver.next.bind(nextListenerOrObserver);\n      resolvedCompleteListener = nextListenerOrObserver.complete.bind(nextListenerOrObserver);\n    }\n\n    this.listeners.add(listener); // Send current state to listener\n\n    if (this._status === InterpreterStatus.Running) {\n      listener(this.state);\n    }\n\n    if (resolvedCompleteListener) {\n      this.onDone(resolvedCompleteListener);\n    }\n\n    return {\n      unsubscribe: function () {\n        listener && _this.listeners.delete(listener);\n        resolvedCompleteListener && _this.doneListeners.delete(resolvedCompleteListener);\n      }\n    };\n  };\n  /**\r\n   * Adds an event listener that is notified whenever an event is sent to the running interpreter.\r\n   * @param listener The event listener\r\n   */\n\n\n  Interpreter.prototype.onEvent = function (listener) {\n    this.eventListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds an event listener that is notified whenever a `send` event occurs.\r\n   * @param listener The event listener\r\n   */\n\n\n  Interpreter.prototype.onSend = function (listener) {\n    this.sendListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a context listener that is notified whenever the state context changes.\r\n   * @param listener The context listener\r\n   */\n\n\n  Interpreter.prototype.onChange = function (listener) {\n    this.contextListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a listener that is notified when the machine is stopped.\r\n   * @param listener The listener\r\n   */\n\n\n  Interpreter.prototype.onStop = function (listener) {\n    this.stopListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a state listener that is notified when the statechart has reached its final state.\r\n   * @param listener The state listener\r\n   */\n\n\n  Interpreter.prototype.onDone = function (listener) {\n    this.doneListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Removes a listener.\r\n   * @param listener The listener to remove\r\n   */\n\n\n  Interpreter.prototype.off = function (listener) {\n    this.listeners.delete(listener);\n    this.eventListeners.delete(listener);\n    this.sendListeners.delete(listener);\n    this.stopListeners.delete(listener);\n    this.doneListeners.delete(listener);\n    this.contextListeners.delete(listener);\n    return this;\n  };\n  /**\r\n   * Starts the interpreter from the given state, or the initial state.\r\n   * @param initialState The state to start the statechart from\r\n   */\n\n\n  Interpreter.prototype.start = function (initialState) {\n    var _this = this;\n\n    if (this._status === InterpreterStatus.Running) {\n      // Do not restart the service if it is already started\n      return this;\n    }\n\n    registry.register(this.sessionId, this);\n    this.initialized = true;\n    this._status = InterpreterStatus.Running;\n    var resolvedState = initialState === undefined ? this.initialState : withServiceScope(this, function () {\n      return isState(initialState) ? _this.machine.resolveState(initialState) : _this.machine.resolveState(State.from(initialState, _this.machine.context));\n    });\n\n    if (this.options.devTools) {\n      this.attachDev();\n    }\n\n    this.scheduler.initialize(function () {\n      _this.update(resolvedState, initEvent);\n    });\n    return this;\n  };\n  /**\r\n   * Stops the interpreter and unsubscribe all listeners.\r\n   *\r\n   * This will also notify the `onStop` listeners.\r\n   */\n\n\n  Interpreter.prototype.stop = function () {\n    var e_6, _a, e_7, _b, e_8, _c, e_9, _d, e_10, _e;\n\n    try {\n      for (var _f = __values(this.listeners), _g = _f.next(); !_g.done; _g = _f.next()) {\n        var listener = _g.value;\n        this.listeners.delete(listener);\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (_g && !_g.done && (_a = _f.return)) _a.call(_f);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n\n    try {\n      for (var _h = __values(this.stopListeners), _j = _h.next(); !_j.done; _j = _h.next()) {\n        var listener = _j.value; // call listener, then remove\n\n        listener();\n        this.stopListeners.delete(listener);\n      }\n    } catch (e_7_1) {\n      e_7 = {\n        error: e_7_1\n      };\n    } finally {\n      try {\n        if (_j && !_j.done && (_b = _h.return)) _b.call(_h);\n      } finally {\n        if (e_7) throw e_7.error;\n      }\n    }\n\n    try {\n      for (var _k = __values(this.contextListeners), _l = _k.next(); !_l.done; _l = _k.next()) {\n        var listener = _l.value;\n        this.contextListeners.delete(listener);\n      }\n    } catch (e_8_1) {\n      e_8 = {\n        error: e_8_1\n      };\n    } finally {\n      try {\n        if (_l && !_l.done && (_c = _k.return)) _c.call(_k);\n      } finally {\n        if (e_8) throw e_8.error;\n      }\n    }\n\n    try {\n      for (var _m = __values(this.doneListeners), _o = _m.next(); !_o.done; _o = _m.next()) {\n        var listener = _o.value;\n        this.doneListeners.delete(listener);\n      }\n    } catch (e_9_1) {\n      e_9 = {\n        error: e_9_1\n      };\n    } finally {\n      try {\n        if (_o && !_o.done && (_d = _m.return)) _d.call(_m);\n      } finally {\n        if (e_9) throw e_9.error;\n      }\n    } // Stop all children\n\n\n    this.children.forEach(function (child) {\n      if (isFunction(child.stop)) {\n        child.stop();\n      }\n    });\n\n    try {\n      // Cancel all delayed events\n      for (var _p = __values(keys(this.delayedEventsMap)), _q = _p.next(); !_q.done; _q = _p.next()) {\n        var key = _q.value;\n        this.clock.clearTimeout(this.delayedEventsMap[key]);\n      }\n    } catch (e_10_1) {\n      e_10 = {\n        error: e_10_1\n      };\n    } finally {\n      try {\n        if (_q && !_q.done && (_e = _p.return)) _e.call(_p);\n      } finally {\n        if (e_10) throw e_10.error;\n      }\n    }\n\n    this.scheduler.clear();\n    this.initialized = false;\n    this._status = InterpreterStatus.Stopped;\n    registry.free(this.sessionId);\n    return this;\n  };\n\n  Interpreter.prototype.batch = function (events) {\n    var _this = this;\n\n    if (this._status === InterpreterStatus.NotStarted && this.options.deferEvents) {\n      // tslint:disable-next-line:no-console\n      if (!IS_PRODUCTION) {\n        warn(false, events.length + \" event(s) were sent to uninitialized service \\\"\" + this.machine.id + \"\\\" and are deferred. Make sure .start() is called for this service.\\nEvent: \" + JSON.stringify(event));\n      }\n    } else if (this._status !== InterpreterStatus.Running) {\n      throw new Error( // tslint:disable-next-line:max-line-length\n      events.length + \" event(s) were sent to uninitialized service \\\"\" + this.machine.id + \"\\\". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\");\n    }\n\n    this.scheduler.schedule(function () {\n      var e_11, _a;\n\n      var nextState = _this.state;\n      var batchChanged = false;\n      var batchedActions = [];\n\n      var _loop_1 = function (event_1) {\n        var _event = toSCXMLEvent(event_1);\n\n        _this.forward(_event);\n\n        nextState = withServiceScope(_this, function () {\n          return _this.machine.transition(nextState, _event);\n        });\n        batchedActions.push.apply(batchedActions, __spread(nextState.actions.map(function (a) {\n          return bindActionToState(a, nextState);\n        })));\n        batchChanged = batchChanged || !!nextState.changed;\n      };\n\n      try {\n        for (var events_1 = __values(events), events_1_1 = events_1.next(); !events_1_1.done; events_1_1 = events_1.next()) {\n          var event_1 = events_1_1.value;\n\n          _loop_1(event_1);\n        }\n      } catch (e_11_1) {\n        e_11 = {\n          error: e_11_1\n        };\n      } finally {\n        try {\n          if (events_1_1 && !events_1_1.done && (_a = events_1.return)) _a.call(events_1);\n        } finally {\n          if (e_11) throw e_11.error;\n        }\n      }\n\n      nextState.changed = batchChanged;\n      nextState.actions = batchedActions;\n\n      _this.update(nextState, toSCXMLEvent(events[events.length - 1]));\n    });\n  };\n  /**\r\n   * Returns a send function bound to this interpreter instance.\r\n   *\r\n   * @param event The event to be sent by the sender.\r\n   */\n\n\n  Interpreter.prototype.sender = function (event) {\n    return this.send.bind(this, event);\n  };\n  /**\r\n   * Returns the next state given the interpreter's current state and the event.\r\n   *\r\n   * This is a pure method that does _not_ update the interpreter's state.\r\n   *\r\n   * @param event The event to determine the next state\r\n   */\n\n\n  Interpreter.prototype.nextState = function (event) {\n    var _this = this;\n\n    var _event = toSCXMLEvent(event);\n\n    if (_event.name.indexOf(errorPlatform) === 0 && !this.state.nextEvents.some(function (nextEvent) {\n      return nextEvent.indexOf(errorPlatform) === 0;\n    })) {\n      throw _event.data.data;\n    }\n\n    var nextState = withServiceScope(this, function () {\n      return _this.machine.transition(_this.state, _event);\n    });\n    return nextState;\n  };\n\n  Interpreter.prototype.forward = function (event) {\n    var e_12, _a;\n\n    try {\n      for (var _b = __values(this.forwardTo), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var id = _c.value;\n        var child = this.children.get(id);\n\n        if (!child) {\n          throw new Error(\"Unable to forward event '\" + event + \"' from interpreter '\" + this.id + \"' to nonexistant child '\" + id + \"'.\");\n        }\n\n        child.send(event);\n      }\n    } catch (e_12_1) {\n      e_12 = {\n        error: e_12_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_12) throw e_12.error;\n      }\n    }\n  };\n\n  Interpreter.prototype.defer = function (sendAction) {\n    var _this = this;\n\n    this.delayedEventsMap[sendAction.id] = this.clock.setTimeout(function () {\n      if (sendAction.to) {\n        _this.sendTo(sendAction._event, sendAction.to);\n      } else {\n        _this.send(sendAction._event);\n      }\n    }, sendAction.delay);\n  };\n\n  Interpreter.prototype.cancel = function (sendId) {\n    this.clock.clearTimeout(this.delayedEventsMap[sendId]);\n    delete this.delayedEventsMap[sendId];\n  };\n\n  Interpreter.prototype.exec = function (action, state, actionFunctionMap) {\n    if (actionFunctionMap === void 0) {\n      actionFunctionMap = this.machine.options.actions;\n    }\n\n    var context = state.context,\n        _event = state._event;\n    var actionOrExec = action.exec || getActionFunction(action.type, actionFunctionMap);\n    var exec = isFunction(actionOrExec) ? actionOrExec : actionOrExec ? actionOrExec.exec : action.exec;\n\n    if (exec) {\n      try {\n        return exec(context, _event.data, {\n          action: action,\n          state: this.state,\n          _event: _event\n        });\n      } catch (err) {\n        if (this.parent) {\n          this.parent.send({\n            type: 'xstate.error',\n            data: err\n          });\n        }\n\n        throw err;\n      }\n    }\n\n    switch (action.type) {\n      case send:\n        var sendAction = action;\n\n        if (typeof sendAction.delay === 'number') {\n          this.defer(sendAction);\n          return;\n        } else {\n          if (sendAction.to) {\n            this.sendTo(sendAction._event, sendAction.to);\n          } else {\n            this.send(sendAction._event);\n          }\n        }\n\n        break;\n\n      case cancel:\n        this.cancel(action.sendId);\n        break;\n\n      case start:\n        {\n          var activity = action.activity; // If the activity will be stopped right after it's started\n          // (such as in transient states)\n          // don't bother starting the activity.\n\n          if (!this.state.activities[activity.id || activity.type]) {\n            break;\n          } // Invoked services\n\n\n          if (activity.type === ActionTypes.Invoke) {\n            var serviceCreator = this.machine.options.services ? this.machine.options.services[activity.src] : undefined;\n            var id = activity.id,\n                data = activity.data;\n\n            if (!IS_PRODUCTION) {\n              warn(!('forward' in activity), // tslint:disable-next-line:max-line-length\n              \"`forward` property is deprecated (found in invocation of '\" + activity.src + \"' in in machine '\" + this.machine.id + \"'). \" + \"Please use `autoForward` instead.\");\n            }\n\n            var autoForward = 'autoForward' in activity ? activity.autoForward : !!activity.forward;\n\n            if (!serviceCreator) {\n              // tslint:disable-next-line:no-console\n              if (!IS_PRODUCTION) {\n                warn(false, \"No service found for invocation '\" + activity.src + \"' in machine '\" + this.machine.id + \"'.\");\n              }\n\n              return;\n            }\n\n            var resolvedData = data ? mapContext(data, context, _event) : undefined;\n            var source = isFunction(serviceCreator) ? serviceCreator(context, _event.data, {\n              data: resolvedData\n            }) : serviceCreator;\n\n            if (isPromiseLike(source)) {\n              this.state.children[id] = this.spawnPromise(Promise.resolve(source), id);\n            } else if (isFunction(source)) {\n              this.state.children[id] = this.spawnCallback(source, id);\n            } else if (isObservable(source)) {\n              this.state.children[id] = this.spawnObservable(source, id);\n            } else if (isMachine(source)) {\n              // TODO: try/catch here\n              this.state.children[id] = this.spawnMachine(resolvedData ? source.withContext(resolvedData) : source, {\n                id: id,\n                autoForward: autoForward\n              });\n            }\n          } else {\n            this.spawnActivity(activity);\n          }\n\n          break;\n        }\n\n      case stop:\n        {\n          this.stopChild(action.activity.id);\n          break;\n        }\n\n      case log:\n        var label = action.label,\n            value = action.value;\n\n        if (label) {\n          this.logger(label, value);\n        } else {\n          this.logger(value);\n        }\n\n        break;\n\n      default:\n        if (!IS_PRODUCTION) {\n          warn(false, \"No implementation found for action type '\" + action.type + \"'\");\n        }\n\n        break;\n    }\n\n    return undefined;\n  };\n\n  Interpreter.prototype.removeChild = function (childId) {\n    this.children.delete(childId);\n    this.forwardTo.delete(childId);\n    delete this.state.children[childId];\n  };\n\n  Interpreter.prototype.stopChild = function (childId) {\n    var child = this.children.get(childId);\n\n    if (!child) {\n      return;\n    }\n\n    this.removeChild(childId);\n\n    if (isFunction(child.stop)) {\n      child.stop();\n    }\n  };\n\n  Interpreter.prototype.spawn = function (entity, name, options) {\n    if (isPromiseLike(entity)) {\n      return this.spawnPromise(Promise.resolve(entity), name);\n    } else if (isFunction(entity)) {\n      return this.spawnCallback(entity, name);\n    } else if (isActor(entity)) {\n      return this.spawnActor(entity);\n    } else if (isObservable(entity)) {\n      return this.spawnObservable(entity, name);\n    } else if (isMachine(entity)) {\n      return this.spawnMachine(entity, __assign(__assign({}, options), {\n        id: name\n      }));\n    } else {\n      throw new Error(\"Unable to spawn entity \\\"\" + name + \"\\\" of type \\\"\" + typeof entity + \"\\\".\");\n    }\n  };\n\n  Interpreter.prototype.spawnMachine = function (machine, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    var childService = new Interpreter(machine, __assign(__assign({}, this.options), {\n      parent: this,\n      id: options.id || machine.id\n    }));\n\n    var resolvedOptions = __assign(__assign({}, DEFAULT_SPAWN_OPTIONS), options);\n\n    if (resolvedOptions.sync) {\n      childService.onTransition(function (state) {\n        _this.send(update, {\n          state: state,\n          id: childService.id\n        });\n      });\n    }\n\n    var actor = childService;\n    this.children.set(childService.id, actor);\n\n    if (resolvedOptions.autoForward) {\n      this.forwardTo.add(childService.id);\n    }\n\n    childService.onDone(function (doneEvent) {\n      _this.removeChild(childService.id);\n\n      _this.send(toSCXMLEvent(doneEvent, {\n        origin: childService.id\n      }));\n    }).start();\n    return actor;\n  };\n\n  Interpreter.prototype.spawnPromise = function (promise, id) {\n    var _this = this;\n\n    var canceled = false;\n    promise.then(function (response) {\n      if (!canceled) {\n        _this.removeChild(id);\n\n        _this.send(toSCXMLEvent(doneInvoke(id, response), {\n          origin: id\n        }));\n      }\n    }, function (errorData) {\n      if (!canceled) {\n        _this.removeChild(id);\n\n        var errorEvent = error(id, errorData);\n\n        try {\n          // Send \"error.platform.id\" to this (parent).\n          _this.send(toSCXMLEvent(errorEvent, {\n            origin: id\n          }));\n        } catch (error) {\n          reportUnhandledExceptionOnInvocation(errorData, error, id);\n\n          if (_this.devTools) {\n            _this.devTools.send(errorEvent, _this.state);\n          }\n\n          if (_this.machine.strict) {\n            // it would be better to always stop the state machine if unhandled\n            // exception/promise rejection happens but because we don't want to\n            // break existing code so enforce it on strict mode only especially so\n            // because documentation says that onError is optional\n            _this.stop();\n          }\n        }\n      }\n    });\n    var actor = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function (next, handleError, complete) {\n        var unsubscribed = false;\n        promise.then(function (response) {\n          if (unsubscribed) {\n            return;\n          }\n\n          next && next(response);\n\n          if (unsubscribed) {\n            return;\n          }\n\n          complete && complete();\n        }, function (err) {\n          if (unsubscribed) {\n            return;\n          }\n\n          handleError(err);\n        });\n        return {\n          unsubscribe: function () {\n            return unsubscribed = true;\n          }\n        };\n      },\n      stop: function () {\n        canceled = true;\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    };\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnCallback = function (callback, id) {\n    var _this = this;\n\n    var canceled = false;\n    var receivers = new Set();\n    var listeners = new Set();\n\n    var receive = function (e) {\n      listeners.forEach(function (listener) {\n        return listener(e);\n      });\n\n      if (canceled) {\n        return;\n      }\n\n      _this.send(e);\n    };\n\n    var callbackStop;\n\n    try {\n      callbackStop = callback(receive, function (newListener) {\n        receivers.add(newListener);\n      });\n    } catch (err) {\n      this.send(error(id, err));\n    }\n\n    if (isPromiseLike(callbackStop)) {\n      // it turned out to be an async function, can't reliably check this before calling `callback`\n      // because transpiled async functions are not recognizable\n      return this.spawnPromise(callbackStop, id);\n    }\n\n    var actor = {\n      id: id,\n      send: function (event) {\n        return receivers.forEach(function (receiver) {\n          return receiver(event);\n        });\n      },\n      subscribe: function (next) {\n        listeners.add(next);\n        return {\n          unsubscribe: function () {\n            listeners.delete(next);\n          }\n        };\n      },\n      stop: function () {\n        canceled = true;\n\n        if (isFunction(callbackStop)) {\n          callbackStop();\n        }\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    };\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnObservable = function (source, id) {\n    var _this = this;\n\n    var subscription = source.subscribe(function (value) {\n      _this.send(toSCXMLEvent(value, {\n        origin: id\n      }));\n    }, function (err) {\n      _this.removeChild(id);\n\n      _this.send(toSCXMLEvent(error(id, err), {\n        origin: id\n      }));\n    }, function () {\n      _this.removeChild(id);\n\n      _this.send(toSCXMLEvent(doneInvoke(id), {\n        origin: id\n      }));\n    });\n    var actor = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function (next, handleError, complete) {\n        return source.subscribe(next, handleError, complete);\n      },\n      stop: function () {\n        return subscription.unsubscribe();\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    };\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnActor = function (actor) {\n    this.children.set(actor.id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnActivity = function (activity) {\n    var implementation = this.machine.options && this.machine.options.activities ? this.machine.options.activities[activity.type] : undefined;\n\n    if (!implementation) {\n      if (!IS_PRODUCTION) {\n        warn(false, \"No implementation found for activity '\" + activity.type + \"'\");\n      } // tslint:disable-next-line:no-console\n\n\n      return;\n    } // Start implementation\n\n\n    var dispose = implementation(this.state.context, activity);\n    this.spawnEffect(activity.id, dispose);\n  };\n\n  Interpreter.prototype.spawnEffect = function (id, dispose) {\n    this.children.set(id, {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function () {\n        return {\n          unsubscribe: function () {\n            return void 0;\n          }\n        };\n      },\n      stop: dispose || undefined,\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    });\n  };\n\n  Interpreter.prototype.attachDev = function () {\n    if (this.options.devTools && typeof window !== 'undefined') {\n      if (window.__REDUX_DEVTOOLS_EXTENSION__) {\n        var devToolsOptions = typeof this.options.devTools === 'object' ? this.options.devTools : undefined;\n        this.devTools = window.__REDUX_DEVTOOLS_EXTENSION__.connect(__assign(__assign({\n          name: this.id,\n          autoPause: true,\n          stateSanitizer: function (state) {\n            return {\n              value: state.value,\n              context: state.context,\n              actions: state.actions\n            };\n          }\n        }, devToolsOptions), {\n          features: __assign({\n            jump: false,\n            skip: false\n          }, devToolsOptions ? devToolsOptions.features : undefined)\n        }), this.machine);\n        this.devTools.init(this.state);\n      } // add XState-specific dev tooling hook\n\n\n      registerService(this);\n    }\n  };\n\n  Interpreter.prototype.toJSON = function () {\n    return {\n      id: this.id\n    };\n  };\n\n  Interpreter.prototype[symbolObservable] = function () {\n    return this;\n  };\n  /**\r\n   * The default interpreter options:\r\n   *\r\n   * - `clock` uses the global `setTimeout` and `clearTimeout` functions\r\n   * - `logger` uses the global `console.log()` method\r\n   */\n\n\n  Interpreter.defaultOptions = /*#__PURE__*/function (global) {\n    return {\n      execute: true,\n      deferEvents: true,\n      clock: {\n        setTimeout: function (fn, ms) {\n          return global.setTimeout.call(null, fn, ms);\n        },\n        clearTimeout: function (id) {\n          return global.clearTimeout.call(null, id);\n        }\n      },\n      logger: global.console.log.bind(console),\n      devTools: false\n    };\n  }(typeof window === 'undefined' ? global : window);\n\n  Interpreter.interpret = interpret;\n  return Interpreter;\n}();\n\nvar createNullActor = function (name) {\n  if (name === void 0) {\n    name = 'null';\n  }\n\n  return {\n    id: name,\n    send: function () {\n      return void 0;\n    },\n    subscribe: function () {\n      // tslint:disable-next-line:no-empty\n      return {\n        unsubscribe: function () {}\n      };\n    },\n    toJSON: function () {\n      return {\n        id: name\n      };\n    }\n  };\n};\n\nvar resolveSpawnOptions = function (nameOrOptions) {\n  if (isString(nameOrOptions)) {\n    return __assign(__assign({}, DEFAULT_SPAWN_OPTIONS), {\n      name: nameOrOptions\n    });\n  }\n\n  return __assign(__assign(__assign({}, DEFAULT_SPAWN_OPTIONS), {\n    name: uniqueId()\n  }), nameOrOptions);\n};\n\nfunction spawn(entity, nameOrOptions) {\n  var resolvedOptions = resolveSpawnOptions(nameOrOptions);\n  return withServiceScope(undefined, function (service) {\n    if (!IS_PRODUCTION) {\n      warn(!!service, \"Attempted to spawn an Actor (ID: \\\"\" + (isMachine(entity) ? entity.id : 'undefined') + \"\\\") outside of a service. This will have no effect.\");\n    }\n\n    if (service) {\n      return service.spawn(entity, resolvedOptions.name, resolvedOptions);\n    } else {\n      return createNullActor(resolvedOptions.name);\n    }\n  });\n}\n/**\r\n * Creates a new Interpreter instance for the given machine with the provided options, if any.\r\n *\r\n * @param machine The machine to interpret\r\n * @param options Interpreter options\r\n */\n\n\nfunction interpret(machine, options) {\n  var interpreter = new Interpreter(machine, options);\n  return interpreter;\n}\n\nexport { Interpreter, interpret, spawn };","import { __assign, __values, __spread, __read, __rest } from './_virtual/_tslib.js';\nimport { STATE_DELIMITER } from './constants.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { mapValues, isArray, flatten, keys, toArray, toStateValue, isString, getEventType, matchesState, path, evaluateGuard, mapContext, toSCXMLEvent, pathToStateValue, isBuiltInEvent, partition, updateHistoryValue, toStatePath, mapFilterValues, warn, toStatePaths, nestedPath, normalizeTarget, toGuard, toTransitionConfigArray, isMachine, isFunction } from './utils.js';\nimport { SpecialTargets } from './types.js';\nimport { getAllStateNodes, getConfiguration, has, getChildren, isInFinalState, getValue, isLeafNode } from './stateUtils.js';\nimport { start as start$1, stop as stop$1, invoke, update, nullEvent, raise as raise$1, send as send$1 } from './actionTypes.js';\nimport { done, start, raise, stop, toActionObjects, resolveActions, doneInvoke, error, toActionObject, toActivityDefinition, after, send, cancel, initEvent } from './actions.js';\nimport { State, stateValuesEqual } from './State.js';\nimport { createInvocableActor } from './Actor.js';\nvar NULL_EVENT = '';\nvar STATE_IDENTIFIER = '#';\nvar WILDCARD = '*';\nvar EMPTY_OBJECT = {};\n\nvar isStateId = function (str) {\n  return str[0] === STATE_IDENTIFIER;\n};\n\nvar createDefaultOptions = function () {\n  return {\n    actions: {},\n    guards: {},\n    services: {},\n    activities: {},\n    delays: {}\n  };\n};\n\nvar validateArrayifiedTransitions = function (stateNode, event, transitions) {\n  var hasNonLastUnguardedTarget = transitions.slice(0, -1).some(function (transition) {\n    return !('cond' in transition) && !('in' in transition) && (isString(transition.target) || isMachine(transition.target));\n  });\n  var eventText = event === NULL_EVENT ? 'the transient event' : \"event '\" + event + \"'\";\n  warn(!hasNonLastUnguardedTarget, \"One or more transitions for \" + eventText + \" on state '\" + stateNode.id + \"' are unreachable. \" + \"Make sure that the default transition is the last one defined.\");\n};\n\nvar StateNode =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  function StateNode(\n  /**\r\n   * The raw config used to create the machine.\r\n   */\n  config, options,\n  /**\r\n   * The initial extended state\r\n   */\n  context) {\n    var _this = this;\n\n    this.config = config;\n    this.context = context;\n    /**\r\n     * The order this state node appears. Corresponds to the implicit SCXML document order.\r\n     */\n\n    this.order = -1;\n    this.__xstatenode = true;\n    this.__cache = {\n      events: undefined,\n      relativeValue: new Map(),\n      initialStateValue: undefined,\n      initialState: undefined,\n      on: undefined,\n      transitions: undefined,\n      candidates: {},\n      delayedTransitions: undefined\n    };\n    this.idMap = {};\n    this.options = Object.assign(createDefaultOptions(), options);\n    this.parent = this.options._parent;\n    this.key = this.config.key || this.options._key || this.config.id || '(machine)';\n    this.machine = this.parent ? this.parent.machine : this;\n    this.path = this.parent ? this.parent.path.concat(this.key) : [];\n    this.delimiter = this.config.delimiter || (this.parent ? this.parent.delimiter : STATE_DELIMITER);\n    this.id = this.config.id || __spread([this.machine.key], this.path).join(this.delimiter);\n    this.version = this.parent ? this.parent.version : this.config.version;\n    this.type = this.config.type || (this.config.parallel ? 'parallel' : this.config.states && keys(this.config.states).length ? 'compound' : this.config.history ? 'history' : 'atomic');\n\n    if (!IS_PRODUCTION) {\n      warn(!('parallel' in this.config), \"The \\\"parallel\\\" property is deprecated and will be removed in version 4.1. \" + (this.config.parallel ? \"Replace with `type: 'parallel'`\" : \"Use `type: '\" + this.type + \"'`\") + \" in the config for state node '\" + this.id + \"' instead.\");\n    }\n\n    this.initial = this.config.initial;\n    this.states = this.config.states ? mapValues(this.config.states, function (stateConfig, key) {\n      var _a;\n\n      var stateNode = new StateNode(stateConfig, {\n        _parent: _this,\n        _key: key\n      });\n      Object.assign(_this.idMap, __assign((_a = {}, _a[stateNode.id] = stateNode, _a), stateNode.idMap));\n      return stateNode;\n    }) : EMPTY_OBJECT; // Document order\n\n    var order = 0;\n\n    function dfs(stateNode) {\n      var e_1, _a;\n\n      stateNode.order = order++;\n\n      try {\n        for (var _b = __values(getChildren(stateNode)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var child = _c.value;\n          dfs(child);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n    }\n\n    dfs(this); // History config\n\n    this.history = this.config.history === true ? 'shallow' : this.config.history || false;\n    this._transient = !!this.config.always || (!this.config.on ? false : Array.isArray(this.config.on) ? this.config.on.some(function (_a) {\n      var event = _a.event;\n      return event === NULL_EVENT;\n    }) : NULL_EVENT in this.config.on);\n    this.strict = !!this.config.strict; // TODO: deprecate (entry)\n\n    this.onEntry = toArray(this.config.entry || this.config.onEntry).map(function (action) {\n      return toActionObject(action);\n    }); // TODO: deprecate (exit)\n\n    this.onExit = toArray(this.config.exit || this.config.onExit).map(function (action) {\n      return toActionObject(action);\n    });\n    this.meta = this.config.meta;\n    this.doneData = this.type === 'final' ? this.config.data : undefined;\n    this.invoke = toArray(this.config.invoke).map(function (invokeConfig, i) {\n      var _a, _b;\n\n      if (isMachine(invokeConfig)) {\n        _this.machine.options.services = __assign((_a = {}, _a[invokeConfig.id] = invokeConfig, _a), _this.machine.options.services);\n        return {\n          type: invoke,\n          src: invokeConfig.id,\n          id: invokeConfig.id\n        };\n      } else if (typeof invokeConfig.src !== 'string') {\n        var invokeSrc = _this.id + \":invocation[\" + i + \"]\"; // TODO: util function\n\n        _this.machine.options.services = __assign((_b = {}, _b[invokeSrc] = invokeConfig.src, _b), _this.machine.options.services);\n        return __assign(__assign({\n          type: invoke,\n          id: invokeSrc\n        }, invokeConfig), {\n          src: invokeSrc\n        });\n      } else {\n        return __assign(__assign({}, invokeConfig), {\n          type: invoke,\n          id: invokeConfig.id || invokeConfig.src,\n          src: invokeConfig.src\n        });\n      }\n    });\n    this.activities = toArray(this.config.activities).concat(this.invoke).map(function (activity) {\n      return toActivityDefinition(activity);\n    });\n    this.transition = this.transition.bind(this);\n  }\n\n  StateNode.prototype._init = function () {\n    if (this.__cache.transitions) {\n      return;\n    }\n\n    getAllStateNodes(this).forEach(function (stateNode) {\n      return stateNode.on;\n    });\n  };\n  /**\r\n   * Clones this state machine with custom options and context.\r\n   *\r\n   * @param options Options (actions, guards, activities, services) to recursively merge with the existing options.\r\n   * @param context Custom context (will override predefined context)\r\n   */\n\n\n  StateNode.prototype.withConfig = function (options, context) {\n    if (context === void 0) {\n      context = this.context;\n    }\n\n    var _a = this.options,\n        actions = _a.actions,\n        activities = _a.activities,\n        guards = _a.guards,\n        services = _a.services,\n        delays = _a.delays;\n    return new StateNode(this.config, {\n      actions: __assign(__assign({}, actions), options.actions),\n      activities: __assign(__assign({}, activities), options.activities),\n      guards: __assign(__assign({}, guards), options.guards),\n      services: __assign(__assign({}, services), options.services),\n      delays: __assign(__assign({}, delays), options.delays)\n    }, context);\n  };\n  /**\r\n   * Clones this state machine with custom context.\r\n   *\r\n   * @param context Custom context (will override predefined context, not recursive)\r\n   */\n\n\n  StateNode.prototype.withContext = function (context) {\n    return new StateNode(this.config, this.options, context);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"definition\", {\n    /**\r\n     * The well-structured state node definition.\r\n     */\n    get: function () {\n      return {\n        id: this.id,\n        key: this.key,\n        version: this.version,\n        context: this.context,\n        type: this.type,\n        initial: this.initial,\n        history: this.history,\n        states: mapValues(this.states, function (state) {\n          return state.definition;\n        }),\n        on: this.on,\n        transitions: this.transitions,\n        entry: this.onEntry,\n        exit: this.onExit,\n        activities: this.activities || [],\n        meta: this.meta,\n        order: this.order || -1,\n        data: this.doneData,\n        invoke: this.invoke\n      };\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  StateNode.prototype.toJSON = function () {\n    return this.definition;\n  };\n\n  Object.defineProperty(StateNode.prototype, \"on\", {\n    /**\r\n     * The mapping of events to transitions.\r\n     */\n    get: function () {\n      if (this.__cache.on) {\n        return this.__cache.on;\n      }\n\n      var transitions = this.transitions;\n      return this.__cache.on = transitions.reduce(function (map, transition) {\n        map[transition.eventType] = map[transition.eventType] || [];\n        map[transition.eventType].push(transition);\n        return map;\n      }, {});\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"after\", {\n    get: function () {\n      return this.__cache.delayedTransitions || (this.__cache.delayedTransitions = this.getDelayedTransitions(), this.__cache.delayedTransitions);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"transitions\", {\n    /**\r\n     * All the transitions that can be taken from this state node.\r\n     */\n    get: function () {\n      return this.__cache.transitions || (this.__cache.transitions = this.formatTransitions(), this.__cache.transitions);\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  StateNode.prototype.getCandidates = function (eventName) {\n    if (this.__cache.candidates[eventName]) {\n      return this.__cache.candidates[eventName];\n    }\n\n    var transient = eventName === NULL_EVENT;\n    var candidates = this.transitions.filter(function (transition) {\n      var sameEventType = transition.eventType === eventName; // null events should only match against eventless transitions\n\n      return transient ? sameEventType : sameEventType || transition.eventType === WILDCARD;\n    });\n    this.__cache.candidates[eventName] = candidates;\n    return candidates;\n  };\n  /**\r\n   * All delayed transitions from the config.\r\n   */\n\n\n  StateNode.prototype.getDelayedTransitions = function () {\n    var _this = this;\n\n    var afterConfig = this.config.after;\n\n    if (!afterConfig) {\n      return [];\n    }\n\n    var mutateEntryExit = function (delay, i) {\n      var delayRef = isFunction(delay) ? _this.id + \":delay[\" + i + \"]\" : delay;\n      var eventType = after(delayRef, _this.id);\n\n      _this.onEntry.push(send(eventType, {\n        delay: delay\n      }));\n\n      _this.onExit.push(cancel(eventType));\n\n      return eventType;\n    };\n\n    var delayedTransitions = isArray(afterConfig) ? afterConfig.map(function (transition, i) {\n      var eventType = mutateEntryExit(transition.delay, i);\n      return __assign(__assign({}, transition), {\n        event: eventType\n      });\n    }) : flatten(keys(afterConfig).map(function (delay, i) {\n      var configTransition = afterConfig[delay];\n      var resolvedTransition = isString(configTransition) ? {\n        target: configTransition\n      } : configTransition;\n      var resolvedDelay = !isNaN(+delay) ? +delay : delay;\n      var eventType = mutateEntryExit(resolvedDelay, i);\n      return toArray(resolvedTransition).map(function (transition) {\n        return __assign(__assign({}, transition), {\n          event: eventType,\n          delay: resolvedDelay\n        });\n      });\n    }));\n    return delayedTransitions.map(function (delayedTransition) {\n      var delay = delayedTransition.delay;\n      return __assign(__assign({}, _this.formatTransition(delayedTransition)), {\n        delay: delay\n      });\n    });\n  };\n  /**\r\n   * Returns the state nodes represented by the current state value.\r\n   *\r\n   * @param state The state value or State instance\r\n   */\n\n\n  StateNode.prototype.getStateNodes = function (state) {\n    var _a;\n\n    var _this = this;\n\n    if (!state) {\n      return [];\n    }\n\n    var stateValue = state instanceof State ? state.value : toStateValue(state, this.delimiter);\n\n    if (isString(stateValue)) {\n      var initialStateValue = this.getStateNode(stateValue).initial;\n      return initialStateValue !== undefined ? this.getStateNodes((_a = {}, _a[stateValue] = initialStateValue, _a)) : [this.states[stateValue]];\n    }\n\n    var subStateKeys = keys(stateValue);\n    var subStateNodes = subStateKeys.map(function (subStateKey) {\n      return _this.getStateNode(subStateKey);\n    });\n    return subStateNodes.concat(subStateKeys.reduce(function (allSubStateNodes, subStateKey) {\n      var subStateNode = _this.getStateNode(subStateKey).getStateNodes(stateValue[subStateKey]);\n\n      return allSubStateNodes.concat(subStateNode);\n    }, []));\n  };\n  /**\r\n   * Returns `true` if this state node explicitly handles the given event.\r\n   *\r\n   * @param event The event in question\r\n   */\n\n\n  StateNode.prototype.handles = function (event) {\n    var eventType = getEventType(event);\n    return this.events.includes(eventType);\n  };\n  /**\r\n   * Resolves the given `state` to a new `State` instance relative to this machine.\r\n   *\r\n   * This ensures that `.events` and `.nextEvents` represent the correct values.\r\n   *\r\n   * @param state The state to resolve\r\n   */\n\n\n  StateNode.prototype.resolveState = function (state) {\n    var configuration = Array.from(getConfiguration([], this.getStateNodes(state.value)));\n    return new State(__assign(__assign({}, state), {\n      value: this.resolve(state.value),\n      configuration: configuration\n    }));\n  };\n\n  StateNode.prototype.transitionLeafNode = function (stateValue, state, _event) {\n    var stateNode = this.getStateNode(stateValue);\n    var next = stateNode.next(state, _event);\n\n    if (!next || !next.transitions.length) {\n      return this.next(state, _event);\n    }\n\n    return next;\n  };\n\n  StateNode.prototype.transitionCompoundNode = function (stateValue, state, _event) {\n    var subStateKeys = keys(stateValue);\n    var stateNode = this.getStateNode(subStateKeys[0]);\n\n    var next = stateNode._transition(stateValue[subStateKeys[0]], state, _event);\n\n    if (!next || !next.transitions.length) {\n      return this.next(state, _event);\n    }\n\n    return next;\n  };\n\n  StateNode.prototype.transitionParallelNode = function (stateValue, state, _event) {\n    var e_2, _a;\n\n    var transitionMap = {};\n\n    try {\n      for (var _b = __values(keys(stateValue)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var subStateKey = _c.value;\n        var subStateValue = stateValue[subStateKey];\n\n        if (!subStateValue) {\n          continue;\n        }\n\n        var subStateNode = this.getStateNode(subStateKey);\n\n        var next = subStateNode._transition(subStateValue, state, _event);\n\n        if (next) {\n          transitionMap[subStateKey] = next;\n        }\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    var stateTransitions = keys(transitionMap).map(function (key) {\n      return transitionMap[key];\n    });\n    var enabledTransitions = flatten(stateTransitions.map(function (st) {\n      return st.transitions;\n    }));\n    var willTransition = stateTransitions.some(function (st) {\n      return st.transitions.length > 0;\n    });\n\n    if (!willTransition) {\n      return this.next(state, _event);\n    }\n\n    var entryNodes = flatten(stateTransitions.map(function (t) {\n      return t.entrySet;\n    }));\n    var configuration = flatten(keys(transitionMap).map(function (key) {\n      return transitionMap[key].configuration;\n    }));\n    return {\n      transitions: enabledTransitions,\n      entrySet: entryNodes,\n      exitSet: flatten(stateTransitions.map(function (t) {\n        return t.exitSet;\n      })),\n      configuration: configuration,\n      source: state,\n      actions: flatten(keys(transitionMap).map(function (key) {\n        return transitionMap[key].actions;\n      }))\n    };\n  };\n\n  StateNode.prototype._transition = function (stateValue, state, _event) {\n    // leaf node\n    if (isString(stateValue)) {\n      return this.transitionLeafNode(stateValue, state, _event);\n    } // hierarchical node\n\n\n    if (keys(stateValue).length === 1) {\n      return this.transitionCompoundNode(stateValue, state, _event);\n    } // orthogonal node\n\n\n    return this.transitionParallelNode(stateValue, state, _event);\n  };\n\n  StateNode.prototype.next = function (state, _event) {\n    var e_3, _a;\n\n    var _this = this;\n\n    var eventName = _event.name;\n    var actions = [];\n    var nextStateNodes = [];\n    var selectedTransition;\n\n    try {\n      for (var _b = __values(this.getCandidates(eventName)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var candidate = _c.value;\n        var cond = candidate.cond,\n            stateIn = candidate.in;\n        var resolvedContext = state.context;\n        var isInState = stateIn ? isString(stateIn) && isStateId(stateIn) ? // Check if in state by ID\n        state.matches(toStateValue(this.getStateNodeById(stateIn).path, this.delimiter)) : // Check if in state by relative grandparent\n        matchesState(toStateValue(stateIn, this.delimiter), path(this.path.slice(0, -2))(state.value)) : true;\n        var guardPassed = false;\n\n        try {\n          guardPassed = !cond || evaluateGuard(this.machine, cond, resolvedContext, _event, state);\n        } catch (err) {\n          throw new Error(\"Unable to evaluate guard '\" + (cond.name || cond.type) + \"' in transition for event '\" + eventName + \"' in state node '\" + this.id + \"':\\n\" + err.message);\n        }\n\n        if (guardPassed && isInState) {\n          if (candidate.target !== undefined) {\n            nextStateNodes = candidate.target;\n          }\n\n          actions.push.apply(actions, __spread(candidate.actions));\n          selectedTransition = candidate;\n          break;\n        }\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    if (!selectedTransition) {\n      return undefined;\n    }\n\n    if (!nextStateNodes.length) {\n      return {\n        transitions: [selectedTransition],\n        entrySet: [],\n        exitSet: [],\n        configuration: state.value ? [this] : [],\n        source: state,\n        actions: actions\n      };\n    }\n\n    var allNextStateNodes = flatten(nextStateNodes.map(function (stateNode) {\n      return _this.getRelativeStateNodes(stateNode, state.historyValue);\n    }));\n    var isInternal = !!selectedTransition.internal;\n    var reentryNodes = isInternal ? [] : flatten(allNextStateNodes.map(function (n) {\n      return _this.nodesFromChild(n);\n    }));\n    return {\n      transitions: [selectedTransition],\n      entrySet: reentryNodes,\n      exitSet: isInternal ? [] : [this],\n      configuration: allNextStateNodes,\n      source: state,\n      actions: actions\n    };\n  };\n\n  StateNode.prototype.nodesFromChild = function (childStateNode) {\n    if (childStateNode.escapes(this)) {\n      return [];\n    }\n\n    var nodes = [];\n    var marker = childStateNode;\n\n    while (marker && marker !== this) {\n      nodes.push(marker);\n      marker = marker.parent;\n    }\n\n    nodes.push(this); // inclusive\n\n    return nodes;\n  };\n  /**\r\n   * Whether the given state node \"escapes\" this state node. If the `stateNode` is equal to or the parent of\r\n   * this state node, it does not escape.\r\n   */\n\n\n  StateNode.prototype.escapes = function (stateNode) {\n    if (this === stateNode) {\n      return false;\n    }\n\n    var parent = this.parent;\n\n    while (parent) {\n      if (parent === stateNode) {\n        return false;\n      }\n\n      parent = parent.parent;\n    }\n\n    return true;\n  };\n\n  StateNode.prototype.getActions = function (transition, currentContext, _event, prevState) {\n    var e_4, _a, e_5, _b;\n\n    var prevConfig = getConfiguration([], prevState ? this.getStateNodes(prevState.value) : [this]);\n    var resolvedConfig = transition.configuration.length ? getConfiguration(prevConfig, transition.configuration) : prevConfig;\n\n    try {\n      for (var resolvedConfig_1 = __values(resolvedConfig), resolvedConfig_1_1 = resolvedConfig_1.next(); !resolvedConfig_1_1.done; resolvedConfig_1_1 = resolvedConfig_1.next()) {\n        var sn = resolvedConfig_1_1.value;\n\n        if (!has(prevConfig, sn)) {\n          transition.entrySet.push(sn);\n        }\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (resolvedConfig_1_1 && !resolvedConfig_1_1.done && (_a = resolvedConfig_1.return)) _a.call(resolvedConfig_1);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n\n    try {\n      for (var prevConfig_1 = __values(prevConfig), prevConfig_1_1 = prevConfig_1.next(); !prevConfig_1_1.done; prevConfig_1_1 = prevConfig_1.next()) {\n        var sn = prevConfig_1_1.value;\n\n        if (!has(resolvedConfig, sn) || has(transition.exitSet, sn.parent)) {\n          transition.exitSet.push(sn);\n        }\n      }\n    } catch (e_5_1) {\n      e_5 = {\n        error: e_5_1\n      };\n    } finally {\n      try {\n        if (prevConfig_1_1 && !prevConfig_1_1.done && (_b = prevConfig_1.return)) _b.call(prevConfig_1);\n      } finally {\n        if (e_5) throw e_5.error;\n      }\n    }\n\n    if (!transition.source) {\n      transition.exitSet = []; // Ensure that root StateNode (machine) is entered\n\n      transition.entrySet.push(this);\n    }\n\n    var doneEvents = flatten(transition.entrySet.map(function (sn) {\n      var events = [];\n\n      if (sn.type !== 'final') {\n        return events;\n      }\n\n      var parent = sn.parent;\n\n      if (!parent.parent) {\n        return events;\n      }\n\n      events.push(done(sn.id, sn.doneData), // TODO: deprecate - final states should not emit done events for their own state.\n      done(parent.id, sn.doneData ? mapContext(sn.doneData, currentContext, _event) : undefined));\n      var grandparent = parent.parent;\n\n      if (grandparent.type === 'parallel') {\n        if (getChildren(grandparent).every(function (parentNode) {\n          return isInFinalState(transition.configuration, parentNode);\n        })) {\n          events.push(done(grandparent.id));\n        }\n      }\n\n      return events;\n    }));\n    transition.exitSet.sort(function (a, b) {\n      return b.order - a.order;\n    });\n    transition.entrySet.sort(function (a, b) {\n      return a.order - b.order;\n    });\n    var entryStates = new Set(transition.entrySet);\n    var exitStates = new Set(transition.exitSet);\n\n    var _c = __read([flatten(Array.from(entryStates).map(function (stateNode) {\n      return __spread(stateNode.activities.map(function (activity) {\n        return start(activity);\n      }), stateNode.onEntry);\n    })).concat(doneEvents.map(raise)), flatten(Array.from(exitStates).map(function (stateNode) {\n      return __spread(stateNode.onExit, stateNode.activities.map(function (activity) {\n        return stop(activity);\n      }));\n    }))], 2),\n        entryActions = _c[0],\n        exitActions = _c[1];\n\n    var actions = toActionObjects(exitActions.concat(transition.actions).concat(entryActions), this.machine.options.actions);\n    return actions;\n  };\n  /**\r\n   * Determines the next state given the current `state` and sent `event`.\r\n   *\r\n   * @param state The current State instance or state value\r\n   * @param event The event that was sent at the current state\r\n   * @param context The current context (extended state) of the current state\r\n   */\n\n\n  StateNode.prototype.transition = function (state, event, context) {\n    if (state === void 0) {\n      state = this.initialState;\n    }\n\n    var _event = toSCXMLEvent(event);\n\n    var currentState;\n\n    if (state instanceof State) {\n      currentState = context === undefined ? state : this.resolveState(State.from(state, context));\n    } else {\n      var resolvedStateValue = isString(state) ? this.resolve(pathToStateValue(this.getResolvedPath(state))) : this.resolve(state);\n      var resolvedContext = context ? context : this.machine.context;\n      currentState = this.resolveState(State.from(resolvedStateValue, resolvedContext));\n    }\n\n    if (!IS_PRODUCTION && _event.name === WILDCARD) {\n      throw new Error(\"An event cannot have the wildcard type ('\" + WILDCARD + \"')\");\n    }\n\n    if (this.strict) {\n      if (!this.events.includes(_event.name) && !isBuiltInEvent(_event.name)) {\n        throw new Error(\"Machine '\" + this.id + \"' does not accept event '\" + _event.name + \"'\");\n      }\n    }\n\n    var stateTransition = this._transition(currentState.value, currentState, _event) || {\n      transitions: [],\n      configuration: [],\n      entrySet: [],\n      exitSet: [],\n      source: currentState,\n      actions: []\n    };\n    var prevConfig = getConfiguration([], this.getStateNodes(currentState.value));\n    var resolvedConfig = stateTransition.configuration.length ? getConfiguration(prevConfig, stateTransition.configuration) : prevConfig;\n    stateTransition.configuration = __spread(resolvedConfig);\n    return this.resolveTransition(stateTransition, currentState, _event);\n  };\n\n  StateNode.prototype.resolveRaisedTransition = function (state, _event, // @ts-ignore\n  originalEvent) {\n    var _a;\n\n    var currentActions = state.actions;\n    state = this.transition(state, _event); // Save original event to state\n    // TODO: this should be the raised event! Delete in V5 (breaking)\n\n    state._event = originalEvent;\n    state.event = originalEvent.data;\n\n    (_a = state.actions).unshift.apply(_a, __spread(currentActions));\n\n    return state;\n  };\n\n  StateNode.prototype.resolveTransition = function (stateTransition, currentState, _event, context) {\n    var e_6, _a;\n\n    var _this = this;\n\n    if (_event === void 0) {\n      _event = initEvent;\n    }\n\n    if (context === void 0) {\n      context = this.machine.context;\n    }\n\n    var configuration = stateTransition.configuration; // Transition will \"apply\" if:\n    // - this is the initial state (there is no current state)\n    // - OR there are transitions\n\n    var willTransition = !currentState || stateTransition.transitions.length > 0;\n    var resolvedStateValue = willTransition ? getValue(this.machine, configuration) : undefined;\n    var historyValue = currentState ? currentState.historyValue ? currentState.historyValue : stateTransition.source ? this.machine.historyValue(currentState.value) : undefined : undefined;\n    var currentContext = currentState ? currentState.context : context;\n    var actions = this.getActions(stateTransition, currentContext, _event, currentState);\n    var activities = currentState ? __assign({}, currentState.activities) : {};\n\n    try {\n      for (var actions_1 = __values(actions), actions_1_1 = actions_1.next(); !actions_1_1.done; actions_1_1 = actions_1.next()) {\n        var action = actions_1_1.value;\n\n        if (action.type === start$1) {\n          activities[action.activity.id || action.activity.type] = action;\n        } else if (action.type === stop$1) {\n          activities[action.activity.id || action.activity.type] = false;\n        }\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (actions_1_1 && !actions_1_1.done && (_a = actions_1.return)) _a.call(actions_1);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n\n    var _b = __read(resolveActions(this, currentState, currentContext, _event, actions), 2),\n        resolvedActions = _b[0],\n        updatedContext = _b[1];\n\n    var _c = __read(partition(resolvedActions, function (action) {\n      return action.type === raise$1 || action.type === send$1 && action.to === SpecialTargets.Internal;\n    }), 2),\n        raisedEvents = _c[0],\n        nonRaisedActions = _c[1];\n\n    var invokeActions = resolvedActions.filter(function (action) {\n      return action.type === start$1 && action.activity.type === invoke;\n    });\n    var children = invokeActions.reduce(function (acc, action) {\n      acc[action.activity.id] = createInvocableActor(action.activity, _this.machine);\n      return acc;\n    }, currentState ? __assign({}, currentState.children) : {});\n    var resolvedConfiguration = resolvedStateValue ? stateTransition.configuration : currentState ? currentState.configuration : [];\n    var meta = resolvedConfiguration.reduce(function (acc, stateNode) {\n      if (stateNode.meta !== undefined) {\n        acc[stateNode.id] = stateNode.meta;\n      }\n\n      return acc;\n    }, {});\n    var isDone = isInFinalState(resolvedConfiguration, this);\n    var nextState = new State({\n      value: resolvedStateValue || currentState.value,\n      context: updatedContext,\n      _event: _event,\n      // Persist _sessionid between states\n      _sessionid: currentState ? currentState._sessionid : null,\n      historyValue: resolvedStateValue ? historyValue ? updateHistoryValue(historyValue, resolvedStateValue) : undefined : currentState ? currentState.historyValue : undefined,\n      history: !resolvedStateValue || stateTransition.source ? currentState : undefined,\n      actions: resolvedStateValue ? nonRaisedActions : [],\n      activities: resolvedStateValue ? activities : currentState ? currentState.activities : {},\n      meta: resolvedStateValue ? meta : currentState ? currentState.meta : undefined,\n      events: [],\n      configuration: resolvedConfiguration,\n      transitions: stateTransition.transitions,\n      children: children,\n      done: isDone\n    });\n    var didUpdateContext = currentContext !== updatedContext;\n    nextState.changed = _event.name === update || didUpdateContext; // Dispose of penultimate histories to prevent memory leaks\n\n    var history = nextState.history;\n\n    if (history) {\n      delete history.history;\n    }\n\n    if (!resolvedStateValue) {\n      return nextState;\n    }\n\n    var maybeNextState = nextState;\n\n    if (!isDone) {\n      var isTransient = this._transient || configuration.some(function (stateNode) {\n        return stateNode._transient;\n      });\n\n      if (isTransient) {\n        maybeNextState = this.resolveRaisedTransition(maybeNextState, {\n          type: nullEvent\n        }, _event);\n      }\n\n      while (raisedEvents.length) {\n        var raisedEvent = raisedEvents.shift();\n        maybeNextState = this.resolveRaisedTransition(maybeNextState, raisedEvent._event, _event);\n      }\n    } // Detect if state changed\n\n\n    var changed = maybeNextState.changed || (history ? !!maybeNextState.actions.length || didUpdateContext || typeof history.value !== typeof maybeNextState.value || !stateValuesEqual(maybeNextState.value, history.value) : undefined);\n    maybeNextState.changed = changed; // Preserve original history after raised events\n\n    maybeNextState.historyValue = nextState.historyValue;\n    maybeNextState.history = history;\n    return maybeNextState;\n  };\n  /**\r\n   * Returns the child state node from its relative `stateKey`, or throws.\r\n   */\n\n\n  StateNode.prototype.getStateNode = function (stateKey) {\n    if (isStateId(stateKey)) {\n      return this.machine.getStateNodeById(stateKey);\n    }\n\n    if (!this.states) {\n      throw new Error(\"Unable to retrieve child state '\" + stateKey + \"' from '\" + this.id + \"'; no child states exist.\");\n    }\n\n    var result = this.states[stateKey];\n\n    if (!result) {\n      throw new Error(\"Child state '\" + stateKey + \"' does not exist on '\" + this.id + \"'\");\n    }\n\n    return result;\n  };\n  /**\r\n   * Returns the state node with the given `stateId`, or throws.\r\n   *\r\n   * @param stateId The state ID. The prefix \"#\" is removed.\r\n   */\n\n\n  StateNode.prototype.getStateNodeById = function (stateId) {\n    var resolvedStateId = isStateId(stateId) ? stateId.slice(STATE_IDENTIFIER.length) : stateId;\n\n    if (resolvedStateId === this.id) {\n      return this;\n    }\n\n    var stateNode = this.machine.idMap[resolvedStateId];\n\n    if (!stateNode) {\n      throw new Error(\"Child state node '#\" + resolvedStateId + \"' does not exist on machine '\" + this.id + \"'\");\n    }\n\n    return stateNode;\n  };\n  /**\r\n   * Returns the relative state node from the given `statePath`, or throws.\r\n   *\r\n   * @param statePath The string or string array relative path to the state node.\r\n   */\n\n\n  StateNode.prototype.getStateNodeByPath = function (statePath) {\n    if (typeof statePath === 'string' && isStateId(statePath)) {\n      try {\n        return this.getStateNodeById(statePath.slice(1));\n      } catch (e) {// try individual paths\n        // throw e;\n      }\n    }\n\n    var arrayStatePath = toStatePath(statePath, this.delimiter).slice();\n    var currentStateNode = this;\n\n    while (arrayStatePath.length) {\n      var key = arrayStatePath.shift();\n\n      if (!key.length) {\n        break;\n      }\n\n      currentStateNode = currentStateNode.getStateNode(key);\n    }\n\n    return currentStateNode;\n  };\n  /**\r\n   * Resolves a partial state value with its full representation in this machine.\r\n   *\r\n   * @param stateValue The partial state value to resolve.\r\n   */\n\n\n  StateNode.prototype.resolve = function (stateValue) {\n    var _a;\n\n    var _this = this;\n\n    if (!stateValue) {\n      return this.initialStateValue || EMPTY_OBJECT; // TODO: type-specific properties\n    }\n\n    switch (this.type) {\n      case 'parallel':\n        return mapValues(this.initialStateValue, function (subStateValue, subStateKey) {\n          return subStateValue ? _this.getStateNode(subStateKey).resolve(stateValue[subStateKey] || subStateValue) : EMPTY_OBJECT;\n        });\n\n      case 'compound':\n        if (isString(stateValue)) {\n          var subStateNode = this.getStateNode(stateValue);\n\n          if (subStateNode.type === 'parallel' || subStateNode.type === 'compound') {\n            return _a = {}, _a[stateValue] = subStateNode.initialStateValue, _a;\n          }\n\n          return stateValue;\n        }\n\n        if (!keys(stateValue).length) {\n          return this.initialStateValue || {};\n        }\n\n        return mapValues(stateValue, function (subStateValue, subStateKey) {\n          return subStateValue ? _this.getStateNode(subStateKey).resolve(subStateValue) : EMPTY_OBJECT;\n        });\n\n      default:\n        return stateValue || EMPTY_OBJECT;\n    }\n  };\n\n  StateNode.prototype.getResolvedPath = function (stateIdentifier) {\n    if (isStateId(stateIdentifier)) {\n      var stateNode = this.machine.idMap[stateIdentifier.slice(STATE_IDENTIFIER.length)];\n\n      if (!stateNode) {\n        throw new Error(\"Unable to find state node '\" + stateIdentifier + \"'\");\n      }\n\n      return stateNode.path;\n    }\n\n    return toStatePath(stateIdentifier, this.delimiter);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialStateValue\", {\n    get: function () {\n      var _a;\n\n      if (this.__cache.initialStateValue) {\n        return this.__cache.initialStateValue;\n      }\n\n      var initialStateValue;\n\n      if (this.type === 'parallel') {\n        initialStateValue = mapFilterValues(this.states, function (state) {\n          return state.initialStateValue || EMPTY_OBJECT;\n        }, function (stateNode) {\n          return !(stateNode.type === 'history');\n        });\n      } else if (this.initial !== undefined) {\n        if (!this.states[this.initial]) {\n          throw new Error(\"Initial state '\" + this.initial + \"' not found on '\" + this.key + \"'\");\n        }\n\n        initialStateValue = isLeafNode(this.states[this.initial]) ? this.initial : (_a = {}, _a[this.initial] = this.states[this.initial].initialStateValue, _a);\n      }\n\n      this.__cache.initialStateValue = initialStateValue;\n      return this.__cache.initialStateValue;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  StateNode.prototype.getInitialState = function (stateValue, context) {\n    var configuration = this.getStateNodes(stateValue);\n    return this.resolveTransition({\n      configuration: configuration,\n      entrySet: configuration,\n      exitSet: [],\n      transitions: [],\n      source: undefined,\n      actions: []\n    }, undefined, undefined, context);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialState\", {\n    /**\r\n     * The initial State instance, which includes all actions to be executed from\r\n     * entering the initial state.\r\n     */\n    get: function () {\n      this._init();\n\n      var initialStateValue = this.initialStateValue;\n\n      if (!initialStateValue) {\n        throw new Error(\"Cannot retrieve initial state from simple state '\" + this.id + \"'.\");\n      }\n\n      return this.getInitialState(initialStateValue);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"target\", {\n    /**\r\n     * The target state value of the history state node, if it exists. This represents the\r\n     * default state value to transition to if no history value exists yet.\r\n     */\n    get: function () {\n      var target;\n\n      if (this.type === 'history') {\n        var historyConfig = this.config;\n\n        if (isString(historyConfig.target)) {\n          target = isStateId(historyConfig.target) ? pathToStateValue(this.machine.getStateNodeById(historyConfig.target).path.slice(this.path.length - 1)) : historyConfig.target;\n        } else {\n          target = historyConfig.target;\n        }\n      }\n\n      return target;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Returns the leaf nodes from a state path relative to this state node.\r\n   *\r\n   * @param relativeStateId The relative state path to retrieve the state nodes\r\n   * @param history The previous state to retrieve history\r\n   * @param resolve Whether state nodes should resolve to initial child state nodes\r\n   */\n\n  StateNode.prototype.getRelativeStateNodes = function (relativeStateId, historyValue, resolve) {\n    if (resolve === void 0) {\n      resolve = true;\n    }\n\n    return resolve ? relativeStateId.type === 'history' ? relativeStateId.resolveHistory(historyValue) : relativeStateId.initialStateNodes : [relativeStateId];\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialStateNodes\", {\n    get: function () {\n      var _this = this;\n\n      if (isLeafNode(this)) {\n        return [this];\n      } // Case when state node is compound but no initial state is defined\n\n\n      if (this.type === 'compound' && !this.initial) {\n        if (!IS_PRODUCTION) {\n          warn(false, \"Compound state node '\" + this.id + \"' has no initial state.\");\n        }\n\n        return [this];\n      }\n\n      var initialStateNodePaths = toStatePaths(this.initialStateValue);\n      return flatten(initialStateNodePaths.map(function (initialPath) {\n        return _this.getFromRelativePath(initialPath);\n      }));\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Retrieves state nodes from a relative path to this state node.\r\n   *\r\n   * @param relativePath The relative path from this state node\r\n   * @param historyValue\r\n   */\n\n  StateNode.prototype.getFromRelativePath = function (relativePath) {\n    if (!relativePath.length) {\n      return [this];\n    }\n\n    var _a = __read(relativePath),\n        stateKey = _a[0],\n        childStatePath = _a.slice(1);\n\n    if (!this.states) {\n      throw new Error(\"Cannot retrieve subPath '\" + stateKey + \"' from node with no states\");\n    }\n\n    var childStateNode = this.getStateNode(stateKey);\n\n    if (childStateNode.type === 'history') {\n      return childStateNode.resolveHistory();\n    }\n\n    if (!this.states[stateKey]) {\n      throw new Error(\"Child state '\" + stateKey + \"' does not exist on '\" + this.id + \"'\");\n    }\n\n    return this.states[stateKey].getFromRelativePath(childStatePath);\n  };\n\n  StateNode.prototype.historyValue = function (relativeStateValue) {\n    if (!keys(this.states).length) {\n      return undefined;\n    }\n\n    return {\n      current: relativeStateValue || this.initialStateValue,\n      states: mapFilterValues(this.states, function (stateNode, key) {\n        if (!relativeStateValue) {\n          return stateNode.historyValue();\n        }\n\n        var subStateValue = isString(relativeStateValue) ? undefined : relativeStateValue[key];\n        return stateNode.historyValue(subStateValue || stateNode.initialStateValue);\n      }, function (stateNode) {\n        return !stateNode.history;\n      })\n    };\n  };\n  /**\r\n   * Resolves to the historical value(s) of the parent state node,\r\n   * represented by state nodes.\r\n   *\r\n   * @param historyValue\r\n   */\n\n\n  StateNode.prototype.resolveHistory = function (historyValue) {\n    var _this = this;\n\n    if (this.type !== 'history') {\n      return [this];\n    }\n\n    var parent = this.parent;\n\n    if (!historyValue) {\n      var historyTarget = this.target;\n      return historyTarget ? flatten(toStatePaths(historyTarget).map(function (relativeChildPath) {\n        return parent.getFromRelativePath(relativeChildPath);\n      })) : parent.initialStateNodes;\n    }\n\n    var subHistoryValue = nestedPath(parent.path, 'states')(historyValue).current;\n\n    if (isString(subHistoryValue)) {\n      return [parent.getStateNode(subHistoryValue)];\n    }\n\n    return flatten(toStatePaths(subHistoryValue).map(function (subStatePath) {\n      return _this.history === 'deep' ? parent.getFromRelativePath(subStatePath) : [parent.states[subStatePath[0]]];\n    }));\n  };\n\n  Object.defineProperty(StateNode.prototype, \"stateIds\", {\n    /**\r\n     * All the state node IDs of this state node and its descendant state nodes.\r\n     */\n    get: function () {\n      var _this = this;\n\n      var childStateIds = flatten(keys(this.states).map(function (stateKey) {\n        return _this.states[stateKey].stateIds;\n      }));\n      return [this.id].concat(childStateIds);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"events\", {\n    /**\r\n     * All the event types accepted by this state node and its descendants.\r\n     */\n    get: function () {\n      var e_7, _a, e_8, _b;\n\n      if (this.__cache.events) {\n        return this.__cache.events;\n      }\n\n      var states = this.states;\n      var events = new Set(this.ownEvents);\n\n      if (states) {\n        try {\n          for (var _c = __values(keys(states)), _d = _c.next(); !_d.done; _d = _c.next()) {\n            var stateId = _d.value;\n            var state = states[stateId];\n\n            if (state.states) {\n              try {\n                for (var _e = (e_8 = void 0, __values(state.events)), _f = _e.next(); !_f.done; _f = _e.next()) {\n                  var event_1 = _f.value;\n                  events.add(\"\" + event_1);\n                }\n              } catch (e_8_1) {\n                e_8 = {\n                  error: e_8_1\n                };\n              } finally {\n                try {\n                  if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n                } finally {\n                  if (e_8) throw e_8.error;\n                }\n              }\n            }\n          }\n        } catch (e_7_1) {\n          e_7 = {\n            error: e_7_1\n          };\n        } finally {\n          try {\n            if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n          } finally {\n            if (e_7) throw e_7.error;\n          }\n        }\n      }\n\n      return this.__cache.events = Array.from(events);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"ownEvents\", {\n    /**\r\n     * All the events that have transitions directly from this state node.\r\n     *\r\n     * Excludes any inert events.\r\n     */\n    get: function () {\n      var events = new Set(this.transitions.filter(function (transition) {\n        return !(!transition.target && !transition.actions.length && transition.internal);\n      }).map(function (transition) {\n        return transition.eventType;\n      }));\n      return Array.from(events);\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  StateNode.prototype.resolveTarget = function (_target) {\n    var _this = this;\n\n    if (_target === undefined) {\n      // an undefined target signals that the state node should not transition from that state when receiving that event\n      return undefined;\n    }\n\n    return _target.map(function (target) {\n      if (!isString(target)) {\n        return target;\n      }\n\n      var isInternalTarget = target[0] === _this.delimiter; // If internal target is defined on machine,\n      // do not include machine key on target\n\n      if (isInternalTarget && !_this.parent) {\n        return _this.getStateNodeByPath(target.slice(1));\n      }\n\n      var resolvedTarget = isInternalTarget ? _this.key + target : target;\n\n      if (_this.parent) {\n        try {\n          var targetStateNode = _this.parent.getStateNodeByPath(resolvedTarget);\n\n          return targetStateNode;\n        } catch (err) {\n          throw new Error(\"Invalid transition definition for state node '\" + _this.id + \"':\\n\" + err.message);\n        }\n      } else {\n        return _this.getStateNodeByPath(resolvedTarget);\n      }\n    });\n  };\n\n  StateNode.prototype.formatTransition = function (transitionConfig) {\n    var _this = this;\n\n    var normalizedTarget = normalizeTarget(transitionConfig.target);\n    var internal = 'internal' in transitionConfig ? transitionConfig.internal : normalizedTarget ? normalizedTarget.some(function (_target) {\n      return isString(_target) && _target[0] === _this.delimiter;\n    }) : true;\n    var guards = this.machine.options.guards;\n    var target = this.resolveTarget(normalizedTarget);\n\n    var transition = __assign(__assign({}, transitionConfig), {\n      actions: toActionObjects(toArray(transitionConfig.actions)),\n      cond: toGuard(transitionConfig.cond, guards),\n      target: target,\n      source: this,\n      internal: internal,\n      eventType: transitionConfig.event,\n      toJSON: function () {\n        return __assign(__assign({}, transition), {\n          target: transition.target ? transition.target.map(function (t) {\n            return \"#\" + t.id;\n          }) : undefined,\n          source: \"#\" + _this.id\n        });\n      }\n    });\n\n    return transition;\n  };\n\n  StateNode.prototype.formatTransitions = function () {\n    var e_9, _a;\n\n    var _this = this;\n\n    var onConfig;\n\n    if (!this.config.on) {\n      onConfig = [];\n    } else if (Array.isArray(this.config.on)) {\n      onConfig = this.config.on;\n    } else {\n      var _b = this.config.on,\n          _c = WILDCARD,\n          _d = _b[_c],\n          wildcardConfigs = _d === void 0 ? [] : _d,\n          strictTransitionConfigs_1 = __rest(_b, [typeof _c === \"symbol\" ? _c : _c + \"\"]);\n\n      onConfig = flatten(keys(strictTransitionConfigs_1).map(function (key) {\n        if (!IS_PRODUCTION && key === NULL_EVENT) {\n          warn(false, \"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. \" + (\"Please check the `on` configuration for \\\"#\" + _this.id + \"\\\".\"));\n        }\n\n        var transitionConfigArray = toTransitionConfigArray(key, strictTransitionConfigs_1[key]);\n\n        if (!IS_PRODUCTION) {\n          validateArrayifiedTransitions(_this, key, transitionConfigArray);\n        }\n\n        return transitionConfigArray;\n      }).concat(toTransitionConfigArray(WILDCARD, wildcardConfigs)));\n    }\n\n    var eventlessConfig = this.config.always ? toTransitionConfigArray('', this.config.always) : [];\n    var doneConfig = this.config.onDone ? toTransitionConfigArray(String(done(this.id)), this.config.onDone) : [];\n\n    if (!IS_PRODUCTION) {\n      warn(!(this.config.onDone && !this.parent), \"Root nodes cannot have an \\\".onDone\\\" transition. Please check the config of \\\"\" + this.id + \"\\\".\");\n    }\n\n    var invokeConfig = flatten(this.invoke.map(function (invokeDef) {\n      var settleTransitions = [];\n\n      if (invokeDef.onDone) {\n        settleTransitions.push.apply(settleTransitions, __spread(toTransitionConfigArray(String(doneInvoke(invokeDef.id)), invokeDef.onDone)));\n      }\n\n      if (invokeDef.onError) {\n        settleTransitions.push.apply(settleTransitions, __spread(toTransitionConfigArray(String(error(invokeDef.id)), invokeDef.onError)));\n      }\n\n      return settleTransitions;\n    }));\n    var delayedTransitions = this.after;\n    var formattedTransitions = flatten(__spread(doneConfig, invokeConfig, onConfig, eventlessConfig).map(function (transitionConfig) {\n      return toArray(transitionConfig).map(function (transition) {\n        return _this.formatTransition(transition);\n      });\n    }));\n\n    try {\n      for (var delayedTransitions_1 = __values(delayedTransitions), delayedTransitions_1_1 = delayedTransitions_1.next(); !delayedTransitions_1_1.done; delayedTransitions_1_1 = delayedTransitions_1.next()) {\n        var delayedTransition = delayedTransitions_1_1.value;\n        formattedTransitions.push(delayedTransition);\n      }\n    } catch (e_9_1) {\n      e_9 = {\n        error: e_9_1\n      };\n    } finally {\n      try {\n        if (delayedTransitions_1_1 && !delayedTransitions_1_1.done && (_a = delayedTransitions_1.return)) _a.call(delayedTransitions_1);\n      } finally {\n        if (e_9) throw e_9.error;\n      }\n    }\n\n    return formattedTransitions;\n  };\n\n  return StateNode;\n}();\n\nexport { StateNode };","import { StateNode } from './StateNode.js';\n\nfunction Machine(config, options, initialContext) {\n  if (initialContext === void 0) {\n    initialContext = config.context;\n  }\n\n  var resolvedInitialContext = typeof initialContext === 'function' ? initialContext() : initialContext;\n  return new StateNode(config, options, resolvedInitialContext);\n}\n\nfunction createMachine(config, options) {\n  var resolvedInitialContext = typeof config.context === 'function' ? config.context() : config.context;\n  return new StateNode(config, options, resolvedInitialContext);\n}\n\nexport { Machine, createMachine };","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nfunction __rest(s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n}\n\nfunction __values(o) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator],\n      i = 0;\n  if (m) return m.call(o);\n  return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n}\n\nfunction __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n}\n\nfunction __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n}\n\nexport { __assign, __read, __rest, __spread, __values };","import { __spread, __values, __read, __assign } from './_virtual/_tslib.js';\nimport { DEFAULT_GUARD_TYPE, TARGETLESS_KEY, STATE_DELIMITER } from './constants.js';\nimport { IS_PRODUCTION } from './environment.js';\n\nfunction keys(value) {\n  return Object.keys(value);\n}\n\nfunction matchesState(parentStateId, childStateId, delimiter) {\n  if (delimiter === void 0) {\n    delimiter = STATE_DELIMITER;\n  }\n\n  var parentStateValue = toStateValue(parentStateId, delimiter);\n  var childStateValue = toStateValue(childStateId, delimiter);\n\n  if (isString(childStateValue)) {\n    if (isString(parentStateValue)) {\n      return childStateValue === parentStateValue;\n    } // Parent more specific than child\n\n\n    return false;\n  }\n\n  if (isString(parentStateValue)) {\n    return parentStateValue in childStateValue;\n  }\n\n  return keys(parentStateValue).every(function (key) {\n    if (!(key in childStateValue)) {\n      return false;\n    }\n\n    return matchesState(parentStateValue[key], childStateValue[key]);\n  });\n}\n\nfunction getEventType(event) {\n  try {\n    return isString(event) || typeof event === 'number' ? \"\" + event : event.type;\n  } catch (e) {\n    throw new Error('Events must be strings or objects with a string event.type property.');\n  }\n}\n\nfunction toStatePath(stateId, delimiter) {\n  try {\n    if (isArray(stateId)) {\n      return stateId;\n    }\n\n    return stateId.toString().split(delimiter);\n  } catch (e) {\n    throw new Error(\"'\" + stateId + \"' is not a valid state path.\");\n  }\n}\n\nfunction isStateLike(state) {\n  return typeof state === 'object' && 'value' in state && 'context' in state && 'event' in state && '_event' in state;\n}\n\nfunction toStateValue(stateValue, delimiter) {\n  if (isStateLike(stateValue)) {\n    return stateValue.value;\n  }\n\n  if (isArray(stateValue)) {\n    return pathToStateValue(stateValue);\n  }\n\n  if (typeof stateValue !== 'string') {\n    return stateValue;\n  }\n\n  var statePath = toStatePath(stateValue, delimiter);\n  return pathToStateValue(statePath);\n}\n\nfunction pathToStateValue(statePath) {\n  if (statePath.length === 1) {\n    return statePath[0];\n  }\n\n  var value = {};\n  var marker = value;\n\n  for (var i = 0; i < statePath.length - 1; i++) {\n    if (i === statePath.length - 2) {\n      marker[statePath[i]] = statePath[i + 1];\n    } else {\n      marker[statePath[i]] = {};\n      marker = marker[statePath[i]];\n    }\n  }\n\n  return value;\n}\n\nfunction mapValues(collection, iteratee) {\n  var result = {};\n  var collectionKeys = keys(collection);\n\n  for (var i = 0; i < collectionKeys.length; i++) {\n    var key = collectionKeys[i];\n    result[key] = iteratee(collection[key], key, collection, i);\n  }\n\n  return result;\n}\n\nfunction mapFilterValues(collection, iteratee, predicate) {\n  var e_1, _a;\n\n  var result = {};\n\n  try {\n    for (var _b = __values(keys(collection)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var key = _c.value;\n      var item = collection[key];\n\n      if (!predicate(item)) {\n        continue;\n      }\n\n      result[key] = iteratee(item, key, collection);\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return result;\n}\n/**\r\n * Retrieves a value at the given path.\r\n * @param props The deep path to the prop of the desired value\r\n */\n\n\nvar path = function (props) {\n  return function (object) {\n    var e_2, _a;\n\n    var result = object;\n\n    try {\n      for (var props_1 = __values(props), props_1_1 = props_1.next(); !props_1_1.done; props_1_1 = props_1.next()) {\n        var prop = props_1_1.value;\n        result = result[prop];\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (props_1_1 && !props_1_1.done && (_a = props_1.return)) _a.call(props_1);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    return result;\n  };\n};\n/**\r\n * Retrieves a value at the given path via the nested accessor prop.\r\n * @param props The deep path to the prop of the desired value\r\n */\n\n\nfunction nestedPath(props, accessorProp) {\n  return function (object) {\n    var e_3, _a;\n\n    var result = object;\n\n    try {\n      for (var props_2 = __values(props), props_2_1 = props_2.next(); !props_2_1.done; props_2_1 = props_2.next()) {\n        var prop = props_2_1.value;\n        result = result[accessorProp][prop];\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (props_2_1 && !props_2_1.done && (_a = props_2.return)) _a.call(props_2);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    return result;\n  };\n}\n\nfunction toStatePaths(stateValue) {\n  if (!stateValue) {\n    return [[]];\n  }\n\n  if (isString(stateValue)) {\n    return [[stateValue]];\n  }\n\n  var result = flatten(keys(stateValue).map(function (key) {\n    var subStateValue = stateValue[key];\n\n    if (typeof subStateValue !== 'string' && (!subStateValue || !Object.keys(subStateValue).length)) {\n      return [[key]];\n    }\n\n    return toStatePaths(stateValue[key]).map(function (subPath) {\n      return [key].concat(subPath);\n    });\n  }));\n  return result;\n}\n\nfunction flatten(array) {\n  var _a;\n\n  return (_a = []).concat.apply(_a, __spread(array));\n}\n\nfunction toArrayStrict(value) {\n  if (isArray(value)) {\n    return value;\n  }\n\n  return [value];\n}\n\nfunction toArray(value) {\n  if (value === undefined) {\n    return [];\n  }\n\n  return toArrayStrict(value);\n}\n\nfunction mapContext(mapper, context, _event) {\n  var e_5, _a;\n\n  if (isFunction(mapper)) {\n    return mapper(context, _event.data);\n  }\n\n  var result = {};\n\n  try {\n    for (var _b = __values(Object.keys(mapper)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var key = _c.value;\n      var subMapper = mapper[key];\n\n      if (isFunction(subMapper)) {\n        result[key] = subMapper(context, _event.data);\n      } else {\n        result[key] = subMapper;\n      }\n    }\n  } catch (e_5_1) {\n    e_5 = {\n      error: e_5_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_5) throw e_5.error;\n    }\n  }\n\n  return result;\n}\n\nfunction isBuiltInEvent(eventType) {\n  return /^(done|error)\\./.test(eventType);\n}\n\nfunction isPromiseLike(value) {\n  if (value instanceof Promise) {\n    return true;\n  } // Check if shape matches the Promise/A+ specification for a \"thenable\".\n\n\n  if (value !== null && (isFunction(value) || typeof value === 'object') && isFunction(value.then)) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction partition(items, predicate) {\n  var e_6, _a;\n\n  var _b = __read([[], []], 2),\n      truthy = _b[0],\n      falsy = _b[1];\n\n  try {\n    for (var items_1 = __values(items), items_1_1 = items_1.next(); !items_1_1.done; items_1_1 = items_1.next()) {\n      var item = items_1_1.value;\n\n      if (predicate(item)) {\n        truthy.push(item);\n      } else {\n        falsy.push(item);\n      }\n    }\n  } catch (e_6_1) {\n    e_6 = {\n      error: e_6_1\n    };\n  } finally {\n    try {\n      if (items_1_1 && !items_1_1.done && (_a = items_1.return)) _a.call(items_1);\n    } finally {\n      if (e_6) throw e_6.error;\n    }\n  }\n\n  return [truthy, falsy];\n}\n\nfunction updateHistoryStates(hist, stateValue) {\n  return mapValues(hist.states, function (subHist, key) {\n    if (!subHist) {\n      return undefined;\n    }\n\n    var subStateValue = (isString(stateValue) ? undefined : stateValue[key]) || (subHist ? subHist.current : undefined);\n\n    if (!subStateValue) {\n      return undefined;\n    }\n\n    return {\n      current: subStateValue,\n      states: updateHistoryStates(subHist, subStateValue)\n    };\n  });\n}\n\nfunction updateHistoryValue(hist, stateValue) {\n  return {\n    current: stateValue,\n    states: updateHistoryStates(hist, stateValue)\n  };\n}\n\nfunction updateContext(context, _event, assignActions, state) {\n  if (!IS_PRODUCTION) {\n    warn(!!context, 'Attempting to update undefined context');\n  }\n\n  var updatedContext = context ? assignActions.reduce(function (acc, assignAction) {\n    var e_7, _a;\n\n    var assignment = assignAction.assignment;\n    var meta = {\n      state: state,\n      action: assignAction,\n      _event: _event\n    };\n    var partialUpdate = {};\n\n    if (isFunction(assignment)) {\n      partialUpdate = assignment(acc, _event.data, meta);\n    } else {\n      try {\n        for (var _b = __values(keys(assignment)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var key = _c.value;\n          var propAssignment = assignment[key];\n          partialUpdate[key] = isFunction(propAssignment) ? propAssignment(acc, _event.data, meta) : propAssignment;\n        }\n      } catch (e_7_1) {\n        e_7 = {\n          error: e_7_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_7) throw e_7.error;\n        }\n      }\n    }\n\n    return Object.assign({}, acc, partialUpdate);\n  }, context) : context;\n  return updatedContext;\n} // tslint:disable-next-line:no-empty\n\n\nvar warn = function () {};\n\nif (!IS_PRODUCTION) {\n  warn = function (condition, message) {\n    var error = condition instanceof Error ? condition : undefined;\n\n    if (!error && condition) {\n      return;\n    }\n\n    if (console !== undefined) {\n      var args = [\"Warning: \" + message];\n\n      if (error) {\n        args.push(error);\n      } // tslint:disable-next-line:no-console\n\n\n      console.warn.apply(console, args);\n    }\n  };\n}\n\nfunction isArray(value) {\n  return Array.isArray(value);\n} // tslint:disable-next-line:ban-types\n\n\nfunction isFunction(value) {\n  return typeof value === 'function';\n}\n\nfunction isString(value) {\n  return typeof value === 'string';\n} // export function memoizedGetter<T, TP extends { prototype: object }>(\n//   o: TP,\n//   property: string,\n//   getter: () => T\n// ): void {\n//   Object.defineProperty(o.prototype, property, {\n//     get: getter,\n//     enumerable: false,\n//     configurable: false\n//   });\n// }\n\n\nfunction toGuard(condition, guardMap) {\n  if (!condition) {\n    return undefined;\n  }\n\n  if (isString(condition)) {\n    return {\n      type: DEFAULT_GUARD_TYPE,\n      name: condition,\n      predicate: guardMap ? guardMap[condition] : undefined\n    };\n  }\n\n  if (isFunction(condition)) {\n    return {\n      type: DEFAULT_GUARD_TYPE,\n      name: condition.name,\n      predicate: condition\n    };\n  }\n\n  return condition;\n}\n\nfunction isObservable(value) {\n  try {\n    return 'subscribe' in value && isFunction(value.subscribe);\n  } catch (e) {\n    return false;\n  }\n}\n\nvar symbolObservable = /*#__PURE__*/function () {\n  return typeof Symbol === 'function' && Symbol.observable || '@@observable';\n}();\n\nfunction isMachine(value) {\n  try {\n    return '__xstatenode' in value;\n  } catch (e) {\n    return false;\n  }\n}\n\nvar uniqueId = /*#__PURE__*/function () {\n  var currentId = 0;\n  return function () {\n    currentId++;\n    return currentId.toString(16);\n  };\n}();\n\nfunction toEventObject(event, payload // id?: TEvent['type']\n) {\n  if (isString(event) || typeof event === 'number') {\n    return __assign({\n      type: event\n    }, payload);\n  }\n\n  return event;\n}\n\nfunction toSCXMLEvent(event, scxmlEvent) {\n  if (!isString(event) && '$$type' in event && event.$$type === 'scxml') {\n    return event;\n  }\n\n  var eventObject = toEventObject(event);\n  return __assign({\n    name: eventObject.type,\n    data: eventObject,\n    $$type: 'scxml',\n    type: 'external'\n  }, scxmlEvent);\n}\n\nfunction toTransitionConfigArray(event, configLike) {\n  var transitions = toArrayStrict(configLike).map(function (transitionLike) {\n    if (typeof transitionLike === 'undefined' || typeof transitionLike === 'string' || isMachine(transitionLike)) {\n      // @ts-ignore until Type instantiation is excessively deep and possibly infinite bug is fixed\n      return {\n        target: transitionLike,\n        event: event\n      };\n    }\n\n    return __assign(__assign({}, transitionLike), {\n      event: event\n    });\n  });\n  return transitions;\n}\n\nfunction normalizeTarget(target) {\n  if (target === undefined || target === TARGETLESS_KEY) {\n    return undefined;\n  }\n\n  return toArray(target);\n}\n\nfunction reportUnhandledExceptionOnInvocation(originalError, currentError, id) {\n  if (!IS_PRODUCTION) {\n    var originalStackTrace = originalError.stack ? \" Stacktrace was '\" + originalError.stack + \"'\" : '';\n\n    if (originalError === currentError) {\n      // tslint:disable-next-line:no-console\n      console.error(\"Missing onError handler for invocation '\" + id + \"', error was '\" + originalError + \"'.\" + originalStackTrace);\n    } else {\n      var stackTrace = currentError.stack ? \" Stacktrace was '\" + currentError.stack + \"'\" : ''; // tslint:disable-next-line:no-console\n\n      console.error(\"Missing onError handler and/or unhandled exception/promise rejection for invocation '\" + id + \"'. \" + (\"Original error: '\" + originalError + \"'. \" + originalStackTrace + \" Current error is '\" + currentError + \"'.\" + stackTrace));\n    }\n  }\n}\n\nfunction evaluateGuard(machine, guard, context, _event, state) {\n  var guards = machine.options.guards;\n  var guardMeta = {\n    state: state,\n    cond: guard,\n    _event: _event\n  }; // TODO: do not hardcode!\n\n  if (guard.type === DEFAULT_GUARD_TYPE) {\n    return guard.predicate(context, _event.data, guardMeta);\n  }\n\n  var condFn = guards[guard.type];\n\n  if (!condFn) {\n    throw new Error(\"Guard '\" + guard.type + \"' is not implemented on machine '\" + machine.id + \"'.\");\n  }\n\n  return condFn(context, _event.data, guardMeta);\n}\n\nexport { evaluateGuard, flatten, getEventType, isArray, isBuiltInEvent, isFunction, isMachine, isObservable, isPromiseLike, isStateLike, isString, keys, mapContext, mapFilterValues, mapValues, matchesState, nestedPath, normalizeTarget, partition, path, pathToStateValue, reportUnhandledExceptionOnInvocation, symbolObservable, toArray, toArrayStrict, toEventObject, toGuard, toSCXMLEvent, toStatePath, toStatePaths, toStateValue, toTransitionConfigArray, uniqueId, updateContext, updateHistoryStates, updateHistoryValue, warn };"],"sourceRoot":""}