(self.webpackChunkkoku_ui=self.webpackChunkkoku_ui||[]).push([[9612],{88482:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Re});var n=a(11762),l=a(97522),r=a.n(l),s=a(86588),o=a(87932),i=a(99627),c=a(46462),m=a(55399),u=a(1244);const d={limit:10,offset:0,ordering:null,name:null,source_type:null,description:null};function p(e){return Object.keys(e).reduce(((t,a)=>null===e[a]?t:""===t?`?${a}=${e[a]}`:`${t}&${a}=${e[a]}`),"")}function g(e,t){return(e-1)*t}Object.keys(d);const _=(0,m.withRouter)((0,s.connect)((e=>{const{count:t,page:a,perPage:n}=o.E6.pagination(e);return{query:o.E6.query(e),count:t,page:a,perPage:n}}),void 0,((e,t,a)=>{const{history:{push:l}}=a,{count:r,page:s,perPage:o,query:i}=e;return{itemCount:r,page:s,perPage:o,variant:n.PaginationVariant.bottom,onSetPage:(e,t,a)=>{l(p(Object.assign(Object.assign(Object.assign({},d),i),{offset:g(t,a)})))},onPerPageSelect:(e,t)=>{l(p(Object.assign(Object.assign(Object.assign({},d),i),{limit:t,offset:0})))}}}))((function(e){const{variant:t,itemCount:a,page:l,perPage:s,onSetPage:o,onPerPageSelect:i}=e;return r().createElement(n.Toolbar,null,r().createElement(n.ToolbarContent,null,r().createElement(n.ToolbarItem,{variant:n.ToolbarItemVariant.pagination},r().createElement(n.Pagination,{onPerPageSelect:i,onSetPage:o,variant:t,itemCount:a,page:l,perPage:s}))))})));var h=a(20546),E=a(19694),y=a(6813),b=a(79878),S=a(94377),T=a(901),C=a(5144);const v=r().createContext({metricsHash:{},step:1,type:"",name:"",dirtyName:!1,markup:"",description:"",error:null,apiError:null,sources:[],onTypeChange:e=>null,onNameChange:e=>null,onDescChange:e=>null,onMarkupChange:e=>null,onSourceSelect:(...e)=>null,setSources:e=>null,dataFetched:!1,loading:!1,filterName:"",onFilterChange:e=>null,query:{},clearQuery:()=>null,total:0,page:1,perPage:10,onPageChange:(e,t)=>null,onPerPageChange:(e,t)=>null,tiers:[],goToAddPL:e=>null,submitTiers:e=>null,priceListPagination:{page:1,perPage:4,onPerPageSet:(e,t)=>null,onPageSet:(e,t)=>null},fetchSources:(e,t,a,n)=>null,createError:null,createSuccess:!1,onClose:()=>null,createProcess:!1});var w=a(88485),f=a(51508);const P={form:{width:"350px"},textArea:{maxWidth:"450px",minWidth:"350px",minHeight:"75px",maxHeight:"150px"}},k=(0,b.withTranslation)()((({t:e})=>r().createElement(v.Consumer,null,(({name:t,dirtyName:a,description:l,type:s,onNameChange:o,onDescChange:i,onTypeChange:c})=>r().createElement(n.Stack,{hasGutter:!0},r().createElement(n.StackItem,null,r().createElement(n.Title,{headingLevel:"h2",size:"xl"},e("cost_models_wizard.general_info.title"))),r().createElement(n.StackItem,null,r().createElement("a",{href:e("docs.config_cost_models"),target:"blank"},e("cost_models_wizard.general_info.learn_more"))),r().createElement(n.StackItem,null,r().createElement(f.l,{style:P.form},r().createElement(n.FormGroup,{helperTextInvalid:e(le(t)),validated:null!==le(t)&&a?"error":"default",label:e("cost_models_wizard.general_info.name_label"),isRequired:!0,fieldId:"name"},r().createElement(n.TextInput,{validated:null!==le(t)&&a?"error":"default",isRequired:!0,type:"text",id:"name",name:"name",value:t,onChange:o})),r().createElement(n.FormGroup,{helperTextInvalid:e(re(l)),validated:null===re(l)?"default":"error",label:e("cost_models_wizard.general_info.description_label"),fieldId:"description"},r().createElement(n.TextArea,{style:P.textArea,type:"text",id:"description",name:"description",value:l,validated:null===re(l)?"default":"error",onChange:i})),r().createElement(n.FormGroup,{label:e("cost_models_wizard.general_info.source_type_label"),isRequired:!0,fieldId:"source-type"},r().createElement(n.FormSelect,{id:"source-type",value:s,onChange:c},r().createElement(n.FormSelectOption,{value:"",label:e("cost_models_wizard.general_info.source_type_empty_value_label")}),r().createElement(n.FormSelectOption,{value:"AWS",label:e("onboarding.type_options.aws")}),r().createElement(n.FormSelectOption,{value:"AZURE",label:e("onboarding.type_options.azure")}),r().createElement(n.FormSelectOption,{value:"GCP",label:e("onboarding.type_options.gcp")}),r().createElement(n.FormSelectOption,{value:"OCP",label:e("onboarding.type_options.ocp")}))))))))));class x extends r().Component{constructor(){super(...arguments),this.state={isValid:!0}}render(){const{t:e}=this.props,{isValid:t}=this.state;return r().createElement(v.Consumer,null,(({onMarkupChange:a,markup:l})=>r().createElement(n.Stack,{hasGutter:!0},r().createElement(n.StackItem,null,r().createElement(n.Title,{headingLevel:"h2",size:"xl"},e("cost_models_wizard.markup.title"))),r().createElement(n.StackItem,null,r().createElement(n.TextContent,null,r().createElement(n.Text,{component:n.TextVariants.h6},e("cost_models_wizard.markup.sub_title")))),r().createElement(n.StackItem,null,r().createElement(f.l,null,r().createElement(n.FormGroup,{label:e("cost_models_wizard.markup.markup_label"),fieldId:"markup",helperTextInvalid:e("cost_models_wizard.markup.invalid_markup_text"),validated:t?"default":"error"},r().createElement(n.InputGroup,{style:{width:"150px"}},r().createElement(n.TextInput,{type:"text",id:"markup",name:"markup",value:l,onBlur:()=>{this.setState({isValid:!isNaN(Number(l))})},onChange:e=>{a(e),"-"!==e&&this.setState({isValid:!isNaN(Number(e))})},validated:t?"default":"error"}),r().createElement(n.InputGroupText,{style:{borderLeft:"0"}},"%"))))))))}}const z=(0,b.withTranslation)()(x);var O=a(52591);const I=({submitRate:e,cancel:t,metricsHash:a})=>{const{tiers:l}=r().useContext(v),{t:s}=(0,b.useTranslation)(),o=(0,O.bF)(a,void 0,l),i=r().useMemo((()=>(0,O.Cw)(o)),[o.errors,o.rateKind]);return r().createElement(n.Stack,{hasGutter:!0},r().createElement(n.StackItem,null,r().createElement(n.Title,{headingLevel:"h2",size:"xl"},s("cost_models_wizard.price_list.title"))),r().createElement(n.StackItem,null,r().createElement(n.TextContent,null,r().createElement(n.Text,{component:n.TextVariants.h6},s("cost_models_wizard.price_list.sub_title_add")))),r().createElement(n.StackItem,null,r().createElement(n.Form,null,r().createElement(O.HJ,{metricsHash:a,rateFormData:o}))),r().createElement(n.StackItem,null,r().createElement(n.ActionGroup,null,r().createElement(n.Button,{variant:n.ButtonVariant.primary,isDisabled:!i,onClick:()=>e(o)},s("cost_models_wizard.price_list.create_rate")),r().createElement(n.Button,{variant:n.ButtonVariant.link,onClick:t},s("cost_models_wizard.price_list.cancel")))))};var j=a(20777),D=a(55483),F=a(77656),L=a(80963),N=a(66555),B=a(39574),V=a(85218),q=a(60477);const M=({t:e})=>r().createElement(n.Bullseye,null,r().createElement(n.EmptyState,null,r().createElement(n.EmptyStateIcon,{icon:j.wl}),r().createElement(n.Title,{headingLevel:"h2",size:"lg"},e("cost_models_wizard.empty_state.title")),r().createElement(n.EmptyStateBody,null,r().createElement(b.Trans,{i18nKey:"cost_models_wizard.empty_state.desc_create"},r().createElement("strong",null,e("cost_models_wizard.empty_state.add_rate"))),r().createElement("br",null),r().createElement(b.Trans,{i18nKey:"cost_models_wizard.empty_state.desc_skip"},r().createElement("strong",null,e("cost_models_wizard.empty_state.next"))),r().createElement("br",null),r().createElement(b.Trans,{i18nKey:"cost_models_wizard.empty_state.desc_other_time"}))));class A extends r().Component{constructor(){super(...arguments),this.state={metrics:[],measurements:[]}}render(){const{metricsHash:e,t,addRateAction:a,deleteRateAction:l,items:s}=this.props,o=Object.keys(e).map((e=>({label:e,value:e}))),i=o.reduce(((t,a)=>{const n=Object.keys(e[a.value]).filter((e=>!t.map((e=>e.value)).includes(e))).map((e=>({label:e,value:e})));return[...t,...n]}),[]);return r().createElement(v.Consumer,null,(({priceListPagination:e})=>r().createElement(n.Stack,{hasGutter:!0},r().createElement(n.StackItem,null,r().createElement(n.Title,{headingLevel:"h2",size:"xl"},t("cost_models_wizard.price_list.title"))),r().createElement(n.StackItem,null,r().createElement(n.TextContent,null,r().createElement(n.Text,{component:n.TextVariants.h6},t("cost_models_wizard.price_list.sub_title_table")))),r().createElement(n.StackItem,null,r().createElement(F.j,{initialFilters:{primary:"metrics",metrics:[],measurements:[]}},(({search:c,setSearch:m,onRemove:u,onSelect:d,onClearAll:p})=>{const g=(e.page-1)*e.perPage,_=e.page*e.perPage,h=s.filter((e=>0===c.metrics.length||c.metrics.includes(e.metric.label_metric))).filter((e=>0===c.measurements.length||c.measurements.includes(e.metric.label_measurement))),E=h.slice(g,_);return r().createElement(r().Fragment,null,r().createElement(N.Q,{primary:r().createElement(q.J,{isDisabled:0===s.length,primary:c.primary,setPrimary:e=>m({primary:e}),options:[{label:t("toolbar.pricelist.metric"),value:"metrics"},{label:t("toolbar.pricelist.measurement"),value:"measurements"}]}),selected:c.primary,secondaries:[{component:r().createElement(V.n,{isDisabled:0===s.length,placeholderText:t("toolbar.pricelist.measurement_placeholder"),selections:c.measurements,setSelections:e=>d("measurements",e),options:i}),name:"measurements",onRemove:u,filters:c.measurements},{component:r().createElement(V.n,{isDisabled:0===s.length,placeholderText:t("toolbar.pricelist.metric_placeholder"),selections:c.metrics,setSelections:e=>d("metrics",e),options:o}),name:"metrics",onRemove:u,filters:c.metrics}],button:r().createElement(n.Button,{onClick:a},t("cost_models_wizard.price_list.create_rate")),onClear:p,pagination:r().createElement(n.Pagination,{isCompact:!0,itemCount:h.length,perPage:e.perPage,page:e.page,onSetPage:e.onPageSet,onPerPageSelect:e.onPerPageSet})}),0===E.length&&(0!==this.state.metrics.length||0!==this.state.measurements.length)&&r().createElement(n.Bullseye,null,r().createElement(D.c,{filter:t("cost_models_wizard.price_list.toolbar_top_results_aria_label")})),0===E.length&&0===this.state.metrics.length&&0===this.state.measurements.length&&r().createElement(M,{t}),E.length>0&&r().createElement(B.y,{isCompact:!0,t,tiers:E,actions:[{title:"Remove",onClick:(e,t,a)=>{l(a.data.index+g)}}]}),r().createElement(L.Z,{isCompact:!0,itemCount:h.length,perPage:e.perPage,page:e.page,onSetPage:e.onPageSet,onPerPageSelect:e.onPerPageSet}))}))))))}}const R=(0,s.connect)((0,S.X1)((e=>({metricsHash:i.qw.metrics(e)}))))((0,b.withTranslation)()(A)),W=()=>{const{metricsHash:e,tiers:t,submitTiers:a,goToAddPL:n}=r().useContext(v),[l,s]=r().useState("table");return"table"===l?r().createElement(R,{items:t,deleteRateAction:e=>{const l=[...t.slice(0,e),...t.slice(e+1)];a(l),0===l.length&&(s("form"),n(!1))},addRateAction:()=>{s("form"),n(!1)}}):"form"===l?r().createElement(I,{metricsHash:e,submitRate:l=>{var r;r=(0,O.Nl)(l,e),a([...t,r]),s("table"),n(!0)},cancel:()=>{s("table"),n(!0)}}):null};var G=a(78091),$=a(39887);const H=(0,b.withTranslation)()((({t:e})=>r().createElement(v.Consumer,null,(({onClose:t,name:a})=>r().createElement(n.EmptyState,null,r().createElement(n.EmptyStateIcon,{icon:G.xX,color:"green"}),r().createElement(n.Title,{headingLevel:"h2",size:"lg"},e("cost_models_wizard.review.title_success")),r().createElement(n.EmptyStateBody,null,e("cost_models_wizard.review.sub_title_success",{cost_model:a})),r().createElement(n.EmptyStateSecondaryActions,null,r().createElement(n.Button,{variant:"link",onClick:t},e("cost_models_wizard.review.close_button")))))))),K=(0,b.withTranslation)()((({t:e})=>r().createElement(v.Consumer,null,(({name:t,description:a,type:l,markup:s,sources:o,tiers:i,createError:c})=>r().createElement(r().Fragment,null,c&&r().createElement(n.Alert,{variant:"danger",title:`${c}`}),r().createElement(n.Stack,{hasGutter:!0},r().createElement(n.StackItem,null,r().createElement(n.Title,{headingLevel:"h2",size:"xl"},e("cost_models_wizard.review.title_details"))),r().createElement(n.StackItem,null,r().createElement(n.TextContent,null,r().createElement(n.Text,{component:n.TextVariants.h6},r().createElement(b.Trans,{i18nKey:"cost_models_wizard.review.sub_title_details"},r().createElement("b",null,e("cost_models_wizard.review.create_button")),r().createElement("b",null,e("cost_models_wizard.review.back_button")))))),r().createElement(n.StackItem,null,r().createElement(n.TextContent,null,r().createElement(n.TextList,{component:n.TextListVariants.dl},r().createElement(n.TextListItem,{component:n.TextListItemVariants.dt},e("cost_models_wizard.general_info.name_label")),r().createElement(n.TextListItem,{component:n.TextListItemVariants.dd},t),r().createElement(n.TextListItem,{component:n.TextListItemVariants.dt},e("cost_models_wizard.general_info.description_label")),r().createElement(n.TextListItem,{component:n.TextListItemVariants.dd},a),"OCP"===l&&r().createElement(r().Fragment,null,r().createElement(n.TextListItem,{component:n.TextListItemVariants.dt},e("cost_models_wizard.steps.price_list")),r().createElement(n.TextListItem,{component:n.TextListItemVariants.dd},i.length>0?r().createElement(B.y,{t:e,tiers:i}):e("cost_models_wizard.no_rates"))),r().createElement(n.TextListItem,{component:n.TextListItemVariants.dt},e("cost_models_wizard.review.markup")),r().createElement(n.TextListItem,{component:n.TextListItemVariants.dd},s,"%"),r().createElement(n.TextListItem,{component:n.TextListItemVariants.dt},e("cost_models_wizard.review.sources")," ",o.find((e=>e.selected&&Boolean(e.costmodel)))&&r().createElement($.a,{text:e("cost_models_wizard.warning_override_sources")})),r().createElement(n.TextListItem,{component:n.TextListItemVariants.dd},o.filter((e=>e.selected)).map((e=>e.name)).join(", "))))))))))),Z=()=>r().createElement(v.Consumer,null,(({createSuccess:e})=>e?r().createElement(H,null):r().createElement(K,null)));var U=a(52413),J=a(27916),Q=a(10209),X=a(48794);const Y=({id:e,placeholder:t="",value:a,onChange:l,onSearch:s})=>r().createElement(n.InputGroup,null,r().createElement(n.TextInput,{value:a,placeholder:t,id:e,onChange:l,onKeyPress:e=>{"Enter"===e.key&&""!==a&&s(e)}}),r().createElement(n.InputGroupText,{style:{borderLeft:"0"}},r().createElement(X.W1,null))),ee=(0,b.withTranslation)()((({t:e,searchInputProps:t,paginationProps:a,filter:l})=>r().createElement(n.Toolbar,{id:"assign-sources-toolbar",clearAllFilters:l.onClearAll},r().createElement(n.ToolbarContent,null,r().createElement(n.ToolbarItem,{variant:"search-filter"},r().createElement(n.ToolbarFilter,{deleteChip:l.onRemove,chips:l.query.name,categoryName:"name"},r().createElement(Y,Object.assign({placeholder:e("cost_models_wizard.source_table.filter_placeholder")},t)))),r().createElement(n.ToolbarItem,{variant:"pagination"},r().createElement(n.Pagination,{isCompact:a.isCompact,itemCount:a.itemCount,page:a.page,perPage:a.perPage,onSetPage:a.onSetPage,onPerPageSelect:a.onPerPageSelect})))))),te=(0,b.withTranslation)()((({t:e})=>r().createElement(v.Consumer,null,(({loading:t,onSourceSelect:a,sources:l,perPage:s,page:o,type:i,query:c,fetchSources:m,filterName:d,onFilterChange:p})=>{const g="AZURE"===i?"Azure":i;return r().createElement(n.Stack,{hasGutter:!0},r().createElement(n.StackItem,null,r().createElement(n.Title,{headingLevel:"h2",size:"xl"},e("cost_models_wizard.source.title"))),r().createElement(n.StackItem,null,r().createElement(n.TextContent,null,r().createElement(n.Text,{component:n.TextVariants.h6},e("cost_models_wizard.source.sub_title")))),r().createElement(n.StackItem,null,r().createElement(n.TextContent,null,r().createElement(n.Text,{component:n.TextVariants.h3},e("cost_models_wizard.source.caption",{type:e(`source_details.type.${i}`)})))),r().createElement(n.StackItem,null,r().createElement(ee,{filter:{onRemove:(e,t)=>m(g,(0,Q.fg)(c)(e,t),1,s),onClearAll:()=>m(g,{},1,s),query:c},searchInputProps:{id:"assign-source-search-input",value:d,onChange:p,onSearch:()=>{m(g,(0,Q.xZ)(c)("name",d),1,s)}},paginationProps:{isCompact:!0,itemCount:l.length,perPage:s,page:o,onSetPage:(e,t)=>{m(g,c,t,s)},onPerPageSelect:(e,t)=>m(g,c,1,t)}}),t?r().createElement(U.G,null):r().createElement(u.Table,{"aria-label":e("cost_models_wizard.source_table.table_aria_label"),cells:["",e("cost_models_wizard.source_table.column_name"),e("cost_models_wizard.source_table.column_cost_model")],rows:l.map(((t,l)=>({cells:[r().createElement(r().Fragment,null,r().createElement(n.Checkbox,{onChange:e=>{a(l,e)},id:t.name,key:t.name,isChecked:t.selected,isDisabled:Boolean(t.costmodel)})),r().createElement(r().Fragment,null,t.name," ",Boolean(t.costmodel)&&r().createElement($.a,{key:`wrng-${t.name}`,text:e("cost_models_wizard.warning_source",{cost_model:t.costmodel})})),t.costmodel?t.costmodel:""],selected:t.selected})))},r().createElement(u.TableHeader,null),r().createElement(u.TableBody,null)),r().createElement(L.N,{"aria-label":"cost_models_wizard.source_table.pagination_section_aria_label",itemCount:l.length,perPage:s,page:o,onSetPage:(e,t)=>{m(g,c,t,s)},onPerPageSelect:(e,t)=>m(g,c,1,t)})))}))));class ae extends r().Component{constructor(e){super(e),this.fetchData=()=>null,this.fetchData=()=>{const{type:e,query:t,page:a,perPage:n,fetchSources:l}=this.context;l("AZURE"===e?"Azure":e,t,a,n)}}componentDidMount(){const{dataFetched:e}=this.context;e||this.fetchData()}renderContent(){return this.context.loading?r().createElement(U.G,null):this.context.apiError?r().createElement(J.Bu,{onRefresh:this.fetchData}):r().createElement(te,null)}render(){return this.renderContent()}}ae.contextType=v;const ne=ae,le=e=>0===e.length?"cost_models_wizard.general_info.name_required":e.length>100?"cost_models_wizard.general_info.name_too_long":null,re=e=>e.length>500?"cost_models_wizard.general_info.description_too_long":null,se=e=>({"":[{id:1,name:e("cost_models_wizard.steps.general_info"),component:r().createElement(k,null)}],AZURE:[{id:1,name:e("cost_models_wizard.steps.general_info"),component:r().createElement(k,null)},{id:2,name:e("cost_models_wizard.steps.markup"),component:r().createElement(z,null)},{id:3,name:e("cost_models_wizard.steps.sources"),component:r().createElement(ne,null)},{id:4,name:e("cost_models_wizard.steps.review"),component:r().createElement(Z,null)}],AWS:[{id:1,name:e("cost_models_wizard.steps.general_info"),component:r().createElement(k,null)},{id:2,name:e("cost_models_wizard.steps.markup"),component:r().createElement(z,null)},{id:3,name:e("cost_models_wizard.steps.sources"),component:r().createElement(ne,null)},{id:4,name:e("cost_models_wizard.steps.review"),component:r().createElement(Z,null)}],GCP:[{id:1,name:e("cost_models_wizard.steps.general_info"),component:r().createElement(k,null)},{id:2,name:e("cost_models_wizard.steps.markup"),component:r().createElement(z,null)},{id:3,name:e("cost_models_wizard.steps.sources"),component:r().createElement(ne,null)},{id:4,name:e("cost_models_wizard.steps.review"),component:r().createElement(Z,null)}],OCP:[{id:1,name:e("cost_models_wizard.steps.general_info"),component:r().createElement(k,null)},{id:2,name:e("cost_models_wizard.steps.price_list"),component:r().createElement(W,null)},{id:3,name:e("cost_models_wizard.steps.markup"),component:r().createElement(z,null)},{id:4,name:e("cost_models_wizard.steps.sources"),component:r().createElement(ne,null)},{id:5,name:e("cost_models_wizard.steps.review"),component:r().createElement(Z,null)}]}),oe={"":[()=>!1],AWS:[e=>null===le(e.name)&&null===re(e.description)&&""!==e.type,e=>""!==e.markup&&!isNaN(Number(e.markup)),()=>!0,()=>!0],AZURE:[e=>null===le(e.name)&&null===re(e.description)&&""!==e.type,e=>""!==e.markup&&!isNaN(Number(e.markup)),()=>!0,()=>!0],GCP:[e=>null===le(e.name)&&null===re(e.description)&&""!==e.type,e=>""!==e.markup&&!isNaN(Number(e.markup)),()=>!0,()=>!0],OCP:[e=>null===le(e.name)&&null===re(e.description)&&""!==e.type,e=>e.priceListCurrent.justSaved,e=>""!==e.markup&&!isNaN(Number(e.markup)),()=>!0,()=>!0]},ie=(0,b.withTranslation)()((({t:e,isProcess:t,isSuccess:a,closeFnc:l,isOpen:s,onMove:o,validators:i,steps:c,current:m=1,context:u,setError:d,setSuccess:p,updateCostModel:g})=>{const _=c.map(((e,t)=>Object.assign(Object.assign({},e),{canJumpTo:m>t})));_[m-1].enableNext=i[m-1](u);const h="OCP"===u.type&&2===m&&!i[m-1](u);return m===c.length&&""!==u.type&&(_[m-1].nextButtonText=e("cost_models_wizard.review.create_button")),s?r().createElement(n.Wizard,{isOpen:!0,title:e("cost_models_wizard.title"),description:e("cost_models_wizard.description"),steps:_,startAtStep:m,onNext:o,onBack:o,onGoToStep:o,onClose:l,footer:a||t||h?r().createElement("div",null):null,onSave:()=>{const{name:e,type:t,tiers:a,markup:n,description:l,sources:r}=u;(0,y.Rl)({name:e,source_type:t,description:l,rates:a,markup:{value:n,unit:"percent"},source_uuids:r.map((e=>e.uuid))}).then((()=>{p(),g()})).catch((e=>d((0,w.L)(e))))}}):null})),ce={step:1,type:"",name:"",dirtyName:!1,description:"",markup:"0.00",filterName:"",sources:[],error:null,apiError:null,dataFetched:!1,query:{},page:1,perPage:10,total:0,loading:!1,tiers:[],priceListCurrent:{metric:"",measurement:"",rate:"",justSaved:!0},priceListPagination:{page:1,perPage:10},createError:null,createSuccess:!1,createProcess:!1,isDialogOpen:!1};class me extends r().Component{constructor(){super(...arguments),this.state=ce}render(){const{metricsHash:e,t}=this.props,a=()=>{this.setState({isDialogOpen:!1},this.props.openWizard)},l=r().createElement(n.Button,{key:"cancel",variant:"link",onClick:a},t("cost_models_wizard.confirm.cancel")),s=r().createElement(n.Button,{key:"ok",variant:"primary",onClick:()=>this.setState(Object.assign({},ce))},t("cost_models_wizard.confirm.ok"));return r().createElement(v.Provider,{value:{metricsHash:e,step:this.state.step,type:this.state.type,onTypeChange:e=>this.setState({type:e,dataFetched:!1,loading:!1}),name:this.state.name,dirtyName:this.state.dirtyName,onNameChange:e=>this.setState({name:e,dirtyName:!0}),description:this.state.description,onDescChange:e=>this.setState({description:e}),markup:this.state.markup,onMarkupChange:e=>{const t=Number(e),a=e.split("").findIndex((e=>"."===e));!isNaN(t)&&a>-1&&e.length-a-1>2?this.setState({markup:(0,T.Bw)(t,"markup",{fractionDigits:2})}):this.setState({markup:e})},error:this.state.error,apiError:this.state.apiError,sources:this.state.sources,dataFetched:this.state.dataFetched,setSources:e=>this.setState({sources:e,dataFetched:!0,loading:!1}),onSourceSelect:(e,t)=>{if(-1===e)return this.setState({sources:this.state.sources.map((e=>Object.assign(Object.assign({},e),{selected:t})))});const a=[...this.state.sources];return a[e].selected=t,this.setState({sources:a})},total:this.state.total,page:this.state.page,onPageChange:(e,t)=>this.setState({page:t}),onPerPageChange:(e,t)=>this.setState({page:1,perPage:t}),perPage:this.state.perPage,filterName:this.state.filterName,onFilterChange:e=>this.setState({filterName:e}),query:this.state.query,clearQuery:()=>this.setState({query:{}}),loading:this.state.loading,tiers:this.state.tiers,submitTiers:e=>{this.setState({tiers:e})},priceListPagination:{page:this.state.priceListPagination.page,perPage:this.state.priceListPagination.perPage,onPageSet:(e,t)=>this.setState({priceListPagination:Object.assign(Object.assign({},this.state.priceListPagination),{page:t})}),onPerPageSet:(e,t)=>this.setState({priceListPagination:{page:1,perPage:t}})},goToAddPL:e=>this.setState({priceListCurrent:Object.assign(Object.assign({},this.state.priceListCurrent),{justSaved:e||!1})}),fetchSources:(e,t,a,n)=>{this.setState({loading:!0,apiError:null,filterName:""},(()=>(({type:e,page:t,perPage:a,query:n})=>{const l=(t-1)*a,r=a,s=Object.keys(n).reduce(((e,t)=>e?`${e}&${t}=${n[t]}`:`${t}=${n[t]}`),"");return(0,C.l)(`type=${e}&limit=${r}&offset=${l}&${s}`).then((e=>e.data.data)).then((e=>e.map((e=>({name:e.name,uuid:e.uuid,costmodel:e.cost_models.map((e=>e.name)).join(","),selected:!1})))))})({type:e,query:t,page:a,perPage:n}).then((e=>this.setState({sources:e,query:t,page:a,perPage:n,loading:!1,dataFetched:!0,filterName:""}))).catch((e=>this.setState({apiError:e,loading:!1,dataFetched:!0,filterName:""})))))},createSuccess:this.state.createSuccess,createError:this.state.createError,createProcess:this.state.createProcess,onClose:()=>this.setState(Object.assign({},ce),this.props.closeWizard)}},r().createElement(ie,{metricsHash:e,isProcess:this.state.createProcess,isSuccess:this.state.createSuccess,closeFnc:()=>{"OCP"===this.state.type&&this.state.step>1&&this.state.tiers.length>0||"OCP"!==this.state.type&&this.state.step>2?this.setState({isDialogOpen:!0},this.props.closeWizard):this.setState(Object.assign({},ce),this.props.closeWizard)},isOpen:this.props.isOpen,onMove:e=>this.setState({step:Number(e.id)}),steps:se(t)[this.state.type],current:this.state.step,validators:oe[this.state.type],setError:e=>this.setState({createError:e}),setSuccess:()=>this.setState({createError:null,createSuccess:!0}),updateCostModel:()=>this.props.fetch(),context:{name:this.state.name,type:this.state.type,description:this.state.description,markup:this.state.markup,tiers:this.state.tiers,priceListCurrent:this.state.priceListCurrent,sources:this.state.sources.filter((e=>e.selected))}}),r().createElement(n.Modal,{"aria-label":t("cost_models_wizard.confirm.title"),isOpen:this.state.isDialogOpen,header:r().createElement(n.Title,{headingLevel:"h1",size:n.TitleSizes["2xl"]},r().createElement(E.LP,{color:"orange"})," ",t("cost_models_wizard.confirm.title")),onClose:a,actions:[s,l],variant:"small"},t("cost_models_wizard.confirm.message")))}}const ue=(0,s.connect)((0,S.X1)((e=>({metricsHash:i.qw.metrics(e)}))),{fetch:o.F0.fetchCostModels})((0,b.withTranslation)()(me)),de=(0,b.withTranslation)()((0,s.connect)((e=>({canWrite:c.c5.isCostModelWritePermission(e)})),(e=>({openWizard:()=>e(o.F0.setCostModelDialog({name:"createWizard",isOpen:!0})),closeWizard:()=>e(o.F0.setCostModelDialog({name:"createWizard",isOpen:!1}))})),((e,t,a)=>{const{t:l}=a,{canWrite:s}=e,{openWizard:o}=t;return{isDisabled:!s,tooltip:l("cost_models.read_only_tooltip"),children:r().createElement(n.Button,{isDisabled:!s,onClick:o},l("page_cost_models.create_cost_model"))}}))(h.j)),pe=(0,s.connect)((e=>({isOpen:o.E6.isDialogOpen(e)("costmodel").createWizard})),(e=>({openWizard:()=>{e(o.F0.setCostModelDialog({name:"createWizard",isOpen:!0}))},closeWizard:()=>{e(o.F0.setCostModelDialog({name:"createWizard",isOpen:!1}))}})),((e,t)=>{const{isOpen:a}=e,{openWizard:n,closeWizard:l}=t;return{isOpen:a,openWizard:n,closeWizard:l}}))(ue);function ge({head:e,body:t,sources:a}){return r().createElement(n.Stack,{hasGutter:!0},r().createElement(n.StackItem,null,r().createElement(n.TextContent,null,r().createElement(n.Text,null,e))),r().createElement(n.StackItem,null,r().createElement(n.TextContent,null,r().createElement(n.Text,null,t),r().createElement(n.TextList,{component:n.TextListVariants.ol},a.map((e=>r().createElement(n.TextListItem,{key:e},e)))))))}const _e=(0,b.withTranslation)()((0,s.connect)((e=>({isOpen:o.E6.isDialogOpen(e)("costmodel").deleteCostModel,isLoading:o.E6.deleteProcessing(e),deleteError:o.E6.deleteError(e),dialogData:o.E6.dialogData(e)})),(e=>({closeDialog:()=>e(o.F0.setCostModelDialog({name:"deleteCostModel",isOpen:!1})),deleteCostModel:t=>o.F0.deleteCostModel(t,"deleteCostModel")(e)})),((e,t,a)=>{const{t:l}=a,s=(o=e.isLoading,i=e.isOpen,c=e.deleteError,i?o?"loading":c?"failure":"open":"close");var o,i,c;const m=e.dialogData&&e.dialogData.costModel?e.dialogData.costModel:null,u=m?m.name:"",d=m?m.sources.map((e=>e.name)):[],p=m?m.uuid:"",g=function({status:e,deleteText:t,deleteAction:a,cancelText:l,cancelAction:s,sourcesNo:o}){let i=[];return"loading"===e&&(i=[r().createElement(n.Button,{key:"pending_delete",variant:n.ButtonVariant.danger,isDisabled:!0},t),r().createElement(n.Button,{key:"pending_cancel",variant:n.ButtonVariant.link,isDisabled:!0},l)]),["failure","open"].includes(e)&&o>0&&(i=[r().createElement(n.Button,{key:"sources_cancel",variant:n.ButtonVariant.link,onClick:s},l)]),["failure","open"].includes(e)&&0===o&&(i=[r().createElement(n.Button,{key:"delete",variant:n.ButtonVariant.danger,onClick:a},t),r().createElement(n.Button,{key:"cancel",variant:n.ButtonVariant.link,onClick:s},l)]),i}({status:s,deleteText:l("page_cost_models.delete_cost_model"),deleteAction:()=>t.deleteCostModel(p),cancelText:l("page_cost_models.cancel"),cancelAction:t.closeDialog,sourcesNo:d.length}),_=function({status:e,sources:t,error:a,cannotDeleteTitle:l,cannotDeleteBody:s,canDeleteBody:o}){return"close"!==e&&t.length>0?r().createElement(ge,{head:l,body:s,sources:t}):"close"!==e&&0===t.length?r().createElement(n.Stack,{hasGutter:!0},"failure"===e?r().createElement(n.StackItem,null,r().createElement(n.Alert,{variant:n.AlertVariant.danger,title:a})):null,r().createElement(n.StackItem,null,o)):void 0}({status:s,sources:d,error:e.deleteError,cannotDeleteTitle:l("page_cost_models.cannot_delete_description_head"),cannotDeleteBody:l("page_cost_models.cannot_delete_description_body",{name:u}),canDeleteBody:l("page_cost_models.can_delete_description",{name:u})});return{actions:g,isOpen:"close"!==s,variant:n.ModalVariant.small,"aria-label":"delete-cost-model",title:l("page_cost_models.delete_title"),titleIconVariant:"warning",onClose:t.closeDialog,children:_}}))(n.Modal));var he=a(55795);const Ee=(0,b.withTranslation)()((0,s.connect)(((e,t)=>{const{t:a}=t;return{children:r().createElement(r().Fragment,null,a("page_cost_models.header_title"),r().createElement(n.Popover,{"aria-label":"page header popver",bodyContent:a("page_cost_models.header_popover"),enableFlip:!0},r().createElement(n.Button,{variant:n.ButtonVariant.plain},r().createElement(he.iC,null))))}}))((function({children:e}){return r().createElement(n.TextContent,null,r().createElement(n.Title,{headingLevel:"h1",size:"2xl"},e))})));var ye=a(20167),be=a(40610),Se=a(48507),Te=a.n(Se);const Ce=function(e){return r().createElement(n.EmptyState,{className:"pf-m-redhat-font"},r().createElement(n.EmptyStateIcon,{icon:e.icon}),r().createElement(n.Title,{headingLevel:"h2",size:"lg"},e.title),r().createElement(n.EmptyStateBody,null,e.description),e.actions?e.actions:null)},ve=Te()((()=>{const{t:e}=(0,b.useTranslation)();return{title:e("page_cost_models.no_cost_models_title"),description:e("page_cost_models.no_cost_models_description"),icon:j.wl,actions:r().createElement(de,null)}}))(Ce),we=Te()((()=>{const{t:e}=(0,b.useTranslation)();return{title:e("empty_filter_state.title"),description:e("empty_filter_state.subtitle"),icon:X.W1}}))(Ce),fe=(0,m.withRouter)((0,b.withTranslation)()((0,s.connect)((e=>({canWrite:c.c5.isCostModelWritePermission(e),query:o.E6.query(e),costData:o.E6.costModels(e),stateName:o.E6.stateName(e)})),(e=>{const t=o.F0.setCostModelDialog;return{openDeleteDialog:a=>e(t({name:"deleteCostModel",isOpen:!0,meta:a}))}}),((e,t,a)=>{const{t:l,history:{push:s}}=a,o=[{title:l("page_cost_models.name"),transforms:[u.sortable],data:{orderName:"name"}},{title:l("page_cost_models.description")},{title:l("page_cost_models.source_type"),transforms:[u.sortable],data:{orderName:"source_type"}},{title:l("page_cost_models.assigned_sources")},{title:l("page_cost_models.last_change"),transforms:[u.sortable],data:{orderName:"updated_timestamp"}}],i=function(e,t){const{ordering:a}=e;if(null===a)return{};const n="-"===a[0]?a.slice(1):a,l="-"===a[0]?u.SortByDirection.desc:u.SortByDirection.asc;return{index:t.findIndex((e=>e.data&&e.data.orderName===n)),direction:l}}(e.query,o),c=function(e,t,a){return function(n,l,r){const s=e[l]&&e[l].data?e[l].data.orderName:null;null!==s&&(r!==u.SortByDirection.asc?a(p(Object.assign(Object.assign({},t),{ordering:`-${s}`}))):a(p(Object.assign(Object.assign({},t),{ordering:s}))))}}(o,e.query,s);return{"aria-label":"cost-models",cells:o,rows:function(e,t){let a=null;return"loading"===e&&(a=r().createElement(U.G,null)),"empty"===e&&(a=r().createElement(ve,null)),"no-match"===e&&(a=r().createElement(we,null)),"failure"===e&&(a=r().createElement(ye.Z,null)),null!==a?[{heightAuto:!0,cells:[{props:{colSpan:8},title:r().createElement(n.Bullseye,null," ",a," ")}]}]:t.map((e=>({cells:[{title:r().createElement(m.Link,{to:`/cost-models/${e.uuid}`},e.name)},e.description,e.source_type,e.sources.length.toString(),(0,be.relativeTime)(e.updated_timestamp)],data:{costModel:e}})))}(e.stateName,e.costData),sortBy:i,onSort:c,actions:(d=e.stateName,g=e.canWrite,_=[{title:l("page_cost_models.delete"),tooltip:l("cost_models.read_only_tooltip"),onClick:(e,a,n)=>{t.openDeleteDialog(n.data)}}],"success"!==d?[]:_.map((e=>Object.assign(Object.assign({},e),{isDisabled:!g,style:g?void 0:{pointerEvents:"auto"},tooltip:g?void 0:e.tooltip}))))};var d,g,_}))((function(e){return r().createElement(n.PageSection,{variant:n.PageSectionVariants.light},r().createElement(u.Table,{gridBreakPoint:u.TableGridBreakpoint.grid2xl,actions:e.actions,actionResolver:e.actionResolver,rows:e.rows,cells:e.cells,onSort:e.onSort,sortBy:e.sortBy,"aria-label":e["aria-label"]},r().createElement(u.TableHeader,null),r().createElement(u.TableBody,null)))})))),Pe=(e,t,a,n)=>l=>{if("Enter"===l.key&&""!==n.value){const l=n.value;e(p(Object.assign(Object.assign({},a),{[t]:a[t]?`${a[t]},${l}`:l}))),n.setValue("")}},ke=(e,t,a)=>(n,l)=>{const r=a[t]?a[t].split(",").filter((e=>e!==l)):null;e(p(Object.assign(Object.assign({},a),{[t]:null===r||0===r.length?null:r.join(",")})))},xe=(e,t,a)=>()=>{e(p(Object.assign(Object.assign({},t),{[a]:null})))},ze=(0,s.connect)((e=>({filterType:o.E6.currentFilterType(e),query:o.E6.query(e)})),void 0,((e,t,a)=>{const{t:l,value:s,setValue:o,history:{push:i}}=a,{filterType:c,query:m}=e,u="description"===c?r().createElement(n.SearchInput,{onClear:()=>{o("")},placeholder:l("page_cost_models.filter_by_description"),value:s,onChange:e=>{o(e)},onKeyPress:Pe(i,"description",Object.assign(Object.assign({},d),m),{value:s,setValue:o})}):null,p=m.description?m.description.split(","):[];return{deleteChip:ke(i,"description",Object.assign(Object.assign({},d),m)),deleteChipGroup:xe(i,Object.assign(Object.assign({},d),m),"description"),chips:p,categoryName:l("page_cost_models.description"),children:u}}))(n.ToolbarFilter),Oe=Te()((()=>{const[e,t]=r().useState("");return{value:e,setValue:t}}))((0,m.withRouter)((0,b.withTranslation)()(ze))),Ie=(0,s.connect)((e=>({filterType:o.E6.currentFilterType(e),query:o.E6.query(e)})),void 0,((e,t,a)=>{const{t:l,setValue:s,value:o,history:{push:i}}=a,{filterType:c,query:m}=e,u="name"===c?r().createElement(n.SearchInput,{onClear:()=>s(""),placeholder:l("page_cost_models.filter_by_name"),value:o,onChange:e=>s(e),onKeyPress:Pe(i,"name",Object.assign(Object.assign({},d),m),{setValue:s,value:o})}):null,p=m.name?m.name.split(","):[];return{deleteChip:ke(i,"name",Object.assign(Object.assign({},d),m)),deleteChipGroup:xe(i,Object.assign(Object.assign({},d),m),"name"),chips:p,categoryName:l("page_cost_models.name"),children:u}}))(n.ToolbarFilter),je=Te()((()=>{const[e,t]=r().useState("");return{value:e,setValue:t}}))((0,m.withRouter)((0,b.withTranslation)()(Ie))),De=(e,t)=>()=>{t(!1);const a=document.getElementById(e);a&&a.focus()},Fe=(0,s.connect)((e=>({filterType:o.E6.currentFilterType(e),query:o.E6.query(e)})),void 0,((e,t,a)=>{const l="source-type-filter",{t:s,isOpen:o,setIsOpen:i,history:{push:c}}=a,{filterType:m,query:u}=e,g=e=>c(p(Object.assign(Object.assign(Object.assign({},d),u),{source_type:e}))),_="sourceType"===m?r().createElement(n.Dropdown,{onSelect:De(l,i),isOpen:o,toggle:r().createElement(n.DropdownToggle,{onToggle:e=>{i(e)},id:l},s("page_cost_models.filter_by_source_type")),dropdownItems:[r().createElement(n.DropdownItem,{key:"aws",component:"button",onClick:()=>g("aws")},s("page_cost_models.aws")),r().createElement(n.DropdownItem,{key:"azure",component:"button",onClick:()=>g("azure")},s("page_cost_models.azure")),r().createElement(n.DropdownItem,{key:"ocp",component:"button",onClick:()=>g("ocp")},s("page_cost_models.ocp"))]}):null,h=u.source_type?[u.source_type]:[];return{deleteChip:xe(c,Object.assign(Object.assign({},d),u),"source_type"),chips:h,categoryName:s("page_cost_models.source_type"),children:_}}))(n.ToolbarFilter),Le=Te()((()=>{const[e,t]=r().useState(!1);return{isOpen:e,setIsOpen:t}}))((0,m.withRouter)((0,b.withTranslation)()(Fe))),Ne=(0,m.withRouter)((0,s.connect)((e=>({query:o.E6.query(e)})),void 0,((e,t,a)=>{const{history:{push:n}}=a,{query:l}=e;return{id:"cost-models-toolbar",clearAllFilters:()=>n(p(Object.assign(Object.assign(Object.assign({},d),l),{description:null,source_type:null,name:null}))),children:a.children}}))(n.Toolbar));var Be=a(8755);const Ve=Te()((()=>{const[e,t]=r().useState(!1);return{isOpen:e,setIsOpen:t}}))((0,b.withTranslation)()((0,s.connect)((e=>({filterType:o.E6.currentFilterType(e)})),(e=>({updateFilterType:t=>{e(o.F0.updateFilterToolbar({currentFilterType:t}))}})),((e,t,a)=>{const{t:l}=a,s=[r().createElement(n.SelectOption,{key:"name",value:"name"},l("page_cost_models.name")),r().createElement(n.SelectOption,{key:"description",value:"description"},l("page_cost_models.description")),r().createElement(n.SelectOption,{key:"sourceType",value:"sourceType"},l("page_cost_models.source_type"))];return{variant:n.SelectVariant.single,selections:e.filterType,onToggle:a.setIsOpen,isOpen:a.isOpen,onSelect:(e,n)=>{t.updateFilterType(n),a.setIsOpen(!1)},children:s,toggleIcon:r().createElement(Be.k1,null)}}))(n.Select))),qe=(0,m.withRouter)((0,s.connect)((e=>{const{count:t,page:a,perPage:n}=o.E6.pagination(e);return{count:t,page:a,perPage:n,query:o.E6.query(e)}}),void 0,((e,t,a)=>{const{history:{push:l}}=a,{count:r,page:s,perPage:o,query:i}=e;return{isCompact:!0,itemCount:r,page:s,perPage:o,variant:n.PaginationVariant.top,onSetPage:(e,t,a)=>{l(p(Object.assign(Object.assign(Object.assign({},d),i),{offset:g(t,a)})))},onPerPageSelect:(e,t)=>{l(p(Object.assign(Object.assign(Object.assign({},d),i),{limit:t,offset:0})))}}}))(n.Pagination)),Me=()=>r().createElement(Ne,null,r().createElement(n.ToolbarContent,null,r().createElement(n.ToolbarGroup,{variant:"filter-group"},r().createElement(n.ToolbarItem,null,r().createElement(Ve,null)),r().createElement(n.ToolbarItem,null,r().createElement(je,null),r().createElement(Oe,null),r().createElement(Le,null)),r().createElement(n.ToolbarItem,null,r().createElement(de,null))),r().createElement(n.ToolbarItem,{variant:n.ToolbarItemVariant.pagination},r().createElement(qe,null))));class Ae extends r().Component{componentDidMount(){this.props.getCostModelsData(this.props.search.slice(1)),this.props.getRbacData(),this.props.getMetricsData()}componentDidUpdate(e){e.search!==this.props.search&&this.props.getCostModelsData(this.props.search.slice(1))}render(){return r().createElement(r().Fragment,null,r().createElement(n.PageSection,{variant:n.PageSectionVariants.light},r().createElement(Ee,null)),r().createElement(n.PageSection,{isFilled:!0},r().createElement(pe,null),r().createElement(_e,null),r().createElement(Me,null),r().createElement(fe,null),r().createElement(_,null)))}}const Re=(0,s.connect)(((e,t)=>({search:t.location.search})),(e=>({getCostModelsData:t=>o.F0.fetchCostModels(t)(e),getRbacData:()=>c.O9.fetchRbac()(e),getMetricsData:()=>i.Wg.fetchMetrics()(e)})))(Ae)}}]);
//# sourceMappingURL=a258a00a349b3a6c4678.bundle.js.map